(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[854],{71878:function(f,b,r){"use strict";var h=r(65557),a=r(19534);Object.defineProperty(b,"__esModule",{value:!0}),b.default=b.IdentifyActiveEvent=void 0;var u=a(r(28866)),o=a(r(78756)),l=a(r(42579)),s=a(r(42762)),m=a(r(22777)),y=a(r(30044)),$=a(r(99085)),v=a(r(34009)),D=a(r(7165)),E=a(r(12207));function M(A){var R=x();return function(){var c=(0,v.default)(A),I;if(R){var g=(0,v.default)(this).constructor;I=h(c,arguments,g)}else I=c.apply(this,arguments);return(0,$.default)(this,I)}}function x(){if(typeof Reflect>"u"||!h||h.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(h(Boolean,[],function(){})),!0}catch{return!1}}var L={CHANGEACTIVE:"change:active"},O=function(A){(0,y.default)(P,A);var R=M(P);function P(c,I){var g;return(0,m.default)(this,P),g=R.call(this,c),g.active=I,g}return(0,s.default)(P)}(E.default);b.IdentifyActiveEvent=O;var B=function(A){(0,y.default)(P,A);var R=M(P);function P(c,I){var g;return(0,m.default)(this,P),g=R.call(this),g.active=!1,g.map=c,g.earth=I,g._initIdentify(),g}return(0,s.default)(P,[{key:"_initIdentify",value:function(){var I=this,g=[];(0,u.default)(this)&&g.push(new o.default(function(W){var z=this;(0,l.default)(this,I),Promise.all([r.e(2002),r.e(2551),r.e(1381),r.e(5075)]).then(r.bind(r,75075)).then(function(N){var T=this;(0,l.default)(this,z);var Z=N.default;this.mapIdentify=new Z((0,u.default)(this)),this.mapIdentify.on("identifyed",function(V){(0,l.default)(this,T),this.dispatchEvent(V)}.bind(this)),this.mapIdentify.on("identifyedAll",function(V){(0,l.default)(this,T),this.dispatchEvent(V)}.bind(this)),W()}.bind(this))}.bind(this))),this.earth&&g.push(new o.default(function(W){var z=this;(0,l.default)(this,I),Promise.all([r.e(2002),r.e(8890),r.e(3503),r.e(7661),r.e(5810),r.e(3719),r.e(2551),r.e(1381),r.e(6393)]).then(r.bind(r,26393)).then(function(N){var T=this;(0,l.default)(this,z);var Z=N.default;this.earthIdentify=new Z(this.earth),this.earthIdentify.on("identifyed3d",function(V){(0,l.default)(this,T),this.dispatchEvent(V)}.bind(this)),this.earthIdentify.on("identifyedAll3d",function(V){(0,l.default)(this,T),this.dispatchEvent(V)}.bind(this)),W()}.bind(this))}.bind(this))),o.default.all(g).then(function(){(0,l.default)(this,I),this.dispatchEvent({type:"inited"})}.bind(this))}},{key:"init",value:function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"click";(0,u.default)(this)&&this.mapIdentify.init(I),this.earth&&this.earthIdentify.init(I),this.active=!0,this.dispatchEvent(new O(L.CHANGEACTIVE,this.active,I))}},{key:"clearHighLight",value:function(){var I=this.getCurrentView();I==="map"&&this.mapIdentify.clearHighLight(),I==="earth"&&this.earthIdentify.clearHighLight()}},{key:"highLightFeature",value:function(I){var g=this.getCurrentView();g==="map"&&this.mapIdentify.highLightFeature(I),g==="earth"&&this.earthIdentify.highLightFeature(I)}},{key:"setActive",value:function(I){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"click";I?(this.active&&this.cancel(),this.init(g)):this.active&&this.cancel()}},{key:"cancel",value:function(){(0,u.default)(this)&&this.mapIdentify.cancel(),this.earth&&this.earthIdentify.cancel(),this.active=!1,this.dispatchEvent(new O(L.CHANGEACTIVE,this.active))}},{key:"getCurrentView",value:function(){if((0,u.default)(this))if(this.earth){var I=(0,u.default)(this).getContainer().style.display!=="none";return I?"map":"earth"}else return"map";else return"earth"}}]),P}(D.default),F=B;b.default=F},21963:function(f,b,r){var h=r(49500);f.exports=function(a){var u={};function o(l){if(u[l])return u[l].exports;var s=u[l]={i:l,l:!1,exports:{}};return a[l].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=a,o.c=u,o.d=function(l,s,m){o.o(l,s)||Object.defineProperty(l,s,{enumerable:!0,get:m})},o.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},o.t=function(l,s){if(s&1&&(l=o(l)),s&8||s&4&&typeof l=="object"&&l&&l.__esModule)return l;var m=Object.create(null);if(o.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:l}),s&2&&typeof l!="string")for(var y in l)o.d(m,y,function($){return l[$]}.bind(null,y));return m},o.n=function(l){var s=l&&l.__esModule?function(){return l.default}:function(){return l};return o.d(s,"a",s),s},o.o=function(l,s){return Object.prototype.hasOwnProperty.call(l,s)},o.p="/dist/",o(o.s=749)}({0:function(a,u){a.exports=r(42579)},1:function(a,u){a.exports=r(28866)},11:function(a,u){a.exports=r(20314)},17:function(a,u){a.exports=r(85208)},18:function(a,u){a.exports=r(59791)},19:function(a,u){a.exports=r(83393)},2:function(a,u,o){"use strict";o.d(u,"a",function(){return l});function l(s,m,y,$,v,D,E,M){var x=typeof s=="function"?s.options:s;m&&(x.render=m,x.staticRenderFns=y,x._compiled=!0),$&&(x.functional=!0),D&&(x._scopeId="data-v-"+D);var L;if(E?(L=function(F){F=F||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!F&&typeof __VUE_SSR_CONTEXT__<"u"&&(F=__VUE_SSR_CONTEXT__),v&&v.call(this,F),F&&F._registeredComponents&&F._registeredComponents.add(E)},x._ssrRegister=L):v&&(L=M?function(){v.call(this,(x.functional?this.parent:this).$root.$options.shadowRoot)}:v),L)if(x.functional){x._injectStyles=L;var O=x.render;x.render=function(A,R){return L.call(R),O(A,R)}}else{var B=x.beforeCreate;x.beforeCreate=B?[].concat(B,L):[L]}return{exports:s,options:x}}},20:function(a,u){a.exports=r(5077)},21:function(a,u){a.exports=r(81806)},24:function(a,u){a.exports=r(52909)},25:function(a,u){a.exports=r(43389)},28:function(a,u){a.exports=r(32726)},30:function(a,u){a.exports=r(32569)},32:function(a,u){a.exports=r(17745)},35:function(a,u){a.exports=r(49162)},357:function(a,u){a.exports=r(25794)},38:function(a,u){a.exports=r(26541)},39:function(a,u){a.exports=r(26352)},40:function(a,u){a.exports=r(40639)},41:function(a,u){a.exports=r(43586)},43:function(a,u){a.exports=r(47806)},453:function(a,u){a.exports=r(71878)},454:function(a,u){a.exports=r(75420)},455:function(a,u){a.exports=r(66880)},456:function(a,u){a.exports=r(12768)},517:function(a,u){a.exports=r(35156)},54:function(a,u){a.exports=r(1117)},6:function(a,u){a.exports=r(83574)},60:function(a,u){a.exports=r(8421)},61:function(a,u){a.exports=r(19457)},7:function(a,u){a.exports=r(17249)},749:function(a,u,o){"use strict";o.r(u);var l=o(0),s=o.n(l),m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sh-identify-popup"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],staticClass:"button-container"},[t.$slots.default?i("span",{on:{click:function(){return t.toggle()}}},[t._t("default")],2):i("general-button",{attrs:{theme:t.theme,"is-column":t.isColumn,position:t.position,"icon-class":t.iconClass?t.iconClass:"identify-popup",active:t.active,"show-img":t.showImg,"show-label":t.showLabel,"drag-enable":t.dragEnable,"theme-style":t.themeStyle,title:t.title?t.title:"\u67E5\u8BE2"},on:{click:function(){return t.toggle()}}}),t.ready&&(t.viewMode==="23D"||t.viewMode==="2D")?i("MapPopup",{ref:"mapPopup",attrs:{active:t.active,identify:t.identify,"color-config":t.colorConfig,"bind-feature":t.defaultBindFeature,stripe:t.stripe,border:t.border,"stripe-color":t.stripeColor.map,"bind-mode-button":t.bindModeButton,"lock-button":t.lockButton,"popup-card-props":t.popupCardProps,"disabled-popup":t.disabledPopup},on:{"change:feature":t.onChangeFeature,close:t.onClose},scopedSlots:t._u([{key:"popup",fn:function(n){return[t._t("popup",null,null,n)]}},{key:"cardExtend",fn:function(){return[t._t("cardExtend")]},proxy:!0}],null,!0)},[t._t("mapPopup")],2):t._e(),t.ready&&(t.viewMode==="23D"||t.viewMode==="3D")?i("EarthPopup",{ref:"earthPopup",attrs:{active:t.active,identify:t.identify,"bind-feature":t.defaultBindFeature,stripe:t.stripe,border:t.border,"stripe-color":t.stripeColor.earth,"bind-mode-button":t.bindModeButton,"lock-button":t.lockButton,"popup-card-props":t.popupCardProps,"disabled-popup":t.disabledPopup},on:{"change:feature":t.onChangeFeature,close:t.onClose},scopedSlots:t._u([{key:"popup",fn:function(n){return[t._t("popup",null,null,n)]}},{key:"cardExtend",fn:function(){return[t._t("cardExtend")]},proxy:!0}],null,!0)},[t._t("earthPopup")],2):t._e()],1),t.panelShouldShow?i("general-container",{staticStyle:{left:"100px",top:"50px"},attrs:{"style-config":t.panelStyleConfig,position:t.panelPosition,theme:"light",title:t.panelTitle?t.panelTitle:"\u67E5\u8BE2","img-src":t.panelImgSrc?t.panelImgSrc:"identify-popup"},on:{"change:isShow":t.changeIsShow}},[i("el-tabs",{class:["panel-tabs",{"only-one":t.panelConfig.length<2}],model:{value:t.currentTab,callback:function(n){t.currentTab=n},expression:"currentTab"}},[i("el-tab-pane",{attrs:{label:"\u67E5\u8BE2\u65B9\u5F0F",name:"type"}},[t.currentTab==="type"?i("TypeCard",{attrs:{"current-query-type":t.queryType},on:{"update:currentQueryType":function(n){t.queryType=n},"update:current-query-type":function(n){t.queryType=n}}}):t._e()],1),i("el-tab-pane",{attrs:{label:"\u7F13\u51B2\u533A\u67E5\u8BE2",name:"buffer"}},[t.currentTab==="buffer"?i("BufferCard",{attrs:{identify:t.identify,"current-query-type":t.queryType,"default-buffer-radius":t.defaultBufferRadius},on:{"update:currentQueryType":function(n){t.queryType=n},"update:current-query-type":function(n){t.queryType=n}}}):t._e()],1)],1)],1):t._e()],1)},y=[];m._withStripped=!0;var $=o(453),v=o.n($),D=o(6),E=o.n(D),M=o(7),x=o.n(M),L=o(60),O=o.n(L),B=o(30),F=o.n(B),A=o(61),R=o.n(A),P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"sh-map-popup",style:Object.assign({},t.themeVariables)},[t._t("default",function(){return[i("PopupCard",{attrs:{active:t.active,position:t.bindFeatureValue?t.bindPosition:t.unbindPosition,options:t.totalData,"style-config":t.styleConfig,"img-src":t.imgSrc,"bind-feature":t.bindFeatureValue,stripe:t.stripe,border:t.border,"bind-mode-button":t.bindModeButton,"lock-button":t.lockButton},on:{"change:feature":t.onChangeFeature,"change:connectMode":t.onConnectModeChange,"change:lock":t.onChangeLock,zoom:t.onZoom,close:t.onClose},scopedSlots:t._u([{key:"default",fn:function(n){return[t._t("popup",null,null,n)]}},{key:"cardExtend",fn:function(){return[t._t("cardExtend")]},proxy:!0}],null,!0)},[t._t("popup")],2)]})],2)},c=[];P._withStripped=!0;var I=o(17),g=o.n(I),W=o(18),z=o.n(W),N=o(19),T=o.n(N),Z=o(20),V=o.n(Z),Vt=o(25),st=o.n(Vt),Ht=o(38),ht=o.n(Ht),zt=o(8),q=o.n(zt),ct=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("GeneralCard",{ref:"card",staticClass:"sh-popup-card",class:{bind:t.bindFeature,multi:t.layerList.length>1},attrs:{"drag-enable":!t.bindFeature,"style-config":t.styleConfig,position:t.position,"img-src":t.imgSrc?t.imgSrc:"identify-popup",theme:t.theme},on:{"change:isShow":t.onChange}},[i("template",{slot:"title"},[t.layerList.length>1?i("el-select",{staticClass:"select",attrs:{placeholder:"\u8BF7\u9009\u62E9\u56FE\u5C42",size:"mini","popper-append-to-body":!1},model:{value:t.currentLayerId,callback:function(n){t.currentLayerId=n},expression:"currentLayerId"}},[i("template",{slot:"prefix"},[i("IconSvg",{style:{margin:"9px 0"},attrs:{height:"14px",width:"14px",fillcolor:"var(--sh-color-text-primary)","icon-class":"layer-manager-layer"}})],1),t._l(t.layerList,function(n){return i("el-option",{key:n.id,attrs:{label:n.label,value:n.id}},[i("span",[t._v(t._s(n.label))]),i("el-badge",{staticClass:"mark",attrs:{size:"small",max:99,value:n.count}})],1)})],2):[t._v(t._s(t.layerList[0]?t.layerList[0].label:""))]],2),i("template",{slot:"extBtn"},[t.bindModeButton?i("el-tooltip",{attrs:{content:t.bindFeature?"\u4E0D\u505C\u9760":"\u505C\u9760",placement:"top","open-delay":50}},[i("i",{staticClass:"connection-btn el-icon-connection",on:{click:t.onConnectModeChange}})]):t._e(),t.lockButton?i("el-tooltip",{attrs:{content:t.lock?"\u53D6\u6D88\u9501\u5B9A":"\u9501\u5B9A\u5F53\u524D\u67E5\u8BE2",placement:"top","open-delay":50}},[i("IconSvg",{attrs:{height:"16px",width:"16px",fillcolor:t.lock?"#FF5E67":"var(--sh-color-text-primary)","icon-class":"lock"},nativeOn:{click:function(n){return t.onChangeLock.apply(null,arguments)}}})],1):t._e()],1),i("div",{staticClass:"info-container"},[i("el-scrollbar",{staticClass:"table-scrollbar"},[t._t("default",function(){return[t.panelConfig.type==="default"?i("div",{staticClass:"attr-table"},[i("el-table",{attrs:{stripe:t.stripe,border:t.border,"highlight-current-row":!1,data:t.tableData,"show-header":!1}},[i("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"key",label:"\u5C5E\u6027"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"data",label:"\u6570\u503C"},scopedSlots:t._u([{key:"default",fn:function(n){return[t.isLinkFied(n.row.key)?i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(d){t.onHrefClick(t.getLinkFiedUrl(n.row.key))}}},[t._v(t._s(n.row.data))]):i("span",[t._v(t._s(n.row.data))])]}}],null,!1,2416108383)},[t._v(`>
            `)])],1)],1):t.panelConfig.type==="iframe"?i("iframe",{attrs:{src:t.panelConfig.url,frameborder:"0",width:t.panelConfig.iframeWidth,height:t.panelConfig.iframeHeight}}):t.panelConfig.type==="video"?i("div",{staticClass:"video-panel"},[i("VideoPlayer",{attrs:{options:t.videoOptions,"video-config":t.panelConfig.video}})],1):t._e()]},{result:t.currentFeature,layerInfo:t.currentLayerInfo})],2),t.$slots.cardExtend?i("div",{staticClass:"extend"},[t._t("cardExtend")],2):t._e()],1),i("el-pagination",{attrs:{"hide-on-single-page":"",layout:"prev, pager, next","page-count":t.totalPage,"pager-count":5,"current-page":t.currentPage},on:{"update:currentPage":function(n){t.currentPage=n},"update:current-page":function(n){t.currentPage=n}}}),i("div",{ref:"footer",staticClass:"info-footer"},[t.bindFeature?t._e():i("el-button",{ref:"zoomBtn",staticClass:"zoom",attrs:{type:"text",size:"small",icon:"el-icon-position"},on:{click:t.onZoom}},[t._v("\u7F29\u653E\u81F3")]),i("div",{ref:"links",staticClass:"links",style:{left:t.bindFeature?"15px":"85px"}},t._l(t.links,function(n,d){return i("el-button",{key:d,attrs:{type:"text",size:"small"},on:{click:function(p){return t.onFooterHrefClick(n)}}},[t._v(t._s(n.name||"\u94FE\u63A5"))])}),1)],1),t.iframePopup?i("GeneralCard",{ref:"iframeCard",attrs:{position:{type:"absolute",top:"100px",right:"200px"},title:t.iframePopup.name,"style-config":t.styleConfig,"theme-style":t.themeStyle,"img-src":t.imgSrc?t.imgSrc:"identify-popup",theme:t.theme},on:{"change:isShow":t.onIframeChangeShow}},[i("iframe",{attrs:{src:t.iframePopup.url,frameborder:"0",width:t.iframePopup.iframeWidth,height:t.iframePopup.iframeHeight}})]):t._e()],2)},Nt=[];ct._withStripped=!0;var Gt=o(24),k=o.n(Gt),Wt=o(21),Ut=o.n(Wt),Zt=o(1),Qt=o.n(Zt),Jt=o(11),Kt=o.n(Jt),Xt=o(39),Yt=o.n(Xt),kt=o(40),qt=o.n(kt),_t=o(41),te=o.n(_t),ee=o(43),ie=o.n(ee),ne=o(32),re=o.n(ne),oe=o(54),vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("video",{ref:"videoPlayer",staticClass:"video-js vjs-big-play-centered",attrs:{width:"300",height:"168.75"}}),!t.error&&t.currentView==="earth"?i("div",{staticClass:"footer"},[i("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.videoProjection}},[t._v("\u5F00\u542F\u6295\u5F71")]),i("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.destroyVideoProjection}},[t._v("\u5173\u95ED\u6295\u5F71")])],1):t._e()])},ae=[];vt._withStripped=!0;var se=o(454),ue=o.n(se),qe=o(517);function yt(t,e){var i=g()(t);if(z.a){var n=z()(t);e&&(n=q()(n).call(n,function(d){return T()(t,d).enumerable})),i.push.apply(i,n)}return i}function gt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?yt(Object(i),!0).forEach(function(n){st()(t,n,i[n])}):V.a?Object.defineProperties(t,V()(i)):yt(Object(i)).forEach(function(n){Object.defineProperty(t,n,T()(i,n))})}return t}var le={name:"ShVideoPlayer",mixins:[E.a,x.a],props:{options:{type:Object,default:function(){return{}}},videoConfig:{type:Object,default:function(){return{}}}},data:function(){return this.beforeVideoPosition=null,{error:!0}},watch:{options:{handler:function(e){this.player&&this.player.src(e.sources[0])},deep:!0}},mounted:function(){var e=this;this.player=ue()(this.$refs.videoPlayer,this.options),this.player.on("canplay",function(){s()(this,e),this.error=!1}.bind(this)),this.player.on("error",function(i){s()(this,e),h.error("error",i),this.error=!0}.bind(this))},beforeDestroy:function(){this.player&&(this.player.isInPictureInPicture()&&this.player.exitPictureInPicture(),this.player.dispose())},methods:{setCurrentPosition:function(){var e=this.$earth.getCenter(),i=this.$earth.getHeight(),n=this.$earth.getOrientation(),d=n.heading,p=n.roll,C=n.pitch;this.beforeVideoPosition={center:e,height:i,heading:d,roll:p,pitch:C}},videoProjection:function(){this.setCurrentPosition(),this.$earth.performVideoProjection(gt(gt({},this.videoConfig),{},{projection:!0,showPlayer:!1,showSketch:!1,showFrustumOutline:!1}));var e=this.videoConfig,i=e.viewPosition,n=e.viewHeading,d=e.viewPitch;this.$earth.centerAt({center:[i[0],i[1]],height:i[2],heading:n,pitch:d,roll:0})},destroyVideoProjection:function(){var e;(e=this.$earth)===null||e===void 0||e.destroyVideoProjection(),this.beforeVideoPosition&&(this.$earth.centerAt(this.beforeVideoPosition),this.beforeVideoPosition=null)}}},de=le,Q=o(2),fe=Object(Q.a)(de,vt,ae,!1,null,null,null),pe=fe.exports,he=void 0;function ut(t,e){var i=typeof qt.a<"u"&&te()(t)||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=ce(t))||e&&t&&typeof t.length=="number"){i&&(t=i);var n=0,d=function(){};return{s:d,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(j){throw j},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,C=!1,w;return{s:function(){i=i.call(t)},n:function(){var j=i.next();return p=j.done,j},e:function(j){C=!0,w=j},f:function(){try{!p&&i.return!=null&&i.return()}finally{if(C)throw w}}}}function ce(t,e){var i;if(t){if(typeof t=="string")return mt(t,e);var n=Kt()(i=Object.prototype.toString.call(t)).call(i,8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Yt()(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mt(t,e)}}function mt(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var ve={name:"ShPopupCard",components:{GeneralCard:F.a,IconSvg:re.a,VideoPlayer:pe},mixins:[E.a,x.a,ie.a],props:{active:{type:Boolean,default:!1},options:{type:Array,default:function(){return s()(this,he),[]}.bind(void 0)},bindFeature:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},border:{type:Boolean,default:!1},bindModeButton:{type:Boolean,default:!0},lockButton:{type:Boolean,default:!0}},data:function(){return{tableData:[],layerList:[],links:[],currentLayerId:"",totalPage:0,currentPage:1,panelConfig:{type:"default"},iframePopup:null,lock:!1}},computed:{currentFeatureId:function(){return this.currentLayerId+this.currentPage},currentLayerResult:function(){var e,i=this;return k()(e=this.options).call(e,function(n){return s()(this,i),this.queryId+n.layerId===this.currentLayerId}.bind(this))},footerMode:function(){var e=this.bindFeature,i=this.links;return{bindFeature:e,links:i}},isLinkFied:function(){var e=this;return function(i){var n,d,p,C=this;s()(this,e);var w=(n=this.currentLayerResult)===null||n===void 0||(d=n.results)===null||d===void 0?void 0:d[this.currentPage-1];if(w&&((p=g()(w.identifyField.fieldLink||{}))===null||p===void 0?void 0:p.length)>0){var S,j=i,G=w.identifyField.fieldAliases;if(this.currentLayerResult.type==="arcgis"&&G){var U;j=k()(U=g()(G)).call(U,function(J){return s()(this,C),G[J]===i}.bind(this))}return Ut()(S=g()(w.identifyField.fieldLink)).call(S,j)}else return!1}.bind(this)},videoOptions:function(){var e,i;return{autoplay:!0,controls:!0,loop:!0,muted:!0,html5:{vhs:{withCredentials:!1}},sources:[{src:(e=this.panelConfig)===null||e===void 0||(i=e.video)===null||i===void 0?void 0:i.videoUrl}]}},currentFeature:function(){var e;return(e=this.currentLayerResult)===null||e===void 0?void 0:e.results[this.currentPage-1]},currentLayerInfo:function(){var e=this.currentLayerResult||{},i=e.type,n=e.layerLabel,d=e.layerId,p=e.isPop,C=e.layerTag;return{type:i,layerLabel:n,layerId:d,isPop:p,layerTag:C}}},watch:{active:function(e){if(e)this.$refs.card.changeStatus(!0);else{var i;(i=this.$earth)===null||i===void 0||i.destroyVideoProjection()}},options:function(e){var i=this,n;this.$refs.card.changeShow(e.length>0),this.queryId=e.id,this.layerList=Qt()(e).call(e,function(d){return s()(this,i),{id:this.queryId+d.layerId,label:d.layerLabel,count:d.results.length}}.bind(this)),this.currentLayerId=(n=this.layerList[0])===null||n===void 0?void 0:n.id},currentLayerId:function(){this.init()},currentPage:function(){this.tableData=this.getFeatureAttributes()},currentFeatureId:function(e){this.$emit("change:feature",this.currentFeature,this.currentLayerInfo),this.resetData(),this.configLinks(),e&&this.getPanelConfig()},footerMode:function(){var e=this;this.$nextTick(function(){var i,n;s()(this,e);var d=((i=this.$refs.zoomBtn)===null||i===void 0||(n=i.$el)===null||n===void 0?void 0:n.clientHeight)||0,p=this.$refs.links.clientHeight;this.$refs.footer.style.height=Math.max(d,p)+"px"}.bind(this))},iframePopup:function(e){var i=this;e&&this.$nextTick(function(){s()(this,i),this.currentView==="map"?this.$map.getContainer().parentNode.appendChild(this.$refs.iframeCard.$el):this.$earth.getContainer().parentNode.appendChild(this.$refs.iframeCard.$el)}.bind(this))},lock:function(e){this.$emit("change:lock",e)}},methods:{init:function(){var e,i,n=this;this.totalPage=((e=k()(i=this.options).call(i,function(d){return s()(this,n),this.queryId+d.layerId===this.currentLayerId}.bind(this)))===null||e===void 0?void 0:e.results.length)||0,this.currentPage=1,this.tableData=this.getFeatureAttributes()},resetData:function(){this.panelConfig={type:"default"},this.iframePopup=null},getFeatureAttributes:function(){var e,i=this,n,d,p=[],C=k()(e=this.options).call(e,function(Y){return s()(this,i),this.queryId+Y.layerId===this.currentLayerId}.bind(this));if(!C)return[];var w=C.results[this.currentPage-1],S=w.attributes,j=w.identifyField,G=(j==null||(n=j.search)===null||n===void 0?void 0:n.split(","))||[],U=(j==null||(d=j.display)===null||d===void 0?void 0:d.split(","))||[],J=j!=null&&j.config?j.config:[];if(U.length===0||U[0]==="")for(var _ in S)_!=="geometry"&&p.push({key:_,data:S[_]});else for(var K=0;K<U.length;K++){var tt=G[K],H=S[tt],X=void 0;(!H||H.toString().toUpperCase()==="NULL")&&(H="");var rt=ut(J),Ot;try{for(rt.s();!(Ot=rt.n()).done;){var Et=Ot.value;if(Et.search===tt){var pt=Et.enumData;if(pt&&pt.length>0){var ot=ut(pt),Tt;try{for(ot.s();!(Tt=ot.n()).done;){var Mt=Tt.value;H===Mt.enum&&(H=Mt.transEnum)}}catch(Y){ot.e(Y)}finally{ot.f()}}}}}catch(Y){rt.e(Y)}finally{rt.f()}if(typeof H=="number"){var at=ut(J),At;try{for(at.s();!(At=at.n()).done;){var Dt=At.value;Dt.display===tt&&(X=Dt.num)}}catch(Y){at.e(Y)}finally{at.f()}var Rt=String(H).indexOf(".")+1,ke=String(H).length-Rt;Rt>0&&ke>X&&X!==!1&&(H=Math.round(H*Math.pow(10,X))/Math.pow(10,X))}p.push({key:U[K],data:H})}return p},getRealLinkUrl:function(e,i){var n=this,d=e.replace(/\{(.+?)\}/g,function(p,C){if(s()(this,n),this.currentLayerResult.type==="arcgis"&&i.identifyField.fieldAliases){var w=i.identifyField.fieldAliases[C],S=i.attributes[w];return S}else{var j=i.attributes[C];return j}}.bind(this));return d},configLinks:function(){var e,i,n,d=this;this.links=[];var p=(e=this.currentLayerResult)===null||e===void 0||(i=e.results)===null||i===void 0?void 0:i[this.currentPage-1];if(p&&((n=p.identifyField.formConfig)===null||n===void 0?void 0:n.length)>0){var C=[];p.identifyField.formConfig.forEach(function(w){s()(this,d);var S=w.id,j=S===void 0?Object(oe.v4)():S,G=w.formUrl,U=w.name,J=w.type,_=J===void 0?"blank":J,K=w.iframeWidth,tt=K===void 0?275:K,H=w.iframeHeight,X=H===void 0?400:H;p.identifyField.panel!==j&&C.push({name:U,href:this.getRealLinkUrl(G,p),type:_,iframeWidth:tt,iframeHeight:X})}.bind(this)),this.links=C}},getPanelConfig:function(){var e,i,n=this,d=(e=this.currentLayerResult)===null||e===void 0||(i=e.results)===null||i===void 0?void 0:i[this.currentPage-1],p=d?.identifyField||{},C=p.formConfig||[];if(d!=null&&d.video)this.panelConfig={type:"video",video:d.video};else if(!p.panel||p.panel==="default")this.panelConfig={type:"default"};else if(C.some(function(G){return s()(this,n),G.id===p.panel}.bind(this))){var w,S,j=k()(C).call(C,function(G){return s()(this,n),G.id===p.panel}.bind(this));this.panelConfig={type:"iframe",url:this.getRealLinkUrl(j.formUrl,d),iframeWidth:(w=j.iframeWidth)!==null&&w!==void 0?w:275,iframeHeight:(S=j.iframeHeight)!==null&&S!==void 0?S:400}}},getLinkFiedUrl:function(e){var i=this,n=this.currentLayerResult.results[this.currentPage-1],d=e,p=n.identifyField.fieldAliases;if(this.currentLayerResult.type==="arcgis"&&p){var C;d=k()(C=g()(p)).call(C,function(S){return s()(this,i),p[S]===e}.bind(this))}var w=n.identifyField.fieldLink[d];return this.getRealLinkUrl(w,n)},onConnectModeChange:function(){this.$emit("change:connectMode")},onChange:function(e){if(!e){var i;this.resetData(),(i=this.$earth)===null||i===void 0||i.destroyVideoProjection(),this.$emit("close")}},onZoom:function(){this.$emit("zoom")},onHrefClick:function(e){window.open(e)},onFooterHrefClick:function(e){var i=e.name,n=e.href,d=e.type,p=e.iframeWidth,C=e.iframeHeight;d==="blank"?window.open(n):d==="outer"?this.iframePopup={name:i,url:n,iframeWidth:p,iframeHeight:C}:d==="inner"&&(this.panelConfig={type:"iframe",url:n,iframeWidth:p,iframeHeight:C})},onIframeChangeShow:function(e){e||(this.iframePopup=null)},onChangeLock:function(){this.lock=!this.lock}}},ye=ve,ge=Object(Q.a)(ye,ct,Nt,!1,null,null,null),bt=ge.exports,me=o(35),lt=o.n(me),et=o(89),Ct={type:"sticky"},Pt={type:"absolute",top:"20%",right:"5%"},xt={size:{radius:"4px",width:"fit-content",height:"100%"},titleBar:{miniBtn:!0,maxBtn:!1,closeBtn:!0,fixBtn:!0,title:!0}},_e={strokeWidth:3,fillAlpha:.5,fill:"#ff0000",stroke:"#ff0000"},be=void 0;function It(t,e){var i=g()(t);if(z.a){var n=z()(t);e&&(n=q()(n).call(n,function(d){return T()(t,d).enumerable})),i.push.apply(i,n)}return i}function Ft(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?It(Object(i),!0).forEach(function(n){st()(t,n,i[n])}):V.a?Object.defineProperties(t,V()(i)):It(Object(i)).forEach(function(n){Object.defineProperty(t,n,T()(i,n))})}return t}var dt=new lt.a,Ce={name:"ShMapPopup",components:{PopupCard:bt},mixins:[E.a,x.a],props:{colorConfig:{type:Object},active:{type:Boolean,default:!1},identify:{type:Object,require:!0},bindFeature:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},stripeColor:{type:Array,default:function(){return s()(this,be),["#FFF","#fafafa"]}.bind(void 0)},border:{type:Boolean,default:!1},bindModeButton:{type:Boolean,default:!0},lockButton:{type:Boolean,default:!0},popupCardProps:{type:Object},disabledPopup:{type:Boolean,default:!1}},data:function(){return this.curFeature,this.mapPopup,this.bindPosition=Ct,this.unbindPosition=Pt,{visible:!1,totalData:[],isActive:0,queryId:"",bindFeatureValue:this.bindFeature,lock:!1}},computed:{imgSrc:function(){var e;return(e=this.popupCardProps)===null||e===void 0?void 0:e.imgSrc},styleConfig:function(){var e;return Ft(Ft({},xt),((e=this.popupCardProps)===null||e===void 0?void 0:e.styleConfig)||{})},themeVariables:function(){var e={"--stripeColorFirst":this.stripeColor[0],"--stripeColorSecond":this.stripeColor[1]};return e}},watch:{active:function(e){!e&&this.closePopup()},queryId:function(){!this.$slots.default&&this.closePopup()},bindFeatureValue:function(e){if(e)this.$map.getContainer().removeChild(this.$el),this.createPopup();else{var i;(i=this.mapPopup)===null||i===void 0||i.destroy(),this.$map.getContainer().appendChild(this.$el)}}},beforeDestroy:function(){if(this.closePopup(),this.bindFeatureValue){var e;(e=this.mapPopup)===null||e===void 0||e.destroy()}else this.$map.getContainer().removeChild(this.$el)},mounted:function(){var e=this;this.bindFeatureValue?this.createPopup():this.$map.getContainer().appendChild(this.$el),this.identify.on("identifyed",function(i){s()(this,e);var n=i.result,d=i.queryId;if(!this.lock&&!this.disabledPopup&&n.isPop!==!1)if(this.queryId===d){var p;((p=n.results)===null||p===void 0?void 0:p.length)>0&&this.totalData.push(n)}else{var C;this.queryId=d,this.totalData=[],this.totalData.id=this.queryId,((C=n.results)===null||C===void 0?void 0:C.length)>0&&this.totalData.push(n)}}.bind(this)),this.$map.layerManager.on("afterRemoveLayer",function(i){var n,d=this;s()(this,e);var p=ht()(n=this.totalData).call(n,function(S){return s()(this,d),S.layerId===i.layer.get("id")}.bind(this));if(p>-1){var C,w=q()(C=this.totalData).call(C,function(S){return s()(this,d),S.layerId!==i.layer.get("id")}.bind(this));this.totalData=w}}.bind(this))},methods:{onChangeFeature:function(e,i){this.$emit("change:feature",e,i),this.clearHighLight(),e&&this.highLightFeature(e)},clearHighLight:function(){this.identify.clearHighLight(),this.curFeature=void 0},createPopup:function(){this.mapPopup=this.$map.createPopup({element:this.$el,offset:[0,-6]});var e;if(this.curFeature){var i=dt.readGeometry(this.curFeature.geometry);e=Object(et.getCenter)(i.getExtent())}this.mapPopup.setPosition(e)},closePopup:function(){var e;this.visible=!1,this.clearHighLight(),(e=this.mapPopup)===null||e===void 0||e.setPosition(void 0)},onClose:function(){this.closePopup(),this.$emit("close","map")},resetPopup:function(e){var i=this;this.visible=!0,this.bindFeatureValue&&this.$nextTick(function(){s()(this,i),this.mapPopup.setPosition(e)}.bind(this))},highLightFeature:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=e.geometry;if(this.curFeature=e,i){var d=Object(et.getCenter)(dt.readGeometry(n).getExtent());this.resetPopup(d)}this.identify.highLightFeature(e)},onConnectModeChange:function(){this.bindFeatureValue=!this.bindFeatureValue},onZoom:function(){if(this.curFeature){var e=dt.readGeometry(this.curFeature.geometry);if(e.getType()==="Point"){var i,n=e.getCoordinates();this.$map.centerAt({center:n,zoom:(i=this.$map.getView().getMaxZoom())!==null&&i!==void 0?i:18})}else{var d=e.getExtent();this.$map.setExtent(d,{padding:[300,300,300,300]})}}},onChangeLock:function(e){this.lock=e}}},Pe=Ce,xe=Object(Q.a)(Pe,P,c,!1,null,null,null),Ie=xe.exports,$t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"sh-earth-popup",style:Object.assign({},t.themeVariables)},[t._t("default",function(){return[i("PopupCard",{attrs:{active:t.active,position:t.bindFeatureValue?t.bindPosition:t.unbindPosition,options:t.totalData,"style-config":t.styleConfig,"img-src":t.imgSrc,"bind-feature":t.bindFeatureValue,stripe:t.stripe,border:t.border,"bind-mode-button":t.bindModeButton,"lock-button":t.lockButton},on:{"change:feature":t.onChangeFeature,"change:connectMode":t.onConnectModeChange,"change:lock":t.onChangeLock,zoom:t.onZoom,close:t.onClose},scopedSlots:t._u([{key:"default",fn:function(n){return[t._t("popup",null,null,n)]}},{key:"cardExtend",fn:function(){return[t._t("cardExtend")]},proxy:!0}],null,!0)},[t._t("popup")],2)]})],2)},Fe=[];$t._withStripped=!0;var $e=void 0;function St(t,e){var i=g()(t);if(z.a){var n=z()(t);e&&(n=q()(n).call(n,function(d){return T()(t,d).enumerable})),i.push.apply(i,n)}return i}function wt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?St(Object(i),!0).forEach(function(n){st()(t,n,i[n])}):V.a?Object.defineProperties(t,V()(i)):St(Object(i)).forEach(function(n){Object.defineProperty(t,n,T()(i,n))})}return t}var Lt=new lt.a,Se={name:"ShEarthPopup",components:{PopupCard:bt},mixins:[E.a,x.a],props:{colorConfig:{type:Object},active:{type:Boolean,default:!1},identify:{type:Object,require:!0},bindFeature:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},stripeColor:{type:Array,default:function(){return s()(this,$e),["#696969","#555e67"]}.bind(void 0)},border:{type:Boolean,default:!1},bindModeButton:{type:Boolean,default:!0},lockButton:{type:Boolean,default:!0},popupCardProps:{type:Object},disabledPopup:{type:Boolean,default:!1}},data:function(){return this.bindPosition=Ct,this.unbindPosition=Pt,{visible:!1,totalData:[],isActive:0,queryId:"",bindFeatureValue:this.bindFeature,lock:!1}},computed:{imgSrc:function(){var e;return(e=this.popupCardProps)===null||e===void 0?void 0:e.imgSrc},styleConfig:function(){var e;return wt(wt({},xt),((e=this.popupCardProps)===null||e===void 0?void 0:e.styleConfig)||{})},themeVariables:function(){var e={"--stripeColorFirst":this.stripeColor[0],"--stripeColorSecond":this.stripeColor[1]};return e}},watch:{active:function(e){!e&&this.closePopup()},queryId:function(){!this.$slots.default&&this.closePopup()},bindFeatureValue:function(e){if(e)this.$earth.getContainer().removeChild(this.$el),this.createPopup();else{var i;(i=this.earthPopup)===null||i===void 0||i.destroy(),this.earthPopup=null,this.$earth.getContainer().appendChild(this.$el)}}},beforeDestroy:function(){if(this.closePopup(),this.bindFeatureValue){var e;(e=this.earthPopup)===null||e===void 0||e.destroy()}else this.$earth.getContainer().removeChild(this.$el)},mounted:function(){var e=this;this.bindFeatureValue?this.createPopup():this.$earth.getContainer().appendChild(this.$el),this.identify.on("identifyed3d",function(i){s()(this,e);var n=i.result,d=i.queryId;if(!this.lock&&!this.disabledPopup&&n.isPop!==!1)if(this.queryId===d){var p;((p=n.results)===null||p===void 0?void 0:p.length)>0&&this.totalData.push(n)}else{var C;this.queryId=d,this.totalData=[],this.totalData.id=this.queryId,((C=n.results)===null||C===void 0?void 0:C.length)>0&&this.totalData.push(n)}}.bind(this)),this.$earth.layerManager.on("afterRemoveLayer",function(i){var n,d=this;s()(this,e);var p=ht()(n=this.totalData).call(n,function(S){return s()(this,d),S.layerId===i.data.id}.bind(this));if(p>-1){var C,w=q()(C=this.totalData).call(C,function(S){return s()(this,d),S.layerId!==i.data.id}.bind(this));this.totalData=w}}.bind(this))},methods:{createPopup:function(){this.earthPopup=this.$earth.createPopup({element:this.$el,offset:[0,-6]});var e;this.curFeature&&(e=this.getPositionOfFeature(this.curFeature)),e&&(e[2]+=1),this.earthPopup.setPosition(e)},onChangeFeature:function(e,i){this.$emit("change:feature",e,i),this.clearHighLight(),e&&this.highLightFeature(e)},resetPopup:function(e){var i;e[2]+=1,this.visible=!0,(i=this.earthPopup)===null||i===void 0||i.setPosition(e)},highLightFeature:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(this.identify.highLightFeature(e),this.curFeature=e,i){var n=this.getPositionOfFeature(e);this.resetPopup(n)}},clearHighLight:function(){this.identify.clearHighLight(),this.curFeature=void 0},closePopup:function(){var e;this.visible=!1,this.clearHighLight(),(e=this.earthPopup)===null||e===void 0||e.setPosition(void 0)},onClose:function(){this.closePopup(),this.$emit("close","earth")},onConnectModeChange:function(){this.bindFeatureValue=!this.bindFeatureValue},onZoom:function(){if(this.curFeature){var e;if(this.curFeature.position)e=this.curFeature.position;else{var i=Object(et.getCenter)(Lt.readGeometry(this.curFeature.geometry).getExtent());i[2]=1e3,e=i}this.$earth.centerAt({center:e,heading:0,roll:0,pitch:-90})}},getPositionOfFeature:function(e){var i;if(this.curFeature.position)i=e.position;else if(e.geometry){var n=Object(et.getCenter)(Lt.readGeometry(e.geometry).getExtent());i=n}return i},onChangeLock:function(e){this.lock=e}}},we=Se,Le=Object(Q.a)(we,$t,Fe,!1,null,null,null),je=Le.exports,jt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sh-identify-popup-type-card"},[i("el-radio-group",{attrs:{size:"mini"},model:{value:t.queryType,callback:function(n){t.queryType=n},expression:"queryType"}},[i("el-radio",{attrs:{label:"click"}},[t._v("\u70B9")]),i("el-radio",{attrs:{label:"line"}},[t._v("\u7EBF")]),i("el-radio",{attrs:{label:"polygon"}},[t._v("\u9762")]),i("el-radio",{attrs:{label:"box"}},[t._v("\u6846\u9009")])],1)],1)},Be=[];jt._withStripped=!0;var Oe=o(455),Ee=o.n(Oe),Te={name:"ShIdentifyPopupTypeCard",props:{currentQueryType:{type:String,default:"click"}},data:function(){return{queryType:this.currentQueryType}},watch:{queryType:function(e){this.$emit("update:currentQueryType",e)}},mounted:function(){var e;Ee()(e=this.queryType).call(e,"buffer")&&(this.queryType="click")}},Me=Te,Ae=Object(Q.a)(Me,jt,Be,!1,null,null,null),De=Ae.exports,Bt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sh-identify-popup-buffer-card"},[i("el-form",{attrs:{"label-width":"80px",size:"mini",model:t.buffer}},[i("el-form-item",{attrs:{label:"\u56FE\u5F62\u6765\u6E90"}},[i("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9\u56FE\u5F62\u6765\u6E90"},model:{value:t.buffer.source,callback:function(n){t.$set(t.buffer,"source",n)},expression:"buffer.source"}},[i("el-option",{attrs:{label:"\u7ED8\u5236",value:"draw"}}),i("el-option",{attrs:{label:"\u9009\u62E9",value:"select"}})],1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.buffer.source==="draw",expression:"buffer.source === 'draw'"}],attrs:{label:"\u7ED8\u5236\u7C7B\u578B"}},[i("el-radio-group",{staticClass:"drawType",model:{value:t.buffer.drawType,callback:function(n){t.$set(t.buffer,"drawType",n)},expression:"buffer.drawType"}},[i("el-radio",{attrs:{label:"Point"}},[t._v("\u70B9")]),i("el-radio",{attrs:{label:"LineString"}},[t._v("\u7EBF")]),i("el-radio",{attrs:{label:"Polygon"}},[t._v("\u9762")])],1)],1),i("el-form-item",{attrs:{label:"\u7F13\u51B2\u534A\u5F84"}},[i("div",{staticClass:"input-group"},[i("el-input-number",{attrs:{"controls-position":"right",min:0,step:10},model:{value:t.buffer.radius,callback:function(n){t.$set(t.buffer,"radius",n)},expression:"buffer.radius"}}),i("div",{staticClass:"append"},[t._v("\u7C73")])],1)])],1),i("div",{staticClass:"btns"},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.bufferIdentify}},[t._v("\u67E5\u8BE2")])],1)],1)},Re=[];Bt._withStripped=!0;var Ve=o(456),He=o(357),ft=new lt.a,ze={name:"ShIdentifyPopupBufferCard",mixins:[E.a,x.a],props:{identify:{type:Object},currentQueryType:{type:String},defaultBufferRadius:{type:Number,default:100}},data:function(){return this.draw=null,this.originFeature=null,{buffer:{source:"draw",drawType:"Point",radius:this.defaultBufferRadius}}},watch:{"buffer.source":{handler:function(e,i){i==="select"&&(this.$emit("changeSelect",!1),this.subscribe.$off("select-tool:selected",this.onSelected)),e==="draw"?this.createDraw(this.buffer.drawType):e==="select"&&(this.closeDraw(),this.subscribe.$on("select-tool:selected",this.onSelected),this.$emit("changeSelect",!0)),this.$emit("update:currentQueryType","buffer-".concat(e))},immediate:!0},"buffer.drawType":function(e){this.closeDraw(),this.buffer.source==="draw"&&this.createDraw(e)},"buffer.radius":function(){this.originFeature&&this.setBufferedFeature(this.originFeature)}},beforeDestroy:function(){this.$emit("changeSelect",!1),this.subscribe.$off("select-tool:selected",this.onSelected),this.clearDrawLayer(),this.closeDraw()},methods:{createDraw:function(e){var i=this,n=this.$map.getLayerById("identifyDrawLayer").getSource(),d={source:n,type:e};this.draw=new Ve.Draw(d),this.draw.on("drawend",function(p){var C=this;s()(this,i),this.originFeature=p.feature.clone(),setTimeout(function(){return s()(this,C),this.setBufferedFeature(p.feature)}.bind(this),0)}.bind(this)),this.$map.addInteraction(this.draw)},closeDraw:function(){this.clearDrawLayer(),this.originFeature=null,this.draw&&(this.$map.removeInteraction(this.draw),this.draw=null)},clearDrawLayer:function(){this.$map.getLayerById("identifyDrawLayer").getSource().clear()},onSelected:function(e){if(e){var i=ft.readFeatures(e);i.length>0&&(this.originFeature=i[0],this.setBufferedFeature(i[0]))}},setBufferedFeature:function(e){if(this.clearDrawLayer(),!!e){var i=this.$map.getView().getProjection().getCode(),n=e.getGeometry().transform(i,"EPSG:4326"),d=Object(He.buffer)(ft.writeGeometryObject(n),this.buffer.radius/1e3),p;d?p=ft.readFeature(d):p=e,p.setGeometry(p.getGeometry().transform("EPSG:4326",i)),this.$map.getLayerById("identifyDrawLayer").getSource().addFeature(p)}},bufferIdentify:function(){var e=this,i=this.$map.getLayerById("identifyDrawLayer").getSource().getFeatures()[0];i&&(this.identify.mapIdentify.identifyLayer(i),setTimeout(function(){s()(this,e),this.clearDrawLayer(),this.originFeature=null}.bind(this),500))}}},Ne=ze,Ge=Object(Q.a)(Ne,Bt,Re,!1,null,null,null),We=Ge.exports,it=void 0,Ue={name:"ShIdentifyPopup",components:{MapPopup:Ie,EarthPopup:je,GeneralButton:O.a,GeneralContainer:F.a,TypeCard:De,BufferCard:We},mixins:[E.a,x.a,R.a],props:{isShow:{type:Boolean,default:!0},bindModeButton:{type:Boolean,default:!0},lockButton:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},stripeColor:{type:Object,default:function(){return s()(this,it),{map:["#FFF","#fafafa"],earth:["#696969","#555e67"]}}.bind(void 0)},border:{type:Boolean,default:!1},colorConfig:{type:Object},defaultActive:{type:Boolean,default:!1},queryMode:{type:String,default:"click"},isStayActive:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!1},panelConfig:{type:Array,default:function(){return s()(this,it),["type","buffer"]}.bind(void 0)},defaultBufferRadius:{type:Number,default:100},panelCardProps:{type:Object,default:function(){s()(this,it)}.bind(void 0)},defaultBindFeature:{type:Boolean,default:!0},popupCardProps:{type:Object,default:function(){s()(this,it)}.bind(void 0)},disabledPopup:{type:Boolean,default:!1}},data:function(){return this.identify,{ready:!1,active:!1,deactivateByOther:!1,isShowBtn:!1,isStartFix:!1,queryType:this.queryMode?this.queryMode:"click",currentTab:this.panelConfig[0]}},computed:{panelShouldShow:function(){return this.showPanel&&this.active&&this.currentView==="map"},buffPanelShouldShow:function(){return this.buffPanel&&this.active&&this.currentView==="map"},panelStyleConfig:function(){var e;return(e=this.panelCardProps)===null||e===void 0?void 0:e.styleConfig},panelPosition:function(){var e;return((e=this.panelCardProps)===null||e===void 0?void 0:e.position)||{type:"absolute",top:"100px",right:"135px"}},panelImgSrc:function(){var e;return(e=this.panelCardProps)===null||e===void 0?void 0:e.imgSrc},panelTitle:function(){var e;return(e=this.panelCardProps)===null||e===void 0?void 0:e.title}},watch:{currentInteraction:function(e){e===""?this.isStayActive&&this.deactivateByOther&&this.activate():e!==this.$options.name&&this.queryType!=="buffer-select"&&this.active&&(this.deactivate(),this.deactivateByOther=!0)},queryType:{handler:function(e,i){i&&(this.deactivate(),this.activate())},immediate:!0}},beforeDestroy:function(){this.deactivate()},mounted:function(){var e=this;(this.$map||this.$earth)&&setTimeout(function(){s()(this,e),this.begin()}.bind(this),0)},methods:{begin:function(){var e=this;this.identify=new v.a(this.$map,this.$earth),this.identify.on("inited",function(){var i=this;s()(this,e),this.identify.on("change:active",function(n){s()(this,i),this.active=n.active,this.$emit("change:active",n.active,n.identifyType)}.bind(this)),this.identify.on("identifyed",function(n){s()(this,i),this.$emit("identifyed",n)}.bind(this)),this.identify.on("identifyed3d",function(n){s()(this,i),this.$emit("identifyed3d",n)}.bind(this)),this.identify.on("identifyedAll",function(n){s()(this,i),this.$emit("identifyedAll",n)}.bind(this)),this.identify.on("identifyedAll3d",function(n){s()(this,i),this.$emit("identifyedAll3d",n)}.bind(this)),this.ready=!0,this.defaultActive&&this.activate()}.bind(this))},activate:function(){var e;(e=this.identify)===null||e===void 0||e.setActive(!0,this.queryType)},deactivate:function(){var e;(e=this.identify)===null||e===void 0||e.setActive(!1,this.queryType),this.deactivateByOther=!1},toggle:function(e){var i;typeof e=="boolean"?i=e:i=!this.identify.active,i?this.activate():this.deactivate()},changeIsShow:function(e){e||this.deactivate()},highLightFeature:function(e){if(this.currentView==="map"){var i=!!this.$scopedSlots.mapPopup;this.$refs.mapPopup.highLightFeature(e,i)}else{var n=!!this.$scopedSlots.earthPopup;this.$refs.earthPopup.highLightFeature(e,n)}},closePopup:function(){this.currentView==="map"?this.$refs.mapPopup.closePopup():this.$refs.earthPopup.closePopup()},onChangeFeature:function(e,i){this.$emit("change:feature",e,i)},onClose:function(e){this.$emit("close",e)}}},Ze=Ue,Qe=Object(Q.a)(Ze,m,y,!1,null,null,null),Je=Qe.exports,Ke=o(28),Xe=o.n(Ke),Ye=void 0,nt=Xe()(Je,{transform:function(e){s()(this,Ye);var i=e.show,n=e.position;return{isShow:i,position:n}}.bind(void 0)});nt.install=function(t){t.component(nt.name,nt)};var ti=u.default=nt},8:function(a,u){a.exports=r(22466)},89:function(a,u){a.exports=r(92086)}})},19457:function(f,b,r){"use strict";var h=r(19534);Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var a=h(r(52909)),u=h(r(42579)),o=void 0,l={props:{isShow:{type:Boolean,default:!0},position:{type:Object,default:function(){return(0,u.default)(this,o),{type:"absolute",top:"1px",left:"1px"}}.bind(void 0)},isColumn:{type:Boolean,default:!1},title:{type:String},iconClass:{type:String},dragEnable:{type:Boolean,default:!1},showImg:{type:Boolean,default:!0},showLabel:{type:Boolean,default:!0},themeStyle:{type:Object}},data:function(){return{theme:"light"}},watch:{currentView:{handler:function(y){y==="earth"?this.theme="dark":this.theme="light"},immediate:!0}},mounted:function(){var y,$=this;this.$_mixin_generalButton=(0,a.default)(y=this.$children).call(y,function(v){return(0,u.default)(this,$),v.$options.name==="ShGeneralButton"}.bind(this))},methods:{getPosition:function(){var y;return(y=this.$_mixin_generalButton)===null||y===void 0?void 0:y.getPosition()}}},s=l;b.default=s},47806:function(f,b,r){"use strict";var h=r(19534);Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var a=h(r(52909)),u=h(r(42579)),o=void 0,l={inject:{generalCardThemeStyle:{default:null}},props:{styleConfig:{type:Object,default:function(){(0,u.default)(this,o)}.bind(void 0)},position:{type:Object,default:function(){return(0,u.default)(this,o),{type:"absolute",top:"100px",right:"135px"}}.bind(void 0)},themeStyle:{type:Object},imgSrc:{type:String},title:{type:String},isShow:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!1},dragEnable:{type:Boolean,default:!0},onlyContainer:{type:Boolean,default:!1}},data:function(){return{visible:this.isShow,theme:"light"}},watch:{currentView:{handler:function(y){y==="earth"?this.theme="dark":this.theme="light"},immediate:!0},isShow:function(y){this.visible=y}},computed:{cardThemeStyle:function(){return this.themeStyle||this.generalCardThemeStyle}},mounted:function(){var y,$=this;this.$_mixin_generalCard=(0,a.default)(y=this.$children).call(y,function(v){return(0,u.default)(this,$),v.$options.name==="ShGeneralCard"}.bind(this))},methods:{changeShow:function(y){var $;if(($=this.$_mixin_generalCard)===null||$===void 0||$.changeShow(y),y===!1||y!==!0&&this.visible){var v;(v=this.deactivate)===null||v===void 0||v.call(this)}},changeStatus:function(y){var $;($=this.$_mixin_generalCard)===null||$===void 0||$.changeStatus(y)},getPosition:function(){var y;return(y=this.$_mixin_generalCard)===null||y===void 0?void 0:y.getPosition()}}},s=l;b.default=s},42709:function(f,b,r){"use strict";var h=r(48836);const a={data(){return this.map=null,this.timer="",{isEditor:window.location.href.indexOf("editor.html")>0}},inject:{reactiveViewMode:{default:function(){return()=>"23D"}}},computed:{viewMode(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()}},mounted(){!this.widgetInfo.parentId&&this.isEditor&&this.widgetInfo.action.gisMapId&&this.$nextTick(function(){this.updateWidgetParentId({widgetId:this.widgetInfo.id,parentId:this.widgetInfo.action.gisMapId,keepPosition:!0})})},methods:{...(0,h.nv)(["updateWidgetParentId"]),getBindMap(){typeof this.widgetInfo.action.gisMapId<"u"}}};b.Z=a},44513:function(f,b,r){"use strict";r.d(b,{Z:function(){return y}});var h=function(){var v=this,D=v._self._c;return v.attr.buttonHide?D("div",{style:{position:"absolute",right:v.attr.buttonHideRight+"px",top:v.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(E){return v.onHide()}}},[v.openTooltip?D("el-tooltip",{attrs:{"open-delay":1e3,content:v.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[D("el-button",{class:v.attr.buttonHideIconClass&&v.attr.buttonHideIconClass!=""?v.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:v.attr.buttonHideColor,fontSize:v.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):D("el-button",{class:v.attr.buttonHideIconClass&&v.attr.buttonHideIconClass!=""?v.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:v.attr.buttonHideColor,fontSize:v.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):v._e()},a=[],u=r(52246),o={props:["attr"],name:"hide-button",data(){return{isPc:u.b}},computed:{openTooltip:function(){let $=!1,v=this.attr.buttonHideTooltipContent;return u.b&&v&&v!=null&&v.trim()!=""&&($=!0),$}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},l=o,s=r(68141),m=(0,s.Z)(l,h,a,!1,null,"bf399b9a",null),y=m.exports},10854:function(f,b,r){"use strict";r.r(b),r.d(b,{default:function(){return R}});var h=function(){var c=this,I=c._self._c;return I("div",{directives:[{name:"show",rawName:"v-show",value:c.widgetInfo.attr.hide!=!0,expression:"widgetInfo.attr.hide != true"}],ref:"gisBase",staticClass:"my-gisBase",style:{width:c.widgetInfo.attr.w+"px",height:c.widgetInfo.attr.hh+"px"}},[I("hide-button",{attrs:{attr:c.widgetInfo.attr}}),I("IdentifyPopup",c._b({ref:"identify",style:{width:c.widgetInfo.attr.w+"px",height:c.widgetInfo.attr.hh+"px"},attrs:{"btn-attr":c.btnAttr,"theme-style":c.themeConfig,position:c.btnPosition,"query-mode":c.widgetInfo.config.queryMode,"default-active":c.widgetInfo.config.openConfig.isEnable,"is-stay-active":c.widgetInfo.config.openConfig.isStayOpen,"color-config":c.widgetInfo.config.colorConfig,"bind-mode-button":!1,"disabled-popup":!c.widgetInfo.config.iframeConfig.isPop},on:{identifyedAll:c.identifyedAll,identifyedAll3d:c.identifyedAll},scopedSlots:c._u([c.widgetInfo.config.iframeConfig.isCustom&&c.widgetInfo.config.iframeConfig.popId&&c.popWidget?{key:"mapPopup",fn:function(){return[I("draggable-component",{ref:"comp_"+c.popWidget.id,staticStyle:{display:"inline-block",float:"left"},attrs:{id:"widget_"+c.widgetInfo.config.iframeConfig.popId,"is-view":!0,"widget-data":c.popWidget}})]},proxy:!0}:null],null,!0)},"IdentifyPopup",c.widgetInfo.config.btnConfig,!1))],1)},a=[],u=r(21963),o=r.n(u),l=r(44513),s=r(27966),m=r(71298),y=r(45061),$=r(26711),v=r(86892),D=r(42709),E=r(50681),M=r(48836),x=r(95338),L=r(49500),O={name:"GisIdnetify",components:{IdentifyPopup:o(),HideButton:l.Z,DraggableComponent:x.Z},mixins:[m.u,v.D,y.u,$.H,D.Z,E.Z],props:["widgetInfo"],data(){return{timer:"",contentTimer:"",map:null,btnAttr:this.widgetInfo.attr,popAttr:null,popContent:null,imgIconConfig:this.widgetInfo.config.imgIconConfig,iframeConfig:this.widgetInfo.config.iframeConfig}},computed:{...(0,M.Se)(["getWidgets","getWidgetAllArr"]),popWidget(){for(let P in this.getWidgets){let c=JSON.parse(JSON.stringify(this.getWidgets[P]));if(c.id===this.widgetInfo.config.iframeConfig.popId)return c}return null}},mounted(){L.log("isPop",this.widgetInfo.config.iframeConfig.isPop),this.initAction(this.widgetInfo)},methods:{loadInfo(){},reLoadInfo(P){this.loadInfo(P),this.btnAttr=P.attr,this.imgIconConfig=P.config.imgIconConfig},initAction(P){this.actionReceive(P)},getBindContent(){if(typeof this.widgetInfo.config.iframeConfig.popId<"u"&&this.widgetInfo.config.iframeConfig.isCustom){let P=document.getElementById("widget_"+this.widgetInfo.config.iframeConfig.popId),c=this.getWidgetObject(this.widgetInfo.config.iframeConfig.popId);this.popAttr=c.widgetInfo.attr,L.log("popComponent",this.popAttr),P&&(clearInterval(this.contentTimer),this.$refs.identify.bindCustomPop(P,this.popAttr),this.popContent=P)}},identifyedAll(P){if(P.result&&P.result.length>0&&P.result[0].results&&P.result[0].results.length>0){let g=this.$refs["comp_"+this.popWidget?.id];g&&(g.$el.style.display="inline-block"),this.$refs.identify.highLightFeature(P.result[0].results[0])}else this.$refs.identify.closePopup();let c=this,I=c.widgetInfo.action.sendOut.actionList;this.$$lib__.each(I,g=>{if(g.enabled&&g.code==c.$$global_editor.actionType.identify.code){let N=g.code+"_"+c.widgetInfo.id,T={result:P};if(g.paramsExtend&&g.paramsExtend.length>0&&this.getExtendParams(T,g.paramsExtend,[],[]),g.script&&g.script.enabled&&g.script.content){this.doConfigMap=new Function("data",g.script.content);let Z=this.doConfigMap(T);Z&&(T=Z)}s.Z.$emit(N,T),g.postMessage&&this.doPostMessage(T),this.actionNameList.push(N)}if(g.enabled&&g.code==c.$$global_editor.actionType.wgIdentify.code&&P.data.length>0){let N=P.data[0].feature;var W;if(N&&"getProperties"in N){var z=N.getProperties();W={wgid:z.wgid}}else W={wgid:null};let T=g.code+"_"+c.widgetInfo.id;s.Z.$emit(T,W),this.actionNameList.push(T)}})}}},B=O,F=r(68141),A=(0,F.Z)(B,h,a,!1,null,null,null),R=A.exports},66880:function(f,b,r){f.exports=r(14105)},65557:function(f,b,r){f.exports=r(72626)},87507:function(f){function b(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}f.exports=b,f.exports.__esModule=!0,f.exports.default=f.exports},34009:function(f,b,r){var h=r(39155),a=r(1520),u=r(72026);function o(l){var s;return f.exports=o=h?a(s=u).call(s):function(y){return y.__proto__||u(y)},f.exports.__esModule=!0,f.exports.default=f.exports,o(l)}f.exports=o,f.exports.__esModule=!0,f.exports.default=f.exports},30044:function(f,b,r){var h=r(21648),a=r(57448),u=r(39736);function o(l,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=h(s&&s.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),a(l,"prototype",{writable:!1}),s&&u(l,s)}f.exports=o,f.exports.__esModule=!0,f.exports.default=f.exports},99085:function(f,b,r){var h=r(29870).default,a=r(87507);function u(o,l){if(l&&(h(l)==="object"||typeof l=="function"))return l;if(l!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return a(o)}f.exports=u,f.exports.__esModule=!0,f.exports.default=f.exports},39736:function(f,b,r){var h=r(39155),a=r(1520);function u(o,l){var s;return f.exports=u=h?a(s=h).call(s):function(y,$){return y.__proto__=$,y},f.exports.__esModule=!0,f.exports.default=f.exports,u(o,l)}f.exports=u,f.exports.__esModule=!0,f.exports.default=f.exports},44900:function(f,b,r){"use strict";var h=r(56370);f.exports=h},53005:function(f,b,r){"use strict";r(94495);var h=r(18893);f.exports=h("Function","bind")},17086:function(f,b,r){"use strict";var h=r(32242),a=r(53005),u=Function.prototype;f.exports=function(o){var l=o.bind;return o===u||h(u,o)&&l===u.bind?a:l}},71030:function(f,b,r){"use strict";var h=r(32242),a=r(6047),u=String.prototype;f.exports=function(o){var l=o.startsWith;return typeof o=="string"||o===u||h(u,o)&&l===u.startsWith?a:l}},60382:function(f,b,r){"use strict";r(30897);var h=r(94388);f.exports=h.Reflect.construct},6047:function(f,b,r){"use strict";r(45198);var h=r(18893);f.exports=h("String","startsWith")},1520:function(f,b,r){"use strict";f.exports=r(48691)},48691:function(f,b,r){"use strict";var h=r(44900);f.exports=h},77958:function(f,b,r){"use strict";var h=r(36021),a=r(86735),u=r(42660),o=r(79489),l=r(2529),s=r(82396),m=Function,y=h([].concat),$=h([].join),v={},D=function(E,M,x){if(!o(v,M)){for(var L=[],O=0;O<M;O++)L[O]="a["+O+"]";v[M]=m("C,a","return new C("+$(L,",")+")")}return v[M](E,x)};f.exports=s?m.bind:function(M){var x=a(this),L=x.prototype,O=l(arguments,1),B=function(){var A=y(O,l(arguments));return this instanceof B?D(x,A.length,A):x.apply(M,A)};return u(L)&&(B.prototype=L),B}},94495:function(f,b,r){"use strict";var h=r(90434),a=r(77958);h({target:"Function",proto:!0,forced:Function.bind!==a},{bind:a})},30897:function(f,b,r){"use strict";var h=r(90434),a=r(30889),u=r(19522),o=r(77958),l=r(11298),s=r(87934),m=r(42660),y=r(24136),$=r(27909),v=a("Reflect","construct"),D=Object.prototype,E=[].push,M=$(function(){function O(){}return!(v(function(){},[],O)instanceof O)}),x=!$(function(){v(function(){})}),L=M||x;h({target:"Reflect",stat:!0,forced:L,sham:L},{construct:function(B,F){l(B),s(F);var A=arguments.length<3?B:l(arguments[2]);if(x&&!M)return v(B,F,A);if(B===A){switch(F.length){case 0:return new B;case 1:return new B(F[0]);case 2:return new B(F[0],F[1]);case 3:return new B(F[0],F[1],F[2]);case 4:return new B(F[0],F[1],F[2],F[3])}var R=[null];return u(E,R,F),new(u(o,B,R))}var P=A.prototype,c=y(m(P)?P:D),I=u(B,c,F);return m(I)?I:c}})},45198:function(f,b,r){"use strict";var h=r(90434),a=r(43806),u=r(68428).f,o=r(9505),l=r(47482),s=r(72679),m=r(64734),y=r(2541),$=r(96338),v=a("".slice),D=Math.min,E=y("startsWith"),M=!$&&!E&&!!function(){var x=u(String.prototype,"startsWith");return x&&!x.writable}();h({target:"String",proto:!0,forced:!M&&!E},{startsWith:function(L){var O=l(m(this));s(L);var B=o(D(arguments.length>1?arguments[1]:void 0,O.length)),F=l(L);return v(O,B,B+F.length)===F}})},56370:function(f,b,r){"use strict";var h=r(17086);f.exports=h},14105:function(f,b,r){"use strict";var h=r(71030);f.exports=h},72626:function(f,b,r){"use strict";var h=r(60382);f.exports=h}}]);
