"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[6192],{56279:function(x,p,l){l.d(p,{P:function(){return h}});var w=l(86892),c=l(49500);const h={mixins:[w.D],created(){},methods:{lifecycleBeforeChartsLoad(f){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&c.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),c.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let u=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[f]);if(u)return u}return f},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&c.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),c.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},44513:function(x,p,l){l.d(p,{Z:function(){return v}});var w=function(){var s=this,g=s._self._c;return s.attr.buttonHide?g("div",{style:{position:"absolute",right:s.attr.buttonHideRight+"px",top:s.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(C){return s.onHide()}}},[s.openTooltip?g("el-tooltip",{attrs:{"open-delay":1e3,content:s.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[g("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):g("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):s._e()},c=[],h=l(52246),f={props:["attr"],name:"hide-button",data(){return{isPc:h.b}},computed:{openTooltip:function(){let m=!1,s=this.attr.buttonHideTooltipContent;return h.b&&s&&s!=null&&s.trim()!=""&&(m=!0),m}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},b=f,u=l(68141),I=(0,u.Z)(b,w,c,!1,null,"bf399b9a",null),v=I.exports},36192:function(x,p,l){l.r(p),l.d(p,{default:function(){return E}});var w=function(){var t=this,a=t._self._c;return a("div",{style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.h+"px",overflow:"hidden"},attrs:{id:`tree_select_${t.widgetInfo.id}`}},[a("hide-button",{attrs:{attr:t.widgetInfo.attr}}),a("div",[a("span",{staticClass:"tree_select_label"},[t._v(" "+t._s(t.widgetInfo.config.part.label.text)+" ")]),a("div",{ref:"treeSelect",style:{display:"inline-block",float:"left"}},[a("treeselect",{ref:"vueTreeselect",attrs:{id:"treeselect_"+t.widgetInfo.id,"append-to-body":!0,clearable:t.widgetInfo.config.part.option.clearable,"clear-value-text":t.widgetInfo.config.part.option.clearValueText,"default-expand-level":t.widgetInfo.config.part.option.defaultExpandLevel,"disable-branch-nodes":t.widgetInfo.config.part.option.disableBranchNodes,disabled:t.widgetInfo.config.part.option.disabled,"no-results-text":t.widgetInfo.config.part.option.noResultsText,placeholder:t.widgetInfo.config.part.option.placeholder,searchable:t.widgetInfo.config.part.option.searchable,"search-nested":t.widgetInfo.config.part.option.searchNested,"show-count":t.widgetInfo.config.part.option.showCount,"show-count-of":t.widgetInfo.config.part.option.showCountOf,"show-count-on-search":t.widgetInfo.config.part.option.showCountOnSearch,multiple:t.widgetInfo.config.part.option.multiple,limit:t.widgetInfo.config.part.option.limit,"clear-on-select":t.widgetInfo.config.part.option.clearOnSelect,"close-on-select":t.widgetInfo.config.part.option.closeOnSelect,"clear-all-text":t.widgetInfo.config.part.option.clearAllText,"sort-value-by":t.widgetInfo.config.part.option.sortValueBy,"value-consists-of":t.widgetInfo.config.part.option.valueConsistsOf,flat:t.widgetInfo.config.part.option.flat,"loading-text":t.widgetInfo.config.part.option.loadingText,"no-children-text":t.widgetInfo.config.part.option.noChildrenText,"load-options":t.loadOptions,options:t.treeSelectData},on:{close:t.closeEvent,open:t.openEvent},model:{value:t.selectValue,callback:function(e){t.selectValue=e},expression:"selectValue"}})],1)])],1)},c=[],h=l(44513),f=l(45061),b=l(26711),u=l(56279),I=l(75345),v=l.n(I),m=l(55616),s=l(42160),g=l(13067),C=l(33264),F=l(48836),$=l(27966),P=l(64803),L=l(67157);const D={mixins:[L.c],data(){return{config_extend:{config:{part:{label:{paddingLeft:8,marginTop:5},select:{color:"#616266",fontSize:14,fontFamily:"alibabaPuHuiTiRegular",borderColor:"#DCDFE5",borderRadius:4,textAlign:"left",paddingTop:0,background:"#FFFFFF"}}}},filter_config:{part:{label:{fontFamily:"alibabaPuHuiTiRegular",color:"#616266"},select:{dropBackground:null,color:"#616266",fontFamily:"alibabaPuHuiTiRegular",borderColor:"#DCDFE5",background:""}}}}},methods:{filterPredefineColoursSchemeConfig(i,t){this.getNewConfigWithArrary(i,t,this.filter_config)}}};var y=l(21300),T=l(49500),H={name:"TreeSelect",components:{HideButton:h.Z,Treeselect:v()},mixins:[f.u,b.H,u.P,C.t,P.u,D],props:["widgetInfo"],data(){return{treeSelectData:[],selectValue:null}},computed:{...(0,F.Se)(["viewType","getCanvasSettingInfo"]),canvasSetting(){return this.getCanvasSettingInfo}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)},"widgetInfo.config":{deep:!0,handler:function(){this.setStyle(this.widgetInfo)}}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},methods:{loadInfo(i){this.treeSelectData=this.getTreeData(i.dataset[i.dataset.type].encode,i.dataset[i.dataset.type].dimensions,i.dataset[i.dataset.type].source),this.setStyle(i),this.$nextTick(()=>{this.selectValue=this.getSelectValue(i)}),this.lifecycleAfterLoad()},setStyle(i){let t=this.getCssString(i);t+=this.getLabelCssString(i);let a=`css_widget_${i.id}`,e=document.getElementById(a);e?e.innerHTML=t:(e=document.createElement("style"),e.id=a,e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e))},getCssString(i){let t=this.widgetInfo.config.part.select,a="",e={};e.width=this.mUtils.getNewPxW(t.width)+"px",e.height=this.mUtils.getNewPxH(t.height)+"px",e.borderRadius=t.borderRadius+"px",e.background=t.background,e.borderColor=t.borderColor,e.borderWidth=`${t.borderTop}px ${t.borderRight}px ${t.borderBottom}px ${t.borderLeft}px`,e.fontSize=this.mUtils.getNewFontSize(t.fontSize)+"px",e.lineHeight=this.mUtils.getNewPxH(t.height)+"px",e.color=t.color,a+=`#tree_select_${i.id} .vue-treeselect__control {
                     ${this.mUtils.style2CSSStr(e)};
                     ${this.getCustomCss(t.customSelectCss)}
                 }
                 `;let o={};o.paddingLeft=this.mUtils.getNewPxW(t.paddingLeft)+"px",o.paddingTop=this.mUtils.getNewPxH(t.paddingTop)+"px",o.color=t.color,o.fontSize=this.mUtils.getNewFontSize(t.fontSize)+"px",o.fontFamily=t.fontFamily,o.textAlign=t.textAlign,o.lineHeight=e.height,a+=`#tree_select_${i.id} .vue-treeselect__placeholder, .vue-treeselect__single-value, .vue-treeselect__multi-value, .vue-treeselect__multi-value-label {
                    ${this.mUtils.style2CSSStr(o)};
                }
                `;let n=this.$refs.vueTreeselect.getInstanceId();t.customDropItemActiveCss&&(a+=`div[data-instance-id='${n}'] .vue-treeselect__option--selected {
                      ${this.getCustomCss(t.customDropItemActiveCss)}
                }
                `),t.customDropItemHoverCss&&(a+=`div[data-instance-id='${n}'] .vue-treeselect__option--highlight:hover,
                div[data-instance-id='${n}'] .vue-treeselect__option--highlight:hover {
                    ${this.getCustomCss(t.customDropItemHoverCss)}
                }
                `),t.customDropItemCss&&(a+=`div[data-instance-id='${n}'] .vue-treeselect__option {
                    ${this.getCustomCss(t.customDropItemHoverCss)}
                }
                `);let r={};return t.dropWidth&&(r.width=this.mUtils.getNewFontSize(t.dropWidth,i.attr.lockedW)+"px"),t.dropBackgroundImage&&(r.backgroundImage=`url(${this.mUtils.appendImageBaseURL(t.dropBackgroundImage)})`),t.dropColor&&(r.color=t.dropColor),t.dropFontFamily&&(r.fontFamily=t.dropFontFamily),t.dropFontSize&&(r.fontSize=this.mUtils.getNewFontSize(t.dropFontSize)+"px"),t.dropBackground&&(r.backgroundColor=t.dropBackground),a+=` div[data-instance-id='${n}'] .vue-treeselect__menu {
                        ${this.mUtils.style2CSSStr(r)};
                        ${this.getCustomCss(t.customDropCss)}
                        }
                        `,a},getLabelCssString:function(i){let t;if(i.config.part.label.show){let a=i.config.part.label.width,e=i.config.part.label.height;i.config.part.label.paddingLeft&&(a=a-i.config.part.label.paddingLeft),i.config.part.label.marginTop&&(e=e-i.config.part.label.marginTop),t={display:"inline-block",width:this.mUtils.getNewPxW(a)+"px",height:this.mUtils.getNewPxH(e)+"px",lineHeight:this.mUtils.getNewPxH(e)+"px",paddingLeft:this.mUtils.getNewPxW(i.config.part.label.paddingLeft)+"px",marginTop:this.mUtils.getNewPxH(i.config.part.label.marginTop)+"px",fontSize:this.mUtils.getNewFontSize(i.config.part.label.fontSize)+"px",fontFamily:i.config.part.label.fontFamily,color:i.config.part.label.color,textAlign:i.config.part.label.textAlign}}else t={display:"none"};return`
                #tree_select_${i.id} .tree_select_label {
                    ${y.style2CSSStr(t)};
                    ${this.getCustomCss(i.config.part.label.customCss)}
                }`},resize(){this.setStyle(this.widgetInfo)},reLoadInfo(i){this.loadInfo(i)},initAction(i){i.action&&i.action.receive&&i.action.receive.replaceFirstPid&&i.action.receive.replaceFirstPid.enabled&&this.doReplaceFirstPid(i.action.receive.replaceFirstPid,i),this.actionReceive(i)},doReplaceFirstPid(i,t){this.$$lib__.each(i.replaceList,a=>{let e=a[0][1]+"_"+a[0][0];a[0][1].indexOf("_")>-1&&(e=a[0][1]),$.Z.$on(e,o=>{let n=a[0][2],r=n.indexOf("|");r>-1&&(n=a[0][2].substring(r+1)),t.action.receive.replaceFirstPid.script&&t.action.receive.replaceFirstPid.script.enabled&&(T.log("Execute the script to"+i.name+" to the "+t.name+" component"),this.replaceFirstPid=new Function("info","data","param_key",t.action.receive.replaceFirstPid.script.content)),this.replaceFirstPid(t,o,n)})})},replaceFirstPid(i,t,a){this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode.firstPid=t[a],this.loadInfo(this.widgetInfo),this.selectValue=null},openEvent(i){this.widgetInfo.config.part.option.closeOnMouseLeave&&this.$nextTick(function(){this.autoCloseSelected=!0;let t=this.$refs.vueTreeselect,a=t.getInstanceId();document.querySelector(`.vue-treeselect[data-instance-id="${a}"] .vue-treeselect__menu`).addEventListener("mouseleave",function(){setTimeout(function(){t.closeMenu()},200)})})},closeEvent(i){if(i==null)return;let t=this,a=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(a,e=>{if(e.enabled&&e.code==t.$$global_editor.actionType.change.code){let o=t.$$global_editor.actionType.change.code+"_"+t.widgetInfo.id,n=this.getActionParam(i,e);if(e.script&&e.script.enabled){if(T.log("Execute script for "+this.widgetInfo.name+" component to "+e.name+" component"),e.script.content==""){m.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",e.script.content),n=this.customScript(n)}$.Z.$emit(o,n),e.postMessage&&this.doPostMessage(n),this.actionNameList.push(o)}}),setTimeout(()=>{this.setStyle()},1)},getActionParam(i,t){let a={value:i};return t.paramsExtend&&t.paramsExtend.length>0&&this.$$lib__.each(t.paramsExtend,e=>{if(e.type==this.$$global_editor.dataSourcType.static.code&&e.fieldS&&e.fieldS!="")s.default.set(a,e.fieldS,e.value);else if(e.type=="global"&&e.fieldG!=""){let o=this.getGlobalParamsVaule(e.fieldG);s.default.set(a,e.fieldG,o)}else if((e.type==this.$$global_editor.dataSourcType.dynamic.code||e.type==this.$$global_editor.dataSourcType.local.code)&&e.fieldD!="")if(i instanceof Array&&i.length>0){let o=[];for(let n=0;n<i.length;n++)o.push(this.getParamValue(i[n],e.fieldD));s.default.set(a,e.fieldD,o)}else s.default.set(a,e.fieldD,this.getParamValue(i,e.fieldD))}),a},getParamValue(i,t){let a=null,e=-1,o=-1,n=this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode,r=this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions,S=this.widgetInfo.dataset[this.widgetInfo.dataset.type].source;for(let d=0;d<r.length;d++)r[d]==n.id&&(e=d),r[d]==t&&(o=d);if(e>-1&&o>-1)for(let d=0;d<S.length;d++)S[d][e]==i&&(a=S[d][o]);return a},loadOptions({action:i,parentNode:t,callback:a}){let e=this;if((!e.widgetInfo.config.part.option.parentParams||e.widgetInfo.config.part.option.parentParams=="")&&m.Message.warning("\u672A\u9009\u62E9\u7236\u8282\u70B9\u53C2\u6570"),i===I.LOAD_CHILDREN_OPTIONS&&e.widgetInfo.config.part.option.delayedLoading){let o=e.replaceParentParams(t.id,e.widgetInfo.config.part.option.parentParams,e.widgetInfo.dataset[e.widgetInfo.dataset.type]);switch(this.viewType){case this.$$global.editType.original.code:g.o.getAggregateDataEx(o).then(n=>{if(n&&n.status==200){let r=this.listToObj(e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions,n.data.data);t.children=this.handleDataList(r,e.widgetInfo.dataset[e.widgetInfo.dataset.type].encode),a()}else a(new Error(n.msg))});break;case this.$$global.editType.public.code:this.getAggregateDataEx(o).then(n=>{if(n&&n.status==200){let r=this.listToObj(e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions,n.data.data);t.children=this.handleDataList(r,e.widgetInfo.dataset[e.widgetInfo.dataset.type].encode),a()}else a(new Error(n.msg))});break;default:g.o.getAggregateDataEx(o).then(n=>{if(n&&n.status==200){let r=this.listToObj(e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions,n.data.data);t.children=this.handleDataList(r,e.widgetInfo.dataset[e.widgetInfo.dataset.type].encode),a()}else a(new Error(n.msg))})}}},replaceParentParams(i,t,a){return a&&a.query&&a.query.params&&a.query.params.length>0&&this.$$lib__.each(a.query.params,e=>{e.name&&e.name==t&&(e.defaultVal=i)}),a.source=[],{dataSet:JSON.stringify(a)}},getTreeData(i,t,a){let e=[];if(i.id&&i.pid&&i.label){let o=this.listToObj(t,a);if(o.length==0)return e;this.widgetInfo.config.part.option.delayedLoading?e=this.handleDataList(o,i):e=this.handleDataTree(o,i)}return e},listToObj(i,t){let a=[];for(let e=0;e<t.length;e++){let o={};for(let n=0;n<i.length;n++)s.default.set(o,i[n],t[e][n]);a.push(JSON.parse(JSON.stringify(o)))}return a},handleDataList(i,t){let a=[];return this.$$lib__.each(i,e=>{e.id=e[t.id],e.label=e[t.label],e.children=null,this.$$lib__.isUndefined(e[t.disabled])||(e.isDisabled=y.stringToBoolean(e[t.disabled])),a.push(JSON.parse(JSON.stringify(e)))}),a},handleDataTree(i,t){let a={},e=[];return this.$$lib__.each(i,o=>{o.id=o[t.id],o.label=o[t.label],this.$$lib__.isUndefined(o[t.disabled])||(o.isDisabled=y.stringToBoolean(o[t.disabled])),o[t.pid]!=null&&o[t.pid]!=""&&o[t.pid]!=t.firstPid?(a[o[t.pid]]||(a[o[t.pid]]=[]),a[o[t.pid]].push(o)):e.push(o)}),this.transferFl(e,a,t.id),JSON.parse(JSON.stringify(e))},transferFl(i,t,a){this.$$lib__.each(i,e=>{let o=t[e[a]];o&&(e.children=o,this.transferFl(o,t,a))})},getValue(){return this.selectValue},getGlobalParams(i){let t;return this.$$lib__.each(this.canvasSetting.data.globalParams.params,(a,e)=>{i.split("globalParams_")[1]==e&&(t=a)}),t},getSelectValue(i){let t=null,a=i.dataset[i.dataset.type].encode.defaultValType,e=i.dataset[i.dataset.type].encode.defaultVal,o=i.dataset[i.dataset.type].encode.defaultParams;this.treeSelectData.length>0&&(a=="static"&&e&&e!=""?t=e:(a=="dynamic"||a=="local")&&o&&o!=""?t=this.getGlobalParams(o):a=="first"&&(i.config.part.option.disableBranchNodes?t=this.getFirstTreeNode(this.treeSelectData):t=this.treeSelectData[0].id));let n=null;return this.widgetInfo.config.part.option.multiple?(n=[],t&&t.split(",").length>1?n=t.split(","):t&&n.push(t)):n=t,n},getFirstTreeNode(i){let t=null;return i.length>0&&(i[0].children&&i[0].children.length>0?t=this.getFirstTreeNode(i[0].children):t=i[0].id),t},getCustomCss(i){return i?(i.indexOf(".cls")>-1&&(i=i.replace(".cls","").replace(".cls","").replace("{","").replace("}","")),i):""}}},_=H,N=l(68141),O=(0,N.Z)(_,w,c,!1,null,"3716b7fe",null),E=O.exports}}]);
