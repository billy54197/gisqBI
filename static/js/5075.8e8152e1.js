"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[5075],{75075:function(vt,m,e){var $=e(19534);Object.defineProperty(m,"__esModule",{value:!0}),m.default=void 0;var S=$(e(78254)),Z=S.default;m.default=Z},78254:function(vt,m,e){var $=e(49500),S=e(65557),Z=e(20314),gt=e(26352),ct=e(40639),xt=e(43586),d=e(19534);Object.defineProperty(m,"__esModule",{value:!![]}),m.default=m.IdentifyEvent=m.IdentifyActiveEvent=void 0;var s=d(e(28866)),mt=d(e(66880)),K=d(e(85208)),ot=d(e(22466)),It=d(e(81806)),Et=d(e(78756)),pt=d(e(20314)),At=d(e(52909)),Ct=d(e(18853)),y=d(e(42579)),Ft=d(e(87507)),Q=d(e(42762)),X=d(e(22777)),b=d(e(30044)),Pt=d(e(99085)),lt=d(e(34009)),Gt=d(e(23378)),Lt=e(1117),Tt=d(e(7165)),st=d(e(12207)),wt=e(12768),St=e(65056),Ot=e(92086),q=e(91873),ut=e(63870),ft=d(e(47598)),Dt=e(72233),Vt=d(e(97998)),Ht=d(e(27482)),k=e(25794),j=e(3674),dt=d(e(49162)),jt=e(59269);function Rt(o,v){var r=typeof ct<"u"&&xt(o)||o["@@iterator"];if(!r){if(Array.isArray(o)||(r=Mt(o))||v&&o&&typeof o.length=="number"){r&&(o=r);var l=0,t=function(){};return{s:t,n:function(){return l>=o.length?{done:!![]}:{done:![],value:o[l++]}},e:function(f){throw f},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n=!![],u=![],a;return{s:function(){r=r.call(o)},n:function(){var f=r.next();return n=f.done,f},e:function(f){u=!![],a=f},f:function(){try{!n&&r.return!=null&&r.return()}finally{if(u)throw a}}}}function Mt(o,v){var r;if(o){if(typeof o=="string")return ht(o,v);var l=Z(r=Object.prototype.toString.call(o)).call(r,8,-1);if(l==="Object"&&o.constructor&&(l=o.constructor.name),l==="Map"||l==="Set")return gt(o);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return ht(o,v)}}function ht(o,v){(v==null||v>o.length)&&(v=o.length);for(var r=0,l=new Array(v);r<v;r++)l[r]=o[r];return l}function _(o){var v=Yt();return function(){var l=(0,lt.default)(o),t;if(v){var n=(0,lt.default)(this).constructor;t=S(l,arguments,n)}else t=l.apply(this,arguments);return(0,Pt.default)(this,t)}}function Yt(){if(typeof Reflect>"u"||!S)return![];if(S.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(S(Boolean,[],function(){})),!![]}catch{return![]}}var p=new dt.default,L={CHANGEACTIVE:"change:active",IDEHTIFYED:"identifyed",IDEHTIFYEDALL:"identifyedAll"},tt=function(o){(0,b.default)(r,o);var v=_(r);function r(l,t,n){var u;return(0,X.default)(this,r),u=v.call(this,l),u.active=t,u.identifyType=n,u}return(0,Q.default)(r)}(st.default);m.IdentifyActiveEvent=tt;var O=function(o){(0,b.default)(r,o);var v=_(r);function r(l,t,n,u){var a;return(0,X.default)(this,r),a=v.call(this,l),a.result=t,a.coordinate=n,a.queryId=u,a}return(0,Q.default)(r)}(st.default);m.IdentifyEvent=O;var Bt=function(o){(0,b.default)(r,o);var v=_(r);function r(l){var t;return(0,X.default)(this,r),t=v.call(this),t.active=![],t.map=l,t.allVectorFeatures={},t.mapIdentifyExecute=t.mapIdentifyExecute.bind((0,Ft.default)(t)),t}return(0,Q.default)(r,[{key:"init",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"click";(0,s.default)(this)&&!(0,mt.default)(t).call(t,"buffer")&&this.initMapIdentify(t),this.active=!![],this.dispatchEvent(new tt(L.CHANGEACTIVE,this.active,t))}},{key:"initMapIdentify",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"click";if(n==="click")(0,s.default)(this).on("click",this.mapIdentifyExecute);else{var u=(0,s.default)(this).getLayerById("identifyDrawLayer").getSource(),a="";n==="polygon"?a="Polygon":n==="line"?a="LineString":n==="box"&&(a="Circle");var i={source:u,type:a};a==="Circle"&&(i.geometryFunction=(0,St.createBox)()),this.draw=new wt.Draw(i),this.draw.on("drawstart",function(){var f=this;(0,y.default)(this,t),u.once("addfeature",function(){var g=this;(0,y.default)(this,f),setTimeout(function(){(0,y.default)(this,g),u.clear()}.bind(this),500)}.bind(this))}.bind(this)),this.draw.on("drawend",function(f){(0,y.default)(this,t);var g=f.feature;this.identifyLayer(g)}.bind(this)),(0,s.default)(this).addInteraction(this.draw)}}},{key:"mapIdentifyExecute",value:function(t){var n=new ft.default({geometry:new Gt.default(t.coordinate)});this.identifyLayer(n)}},{key:"identifyLayer",value:function(t){var n=this;if((0,s.default)(this).maskGeoJson){var u=p.writeGeometryObject(p.readGeometry((0,s.default)(this).maskGeoJson));if(t.getGeometry().getType()==="Point"&&!(0,k.booleanPointInPolygon)(t.getGeometry().getCoordinates(),u))return}(0,s.default)(this).getContainer().style.cursor="wait";var a=(0,Ot.getCenter)(t.getGeometry().getExtent()),i=(0,Lt.v4)(),f=(0,s.default)(this).layerManager.getCheckedLayers(),g=p.writeGeometry(t.getGeometry()),c=[];if(this.allVectorFeatures={},t.getGeometry().getType()==="Point"){var R=(0,s.default)(this).getPixelFromCoordinate(a);(0,s.default)(this).forEachFeatureAtPixel(R,function(E,P){var W=this;(0,y.default)(this,n);var B=P.get("id");(0,K.default)(this.allVectorFeatures).some(function(rt){return(0,y.default)(this,W),rt===B}.bind(this))?this.allVectorFeatures[B].push(E):this.allVectorFeatures[B]=[E]}.bind(this),{layerFilter:function(P){return(0,y.default)(this,n),!!P.get("id")}.bind(this),hitTolerance:3})}for(var T=(0,s.default)(this).layerManager.getAllDrawLayer(jt.DRAWLAYER_TYPE),F=(0,ot.default)(T).call(T,function(E){var P;return(0,y.default)(this,n),(0,It.default)(P=(0,K.default)(this.allVectorFeatures)).call(P,E.get("id"))}.bind(this)),A=0,I=F.length;A<I;A++){var C=F[A].getProperties(),et=C.id,it=C.isPop,D=C.drawLayerType,nt=C.layerTag,J=C.visible,N=C.label,M={id:et,isPop:it,type:D,group:"2",layerTag:nt,label:N,identifyField:[{}]};if(J){var U=this.getVectorLayerIdentifyTask(M,t);U&&c.push(U)}}for(var Y=0,at=f.length;Y<at;Y++){var h=(0,j.compatibleOldFormConfig)(f[Y]);if(h.type==="geoserver-wfs"||h.type==="arcgis-wfs"||h.type==="geoJson"||h.type==="feature"||h.type==="feature-pbf"){var V=this.getVectorLayerIdentifyTask(h,t);V&&c.push(V)}else if(h.serverOrigin==="geoserver"){var x=(0,j.getGeoServerIdentifyTask)(h,g,{map:(0,s.default)(this)});x&&c.push(x)}else if(h.serverOrigin==="arcgis"){var w=(0,j.getArcgisIdentifyTask)(h,g,{map:(0,s.default)(this)});w&&c.push(w)}else if(h.serverOrigin==="geoway"){var H=(0,j.getGeowayIdentifyTask)(h,g,{map:(0,s.default)(this)});H&&c.push(H)}}c.length>0?this.taskHandle(c,i,a):((0,s.default)(this).getContainer().style.cursor="auto",this.dispatchEvent(new O(L.IDEHTIFYED,[],a,i)),this.dispatchEvent(new O(L.IDEHTIFYEDALL,[],a,i)))}},{key:"getVectorLayerIdentifyTask",value:function(t,n){var u,a=this,i=(u=t.identifyField)===null||u===void 0?void 0:(0,ot.default)(u).call(u,function(h){return(0,y.default)(this,a),h.isOpenSearch!==![]}.bind(this));if(t.group==="2"&&i?.length>0&&(0,j.judgeZoomLimit)({map:(0,s.default)(this)},t.identifyZoom)){var f=t.serverOrigin,g=t.label,c=t.id,R=t.isPop,T=t.layerTag,F=[],A={type:f,results:[],layerLabel:g,layerId:c,isPop:R,layerTag:T};if(n.getGeometry().getType()==="Point")F=this.allVectorFeatures[t.id]||[];else{var I=[],C=(0,s.default)(this).getLayerById(t.id);if(C instanceof Ht.default){var et=C.getLayers();et.forEach(function(h){(0,y.default)(this,a),I.push(h.getSource())}.bind(this))}else I.push(C.getSource());var it=n.getGeometry(),D=(0,s.default)(this).getView().getProjection().getCode(),nt=(0,Dt.getPointResolution)((0,s.default)(this).getView().getProjection(),(0,s.default)(this).getView().getResolution(),(0,s.default)(this).getView().getCenter(),Vt.default.METERS),J=(0,k.buffer)(p.writeGeometryObject(it.transform(D,"EPSG:4326")),3*nt/1e3),N=p.readFeature(J).getGeometry().transform("EPSG:4326",D),M=p.writeGeometryObject(N.clone().transform(D,"EPSG:4326"));if((0,s.default)(this).maskGeoJson){var U=p.writeGeometryObject(p.readGeometry((0,s.default)(this).maskGeoJson)),Y=(0,k.intersect)(U,J);M=Y}M&&I.forEach(function(h){var V=this;(0,y.default)(this,a),h.forEachFeatureIntersectingExtent(N.getExtent(),function(x){(0,y.default)(this,V);var w=p.writeGeometryObject(x.clone().getGeometry().transform(D,"EPSG:4326"));(0,k.booleanIntersects)(w,M)&&F.push(x)}.bind(this))}.bind(this))}var at=new Et.default(function(h){var V=this;(0,y.default)(this,a),F.forEach(function(x){var w=this;(0,y.default)(this,V);var H={},E=x.getProperties();if(delete E.geometry,f==="arcgis"){var P,W={},B=(0,pt.default)(P=x.id_).call(P,0,x.id_.lastIndexOf("."));H=i==null?void 0:(0,At.default)(i).call(i,function(z){return(0,y.default)(this,w),z.name===B}.bind(this));var rt=H.fieldAliases;(0,K.default)(E).forEach(function(z){(0,y.default)(this,w),W[rt[z]]=E[z]}.bind(this)),E=W}var yt={identifyField:H,geometry:p.writeGeometry(x.getGeometry()),attributes:E};if(x.drawType==="videoProjection"){var G=x.originStyle,Jt=G.showFrustumOutline,Nt=G.showPlayer,Ut=G.showSketch,Wt=G.verticalViewAngle,zt=G.videoUrl,$t=G.viewDistance,Zt=G.viewHeading,Kt=G.viewPitch,Qt=G.horizontalViewAngle;yt.video={showFrustumOutline:Jt,showPlayer:Nt,showSketch:Ut,verticalViewAngle:Wt,videoUrl:zt,viewDistance:$t,viewHeading:Zt,viewPitch:Kt,horizontalViewAngle:Qt}}A.results.push(yt)}.bind(this)),h(A)}.bind(this));return at}}},{key:"taskHandle",value:function(t,n,u){var a=this,i=0,f=[],g=Rt(t),c;try{var R=function(){var F=this,A=c.value;A.id=n,A.then(function(I){(0,y.default)(this,F),(0,s.default)(a).getContainer().style.cursor="auto",i++,A.id===n&&(a.dispatchEvent(new O(L.IDEHTIFYED,I,u,n)),I.results.length&&f.push(I),i===t.length&&a.dispatchEvent(new O(L.IDEHTIFYEDALL,f,u,n)))}.bind(this)).catch(function(I){(0,y.default)(this,F),i++,i===t.length&&a.dispatchEvent(new O(L.IDEHTIFYEDALL,f,u,n)),(0,s.default)(a).getContainer().style.cursor="auto",$.error(I)}.bind(this))};for(g.s();!(c=g.n()).done;)R()}catch(T){g.e(T)}finally{g.f()}}},{key:"clearHighLight",value:function(){(0,s.default)(this).getLayerById("identifyPopupLayer").getSource().getFeatures().length>0&&(0,s.default)(this).getLayerById("identifyPopupLayer").getSource().clear()}},{key:"highLightFeature",value:function(t){var n=t.geometry,u=t.identifyField;if(n){var a=new dt.default,i=a.readGeometry(n);this.clearHighLight();var f=new ft.default({geometry:i});f.setStyle(this.setFeaturesStyle(u)),(0,s.default)(this).getLayerById("identifyPopupLayer").getSource().addFeature(f)}}},{key:"setFeaturesStyle",value:function(t){var n=this.colorConfig?this.colorConfig.fillColor:"",u=this.colorConfig?this.colorConfig.strokeColor:"",a=3;if(t&&t.pickfeaturestyle){var i=t.pickfeaturestyle;(0,Ct.default)(i)&&i.color&&(n=(0,ut.asArray)(i.color),i.opacity&&(n[3]=i.opacity/100)),i.outline&&i.outlineColor&&(u=(0,ut.asArray)(i.outlineColor),i.outlineOpacity&&(u[3]=i.outlineOpacity/100)),i.outline&&i.outlineWidth&&(a=i.outlineWidth)}var f=new q.Fill({color:n||[255,0,0,.5]}),g=new q.Stroke({color:u||[255,0,0],width:a}),c=new q.Style({fill:f,stroke:g});return c}},{key:"setActive",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"click";t?this.init(n):this.active&&this.cancel()}},{key:"cancel",value:function(){(0,s.default)(this)&&((0,s.default)(this).un("click",this.mapIdentifyExecute),(0,s.default)(this).removeInteraction(this.draw)),this.active=![],this.dispatchEvent(new tt(L.CHANGEACTIVE,this.active))}}]),r}(Tt.default),kt=Bt;m.default=kt}}]);
