"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[9249],{9249:function(D,m,a){a.r(m),a.d(m,{default:function(){return W}});var y=function(){var t=this,i=t._self._c;return i("div",{ref:"pictureList",staticClass:"pictureList",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[i("hide-button",{attrs:{attr:t.widgetInfo.attr}}),t.hasImage_?i("div",{style:{paddingLeft:t.mUtils.getNewPxW(t.widgetInfo.config.global.padding.left,t.widgetInfo)+"px",paddingTop:t.mUtils.getNewPxW(t.widgetInfo.config.global.padding.top,t.widgetInfo)+"px"}},[t._l(t.listInfo,function(s,r){return i("div",{key:r,style:t.getContentAreaStyle(t.widgetInfo.config.contentArea),on:{click:function(n){return t.onClick(n,s,r)}}},[i("div",{style:t.getTitleStyle(t.widgetInfo.config.title)},[t._v(" "+t._s(s.title)+" ")]),i("div",{staticStyle:{width:"100%"}},[i("el-image",{style:t.getPictureStyle(t.widgetInfo.config.picture),attrs:{src:t.getImageSrc(s.url),fit:t.widgetInfo.config.picture.fit,id:"picture_list_"+(s.__field__||r)}},[i("div",{staticClass:"picture-list-image-slot-error",attrs:{slot:"error"},slot:"error"},[t._v(" "+t._s(t.widgetInfo.config.picture.errorText)+" ")])])],1),i("div",{ref:"contentTextArea",refInFor:!0,staticClass:"test-div",style:t.getContentStyle(t.widgetInfo.config.content),attrs:{contenteditable:"false"},domProps:{textContent:t._s(s.content)}})])}),[t.showViewer?i("pic-image-viewer",{attrs:{"on-close":t.closeViewer,"initial-index":t.currentIndex,infinite:t.widgetInfo.config.picture.infinite,"url-list":t.previewSrcList(t.srcList),errorText:t.widgetInfo.config.picture.errorText}}):t._e()]],2):i("diV",{staticClass:"picture-list-image-slot-error"},[t._v(" "+t._s(t.widgetInfo.config.picture.emptyText)+" ")])],1)},x=[],p=a(927966),o=a(321300),_=a(445061),S=a(126711),b=a(56279),k=a(844513),C=a(569861),u=a(555616),$=function(){var t=this,i=t._self._c;return i("transition",{attrs:{name:"viewer-fade"}},[i("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper",style:{"z-index":t.viewerZIndex},attrs:{tabindex:"-1"}},[i("div",{staticClass:"el-image-viewer__mask",on:{click:function(s){return s.target!==s.currentTarget?null:t.handleMaskClick.apply(null,arguments)}}}),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:t.hide}},[i("i",{staticClass:"el-icon-close"})]),t.isSingle?t._e():[i("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!t.infinite&&t.isFirst},on:{click:t.prev}},[i("i",{staticClass:"el-icon-arrow-left"})]),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!t.infinite&&t.isLast},on:{click:t.next}},[i("i",{staticClass:"el-icon-arrow-right"})])],i("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[i("div",{staticClass:"el-image-viewer__actions__inner"},[i("i",{staticClass:"el-icon-zoom-out",on:{click:function(s){return t.handleActions("zoomOut")}}}),i("i",{staticClass:"el-icon-zoom-in",on:{click:function(s){return t.handleActions("zoomIn")}}}),i("i",{staticClass:"el-image-viewer__actions__divider"}),i("i",{class:t.mode.icon,on:{click:t.toggleMode}}),i("i",{staticClass:"el-image-viewer__actions__divider"}),i("i",{staticClass:"el-icon-refresh-left",on:{click:function(s){return t.handleActions("anticlocelise")}}}),i("i",{staticClass:"el-icon-refresh-right",on:{click:function(s){return t.handleActions("clocelise")}}})])]),i("div",{staticClass:"el-image-viewer__canvas"},t._l(t.urlList,function(s,r){return r===t.index?i("img",{key:s,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img",style:t.imgStyle,attrs:{src:t.currentImg},on:{load:t.handleImgLoad,error:t.handleImgError,mousedown:t.handleMouseDown}}):t._e()}),0)],2)])},L=[],c=a(777712),h=a(529896),P=a(595058);const f={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},w=(0,h.vU)()?"DOMMouseScroll":"mousewheel";var T={name:"picImageViewer",props:{infinite:{type:Boolean,default:!0},urlList:{type:Array,default:()=>[]},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:()=>{}},onClose:{type:Function,default:()=>{}},initialIndex:{type:Number,default:0},appendToBody:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},errorText:{type:String,default:"\u52A0\u8F7D\u5931\u8D25"}},data(){return{index:this.initialIndex,isShow:!1,loading:!1,mode:f.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}},computed:{isSingle(){return this.urlList.length<=1},isFirst(){return this.index===0},isLast(){return this.index===this.urlList.length-1},currentImg(){return this.urlList[this.index]},imgStyle(){const{scale:e,deg:t,offsetX:i,offsetY:s,enableTransition:r}=this.transform,n={transform:`scale(${e}) rotate(${t}deg)`,transition:r?"transform .3s":"","margin-left":`${i}px`,"margin-top":`${s}px`,color:"white"};return this.mode===f.CONTAIN&&(n.maxWidth=n.maxHeight="100%"),n},viewerZIndex(){const e=P.q.nextZIndex();return this.zIndex>e?this.zIndex:e}},watch:{index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg(e){this.$nextTick(t=>{this.$refs.img[0].complete||(this.loading=!0)})}},methods:{hide(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall(){this._keyDownHandler=e=>{switch(e.stopPropagation(),e.keyCode){case 27:this.hide();break;case 32:this.toggleMode();break;case 37:this.prev();break;case 38:this.handleActions("zoomIn");break;case 39:this.next();break;case 40:this.handleActions("zoomOut");break}},this._mouseWheelHandler=(0,h.TE)(e=>{(e.wheelDelta?e.wheelDelta:-e.detail)>0?this.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):this.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1})}),(0,c.on)(document,"keydown",this._keyDownHandler),(0,c.on)(document,w,this._mouseWheelHandler)},deviceSupportUninstall(){(0,c.S1)(document,"keydown",this._keyDownHandler),(0,c.S1)(document,w,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad(e){this.loading=!1},handleImgError(e){this.loading=!1,e.target.alt=this.errorText},handleMouseDown(e){if(this.loading||e.button!==0)return;const{offsetX:t,offsetY:i}=this.transform,s=e.pageX,r=e.pageY;this._dragHandler=(0,h.TE)(n=>{this.transform.offsetX=t+n.pageX-s,this.transform.offsetY=i+n.pageY-r}),(0,c.on)(document,"mousemove",this._dragHandler),(0,c.on)(document,"mouseup",n=>{(0,c.S1)(document,"mousemove",this._dragHandler)}),e.preventDefault()},handleMaskClick(){this.maskClosable&&this.hide()},reset(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode(){if(this.loading)return;const e=Object.keys(f),s=(Object.values(f).indexOf(this.mode)+1)%e.length;this.mode=f[e[s]],this.reset()},prev(){if(this.isFirst&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index-1+e)%e},next(){if(this.isLast&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index+1)%e},handleActions(e,t={}){if(this.loading)return;const{zoomRate:i,rotateDeg:s,enableTransition:r}={zoomRate:.2,rotateDeg:90,enableTransition:!0,...t},{transform:n}=this;switch(e){case"zoomOut":n.scale>.2&&(n.scale=parseFloat((n.scale-i).toFixed(3)));break;case"zoomIn":n.scale=parseFloat((n.scale+i).toFixed(3));break;case"clocelise":n.deg+=s;break;case"anticlocelise":n.deg-=s;break}n.enableTransition=r}},mounted(){this.deviceSupportInstall(),this.appendToBody&&document.body.appendChild(this.$el),this.$refs["el-image-viewer__wrapper"].focus()},destroyed(){this.appendToBody&&this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},z=T,v=a(768141),N=(0,v.Z)(z,$,L,!1,null,"68c44763",null),F=N.exports,A=a(67157);const H={mixins:[A.c],data(){return{config_extend:{config:{title:{hide:!0}}},filter_config:{contentArea:{opacity:1},title:{fontStyle:{fontFamily:"Microsoft Yahei",color:""}},content:{backgroundColor:"rgba(236, 240, 241, 1)",fontStyle:{fontFamily:"Microsoft Yahei",color:""}}}}},methods:{filterPredefineColoursSchemeConfig(e,t){this.getNewConfigWithArrary(e,t,this.filter_config)}}};var g=a(149500),E={name:"picture-list",props:["widgetInfo"],components:{HideButton:k.Z,PicImageViewer:F},mixins:[C.baseConfig,_.u,S.H,b.P,H],data(){return{showViewer:!1,currentIndex:0,lib_:this.$$lib__,currentAction:""}},computed:{listInfo:function(){return this.getListInfo(this.widgetInfo.dataset[this.widgetInfo.dataset.type])},srcList(){return this.widgetInfo.config.picture.isPreviewSrcList?this.listInfo.map(e=>this.getImageSrc(e.url)):null},hasImage_(){return this.widgetInfo.dataset[this.widgetInfo.dataset.type].source.length>0}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{closeViewer(){this.showViewer=!1},loadInfo(){this.lifecycleAfterLoad()},reLoadInfo(e){this.loadInfo(e)},initAction(e){this.actionReceive(e)},getListInfo(e){let t=[];return e.source.length||(e.source=[""]),this.lib_.each(e.source,i=>{let s={title:"",url:"",content:""};if(s.title=this.getFieldVal(i,e.dimensions,e.encode.title),s.url=this.getFieldVal(i,e.dimensions,e.encode.url),s.content=this.getFieldVal(i,e.dimensions,e.encode.content),this.widgetInfo.action.receive.preview&&this.widgetInfo.action.receive.preview.enabled){const r=this.widgetInfo.action.receive.preview.field;r&&(s.__field__=this.getFieldVal(i,e.dimensions,r))}t.push(s)}),t},getContentAreaStyle(e){return{float:"left",width:o.getNewPxW(e.w,this.widgetInfo)+"px",height:o.getNewPxH(e.h,this.widgetInfo)+"px",marginLeft:o.getNewPxW(e.left,this.widgetInfo)+"px",marginTop:o.getNewPxH(e.top,this.widgetInfo)+"px",opacity:e.opacity,backgroundColor:e.backgroundColor,backgroundImage:this.getImageUrl(e.backgroundImage),backgroundSize:e.backgroundSize,cursor:this.getCursor(this.widgetInfo.action,this.$$global_editor.actionType.click.code,this.$$global_editor.actionType.openLink.code)}},getPictureStyle(e){return{width:o.getNewPxW(e.w,this.widgetInfo)+"px",height:o.getNewPxH(e.h,this.widgetInfo)+"px",marginLeft:o.getNewPxW(e.left,this.widgetInfo)+"px",marginTop:o.getNewPxH(e.top,this.widgetInfo)+"px",opacity:e.opacity}},getTitleStyle(e){return{height:o.getNewPxH(e.h,this.widgetInfo)+"px",lineHeight:o.getNewPxH(e.h,this.widgetInfo)+"px",opacity:e.opacity,display:e.hide==!0?"none":"",paddingLeft:o.getNewPxW(e.left,this.widgetInfo)+"px",paddingTop:o.getNewPxH(e.top,this.widgetInfo)+"px",backgroundColor:e.backgroundColor,backgroundImage:this.getImageUrl(e.backgroundImage),backgroundSize:e.backgroundSize,fontSize:o.getNewFontSize(e.fontStyle.fontSize)+"px",fontFamily:e.fontStyle.fontFamily,color:e.fontStyle.color,fontWeight:e.fontStyle.fontWeight,fontStyle:e.fontStyle.fontStyle,textDecoration:e.fontStyle.textDecoration,textAlign:e.fontStyle.horizontalAlignment}},getContentStyle(e){return{height:o.getNewPxH(e.h,this.widgetInfo)+"px",lineHeight:o.getNewPxH(e.lineHeight,this.widgetInfo)+"px",opacity:e.opacity,display:e.hide==!0?"none":"",paddingLeft:o.getNewPxH(e.left,this.widgetInfo)+"px",marginTop:o.getNewPxW(e.top,this.widgetInfo)+"px",backgroundColor:e.backgroundColor,backgroundImage:this.getImageUrl(e.backgroundImage),backgroundSize:e.backgroundSize,fontSize:o.getNewFontSize(e.fontStyle.fontSize)+"px",fontFamily:e.fontStyle.fontFamily,color:e.fontStyle.color,fontWeight:e.fontStyle.fontWeight,fontStyle:e.fontStyle.fontStyle,textDecoration:e.fontStyle.textDecoration,textAlign:e.fontStyle.horizontalAlignment}},onClick(e,t,i){this.currentIndex=i,this.showViewer=!0,this.setPreviewStyle();let s=this,r=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(r,n=>{if(n.enabled&&n.code.indexOf(s.$$global_editor.actionType.click.code)>-1){s.currentAction=n;let l=n.code+"_"+s.widgetInfo.id,d={text:t.title};if(n.paramsExtend&&n.paramsExtend.length>0&&this.getExtendParams(d,n.paramsExtend,s.widgetInfo.dataset[s.widgetInfo.dataset.type].source[i],s.widgetInfo.dataset[s.widgetInfo.dataset.type].dimensions),n.script&&n.script.enabled){if(g.log("Execute script for "+s.widgetInfo.name+" component to "+n.name+" component"),n.script.content==""){u.Message.warning({message:n.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam=new Function("param,params",n.script.content),d=this.customScript_actionSend_clickParam(d,n.params)}p.Z.$emit(l,d),n.postMessage&&this.doPostMessage(d),this.actionNameList.push(l)}else if(n.enabled&&n.code.indexOf(s.$$global_editor.actionType.openLink.code)>-1){s.currentAction=n;let l={};if(n.paramsExtend&&n.paramsExtend.length>0&&this.getExtendParams(l,n.paramsExtend,s.widgetInfo.dataset[s.widgetInfo.dataset.type].source[i],s.widgetInfo.dataset[s.widgetInfo.dataset.type].dimensions),n.type===this.$$global_editor.linkType.dynamic.code&&(n[this.$$global_editor.linkType.dynamic.code].url=this.getActionUrl(n,s.widgetInfo.dataset[s.widgetInfo.dataset.type].source[i],s.widgetInfo.dataset[s.widgetInfo.dataset.type].dimensions)),n.script&&n.script.enabled){if(g.log("Execute script for "+s.widgetInfo.name+" component to "+n.name+" component"),n.script.content==""){u.Message.warning({message:n.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam=new Function("param,params",n.script.content),l=this.customScript_actionSend_clickParam(l,n.params)}this.openLinkAction(n,l)}else n.enabled&&n.code.indexOf(s.$$global_editor.actionType.previewChange.code)>-1&&(s.currentAction=n,this.$nextTick(()=>{setTimeout(()=>{let l=document.querySelector(".el-image-viewer__btn.el-image-viewer__prev"),d=document.querySelector(".el-image-viewer__btn.el-image-viewer__next");if(l&&d){let I=this;l.addEventListener("click",I.previewChangeFun,!1),d.addEventListener("click",I.previewChangeFun,!1)}},1e3)}))})},previewChangeFun(){let e=this.currentAction,t=this,i=document.querySelector(".el-image-viewer__canvas .el-image-viewer__img").src,s=e.code+"_"+t.widgetInfo.id,r=t.getImgIndex(i),n={index:r};if(e.paramsExtend&&e.paramsExtend.length>0&&t.getExtendParams(n,e.paramsExtend,t.widgetInfo.dataset[t.widgetInfo.dataset.type].source[r],t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions),e.script&&e.script.enabled){if(g.log("Execute script for "+t.widgetInfo.name+" component to "+e.name+" component"),e.script.content==""){u.Message.warning({message:e.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}t.customScript_actionSend_clickParam=new Function("param",e.script.content),n=t.customScript_actionSend_clickParam(n)}p.Z.$emit(s,n),e.postMessage&&t.doPostMessage(n)},getImgIndex(e){for(let t=0;t<this.srcList.length;t++)if(this.srcList[t]==e)return t},getCursor(e,t,i){let s="default";if(e==null||e.sendOut==null||e.sendOut.actionList==null)return s;let r=e.sendOut.actionList;return this.$$lib__.find(r,l=>(l.code.indexOf(t)>-1||l.code.indexOf(i)>-1)&&l.enabled)&&(s="pointer"),s},getImageUrl(e){return e&&e!==""?/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*?)\s*$/i.test(e)?e:(g.info(o.appendImageBaseURL(e)),"url("+o.appendImageBaseURL(e)+")"):null},getImageSrc(e){return e&&e!==""?/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*?)\s*$/i.test(e)?e:o.appendImageBaseURL(e):null},setPreviewStyle(){if(this.widgetInfo.config.picture.isPreviewSrcList){let e=document.querySelector(".el-image-viewer__wrapper");e&&(e.style.top=this.widgetInfo.config.picture.previewTop+"px",e.style.bottom=this.widgetInfo.config.picture.previewBottom+"px",e.style.left=this.widgetInfo.config.picture.previewLeft+"px",e.style.right=this.widgetInfo.config.picture.previewRight+"px",document.querySelector(".el-image-viewer__mask").style.opacity=this.widgetInfo.config.picture.previewOpacity)}},setPreviewSrcList(e){const t="#picture_list_"+e,i=this.$refs.pictureList.querySelector(t);let s=document.querySelector(".el-image-viewer__close");i&&(this.widgetInfo.config.picture.isPreviewSrcList=!0,s&&s.click(),this.$nextTick(()=>{i.click(),this.$nextTick(()=>{this.setPreviewStyle()})}))},previewSrcList(e){g.log(e);let t=[];for(let i=0;i<e.length;i++)e[i]==null&&(e[i]="http:.png"),t.push(e[i]);return g.log(t),t}}},O=E,M=(0,v.Z)(O,y,x,!1,null,"899fca82",null),W=M.exports}}]);
