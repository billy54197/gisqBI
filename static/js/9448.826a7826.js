"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[9448],{69448:function(Q,N,r){r.r(N),r.d(N,{default:function(){return V}});var A=function(){var i=this,t=i._self._c;return t("div",{style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[t("hide-button",{attrs:{attr:i.widgetInfo.attr}}),t("div",{ref:"countryMapBar",staticClass:"charts chart-bar map-mount-node",style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"},attrs:{id:"mapChart"}})],1)},B=[],$=r(21300),L=r(44513),O=r(27966),T=r(45061),j=r(26711),J=r(99349),D=r(5572),G=r(67157),w=r(50666);const q={mixins:[G.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(w.Z.charts.title)),legend:JSON.parse(JSON.stringify(w.Z.charts.legend)),tooltip2:JSON.parse(JSON.stringify(w.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(w.Z.charts.toolbox)),visualMap:{inRange:{color:["#147AD9","#4C84FF"]}},geo:{label:{color:""},name:{color:"rgba(255,69,0,1)"}},map:{itemStyle:{normal:{areaColor:"rgba(0, 0, 0,0)",opacity:1,color:"#389BB7",borderColor:"rgba(147, 235, 248)",shadowColor:"rgba(128, 217, 248,.6)"},emphasis:{areaColor:"#389BB7"}}},liquidFill:{show:!0,color:["#294D99"],itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.4)"},backgroundStyle:{borderWidth:2,borderColor:"#1789fb",color:"#E3F7FF"},outline:{show:!1,borderDistance:10,itemStyle:{}},label:{show:!0,color:"#294D99",fontFamily:"Microsoft Yahei",fontSize:12,fontWeight:"normal",align:"center",baseline:"middle"},colorList:[]},graphic:{style:{color:"#294D99"}}}}},methods:{filterPredefineColoursSchemeConfig(e,i){this.getNewConfigWithArrary(e,i,this.filter_config)}}};var _=r(96896),F=r(43156),E=r(55616),W=r(56279),s=r(49500);const z=r(29426);var k={props:["widgetInfo"],name:"country-map-liquidfill",components:{HideButton:L.Z},mixins:[D.u,q,T.u,j.H,W.P,J.P],data(){return{mapChart:null,dimensionsEx:null,dimensionsAliasEx:null,identical:!0,regionParent:{name:null,code:null},currentRegion:{id:null,name:null,cp:null,features:null,childrenCentralPoint:null}}},mounted(){this.mapChart||(this.mapChart=z.init(this.$refs.countryMapBar,null,{devicePixelRatio:2})),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.mapChart.dispose()},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(e){e==null&&(e=this.widgetInfo),this.getCurrentRegionInfo(e.config.regionCode,i=>{let t=e.dataset[e.dataset.type].source,n=e.dataset[e.dataset.type].dimensions,o=e.dataset[e.dataset.type].dimensionsAlias,l=e.dataset[e.dataset.type].encode;this.dimensionsEx=n,this.dimensionsAliasEx=o,this.encode=l;let p=JSON.parse(JSON.stringify(e.config.title)),f=this.getTooltip(e.config.tooltip2),S=this.getLegend(e.config.legend);e.config.visualMap.visualMapMin=="dataMin"&&(e.config.visualMap.min=this.getVisualmapData(e,l.percentage)[0]),e.config.visualMap.visualMapMax=="dataMax"&&(e.config.visualMap.max=this.getVisualmapData(e,l.percentage)[1]);let d={animation:!0,color:"rgba(0,0,0,0)",title:p,tooltip:f,legend:S,visualMap:e.config.visualMap.show?this.getVisualMap(e.config.visualMap):""},u=[],b=t.length,a={};for(let c=n.length-1;c>-1;--c)a[n[c]]=c;let I="";a[l.percentage]&&(I=this.dimensionsAliasEx[a[l.percentage]].alias||this.dimensionsAliasEx[a[l.percentage]].name);for(let c=0;c<b;++c){let g=t[c],P=g[a[l.region]]||"",M=g[a[l.name]]||"",v=g[a[l.coordinate]]||"",X=g[a[l.molecular]]||"",Y=g[a[l.denominator]]||"",K=g[a[l.percentage]]||"",x=[],R=NaN;if(e.dataset.regionType==="coordinate")v=v.split(","),x=[Number(v[0].trim()),Number(v[1].trim())];else{let C=this.getFeatureInfo(P);C&&(M=C.name,C.cp&&C.cp.length==2?x=C.cp:s.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF0C\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+P+' ]\u7684\u4E2D\u5FC3\u70B9cp\u5C5E\u6027\uFF0C\u5373properties:{"id":"","name":"","cp":[]}\u5C5E\u6027\u4E2Dcp\u4E0D\u5B58\u5728'))}e.dataset.scaleType==="molecular"?R=parseFloat((parseFloat(X)/parseFloat(Y)).toFixed(4)):R=parseFloat((parseFloat(K)/100).toFixed(4)),u.push({value:R,coordinates:x,name:M,source:g,alias:I,type:g[a[l.type]]||""})}let h=e.config.graphic.style.fontSize+"px solid"+e.config.graphic.style.fontFamily;d.graphic=[{type:"group",bounding:"raw",left:e.config.graphic.style.iconLeft+"%",top:e.config.graphic.style.iconTop+"%",ignore:this.ignoreGraphic(),children:[{type:"text",z:100,style:{fill:e.config.graphic.style.color,text:e.config.graphic.style.text?e.config.graphic.style.text:"\u4E0A\u4E00\u7EA7",font:h,x:e.config.graphic.style.iconWidth+e.config.graphic.style.txtLeft,y:e.config.graphic.style.txtTop}},{type:"image",z:-10,bounding:"raw",origin:[25,25],ignore:this.ignoreGraphic(),style:{image:this.getImageUrl(e.config.graphic.style.iconImg),width:e.config.graphic.style.iconWidth,height:e.config.graphic.style.iconHeight}}]}];let m={map:e.config.regionCode.toString(),show:!0,aspectScale:1,itemStyle:{normal:{areaColor:e.config.map.itemStyle.normal.color,borderColor:e.config.map.shadow.borderColor,borderWidth:e.config.map.shadow.borderWidth,shadowColor:e.config.map.shadow.shadowColor,shadowBlur:e.config.map.shadow.shadowBlur}}};e.config.map.autoMargin||(m.left=e.config.map.left+"%",m.right=e.config.map.right+"%",m.top=e.config.map.top+"%",m.bottom=e.config.map.bottom+"%"),d.geo=[m];let y={geoIndex:1,aspectScale:1,data:u,type:"map",showLegendSymbol:!1,map:e.config.regionCode.toString(),label:{show:e.config.geo.label.show,fontSize:e.config.geo.label.fontSize,color:e.config.geo.label.color,fontFamily:e.config.geo.label.fontFamily,position:e.config.geo.label.position,emphasis:{show:!1,color:e.config.geo.emphasisLabelColor}},itemStyle:{normal:{areaColor:e.config.map.itemStyle.normal.color,borderColor:e.config.map.itemStyle.normal.borderColor,borderWidth:e.config.map.itemStyle.normal.borderWidth,borderType:e.config.map.itemStyle.normal.borderType,shadowColor:e.config.map.itemStyle.normal.shadowColor,shadowBlur:e.config.map.itemStyle.normal.shadowBlur},emphasis:{areaColor:e.config.map.itemStyle.emphasis.areaColor}}};e.config.map.autoMargin||(y.left=e.config.map.left+"%",y.right=e.config.map.right+"%",y.top=e.config.map.top+"%",y.bottom=e.config.map.bottom+"%"),d.series=[y],z.registerMap(e.config.regionCode.toString(),i),this.mapChart.clear(),this.mapChart.setOption(this.lifecycleBeforeChartsLoad(d),!0),this.mapChart.resize(),e.config.liquidFill.show&&setTimeout(this.renderEachCity(u,d),0)})},reLoadInfo(e){e&&(this.$refs.countryMapBar.style.width=e.attr.w+"px",this.$refs.countryMapBar.style.height=e.attr.hh+"px"),this.loadInfo(e),this.mapChart.resize()},getRegionByNameAndParentCode(e,i){e&&F.h.getEchartsGeojsonByNameAndParentCode(e,this.widgetInfo.config.regionCode).then(t=>{if(t&&t.status==200){if(!t.data){s.warn("\u672A\u67E5\u5230\u884C\u653F\u533A[ "+e+" ]\u7684\u76F8\u5173\u6570\u636E"),i(null);return}if(!t.data.xzqCode||t.data.xzqCode==""){s.warn("\u672A\u67E5\u5230\u884C\u653F\u533A[ "+e+" ]\u7684\u76F8\u5173\u6570\u636E"),i(t.data);return}let n=t.data.geojsonEcharts;if(!n||n==""){s.warn("\u884C\u653F\u533A[ "+t.data.xzqName+" ]\u6CA1\u6709\u8BBE\u7F6E\u884C\u653F\u533A\u8FB9\u754C\u6570\u636E"),i(t.data);return}i(t.data)}else s.error(t.msg)})},getCurrentRegionInfo(e,i){this.currentRegion.id=null,this.currentRegion.name=null,this.currentRegion.cp=null,this.currentRegion.features=null,this.currentRegion.childrenCentralPoint=null,F.h.getEchartsGeojsonByCodeWithChildrenCentralPoint(e).then(t=>{if(t&&t.status==200){if(!t.data){s.warn("\u672A\u67E5\u8BE2\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+e+" ]\u7684\u76F8\u5173\u6570\u636E");return}this.widgetInfo.config.regionName=t.data.xzqName,this.regionParent.code=t.data.parentCode,this.regionParent.name=t.data.parentName,this.currentRegion.id=e,this.currentRegion.name=t.data.xzqName,this.currentRegion.childrenCentralPoint=t.data.childrenCentralPoint;let n=t.data.geojsonEcharts;if(!n||n==""){s.warn("\u884C\u653F\u533A[ "+t.data.xzqName+" ]\u6CA1\u6709\u8BBE\u7F6E\u884C\u653F\u533A\u8FB9\u754C\u6570\u636E"),i();return}let o=JSON.parse(n);o&&o.cp&&(this.currentRegion.cp=o.cp),o&&o.features&&(this.currentRegion.features=o.features),i(o)}else s.log(t.msg)})},getFeatureInfo(e){let i=this.currentRegion.childrenCentralPoint[e];if(i&&i.cp)return JSON.parse(JSON.stringify(i));if(!this.currentRegion.features)return s.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5F53\u524D\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7F3A\u5C11features\u5C5E\u6027"),null;let t=this.$$lib__.find(this.currentRegion.features,n=>n.properties&&e==n.properties.id);return t?{id:t.properties.id,name:t.properties.name,cp:t.properties.cp}:(s.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF0C\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+e+' ]\u7684\u76F8\u5173\u5C5E\u6027\uFF0C\u5373properties:{"id":"","name":"","cp":[]}\u4E0D\u5B58\u5728'),null)},renderEachCity(e,i){let t=this.widgetInfo.config.liquidFill,n=[];this.$$lib__.each(e,l=>{n.push({name:l.name,value:[l.coordinates[0],l.coordinates[1],l.value]})}),i.series.push({name:"",type:"scatter",coordinateSystem:"geo",data:n,label:{formatter:"{b}",position:"bottom",distance:t.radius+this.widgetInfo.config.geo.name.distance,fontSize:this.widgetInfo.config.geo.name.fontSize,color:this.widgetInfo.config.geo.name.color,fontFamily:this.widgetInfo.config.geo.name.fontFamily,show:this.widgetInfo.config.geo.name.show}});let o=this;for(let l=0;l<e.length;l++){let p=e[l].coordinates,f=o.mapChart.convertToPixel("geo",p);if(this.$$lib__.isNaN(f[0])||this.$$lib__.isNaN(f[0]))continue;let S=o.getFormatterString(t.label.formatter),d=f[0]/this.widgetInfo.attr.w*100+"%",u=f[1]/this.widgetInfo.attr.hh*100+"%",b=t.label.color,a=t.color,I=e[l].type||e[l].alias;t.colorList.forEach(h=>{h.type===e[l].type&&(h.color!==""&&(b=h.color),h.bColor!==""&&(a=[h.bColor]))}),i.series.push({type:"liquidFill",name:I,center:[d,u],data:[e[l]],color:a,shape:t.shape,zlevel:9,animationDuration:t.animationDuration,radius:t.radius+"%",amplitude:t.amplitude+"%",waveLength:t.waveLength+"%",itemStyle:t.itemStyle,backgroundStyle:t.backgroundStyle,outline:t.outline,label:{show:t.label.show,formatter:S,baseline:t.label.baseline,color:b,insideColor:t.backgroundStyle.color,fontSize:t.label.fontSize,fontWeight:t.label.fontWeight,fontFamily:t.label.fontFamily,align:t.label.align}})}o.mapChart.setOption(this.lifecycleBeforeChartsLoad(i))},initAction(e){this.actionSendout(e),this.actionReceive(e),this.registerAction(e,"openRegion","widgetList",this.doOpenRegion),this.clickEvent()},doOpenRegion(e,i,t,n){if(i&&t&&i[t]){let o=i[t];if(n.script&&n.script.enabled){if(s.log("Execute script for "+n.name+" component to "+n.script.title+" component"),n.script.content==""){E.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_openRegion=new Function("region,info,data,param_key",n.script.content),this.customScript_actionSend_openRegion(o,e,i,t)}else this.widgetInfo.config.regionCode!=o&&(this.widgetInfo.config.regionCode=o,this.loadInfo(this.widgetInfo))}},clickEvent(){this.mapChart.on("click",this.doClickEvent),this.widgetInfo.config.allowDrill&&this.widgetInfo.config.dblClickDrill&&this.mapChart.on("dblclick",this.doDblClickEvent)},doDblClickEvent(e){this.dblClicking=!0,this.dblName=e.name},doClickEvent(e){if(this.clicking)return;this.clicking=!0,setTimeout(()=>{this.clicking=!1},500);let i=e.componentType=="graphic"?this.regionParent.name:e.name;this.getRegionByNameAndParentCode(i,t=>{let n={code:e.componentType=="graphic"?this.regionParent.code:t!=null?t.xzqCode:null,name:i};if(e.componentType=="graphic"&&(this.widgetInfo.config.regionCode=n.code,this.loadInfo(),this.sendActionFun(n,e)),!t||!t.xzqCode||t.xzqCode==""){this.sendActionFun(n,e);return}this.widgetInfo.config.allowDrill&&this.widgetInfo.config.dblClickDrill?setTimeout(()=>{this.dblClicking&&this.dblName===n.name&&this.doDrill(t),this.dblClicking=!1,this.dblName=""},500):this.doDrill(t),this.sendActionFun(n,e)})},sendActionFun(e,i){let t=this,n=t.widgetInfo.action.sendOut.actionList;t.$$lib__.each(n,o=>{if(o.enabled&&o.code===t.$$global_editor.actionType.click.code){let l=t.$$global_editor.actionType.click.code+"_"+t.widgetInfo.id;if(o.paramsExtend&&o.paramsExtend.length>0){let p=[];i.data&&(p=i.data.source),t.getExtendParams(e,o.paramsExtend,p,t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions)}if(o.script&&o.script.enabled){if(s.log("Execute script for "+o.name+" component to "+o.script.title+" component"),o.script.content==""){E.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam2=new Function("param, params",o.script.content),e=this.customScript_actionSend_clickParam2(e,i)}O.Z.$emit(l,e),o.postMessage&&t.doPostMessage(e),t.actionNameList.push(l)}else if(o.enabled&&o.code===t.$$global_editor.actionType.openLink.code){if(o.paramsExtend&&o.paramsExtend.length>0){let l=[];i.data&&(l=i.data.source),t.getExtendParams(e,o.paramsExtend,l,t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions)}t.openLinkAction(o,e)}})},getImageUrl(e){if(e&&e!=="")return $.appendImageBaseURL(e)},doDrill(e){let i=!1,t=this.widgetInfo.config.allowDrillArea;(e.xzqCode=="china"||t==null||t==""||t=="province"&&e.xzqCode.length<=2||t=="city"&&e.xzqCode.length<=4||t=="area"&&e.xzqCode.length<=6||t=="town"&&e.xzqCode.length<=9)&&(i=!0),this.widgetInfo.config.allowDrill&&i&&e&&e.geojsonEcharts&&e.geojsonEcharts!=""&&(this.regionParent.code=e.parentCode,this.regionParent.name=e.parentName,this.widgetInfo.config.regionCode=e.xzqCode,this.loadInfo())},ignoreGraphic(){let e=this.widgetInfo.config.graphic.style.showArea;return this.currentRegion.id=="china"?!0:e=="province"&&this.currentRegion.id.length>2?this.getIgnoreGraphic():e=="city"&&this.currentRegion.id.length>4?this.getIgnoreGraphic():e=="area"&&this.currentRegion.id.length>6?this.getIgnoreGraphic():e=="town"&&this.currentRegion.id.length>9?this.getIgnoreGraphic():e==null||e==""?this.getIgnoreGraphic():!0},getIgnoreGraphic(){return this.regionParent.code&&this.regionParent.code!=""?this.identical=!1:this.identical=!0,!this.widgetInfo.config.allowDrill||this.identical}}},Z=k,H=r(68141),U=(0,H.Z)(Z,A,B,!1,null,"31a034fc",null),V=U.exports}}]);
