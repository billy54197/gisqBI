"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[797],{56279:function(I,m,s){s.d(m,{P:function(){return S}});var u=s(86892),d=s(49500);const S={mixins:[u.D],created(){},methods:{lifecycleBeforeChartsLoad(f){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&d.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),d.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let g=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[f]);if(g)return g}return f},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&d.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),d.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},77274:function(I,m,s){s.r(m),s.d(m,{default:function(){return P}});var u=function(){var i=this,n=i._self._c;return n("div",{style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[n("hide-button",{attrs:{attr:i.widgetInfo.attr}}),n("div",{ref:"funnelSimple",style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}})],1)},d=[],S=s(44513),f=s(27966),w=s(77928),g=s(56279),b=s(45061),C=s(26711),O=s(99349),F=s(55616),L=s(75770),N=s(67157),y=s(50666);const J={mixins:[N.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(y.Z.charts.title)),legend:JSON.parse(JSON.stringify(y.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(y.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(y.Z.charts.toolbox)),series:{itemStyle:{colorInfo:[{type:"pureColor",pureColor:"#FEC400",gradation:{top:"rgba(255, 0, 0, 1)",bottom:"rgba(30, 144, 255, 1)"}}],opacity:1}}}}},methods:{filterPredefineColoursSchemeConfig(t,i){this.getNewConfigWithArrary(t,i,this.filter_config)}}};var x=s(49500);const v=s(29426);var $={name:"FunnelSimple",components:{HideButton:S.Z},mixins:[w.u,g.P,b.u,C.H,O.P,J],props:["widgetInfo"],data(){return{}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=v.init(this.$refs.funnelSimple,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{loadInfo(t){let i=[],n=[];i=this.getSeriesData(t.dataset[t.dataset.type].source,t.dataset[t.dataset.type].dimensions,t.dataset[t.dataset.type].encode);let a=JSON.parse(JSON.stringify(t.config.grid)),e=JSON.parse(JSON.stringify(t.config.series)),l=JSON.parse(JSON.stringify(t.config.title)),o=JSON.parse(JSON.stringify(t.config.legend)),Z=this.getTooltip(t.config.tooltip),D=JSON.parse(JSON.stringify(t.config.toolbox)),M=this.$$global_editor.predefineColors;for(let r=0;r<e.itemStyle.colorInfo.length;++r)n.push(this.getItemStyleColor(e.itemStyle.colorInfo[r]));let h={color:this.$$global_editor.predefineColors,tooltip:Z,toolbox:D,title:{show:l.show,text:l.text,link:l.link,textAlign:l.textAlign,left:l.left+"%",right:l.right+"%",top:l.top+"%",bottom:l.bottom+"%",textStyle:{fontSize:l.textStyle.fontSize,fontFamily:l.textStyle.fontFamily,color:l.textStyle.color}},legend:{show:o.show,type:o.type,itemWidth:o.itemWidth,itemHeight:o.itemHeight,icon:o.icon,orient:o.orient,align:o.align,itemGap:o.itemGap,left:o.left+"%",right:o.right+"%",top:o.top+"%",bottom:o.bottom+"%",textStyle:{fontSize:o.textStyle.fontSize,color:o.textStyle.color,fontFamily:o.textStyle.fontFamily}},series:[{name:this.getSeriesName(t),type:"funnel",data:i,min:e.min,max:e.max,minSize:e.minSize+"%",maxSize:e.maxSize+"%",sort:e.sort,gap:e.gap,funnelAlign:e.funnelAlign,left:a.left+"%",right:a.right+"%",top:a.top+"%",bottom:a.bottom+"%",label:this.getLabelStyle(e.label),emphasis:{itemStyle:e.emphasis.itemStyle},itemStyle:{borderColor:e.itemStyle.borderColor,borderWidth:e.itemStyle.borderWidth,color:function(r){return n[r.dataIndex]?n[r.dataIndex]:M[r.dataIndex]}}}]};if(e.emphasis)try{let r=e.emphasis;if(r.script&&r.script.enabled){if(r.script.content){let T=new Function("index","item","data",r.script.content),c=h.series[0].data;if(c&&c.length>0)for(let p=0;p<c.length;++p)try{c[p].emphasis=T.call(this,p,c[p],c)}catch(H){x.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",H)}}}else e.emphasis.itemStyle&&e.emphasis.itemStyle.color&&(h.series[0].emphasis={itemStyle:{...e.emphasis.itemStyle}})}catch(r){x.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",r)}this.getAnimation(h,t),this.setOption(h),this.setAnimationLoop(t,()=>{this.setOption(h,t)})},setOption(t){this.echarts.getOption()&&this.echarts.clear(),setTimeout(()=>{this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!1})},0)},reLoadInfo(t){t&&(this.$refs.funnelSimple.style.width=t.attr.w+"px",this.$refs.funnelSimple.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},getSeriesData(t,i,n){let a=[],e=-1,l=-1;for(let o=0;o<i.length;o++)i[o]==n.x&&(e=o),i[o]==n.y&&(l=o);for(let o=0;o<t.length;o++)a.push({name:t[o][e],value:t[o][l]});return a},getSeriesName(t){let i="",n=t.dataset[t.dataset.type].encode,a=t.dataset[t.dataset.type].dimensionsAlias;if(n&&a)for(let e in a)n.y==a[e].name&&(i=a[e].alias?a[e].alias:a[e].name);return i},initAction(t){this.actionSendout(t),this.actionReceive(t)},getItemStyleColor(t){let i=null;return t.pureColor&&t.type==this.$$global_editor.colorType.pureColor.code?i=t.pureColor:t.type==this.$$global_editor.colorType.gradation.code&&(i=new v.graphic.LinearGradient(0,0,0,1,[{offset:0,color:t.gradation.top!=null&&t.gradation.top!=""?t.gradation.top:"#FFFFFF"},{offset:1,color:t.gradation.bottom!=null&&t.gradation.bottom!=""?t.gradation.bottom:"#FFFFFF"}])),i},actionSendout(t){let i=this;this.$$lib__.each(t.action.sendOut.actionList,n=>{if(n.enabled){let a=n.code+"_"+t.id;if(n.paramsExtend&&n.paramsExtend.length>0){let e={};this.getParamsExtend(e,n.paramsExtend,t)}n.code==L.Z.click.code&&i.onClick(a,n)}})},onClick(t,i){let n=this;n.echarts.on("click",a=>{let e={};if(e.x=a.data.name,e.y=a.data.value,i.script&&i.script.enabled){if(x.log("Execute script for "+n.widgetInfo.name+" component to "+i.name+" component"),i.script.content==""){F.Message.warning({message:i.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",i.script.content),e=this.customScript(e)}f.Z.$emit(t,e),i.postMessage&&n.doPostMessage(e),n.actionNameList.push(t)})}}},A=$,E=s(68141),z=(0,E.Z)(A,u,d,!1,null,"7618d006",null),P=z.exports}}]);
