"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[2654],{32654:function(x,r,n){n.r(r),n.d(r,{default:function(){return m}});var a=function(){var t=this,e=t._self._c;return e("div",[t.button_info.export_excel_customer_fields?[e("el-popover",{attrs:{placement:"bottom-end",width:"200",trigger:t.button_info.trigger},model:{value:t.visible,callback:function(o){t.visible=o},expression:"visible"}},[e("div",{style:{overflowY:"auto",maxHeight:t.table_height+"px"}},[e("el-tree",{ref:"refCustomerFieldsTree",attrs:{data:t.customer_fields_tree,"node-key":"id","show-checkbox":"","default-expand-all":"","expand-on-click-node":!1,"default-checked-keys":t.default_checked_keys!=null?t.default_checked_keys:t.displayCustomerFields},scopedSlots:t._u([{key:"default",fn:function({node:o,data:l}){return e("span",{},[l.isCustomerField?e("el-tooltip",{attrs:{"open-delay":1e3,content:"\u5BFC\u51FA\u6B64\u5217\u6570\u636E",effect:"light",placement:"top"}},[e("span",{staticStyle:{color:"#67C23A"}},[t._v(" "+t._s(o.label)+" ")])]):e("el-tooltip",{attrs:{"open-delay":1e3,content:"\u4E0D\u4F1A\u5BFC\u51FA\u6B64\u5217\u6570\u636E",effect:"light",placement:"top"}},[e("span",[t._v(" "+t._s(o.label)+" ")])])],1)}}],null,!1,3236955500)})],1),e("div",{staticStyle:{"margin-top":"10px","text-align":"center"}},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(o){return t.exportExcel(t.button_info,"customer")}}},[t._v("\u5BFC\u51FA")]),e("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(o){t.visible=!1}}},[t._v("\u5173\u95ED")])],1),e("button-tooltip",{attrs:{slot:"reference",button_config:t.button_info},slot:"reference"},[t.is_dropdown==!1?[e("el-button",{style:t.buttonStyle(t.button_info),attrs:{size:t.button_info.size,disabled:t.button_info.disabled,type:t.button_info.style=="text"?"text":"",plain:t.button_info.style=="plain",round:t.button_info.style=="round",circle:t.button_info.style=="circle"},on:{click:function(o){return t.onClickButton(t.button_info)}}},[!t.button_info.icon_align||t.button_info.icon_align==t.global_query.position.left.code?e("i",{class:t.button_info.icon}):t._e(),t._v(" "+t._s(t.button_info.label)+" "),t.button_info.icon_align==t.global_query.position.right.code?e("i",{class:t.button_info.icon}):t._e(),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})])]:e("div",{on:{click:function(o){return t.onClickButton(t.button_info)}}},[!t.button_info.icon_align||t.button_info.icon_align==t.global_query.position.left.code?e("i",{class:t.button_info.icon}):t._e(),e("span",{style:{color:t.button_info.color,marginRight:"5px"}},[t._v(t._s(t.button_info.label))]),t.button_info.icon_align==t.global_query.position.right.code?e("i",{class:t.button_info.icon}):t._e()])],2)],1)]:[e("button-tooltip",{attrs:{button_config:t.button_info}},[t.is_dropdown==!1?[e("el-button",{class:`gisq-query-button el-button--${t.button_info.colorType}`,style:t.buttonStyle(t.button_info),attrs:{size:t.button_info.size,disabled:t.button_info.disabled,type:t.button_info.style=="text"?"text":"",plain:t.button_info.style=="plain",round:t.button_info.style=="round",circle:t.button_info.style=="circle"},on:{click:function(o){return t.exportExcel(t.button_info)}}},[!t.button_info.icon_align||t.button_info.icon_align==t.global_query.position.left.code?e("i",{class:t.button_info.icon}):t._e(),t._v(" "+t._s(t.button_info.label)+" "),t.button_info.icon_align==t.global_query.position.right.code?e("i",{class:t.button_info.icon}):t._e()])]:e("div",{on:{click:function(o){return t.exportExcel(t.button_info)}}},[!t.button_info.icon_align||t.button_info.icon_align==t.global_query.position.left.code?e("i",{class:t.button_info.icon}):t._e(),e("span",{style:{color:t.button_info.color,marginRight:"5px"}},[t._v(t._s(t.button_info.label))]),t.button_info.icon_align==t.global_query.position.right.code?e("i",{class:t.button_info.icon}):t._e()])],2)]],2)},d=[],c=n(48836),u=n(27966),_=n(52013),f=n(79876),p=n(55616),s=n(49500),b={name:"export-excel",components:{ButtonTooltip:_.Z},props:{widgetId:{type:String},is_dropdown:{type:Boolean,default:!1},button_info:{}},mixins:[f.G],data(){return{visible:!1,global_query:this.$$global_query,displayCustomerFields:[],default_checked_keys:null}},computed:{...(0,c.Se)(["view_height_fun"]),view_height(){return this.view_height_fun(this.widgetId)},customer_fields_tree(){return[{id:"root",label:"\u6240\u6709\u67E5\u8BE2\u7ED3\u679C\u5217",children:this.getTreeList()}]},table_height(){return this.view_height.page-this.view_height.header-this.view_height.footer}},watch:{customerFields:{deep:!0,handler:function(){this.getTreeList()}}},mounted(){this.getTreeList()},methods:{...(0,c.nv)(["setCustomerFields"]),exportExcel(i,t){let e=null;if(t=="customer"){let o=this.$refs.refCustomerFieldsTree.getCheckedNodes(),l=this.$$lib__.pluck(o,"id");if(l==null||l.length==0){p.Message.warning({message:"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u5217\u6570\u636E\u8FDB\u884C\u5BFC\u51FA",offset:60});return}e=l}else i.export_excel_all_fields!=!0&&(e=this.default_checked_keys!=null?this.default_checked_keys:this.displayCustomerFields);if(i.is_click){if(!i.script_click||i.script_click==""){s.warn("\u6309\u94AE\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+i.name+" \u811A\u672C\u4E3A\u7A7A");return}s.info("\u6267\u884C\u6309\u94AE\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+i.name+" \u811A\u672C"),new Function("customerFieldsInfo",i.script_click).apply(this,[e])}else i.guid==this.global_query.button_system.exportExcelCurrent.guid?this.doExportExcelCurrent(i,e):i.guid==this.global_query.button_system.exportExcelAll.guid&&this.doExportExcelAll(i,e)},doExportExcelCurrent(i,t){let e=JSON.parse(JSON.stringify(this.requestBody));e.customerFields=t,u.Z.$emit("busExportExcel"+(this.widgetId?"_"+this.widgetId:""),{requestBody:e,button:i}),this.$emit("sendAction",this.global_query.action_system.query_doExportExcelCurrent.code)},doExportExcelAll(i,t){let e=JSON.parse(JSON.stringify(this.requestBody));e.page&&(e.page.enabled=!1),e.customerFields=t,u.Z.$emit("busExportExcel"+(this.widgetId?"_"+this.widgetId:""),{requestBody:e,button:i}),this.$emit("sendAction",this.global_query.action_system.query_doExportExcelAll.code)},onClickButton(i){this.buttonClick(i)},buttonClick(i){if(!i.is_click)return;if(!i.script_click||i.script_click==""){s.warn("\u6309\u94AE\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+i.name+" \u811A\u672C\u4E3A\u7A7A");return}s.info("\u6267\u884C\u6309\u94AE\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+i.name+" \u811A\u672C"),new Function(i.script_click).apply(this)},scriptClick(){this.refTable.clearSelection()},getTreeList(){let i=[];return this.default_checked_keys=this.customerFields,this.$$lib__.each(this.queryConfig.field,t=>{JSON.parse(JSON.stringify(t)).hide||(i.push({id:t.guid,label:t.label&&t.label!=""?t.label:t.field,isCustomerField:this.$$lib__.contains(this.customerFields,t.guid)}),t.default_display&&this.displayCustomerFields.push(t.guid))}),i=this.$$lib__.sortBy(i,"order"),i}}},h=b,g=n(68141),y=(0,g.Z)(h,a,d,!1,null,"5ca33678",null),m=y.exports}}]);
