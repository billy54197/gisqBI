"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[2522],{22522:function(V,d,s){s.r(d),s.d(d,{default:function(){return A}});var p=function(){var e=this,i=e._self._c;return i("div",{ref:"pictureList",staticClass:"pictureList",style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px"}},[i("hide-button",{attrs:{attr:e.widgetInfo.attr}}),e.hasVideo?i("div",{staticClass:"my-content",style:{paddingLeft:e.mUtils.getNewPxW(e.widgetInfo.config.global.padding.left)+"px",paddingTop:e.mUtils.getNewPxW(e.widgetInfo.config.global.padding.top)+"px",height:e.widgetInfo.attr.hh+"px"}},[e._l(e.listInfo,function(n,r){return i("div",{key:r,style:e.getContentAreaStyle(e.widgetInfo.config.contentArea),on:{click:function(l){return e.onClick(l,n,r)}}},[i("div",{style:e.getTitleStyle(e.widgetInfo.config.title)},[e._v(" "+e._s(n.title)+" ")]),i("div",{staticStyle:{width:"100%",position:"relative"}},[e.widgetInfo.config.video.isPreviewSrcList?i("div",{style:e.getButStyle(e.widgetInfo.config.video),on:{click:function(l){return l.target!==l.currentTarget?null:e.openViewer(r)}}}):e._e(),n.isUpdateLive&&e.updatePoster&&e.flag?i("LivePlayer",{ref:"livePlayer1111",refInFor:!0,staticClass:"my-player",staticStyle:{position:"absolute"},style:e.getVideoStyle(e.widgetInfo.config.video),attrs:{videoUrl:e.mUtils.appendImageBaseURL(n.url),poster:e.mUtils.appendImageBaseURL(n.posterUrl),alt:e.widgetInfo.config.video.errorText,autoplay:e.widgetInfo.config.video.autoplay&&e.isView,controls:e.widgetInfo.config.video.controls,loop:e.widgetInfo.config.video.loop,live:!e.widgetInfo.config.video.live,aspect:e.widgetInfo.config.video.aspectW+":"+e.widgetInfo.config.video.aspectH,fluent:""},on:{snapOutside:e.snapOutside,snapInside:e.snapInside,ended:function(l){return e.livepalyEnded(r)},play:function(l){return e.livePlay(r)}}}):e._e()],1),i("div",{ref:"contentTextArea",refInFor:!0,staticClass:"test-div",style:e.getContentStyle(e.widgetInfo.config.content,e.widgetInfo.config.video),attrs:{contenteditable:"false"},domProps:{textContent:e._s(n.content)}})])}),[e.showViewer?i("video-viewer",{attrs:{"initial-index":e.currentIndex,"url-list":e.listInfo,"on-close":e.closeViewer,"preview-top":e.widgetInfo.config.video.previewTop,"preview-bottom":e.widgetInfo.config.video.previewBottom,"preview-left":e.widgetInfo.config.video.previewLeft,"preview-right":e.widgetInfo.config.video.previewRight,"preview-opacity":e.widgetInfo.config.video.previewOpacity,"preview-aspect-w":e.widgetInfo.config.video.aspectW,"preview-aspect-h":e.widgetInfo.config.video.aspectH,infinite:e.widgetInfo.config.video.infinite,"auto-play":e.widgetInfo.config.video.autoplay&&e.isView,loop:e.widgetInfo.config.video.loop,controls:e.widgetInfo.config.video.controls,live:!e.widgetInfo.config.video.live}}):e._e()]],2):i("diV",{staticClass:"picture-list-image-slot-error"},[e._v(" "+e._s(e.widgetInfo.config.video.emptyText)+" ")])],1)},u=[],h=s(44513),v=s(4237),w=s(45061),m=s(26711),y=s(56279),o=s(21300),I=s(48836),x=s(67157);const S={mixins:[x.c],data(){return{config_extend:{config:{title:{hide:!0}}},filter_config:{contentArea:{opacity:1},title:{fontStyle:{fontFamily:"Microsoft Yahei",color:""}},content:{backgroundColor:"rgba(236, 240, 241, 0)",fontStyle:{fontFamily:"Microsoft Yahei",color:""}}}}},methods:{filterPredefineColoursSchemeConfig(t,e){this.getNewConfigWithArrary(t,e,this.filter_config)}}};var b=function(){var e=this,i=e._self._c;return i("transition",{attrs:{name:"viewer-fade"}},[i("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper",style:{"z-index":e.viewerZIndex,marginTop:e.previewTop+"px",marginTop:e.previewTop+"px",marginBottom:e.previewBottom+"px",marginLeft:e.previewLeft+"px",marginRight:e.previewRight+"px",overflow:"hidden"},attrs:{tabindex:"-1"}},[i("div",{staticClass:"el-image-viewer__mask",style:{opacity:e.previewOpacity},on:{click:function(n){return n.target!==n.currentTarget?null:e.handleMaskClick.apply(null,arguments)}}}),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:e.hide}},[i("i",{staticClass:"el-icon-close"})]),e.isSingle?e._e():[i("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!e.infinite&&e.isFirst},on:{click:e.prev}},[i("i",{staticClass:"el-icon-arrow-left"})]),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!e.infinite&&e.isLast},on:{click:e.next}},[i("i",{staticClass:"el-icon-arrow-right"})])],e.flag?i("div",{staticClass:"el-image-viewer__canvas"},e._l(e.urlList,function(n,r){return i("LivePlayer",{directives:[{name:"show",rawName:"v-show",value:r===e.index,expression:"i === index"}],key:n+r,ref:"livePlayerViewer",refInFor:!0,staticClass:"pop-video-viewer",attrs:{videoUrl:e.mUtils.appendImageBaseURL(n.url),poster:e.mUtils.appendImageBaseURL(n.posterUrl),autoplay:e.autoPlay,aspect:e.previewAspectW+":"+e.previewAspectH,loop:e.loop,controls:e.controls,live:e.live,fluent:""},on:{snapOutside:e.snapOutside,snapInside:e.snapInside}})}),1):e._e()],2)])},C=[],P=s(29896),N=s(95058),a=s(77712);const f={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},g=(0,P.vU)()?"DOMMouseScroll":"mousewheel";var L={name:"video-viewer",components:{LivePlayer:()=>s.e(430).then(s.t.bind(s,26806,23))},async beforeCreate(){await o.registerScript("./js/liveplayer-lib.min.js").then(()=>{this.flag=!0})},props:{infinite:{type:Boolean,default:!0},initialIndex:{type:Number,default:0},urlList:{type:Array,default:()=>[]},onClose:{type:Function,default:()=>{}},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:()=>{}},appendToBody:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!1},errorText:{type:String,default:"\u52A0\u8F7D\u5931\u8D25"},previewLeft:{type:Number,default:0},previewRight:{type:Number,default:0},previewTop:{type:Number,default:0},previewBottom:{type:Number,default:0},previewOpacity:{type:Number,default:1},previewAspectW:{type:Number,default:16},previewAspectH:{type:Number,default:9},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},controls:{type:Boolean,default:!0},live:{type:Boolean,default:!1}},data(){return{flag:!1,index:this.initialIndex,isShow:!1,loading:!1,mode:f.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}},computed:{isSingle(){return this.urlList.length<=1},isFirst(){return this.index===0},isLast(){return this.index===this.urlList.length-1},imgStyle(){const{scale:t,deg:e,offsetX:i,offsetY:n,enableTransition:r}=this.transform,l={transform:`scale(${t}) rotate(${e}deg)`,transition:r?"transform .3s":"","margin-left":`${i}px`,"margin-top":`${n}px`,color:"white"};return this.mode===f.CONTAIN&&(l.maxWidth=l.maxHeight="100%"),l},viewerZIndex(){const t=N.q.nextZIndex();return this.zIndex>t?this.zIndex:t}},watch:{index:{handler:function(t){this.reset(),this.onSwitch(t)}},currentImg(t){this.$nextTick(e=>{this.$refs.img[0].complete||(this.loading=!0)})}},methods:{snapOutside(){},snapInside(t){t||this.$message({type:"info",message:"\u5FEB\u7167\u622A\u53D6\u5931\u8D25"})},hide(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall(){this._keyDownHandler=t=>{switch(t.stopPropagation(),t.keyCode){case 27:this.hide();break;case 37:this.prev();break;case 39:this.next();break}},(0,a.on)(document,"keydown",this._keyDownHandler),(0,a.on)(document,g,this._mouseWheelHandler)},deviceSupportUninstall(){(0,a.S1)(document,"keydown",this._keyDownHandler),(0,a.S1)(document,g,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad(t){this.loading=!1},handleImgError(t){this.loading=!1,t.target.alt=this.errorText},handleMaskClick(){this.maskClosable&&this.hide()},reset(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},prev(){if(this.isFirst&&!this.infinite)return;this.$refs.livePlayerViewer[this.index].pause();const t=this.urlList.length;this.index=(this.index-1+t)%t},next(){if(this.isLast&&!this.infinite)return;this.$refs.livePlayerViewer[this.index].pause();const t=this.urlList.length;this.index=(this.index+1)%t}},mounted(){this.deviceSupportInstall(),this.appendToBody&&document.body.appendChild(this.$el),this.$refs["el-image-viewer__wrapper"].focus()},destroyed(){this.appendToBody&&this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},T=L,c=s(68141),k=(0,c.Z)(T,b,C,!1,null,"07923048",null),H=k.exports,W=s(49500),U={name:"video-list",props:["widgetInfo"],async beforeCreate(){await o.registerScript("./js/liveplayer-lib.min.js").then(()=>{this.flag=!0})},components:{VideoViewer:H,HideButton:h.Z,LivePlayer:()=>s.e(430).then(s.t.bind(s,26806,23))},mixins:[v.u,w.u,m.H,y.P,S],watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)},listInfo:function(t){t&&(this.updatePoster=!1,this.$nextTick(()=>{this.updatePoster=!0,setTimeout(()=>{this.removePoster()},200)}))},"widgetInfo.config.video.w":function(){setTimeout(()=>{this.setControlBarStyle()},200)},"widgetInfo.config.video.aspectW":function(){setTimeout(()=>{this.setControlBarStyle()},200)},"widgetInfo.config.video.aspectH":function(){setTimeout(()=>{this.setControlBarStyle()},200)}},data(){return{flag:!1,mUtils:o,lib_:this.$$lib__,updatePoster:!0,listInfo:[],showViewer:!1,currentIndex:0}},computed:{...(0,I.Se)(["isView"]),hasVideo(){return this.widgetInfo.dataset[this.widgetInfo.dataset.type].source.length>0}},methods:{livePlay(t){this.listInfo[t].isPlaying=!0},livepalyEnded(t){this.listInfo[t].isPlaying=!1,setTimeout(()=>{this.listInfo[t].isPlaying||this.reloadLive(t)},2e3)},reloadLive(t){this.listInfo[t].isUpdateLive=!1,this.$nextTick(()=>{this.listInfo[t].isUpdateLive=!0,setTimeout(()=>{let i=document.querySelectorAll(".my-player video[class=vjs-tech]")[t];if(!i.getAttribute("poster")||i.getAttribute("poster")==="null"){i.removeAttribute("poster"),i.setAttribute("preload","true");const n=i.nextElementSibling;n.style.display="none"}},200)}),setTimeout(()=>{this.setControlBarStyle()},200)},loadInfo(t){this.listInfo=this.getListInfo(t.dataset[t.dataset.type]),this.lifecycleAfterLoad()},reLoadInfo(t){this.loadInfo(t)},initAction(t){this.actionReceive(t)},snapOutside(){},snapInside(t){t||this.$message({type:"info",message:"\u5FEB\u7167\u622A\u53D6\u5931\u8D25"})},getListInfo(t){let e=[];return t.source.length||(t.source=[]),this.lib_.each(t.source,i=>{let n={title:"",url:"",posterUrl:"",content:"",isUpdateLive:!0,isPlaying:!1};if(n.title=this.getFieldVal(i,t.dimensions,t.encode.title),n.url=this.getFieldVal(i,t.dimensions,t.encode.url),n.posterUrl=this.getFieldVal(i,t.dimensions,t.encode.posterUrl),n.content=this.getFieldVal(i,t.dimensions,t.encode.content),this.widgetInfo.action.receive.preview&&this.widgetInfo.action.receive.preview.enabled){const r=this.widgetInfo.action.receive.preview.field;r&&(n.__field__=this.getFieldVal(i,t.dimensions,r))}e.push(n)}),e},getContentAreaStyle(t){return{float:"left",overflow:"hidden",width:o.getNewPxW(t.w)+"px",height:o.getNewPxH(t.h)+"px",marginLeft:o.getNewPxW(t.left)+"px",marginTop:o.getNewPxH(t.top)+"px",opacity:t.opacity,backgroundColor:t.backgroundColor,backgroundImage:this.getImageUrl(t.backgroundImage),backgroundSize:t.backgroundSize,cursor:this.getCursor(this.widgetInfo.action,this.$$global_editor.actionType.click.code,this.$$global_editor.actionType.openLink.code)}},getVideoStyle(t){const e=this.widgetInfo.config.video.aspectW,i=this.widgetInfo.config.video.aspectH;return{width:o.getNewPxW(t.w)+"px",height:o.getNewPxW(t.w)*i/e+"px",marginLeft:o.getNewPxW(t.left)+"px",marginTop:o.getNewPxH(t.top)+"px",opacity:t.opacity}},getButStyle(t){const e=this.widgetInfo.config.video.aspectW,i=this.widgetInfo.config.video.aspectH;return{width:o.getNewPxW(t.w)+"px",height:t.controls?o.getNewPxW(t.w)*i/e*.85+"px":o.getNewPxW(t.w)*i/e+"px",marginLeft:o.getNewPxW(t.left)+"px",marginTop:o.getNewPxH(t.top)+"px",opacity:t.opacity,backgroundColor:"rgba(0, 0, 0, 0)",position:"absolute",zIndex:10,cursor:"pointer"}},getTitleStyle(t){return{height:o.getNewPxH(t.h)+"px",lineHeight:o.getNewPxH(t.h)+"px",opacity:t.opacity,display:t.hide==!0?"none":"",paddingLeft:o.getNewPxW(t.left)+"px",paddingTop:o.getNewPxH(t.top)+"px",backgroundColor:t.backgroundColor,backgroundImage:this.getImageUrl(t.backgroundImage),backgroundSize:t.backgroundSize,fontSize:o.getNewFontSize(t.fontStyle.fontSize)+"px",fontFamily:t.fontStyle.fontFamily,color:t.fontStyle.color,fontWeight:t.fontStyle.fontWeight,fontStyle:t.fontStyle.fontStyle,textDecoration:t.fontStyle.textDecoration,textAlign:t.fontStyle.horizontalAlignment}},getContentStyle(t,e){const i=this.widgetInfo.config.video.aspectW,n=this.widgetInfo.config.video.aspectH;return{height:o.getNewPxH(t.h)+"px",lineHeight:o.getNewPxH(t.lineHeight)+"px",opacity:t.opacity,display:t.hide==!0?"none":"",paddingLeft:o.getNewPxH(t.left)+"px",marginTop:o.getNewPxW(t.top)+o.getNewPxW(e.w)*n/i+o.getNewPxH(e.top)+"px",backgroundColor:t.backgroundColor,backgroundImage:this.getImageUrl(t.backgroundImage),backgroundSize:t.backgroundSize,fontSize:o.getNewFontSize(t.fontStyle.fontSize)+"px",fontFamily:t.fontStyle.fontFamily,color:t.fontStyle.color,fontWeight:t.fontStyle.fontWeight,fontStyle:t.fontStyle.fontStyle,textDecoration:t.fontStyle.textDecoration,textAlign:t.fontStyle.horizontalAlignment}},getImageUrl(t){return t&&t!==""?/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*?)\s*$/i.test(t)?t:(W.info(o.appendImageBaseURL(t)),"url("+o.appendImageBaseURL(t)+")"):null},setControlBarStyle(){const t=document.querySelectorAll(".my-player .vjs-control-bar");Array.from(t).forEach(e=>{this.widgetInfo.config.video.w<350&&(e.style.width="350px",e.style.transform=`translate(-${(350-this.widgetInfo.config.video.w)/2}px,0.75em) scale(${this.widgetInfo.config.video.w/350},${this.widgetInfo.config.video.w/350})`)})},removePoster(){const t=document.querySelectorAll(".my-player video[class=vjs-tech]");Array.from(t).forEach(e=>{if(!e.getAttribute("poster")||e.getAttribute("poster")==="null"){e.removeAttribute("poster"),e.setAttribute("preload","true");const i=e.nextElementSibling;i.style.display="none"}})},openViewer(t){this.currentIndex=t,this.showViewer=!0},closeViewer(){this.showViewer=!1}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo),setTimeout(()=>{this.setControlBarStyle(),this.removePoster()},200)}},$=U,B=(0,c.Z)($,p,u,!1,null,"3496363b",null),A=B.exports}}]);
