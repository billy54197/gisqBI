(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[30602],{587212:function(Y,D,i){var f=i(149500);Y.exports=function(s){var a={};function o(c){if(a[c])return a[c].exports;var n=a[c]={i:c,l:!1,exports:{}};return s[c].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=s,o.c=a,o.d=function(c,n,p){o.o(c,n)||Object.defineProperty(c,n,{enumerable:!0,get:p})},o.r=function(c){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},o.t=function(c,n){if(n&1&&(c=o(c)),n&8||n&4&&typeof c=="object"&&c&&c.__esModule)return c;var p=Object.create(null);if(o.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:c}),n&2&&typeof c!="string")for(var y in c)o.d(p,y,function(T){return c[T]}.bind(null,y));return p},o.n=function(c){var n=c&&c.__esModule?function(){return c.default}:function(){return c};return o.d(n,"a",n),n},o.o=function(c,n){return Object.prototype.hasOwnProperty.call(c,n)},o.p="/dist/",o(o.s=760)}({0:function(s,a){s.exports=i(342579)},1:function(s,a){s.exports=i(828866)},10:function(s,a){s.exports=i(42762)},2:function(s,a,o){"use strict";o.d(a,"a",function(){return c});function c(n,p,y,T,u,O,w,q){var E=typeof n=="function"?n.options:n;p&&(E.render=p,E.staticRenderFns=y,E._compiled=!0),T&&(E.functional=!0),O&&(E._scopeId="data-v-"+O);var Z;if(w?(Z=function(m){m=m||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!m&&typeof __VUE_SSR_CONTEXT__<"u"&&(m=__VUE_SSR_CONTEXT__),u&&u.call(this,m),m&&m._registeredComponents&&m._registeredComponents.add(w)},E._ssrRegister=Z):u&&(Z=q?function(){u.call(this,(E.functional?this.parent:this).$root.$options.shadowRoot)}:u),Z)if(E.functional){E._injectStyles=Z;var k=E.render;E.render=function(P,z){return Z.call(z),k(P,z)}}else{var L=E.beforeCreate;E.beforeCreate=L?[].concat(L,Z):[Z]}return{exports:n,options:E}}},27:function(s,a){s.exports=i(578756)},28:function(s,a){s.exports=i(132726)},30:function(s,a){s.exports=i(832569)},4:function(s,a){s.exports=i(555616)},43:function(s,a){s.exports=i(147806)},46:function(s,a){s.exports=i(869257)},48:function(s,a){s.exports=i(181360)},5:function(s,a){s.exports=i(705146)},58:function(s,a){s.exports=i(165594)},6:function(s,a){s.exports=i(783574)},67:function(s,a){s.exports=i(31694)},68:function(s,a){s.exports=i(481534)},7:function(s,a){s.exports=i(17249)},70:function(s,a){s.exports=i(692086)},74:function(s,a){s.exports=i(584247)},760:function(s,a,o){"use strict";o.r(a);var c=o(0),n=o.n(c),p=function(){var r=this,t=r.$createElement,e=r._self._c||t;return e("div",{directives:[{name:"show",rawName:"v-show",value:r.shouldShow,expression:"shouldShow"}],staticClass:"sh-file-export"},[e("general-container",{ref:"container",attrs:{"is-show":r.visible,"style-config":r.styleConfig,title:r.title?r.title:"\u6587\u4EF6\u5BFC\u51FA","img-src":r.imgSrc?r.imgSrc:"file-export",position:r.position,theme:r.theme,"theme-style":r.cardThemeStyle,"drag-enable":r.dragEnable,"append-to-body":r.appendToBody,"only-container":r.onlyContainer},on:{"update:isShow":function(g){r.visible=g},"update:is-show":function(g){r.visible=g},"change:isShow":r.onChangeIsShow}},[e("div",{staticClass:"file-export-content"},[e("el-form",{ref:"form",attrs:{"label-width":"70px","label-position":"left"}},[e("el-form-item",{attrs:{label:"\u6587\u4EF6\u7C7B\u578B"}},[e("el-select",{attrs:{size:"small"},model:{value:r.fileType,callback:function(g){r.fileType=g},expression:"fileType"}},r._l(r.fileTypes,function(g){return e("el-option",{key:g.value,attrs:{label:g.label,value:g.value}})}),1)],1),e("el-form-item",{attrs:{label:"\u6587\u4EF6\u540D\u79F0"}},[e("el-input",{attrs:{size:"small"},model:{value:r.fileName,callback:function(g){r.fileName=g},expression:"fileName"}})],1),e("el-form-item",[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:r.fileExportEvt}},[r._v(`\u5BFC\u51FA
          `)])],1)],1)],1)])],1)},y=[];p._withStripped=!0;var T=o(48),u=o.n(T),O=o(9),w=o.n(O),q=o(10),E=o.n(q),Z=o(46),k=o.n(Z),L=o(1),m=o.n(L),P=o(27),z=o.n(P),I=o(67),B=o.n(I),$=o(58),j=o.n($),X=function(){function r(t){w()(this,r),this.url=t.url,this.token=t.token,this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.mapProjectionCode=t.mapProjectionCode}return E()(r,[{key:"generate",value:function(){var e=this,g=[],x=new B.a,v=this.mapProjectionCode.substring(this.mapProjectionCode.lastIndexOf(":")+1,this.mapProjectionCode.length);return this.exportFeatures.forEach(function(d){n()(this,e),g.push(x.writeFeature(d))}.bind(this)),new j.a(this.url).exportFile({wkts:g,extension:"shp",filename:this.exportFileName,wkid:v,exportFileExt:".zip",token:this.token})}}]),r}(),et=X,it=function(){function r(t){w()(this,r),this.url=t.url,this.token=t.token,this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.mapProjectionCode=t.mapProjectionCode}return E()(r,[{key:"generate",value:function(){var e=this,g=[],x=new B.a,v=this.mapProjectionCode.substring(this.mapProjectionCode.lastIndexOf(":")+1,this.mapProjectionCode.length);return this.exportFeatures.forEach(function(d){n()(this,e),g.push(x.writeFeature(d))}.bind(this)),new j.a(this.url).exportFile({wkts:g,extension:this.exportFileType,filename:this.exportFileName,wkid:v,exportFileExt:this.exportFileExt,token:this.token})}}]),r}(),V=it,_=o(5),J=o.n(_),F=o(70),Q=o(87),R=o(68),H=function(){function r(t){w()(this,r),t=k()({},t),this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.isWithDH=t.isWithDH,this.mapProjectionCode=t.mapProjectionCode,this.isDegree=t.isDegree,this.isToTransformProj=t.isToTransformProj,this.transformProjection=t.transformProjection,this.resultString=""}return E()(r,[{key:"generate",value:function(){var e,g,x="EPSG:4490";Object(R.registerProj)(x);var v="2000\u56FD\u5BB6\u5927\u5730\u5750\u6807\u7CFB",d=this.exportFeatures,C=this.mapProjectionCode.split(":")[1]*1,h;if(C<=4554&&C>=4513)h=C-4488;else for(var l=0,S=d.length;l<S;l++){var G=d[l].clone(),W=this.geoProjection(G),M=Object(F.getCenter)(W.getGeometry().getExtent());if(M[0]>=-180&&M[0]<=180){if(!h)h=parseInt((M[0]-1.5)/3+1);else if(h!==parseInt((M[0]-1.5)/3+1))throw new Error("\u9009\u4E2D\u7684\u8981\u7D20\u8DE8\u5E26")}else throw f.warn("\u5E26\u53F7\u89E3\u6790\u5931\u8D25",G,W),new Error("\u5E26\u53F7\u89E3\u6790\u5931\u8D25")}var A=new Date,N=A.getFullYear(),U=A.getMonth()+1,nt=A.getDate(),Mt=J()(e=J()(g="".concat(N,"-")).call(g,U,"-")).call(e,nt);this.resultString+=`[\u5C5E\u6027\u63CF\u8FF0]\r
`,this.resultString+=`\u683C\u5F0F\u7248\u672C\u53F7=1.01\u7248\u672C\r
`,this.resultString+=`\u6570\u636E\u4EA7\u751F\u5355\u4F4D=\r
`,this.resultString+="\u6570\u636E\u4EA7\u751F\u65E5\u671F=".concat(Mt,`\r
`),this.resultString+="\u5750\u6807\u7CFB="+v+`\r
`,this.resultString+=`\u51E0\u5EA6\u5206\u5E26=3\r
`,this.resultString+=`\u6295\u5F71\u7C7B\u578B=\u9AD8\u65AF\u514B\u5415\u683C\r
`,this.resultString+=`\u8BA1\u91CF\u5355\u4F4D=\u7C73\r
`,this.resultString+="\u5E26\u53F7=".concat(h,`\r
`),this.resultString+=`\u7CBE\u5EA6=0.01\r
`,this.resultString+=`\u8F6C\u6362\u53C2\u6570=0,0,0,0,0,0,0\r
`,this.resultString+=`[\u5730\u5757\u5750\u6807]\r
`;for(var tt=0,Nt=d.length;tt<Nt;tt++)if(d[tt].getGeometry().getType()==="Polygon"||d[tt].getGeometry().getType()==="MultiPolygon"){var lt=d[tt].clone(),K={};if(C<=4554&&C>=4513)K=lt,K.set("wkid",C),K.set("delNo",h);else{K=this.geoProjection(lt),K.set("delNo",h);var zt=h+4488;K.set("wkid",zt);var Bt=K.getGeometry(),Ht=K.get("wkid"),ft=this.isToTransformProj?this.transformProjection:"EPSG:"+Ht;Object(R.registerProj)(ft);var At=Bt.transform("EPSG:4490",ft);K.setGeometry(At)}var ht=K.getGeometry().getArea();K.get("DK_MJ")&&K.set("DK_MJ",ht),this.connectGeometryString(K,tt,ht)}else throw new Error("\u9009\u4E2D\u7684\u8981\u7D20\u4E2D\u542B\u6709\u975E\u9762\u8981\u7D20");this.export()}},{key:"geoProjection",value:function(e){var g="EPSG:4490",x=e.getGeometry().transform(this.mapProjectionCode,g);return e.setGeometry(x),e}},{key:"connectGeometryString",value:function(e,g,x){var v=this,d=0,C=[];e.getGeometry().getType()==="MultiPolygon"?(C=e.getGeometry().getPolygons(),e.getGeometry().getPolygons().forEach(function(l){var S=this;n()(this,v),l.getCoordinates().forEach(function(G){n()(this,S),d+=G.length}.bind(this))}.bind(this))):e.getGeometry().getType()==="Polygon"&&(C.push(e.getGeometry()),e.getGeometry().getCoordinates().forEach(function(l){n()(this,v),d+=l.length}.bind(this)));var h="";e.get("DK_MC")&&(h=e.get("DK_MC")),(h===void 0||h===""||h.toUpperCase()==="NULL")&&(h="\u7ED8\u5236\u5730\u5757"),this.resultString+=""+d+","+x+","+this.exportFileName+"-"+g+","+h+`,\u9762,,,,@\r
`,C.forEach(function(l){var S=this;n()(this,v);var G=0;l.getLinearRings().forEach(function(W){var M=this;n()(this,S),G++,W.getCoordinates().forEach(function(A,N){n()(this,M),N===W.getCoordinates().length-1&&(N=0),this.resultString+="J"+(N+1)+","+G+","+A[1].toFixed(3)+","+A[0].toFixed(3)+`\r
`}.bind(this))}.bind(this))}.bind(this))}},{key:"export",value:function(){var e=new Blob(["\uFEFF"+this.resultString],{type:"text/plain;charset=utf-8"});Object(Q.saveAs)(e,this.exportFileName+this.exportFileExt)}}]),r}(),ot=H,b=function(){function r(t){w()(this,r),t=k()({},t),this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.isWithDH=t.isWithDH,this.mapProjectionCode=t.mapProjectionCode,this.isDegree=t.isDegree,this.isToTransformProj=t.isToTransformProj,this.transformProjection=t.transformProjection,this.resultString=""}return E()(r,[{key:"generate",value:function(){var e="EPSG:4490";Object(R.registerProj)(e);for(var g=this.mapProjectionCode.split(":")[1]*1,x=this.exportFeatures,v=0,d=x.length;v<d;v++)if(x[v].getGeometry().getType()==="Polygon"||x[v].getGeometry().getType()==="MultiPolygon"){var C=x[v].clone(),h={};if(g<=4554&&g>=4513)h=C,h.set("wkid",g);else{h=this.geoProjection(C);var l=Object(F.getCenter)(h.getGeometry().getExtent());if(l[0]>=-180&&l[0]<=180){var S=parseInt((l[0]-1.5)/3+1,10);h.set("delNo",S);var G=S+4488;h.set("wkid",G)}}var W=h.getGeometry(),M=this.isToTransformProj?this.transformProjection:"EPSG:"+h.get("wkid");Object(R.registerProj)(M);var A=W.transform("EPSG:"+g,M);h.setGeometry(A);var N=h.getGeometry().getArea();h.get("DK_MJ")&&h.set("DK_MJ",N),this.connectGeometryString(h,v,N)}else throw new Error("\u9009\u4E2D\u7684\u8981\u7D20\u4E2D\u542B\u6709\u975E\u9762\u8981\u7D20");this.export()}},{key:"geoProjection",value:function(e){var g="EPSG:4490",x=e.getGeometry().transform(this.mapProjectionCode,g);return e.setGeometry(x),e}},{key:"connectGeometryString",value:function(e,g,x){var v=this,d=0,C=[];e.getGeometry().getType()==="MultiPolygon"?(C=e.getGeometry().getPolygons(),e.getGeometry().getPolygons().forEach(function(l){var S=this;n()(this,v),l.getCoordinates().forEach(function(G){n()(this,S),d+=G.length}.bind(this))}.bind(this))):e.getGeometry().getType()==="Polygon"&&(C.push(e.getGeometry()),e.getGeometry().getCoordinates().forEach(function(l){n()(this,v),d+=l.length}.bind(this)));var h="";e.get("DK_MC")&&(h=e.get("DK_MC")),this.resultString+=`\u5BFC\u51FA\u9762\u6570\u636E0
`,C.forEach(function(l,S){var G=this;n()(this,v);var W=0;l.getLinearRings().forEach(function(M){var A=this;n()(this,G),W++,M.getCoordinates().forEach(function(N,U){n()(this,A),U===M.getCoordinates().length-1&&(U=0),this.resultString+=N[0].toFixed(3)+","+N[1].toFixed(3)+`\r
`}.bind(this))}.bind(this))}.bind(this))}},{key:"export",value:function(){var e=new Blob(["\uFEFF"+this.resultString],{type:"text/plain;charset=utf-8"});Object(Q.saveAs)(e,this.exportFileName+this.exportFileExt)}}]),r}(),rt=b,gt=function(){function r(t){w()(this,r),t=k()({},t),this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.isWithDH=t.isWithDH,this.mapProjectionCode=t.mapProjectionCode,this.isDegree=t.isDegree,this.isToTransformProj=t.isToTransformProj,this.transformProjection=t.transformProjection,this.resultString=""}return E()(r,[{key:"generate",value:function(){var e="EPSG:4490";Object(R.registerProj)(e);var g="2000\u56FD\u5BB6\u5927\u5730\u5750\u6807\u7CFB";this.resultString=`\u5BFC\u51FA\u9762\u6570\u636E0\r
`;for(var x=this.mapProjectionCode.split(":")[1]*1,v=this.exportFeatures,d=0,C=v.length;d<C;d++)if(v[d].getGeometry().getType()==="Polygon"||v[d].getGeometry().getType()==="MultiPolygon"){var h=v[d].clone(),l={};if(x<=4554&&x>=4513)l=h,l.set("wkid",x);else{l=this.geoProjection(h);var S=Object(F.getCenter)(l.getGeometry().getExtent());if(S[0]>=-180&&S[0]<=180){var G=parseInt((S[0]-1.5)/3+1,10);l.set("delNo",G);var W=G+4488;l.set("wkid",W)}}var M=l.getGeometry(),A=this.isToTransformProj?this.transformProjection:"EPSG:"+l.get("wkid");Object(R.registerProj)(A);var N=M.transform("EPSG:"+x,A);l.setGeometry(N);var U=l.getGeometry().getArea();l.get("DK_MJ")&&l.set("DK_MJ",U),this.connectGeometryString(l,d,U)}else throw new Error("\u9009\u4E2D\u7684\u8981\u7D20\u4E2D\u542B\u6709\u975E\u9762\u8981\u7D20");this.export()}},{key:"geoProjection",value:function(e){var g="EPSG:4490",x=e.getGeometry().transform(this.mapProjectionCode,g);return e.setGeometry(x),e}},{key:"connectGeometryString",value:function(e,g,x){var v=this,d=0,C=[];e.getGeometry().getType()==="MultiPolygon"?(C=e.getGeometry().getPolygons(),e.getGeometry().getPolygons().forEach(function(l){var S=this;n()(this,v),l.getCoordinates().forEach(function(G){n()(this,S),d+=G.length}.bind(this))}.bind(this))):e.getGeometry().getType()==="Polygon"&&(C.push(e.getGeometry()),e.getGeometry().getCoordinates().forEach(function(l){n()(this,v),d+=l.length}.bind(this)));var h="";e.get("DK_MC")&&(h=e.get("DK_MC")),C.forEach(function(l,S){var G=this;n()(this,v);var W=0;l.getLinearRings().forEach(function(M){var A=this;n()(this,G),W++;var N=0;M.getCoordinates().forEach(function(U,nt){n()(this,A),N=N+1,nt===M.getCoordinates().length-1&&(nt=0),this.resultString+=N+","+(g+1)+","+W+",J"+(nt+1)+","+U[0].toFixed(3)+","+U[1].toFixed(3)+`\r
`}.bind(this))}.bind(this))}.bind(this))}},{key:"export",value:function(){var e=new Blob(["\uFEFF"+this.resultString],{type:"text/plain;charset=utf-8"});Object(Q.saveAs)(e,this.exportFileName+this.exportFileExt)}}]),r}(),dt=gt,ct=function(){function r(t){w()(this,r),t=k()({},t),this.map=m()(t),this.exportFileName=t.exportFileName?t.exportFileName:"exportFile",this.exportFileTypeAndExt=t.exportFileTypeAndExt?t.exportFileTypeAndExt:"SHP|.shp",this.mapProjectionCode=m()(this).getView().getProjection().getCode(),this.exportFeatures=m()(this).getSelectFeatures(),this.options={url:t.url,token:t.token,exportFileName:this.exportFileName,exportFileType:this.exportFileTypeAndExt.split("|")[0].toUpperCase(),exportFileExt:this.exportFileTypeAndExt.split("|")[1],isWithDH:!0,exportFeatures:this.exportFeatures,mapProjectionCode:this.mapProjectionCode,isToTransformProj:t.isToTransformProj,transformProjection:m()(this).transformProjection,isDegree:!1}}return E()(r,[{key:"exportFile",value:function(){if(this.exportFeatures&&this.exportFeatures.length>0)return this.options.exportFileType.indexOf("NDH")>=0&&(this.options.exportFileType=this.options.exportFileType.replace("NDH",""),this.options.isWithDH=!1),this.fileTypeFilter();throw new Error("\u5F53\u524D\u672A\u9009\u62E9\u5BFC\u51FA\u5730\u5757")}},{key:"fileTypeFilter",value:function(){var e=this;switch(this.options.exportFileType){case"SHP":{var g=new et(this.options);return g.generate()}case"DXF":case"DWG":{var x=new V(this.options);return x.generate()}case"ZDY":{var v=new rt(this.options);return new z.a(function(h,l){n()(this,e);try{v.generate(),h("\u5BFC\u51FA\u6210\u529F")}catch(S){f.error(S),l(S)}}.bind(this))}case"ZJSGTZYT":{var d=new dt(this.options);return new z.a(function(h,l){n()(this,e);try{d.generate(),h("\u5BFC\u51FA\u6210\u529F")}catch(S){f.error(S),l(S)}}.bind(this))}case"GTJZD":{var C=new ot(this.options);return new z.a(function(h,l){n()(this,e);try{C.generate(),h("\u5BFC\u51FA\u6210\u529F")}catch(S){f.error(S),l(S)}}.bind(this))}default:return new z.a(function(h,l){n()(this,e),l("\u6240\u9009\u5BFC\u51FA\u6587\u4EF6\u683C\u5F0F\u4E0D\u652F\u6301")}.bind(this))}}}]),r}(),ut=ct,pt=o(6),vt=o.n(pt),mt=o(43),xt=o.n(mt),yt=o(7),Ct=o.n(yt),St=o(74),Et=o.n(St),Pt=o(30),Tt=o.n(Pt),st=o(4),bt=void 0,It={name:"ShFileExport",components:{GeneralContainer:Tt.a},directives:{cardDrag:Et.a},mixins:[vt.a,xt.a,Ct.a],props:{url:{type:String},isToTransformProj:{type:Boolean,default:!1},imgIconConfig:{type:Object},fileTypes:{type:Array,default:function(){return n()(this,bt),[{label:"\u56FD\u571F\u8D44\u6E90\u90E8\u6807\u51C6\u683C\u5F0F(*.txt)",value:"GTJZD|.txt"},{label:"Shp\u6587\u4EF6",value:"SHP|.shp"},{label:"AutoCAD DXF\u6587\u4EF6(*.dxf)",value:"DXF|.dxf"},{label:"AutoCAD DWG\u6587\u4EF6(*.dwg)",value:"DWG|.dwg"},{label:"\u6D59\u6C5F\u7701\u56FD\u571F\u8D44\u6E90\u5385\u6587\u4EF6(*.txt)",value:"ZJSGTZYT|.txt"},{label:"\u81EA\u5B9A\u4E49\u6587\u4EF6(*.txt)",value:"ZDY|.txt"}]}.bind(void 0)}},data:function(){return{isComponentShow:!0,fileName:"",projection:"",exportTestIsShow:!0,projectionSelectIsShow:!1,fileType:"GTJZD|.txt",text:this.imgIconConfig&&this.imgIconConfig.text?this.imgIconConfig.text:"\u5BFC\u51FA",fontSizeValue:this.imgIconConfig&&this.imgIconConfig.fontSize?this.imgIconConfig.fontSize:"14px",fontColor:this.imgIconConfig&&this.imgIconConfig.fontColor?this.imgIconConfig.fontColor:"#fff",imgIcon:this.imgIconConfig&&this.imgIconConfig.img?this.imgIconConfig.img:"",width:this.imgIconConfig&&this.imgIconConfig.width?this.imgIconConfig.width:16,height:this.imgIconConfig&&this.imgIconConfig.height?this.imgIconConfig.height:16}},computed:{shouldShow:function(){return this.viewMode==="2D"?!0:this.viewMode==="3D"?!1:this.currentView==="map"}},mounted:function(){var t=this;this.$map&&setTimeout(function(){n()(this,t),this.begin()}.bind(this),0)},methods:{begin:function(){this.fileType=this.fileTypes.length>0?this.fileTypes[0].value:""},onChangeIsShow:function(t){this.$emit("change:isShow",t)},fileExportEvt:function(){var t,e=this;if(u()(t=this.fileName).call(t)==="")return Object(st.Message)({message:"\u6587\u4EF6\u540D\u4E0D\u80FD\u4E3A\u7A7A",type:"warning"}),!1;var g=this.$loading({lock:!0,target:this.$map.getTargetElement(),text:"\u5BFC\u51FA\u4E2D...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),x=new ut({map:this.$map,url:this.url?this.url:this.shinegaUrl+"/geofile/export",token:this.token,exportFileName:this.fileName,exportFileTypeAndExt:this.fileType,isToTransformProj:this.isToTransformProj});setTimeout(function(){var v=this;n()(this,e);try{x.exportFile().then(function(d){n()(this,v),g.close(),Object(st.Message)({message:d,type:"success"})}.bind(this)).catch(function(d){n()(this,v),g.close(),st.Message.error(d.message?d.message:d)}.bind(this))}catch(d){g.close(),f.error(d.message),st.Message.error(d.message)}}.bind(this),100)}}},jt=It,wt=o(2),Ft=Object(wt.a)(jt,p,y,!1,null,null,null),Gt=Ft.exports,Dt=o(28),Ot=o.n(Dt),$t=void 0,at=Ot()(Gt,{configName:"FileExport",transform:function(t){n()(this,$t);var e=t.show,g=t.label,x=t.position,v=t.config,d=v===void 0?{}:v,C=[];for(var h in d.fileInfo){var l=d.fileInfo[h].value;d[l]===!0&&C.push(d.fileInfo[h])}return{isShow:e,title:g,position:x,fileTypes:C}}.bind(void 0)});at.install=function(r){r.component(at.name,at)};var Zt=a.default=at},87:function(s,a){s.exports=i(211227)},9:function(s,a){s.exports=i(122777)}})},147806:function(Y,D,i){"use strict";var f=i(419534);Object.defineProperty(D,"__esModule",{value:!0}),D.default=void 0;var s=f(i(452909)),a=f(i(342579)),o=void 0,c={inject:{generalCardThemeStyle:{default:null}},props:{styleConfig:{type:Object,default:function(){(0,a.default)(this,o)}.bind(void 0)},position:{type:Object,default:function(){return(0,a.default)(this,o),{type:"absolute",top:"100px",right:"135px"}}.bind(void 0)},themeStyle:{type:Object},imgSrc:{type:String},title:{type:String},isShow:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!1},dragEnable:{type:Boolean,default:!0},onlyContainer:{type:Boolean,default:!1}},data:function(){return{visible:this.isShow,theme:"light"}},watch:{currentView:{handler:function(y){y==="earth"?this.theme="dark":this.theme="light"},immediate:!0},isShow:function(y){this.visible=y}},computed:{cardThemeStyle:function(){return this.themeStyle||this.generalCardThemeStyle}},mounted:function(){var y,T=this;this.$_mixin_generalCard=(0,s.default)(y=this.$children).call(y,function(u){return(0,a.default)(this,T),u.$options.name==="ShGeneralCard"}.bind(this))},methods:{changeShow:function(y){var T;if((T=this.$_mixin_generalCard)===null||T===void 0||T.changeShow(y),y===!1||y!==!0&&this.visible){var u;(u=this.deactivate)===null||u===void 0||u.call(this)}},changeStatus:function(y){var T;(T=this.$_mixin_generalCard)===null||T===void 0||T.changeStatus(y)},getPosition:function(){var y;return(y=this.$_mixin_generalCard)===null||y===void 0?void 0:y.getPosition()}}},n=c;D.default=n},132726:function(Y,D,i){"use strict";var f=i(149500),s=i(985208),a=i(659791),o=i(22466),c=i(183393),n=i(105077),p=i(419534);Object.defineProperty(D,"__esModule",{value:!0}),D.default=z;var y=p(i(611323)),T=p(i(543389)),u=p(i(934749)),O=p(i(342579)),w=p(i(985208)),q=p(i(828866)),E=p(i(22466)),Z=p(i(581806)),k=p(i(705146));function L(I,B){var $=s(I);if(a){var j=a(I);B&&(j=o(j).call(j,function(X){return c(I,X).enumerable})),$.push.apply($,j)}return $}function m(I){for(var B=1;B<arguments.length;B++){var $=arguments[B]!=null?arguments[B]:{};B%2?L(Object($),!0).forEach(function(j){(0,T.default)(I,j,$[j])}):n?Object.defineProperties(I,n($)):L(Object($)).forEach(function(j){Object.defineProperty(I,j,c($,j))})}return I}function P(I,B){for(var $=!1,j=I,X=function(){var it=this;j=j.$parent;var V=j.$refs;V&&(0,w.default)(V).forEach(function(_){(0,O.default)(this,it),V[_]===I&&(V[_]=B,$=!0)}.bind(this))};j.$parent&&!$;)X()}function z(I){var B,$,j=this,X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},et=X.configName,it=X.componentName,V=X.transform,_=(0,q.default)(B=(0,E.default)($=I.mixins||[]).call($,function(J){return(0,O.default)(this,j),!!J.props}.bind(this))).call(B,function(J){return(0,O.default)(this,j),{props:J.props}}.bind(this));return{name:it||I.name,props:I.props,mixins:_,inject:{reactiveConfigInstance:{default:function(){var F=this;return function(){return(0,O.default)(this,F),null}.bind(this)}}},data:function(){return this.$configInfo={},{ready:!1}},computed:{configInstance:function(){return this.reactiveConfigInstance()}},mounted:function(){this.initConfig()},methods:{initConfig:function(){var F=this;return(0,u.default)(y.default.mark(function Q(){var R,H;return y.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!F.configInstance){b.next=17;break}return R=F.$options.name.replace("Sh",""),H={},b.prev=3,b.next=6,F.configInstance.getWidgetInfoByTag(et||R);case 6:H=b.sent,b.next=13;break;case 9:return b.prev=9,b.t0=b.catch(3),f.error(b.t0),b.abrupt("return");case 13:if(H.stat){b.next=15;break}return b.abrupt("return");case 15:typeof V=="function"&&H.data?H=V(H.data,F.configInstance.widgetInfo.mapConfig,{url:F.configInstance.url.replace("/role/getResources",""),schemeId:F.configInstance.schemeId}):H=H.data,F.$configInfo=m({},H);case 17:F.ready=!0;case 18:case"end":return b.stop()}},Q,null,[[3,9]])}))()},forwordRef:function(){var F;P(this._self,this._self.$children[0]),(F=this._self.$children[0])===null||F===void 0||F.$emit("mounted",this._self.$children[0])}},render:function(F){var Q,R=this,H;if((0,Z.default)(Q=(0,w.default)(this.$listeners)).call(Q,"hook:mounted")){var ot;H=m(m({},this.$listeners),{},{"hook:mounted":(0,k.default)(ot=[this.forwordRef]).call(ot,this.$listeners["hook:mounted"])})}else H=m(m({},this.$listeners),{},{"hook:mounted":this.forwordRef});var b=this.$options.propsData;return(0,w.default)(b).forEach(function(rt){(0,O.default)(this,R),b[rt]===void 0&&delete b[rt]}.bind(this)),this.ready?F(I,{on:H,scopedSlots:this.$scopedSlots,props:m(m({},this.$configInfo),b),attrs:this.$attrs},this.$slots.default):null}}}},242709:function(Y,D,i){"use strict";var f=i(148836);const s={data(){return this.map=null,this.timer="",{isEditor:window.location.href.indexOf("editor.html")>0}},inject:{reactiveViewMode:{default:function(){return()=>"23D"}}},computed:{viewMode(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()}},mounted(){!this.widgetInfo.parentId&&this.isEditor&&this.widgetInfo.action.gisMapId&&this.$nextTick(function(){this.updateWidgetParentId({widgetId:this.widgetInfo.id,parentId:this.widgetInfo.action.gisMapId,keepPosition:!0})})},methods:{...(0,f.nv)(["updateWidgetParentId"]),getBindMap(){typeof this.widgetInfo.action.gisMapId<"u"}}};D.Z=s},476010:function(Y,D){"use strict";const i={data(){return{isSpecial:!1,isEditor:window.location.href.indexOf("editor.html")>0}},computed:{isBindToPage(){return this.widgetInfo.config.styleConfig.dragEnable||this.isSpecial},position(){return this.isEditor||!this.isBindToPage?{type:"absolute",top:"0px",left:"0px",bottom:"unset",right:"unset",zIndex:this.widgetInfo.attr.z}:{type:"absolute",top:this.widgetInfo.attr.y+"px",left:this.widgetInfo.attr.x+"px",zIndex:this.widgetInfo.attr.z}},styleConfig(){return{isShowBtn:this.widgetInfo.config.styleConfig.isShowBtn,isStartFix:this.isEditor,titleBar:{miniBtn:!0,maxBtn:!1,closeBtn:!1,fixBtn:!this.isEditor,title:!0},autoVisible:!1,btnSize:{size:this.widgetInfo.config.styleConfig.btnSize.size+"px",padding:this.widgetInfo.config.styleConfig.btnSize.padding+"px",radius:this.widgetInfo.config.styleConfig.btnSize.radius+"px"},size:{radius:this.widgetInfo.config.styleConfig.size.radius+"px",width:this.widgetInfo.attr.w>150?this.widgetInfo.attr.w+"px":"275px",height:this.widgetInfo.attr.hh>100?this.widgetInfo.attr.hh+"px":"80vh"},toolBtnSize:{size:this.widgetInfo.config.styleConfig.toolBtnSize.size+"px",margin:(this.widgetInfo.config.styleConfig.btnSize.size-this.widgetInfo.config.styleConfig.toolBtnSize.size)/2+"px"}}},themeConfig(){let f=this.widgetInfo.config.themeStyle.light;return{light:{title:{backgroundImage:"url('"+f.title.backgroundImage+"')",backgroundColor:f.title.backgroundColor?f.title.backgroundColor:f.floatButton.fillcolor,backgroundSize:f.title.backgroundSize,fontSize:f.title.fontSize+"px",color:f.title.fontColor},primaryFont:{fontSize:f.primaryFont.fontSize+"px",fontColor:f.primaryFont.fontColor},toolButton:{color:f.toolButton.color},panel:{backgroundImage:"url('"+f.panel.backgroundImage+"')",backgroundColor:f.panel.fillcolor,backgroundSize:f.panel.backgroundSize,border:f.panel.border},floatButton:{backgroundColor:f.floatButton.fillcolor,shadowColor:f.floatButton.shadowColor,border:f.floatButton.border}}}}},methods:{bindToPage(f){f&&this.isBindToPage&&(f.parentElement.remove(f),document.getElementById("page_"+this.widgetInfo.pageId).append(f),f.style.pointerEvents="auto",document.getElementById("container_child_"+this.widgetInfo.id).remove())}}};D.Z=i},752246:function(Y,D,i){"use strict";i.d(D,{X:function(){return f},b:function(){return s}});let f={versions:function(){var a=navigator.userAgent;return{trident:a.indexOf("Trident")>-1,presto:a.indexOf("Presto")>-1,webKit:a.indexOf("AppleWebKit")>-1,gecko:a.indexOf("Gecko")>-1&&a.indexOf("KHTML")==-1,mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:a.indexOf("Android")>-1,iPhone:a.indexOf("iPhone")>-1,iPad:a.indexOf("iPad")>-1,webApp:a.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},s;f.versions.mobile||f.versions.ios||f.versions.android||f.versions.iPhone||f.versions.iPad?s=!1:s=!0},844513:function(Y,D,i){"use strict";i.d(D,{Z:function(){return y}});var f=function(){var u=this,O=u._self._c;return u.attr.buttonHide?O("div",{style:{position:"absolute",right:u.attr.buttonHideRight+"px",top:u.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(w){return u.onHide()}}},[u.openTooltip?O("el-tooltip",{attrs:{"open-delay":1e3,content:u.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[O("el-button",{class:u.attr.buttonHideIconClass&&u.attr.buttonHideIconClass!=""?u.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:u.attr.buttonHideColor,fontSize:u.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):O("el-button",{class:u.attr.buttonHideIconClass&&u.attr.buttonHideIconClass!=""?u.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:u.attr.buttonHideColor,fontSize:u.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):u._e()},s=[],a=i(752246),o={props:["attr"],name:"hide-button",data(){return{isPc:a.b}},computed:{openTooltip:function(){let T=!1,u=this.attr.buttonHideTooltipContent;return a.b&&u&&u!=null&&u.trim()!=""&&(T=!0),T}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},c=o,n=i(768141),p=(0,n.Z)(c,f,s,!1,null,"bf399b9a",null),y=p.exports},930602:function(Y,D,i){"use strict";i.r(D),i.d(D,{default:function(){return L}});var f=function(){var P=this,z=P._self._c;return z("div",{directives:[{name:"show",rawName:"v-show",value:P.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"content",staticClass:"my-gisBase",style:{width:P.widgetInfo.attr.w+"px",height:P.widgetInfo.attr.hh+"px"}},[z("hide-button",{attrs:{attr:P.widgetInfo.attr}}),z("FileExport",{ref:"fileexport",attrs:{"btn-attr":P.btnAttr,"img-icon-config":P.imgIconConfig,position:P.position,"file-types":P.widgetInfo.config.fileTypes,"style-config":P.styleConfig,"theme-style":P.themeConfig,"drag-enable":P.widgetInfo.config.styleConfig.dragEnable,"img-src":P.widgetInfo.config.imgSrc}})],1)},s=[],a=i(587212),o=i.n(a),c=i(844513),n=i(235718),p=i(445061),y=i(126711),T=i(386892),u=i(476010),O=i(242709),w=i(149500),q={name:"GisFileExport",components:{FileExport:o(),HideButton:c.Z},mixins:[n.baseConfig,T.D,p.u,y.H,u.Z,O.Z],props:["widgetInfo"],data(){return{timer:"",map:null,tocConfig:null,btnAttr:this.widgetInfo.attr,imgIconConfig:this.widgetInfo.config.imgIconConfig}},mounted(){this.isEditor||this.$nextTick(()=>{let m=this.$refs.fileexport.$el;this.bindToPage(m)}),this.initAction(this.widgetInfo)},methods:{loadInfo(){},reLoadInfo(m){this.loadInfo(m),this.btnAttr=m.attr,this.imgIconConfig=m.config.imgIconConfig},initAction(m){this.actionReceive(m)},getBindMap(){if(typeof this.widgetInfo.action.gisMapId<"u"){let m=this.getWidgetObject(this.widgetInfo.action.gisMapId);if(m){clearInterval(this.timer);let P=m.$refs.gismap;P&&(w.log("\u83B7\u53D6map\u5BF9\u8C61\u6210\u529F\uFF0C\u56FE\u5C42\u76EE\u5F55\u7ED1\u5B9A\u5730\u56FE\uFF0C\u521D\u59CB\u5316\u56FE\u5C42\u64CD\u4F5C,\u5173\u95ED\u5B9A\u65F6\u5668"),this.map=P.map,this.$refs.fileexport.setMap(this.map))}}},doConfigMap(m,P,z){let I=P[z];w.info("======tctocovt========="),w.info(m),w.info(I),this.map=I,w.info("==============="),this.$refs.toc.initLayerManager(this.map)}}},E=q,Z=i(768141),k=(0,Z.Z)(E,f,s,!1,null,"73913800",null),L=k.exports}}]);
