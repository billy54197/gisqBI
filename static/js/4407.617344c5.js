"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[4407],{56279:function(x,u,r){r.d(u,{P:function(){return g}});var v=r(86892),l=r(49500);const g={mixins:[v.D],created(){},methods:{lifecycleBeforeChartsLoad(f){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&l.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),l.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let p=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[f]);if(p)return p}return f},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&l.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),l.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},44513:function(x,u,r){r.d(u,{Z:function(){return m}});var v=function(){var o=this,h=o._self._c;return o.attr.buttonHide?h("div",{style:{position:"absolute",right:o.attr.buttonHideRight+"px",top:o.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(P){return o.onHide()}}},[o.openTooltip?h("el-tooltip",{attrs:{"open-delay":1e3,content:o.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[h("el-button",{class:o.attr.buttonHideIconClass&&o.attr.buttonHideIconClass!=""?o.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:o.attr.buttonHideColor,fontSize:o.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):h("el-button",{class:o.attr.buttonHideIconClass&&o.attr.buttonHideIconClass!=""?o.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:o.attr.buttonHideColor,fontSize:o.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):o._e()},l=[],g=r(52246),f={props:["attr"],name:"hide-button",data(){return{isPc:g.b}},computed:{openTooltip:function(){let c=!1,o=this.attr.buttonHideTooltipContent;return g.b&&o&&o!=null&&o.trim()!=""&&(c=!0),c}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},b=f,p=r(68141),y=(0,p.Z)(b,v,l,!1,null,"bf399b9a",null),m=y.exports},14407:function(x,u,r){r.r(u),r.d(u,{default:function(){return E}});var v=function(){var t=this,e=t._self._c;return e("div",{ref:"titleFlip",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[e("hide-button",{attrs:{attr:t.widgetInfo.attr}}),e("iframe",{ref:"myIframe",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px",verticalAlign:"top"},attrs:{id:"my_iframe_"+t.widgetInfo.id,src:t.url,frameborder:!t.widgetInfo.config.frameborder,scrolling:t.widgetInfo.config.scrolling}})],1)},l=[],g=r(44513),f=r(16739),b=r(26711),p=r(45061),y=r(56279),m=r(27966),c=r(55616),o=r(48836),h=r(42160),P=r(75770),w=r(49500),L={name:"AllIframe",components:{HideButton:g.Z},mixins:[f.u,b.H,p.u,y.P],props:["widgetInfo"],computed:{...(0,o.Se)(["getCanvasSetting","getURLParams"]),url:function(){return this.loaded?this.urlInfo.url:this.widgetInfo.attr.hide&&this.widgetInfo.config.loadOnShow?"":(this.loaded=!0,this.urlInfo.url)}},data(){return{loaded:!1,globalEditor:this.$$global_editor,urlInfo:{url:null,host:"",params:{}}}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)},"widgetInfo.config.url":function(){this.getUrlInfo()}},mounted(){this.loadInfo(this.widgetInfo),this.initAction(this.widgetInfo)},methods:{...(0,o.nv)(["addChildInitFinish"]),loadInfo(a){this.getUrlInfo(),w.debug(a),this.lifecycleAfterLoad()},reLoadInfo(a){this.loadInfo(a)},initAction(a){this.actionSendout(a),this.actionReceive(a),this.actionReceiveSelf(a)},actionSendout(a){let t=this;this.$$lib__.each(a.action.sendOut.actionList,e=>{if(e.enabled&&e.code==P.Z.listenerMessage.code){let i=e.code+"_"+a.id,s={};if(e.paramsExtend&&e.paramsExtend.length>0){let n=[];t.widgetInfo.dataset[t.widgetInfo.dataset.type].source&&t.widgetInfo.dataset[t.widgetInfo.dataset.type].source.length>0&&(n=t.widgetInfo.dataset[t.widgetInfo.dataset.type].source[0]),this.getExtendParams(s,e.paramsExtend,n,t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions)}window.addEventListener("message",n=>{if(s=t.getParam(s,n.data),e.script&&e.script.enabled){if(w.log("Execute script for "+e.name+" action"),e.script.content==""){c.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param,data",e.script.content),s=this.customScript(s,n.data)}n.origin==window.origin?n.source&&n.source.frameElement&&n.source.frameElement.id=="my_iframe_"+a.id&&(m.Z.$emit(i,s),e.postMessage&&this.doPostMessage(s)):(m.Z.$emit(i,s),e.postMessage&&this.doPostMessage(s))}),this.actionNameList.push(i)}})},actionReceiveSelf(a){if(a.action==null||a.action.receive==null)return;let t=a.action.receive.postMessage;if(t&&t.enabled&&t.postList&&t.postList.length>0){let i=a.action.receive.postMessage.targetOrigin;this.postMessage(a.action.receive.postMessage.postList,i,t.script,a.name)}let e=a.action.receive.replaceUrlParams;if(e&&e.enabled&&e.replaceList&&e.replaceList.length>0){let i=e.replaceList;this.doUrlParams(i,a)}this.addChildInitFinish()},postMessage(a,t,e,i){let s=this;this.$$lib__.each(a,n=>{if(n[0].length>=2){let d=n[0][1]+"_"+n[0][0];n[0][1].indexOf("_")>-1&&(d=n[0][1]),m.Z.$on(d,I=>{if(e&&e.enabled){if(w.log("Execute script for "+i+" component to postMessage component"),e.content==""){c.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}s.sendPostMessage=new Function("data,origin",e.content)}s.sendPostMessage(I,t)})}})},sendPostMessage(a,t){this.$refs.myIframe.contentWindow.postMessage(a,t)},doUrlParams(a,t){let e={};if(this.$$lib__.each(a,i=>{let s=i.replaceParam;for(let n=0;n<s.length;n++)if(s[n].length==3){let d=s[n][1]+"_"+s[n][0],I=s[n][2],C=I.indexOf("|");s[n][1].indexOf("_")>-1&&(d=s[n][1]),C>-1&&(I=s[n][2].substring(C+1)),s[n][0]!=P.Z.global.code?(e[d]||h.default.set(e,d,{}),e[d][i.param]||h.default.set(e[d],i.param,I)):this.replaceGlobalParams(i.param,I)}}),!this.$$lib__.isEmpty(e))for(let i in e)m.Z.$on(i,s=>{if(t.action.receive.replaceUrlParams.script&&t.action.receive.replaceUrlParams.script.enabled){if(w.log("Execute script for "+t.name+" component to replace UrlParams parameters"),t.action.receive.replaceUrlParams.script.content==""){c.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.doReplaceUrlParams=new Function("info","data","param_key",t.action.receive.replaceUrlParams.script.content),w.log("Replace UrlParams parameter of "+t.name+" component Script execution complete")}this.doReplaceUrlParams(t,s,e[i])})},doReplaceUrlParams(a,t,e){if(!this.$$lib__.isEmpty(this.urlInfo.params)&&this.urlInfo.host!=""){for(let i in e)for(let s in this.urlInfo.params)if(s==i){let n=e[i];this.urlInfo.params[s]=t[n]}this.urlInfo.url=this.urlInfo.host;for(let i in this.urlInfo.params)this.urlInfo.url=this.urlInfo.url+"&"+i+"="+this.urlInfo.params[i]}},replaceGlobalParams(a,t){let e=this.getGlobalParamsValue(t);if(!this.$$lib__.isEmpty(this.urlInfo.params)&&this.urlInfo.host!=""){this.urlInfo.params[a]=e,this.urlInfo.url=this.urlInfo.host;for(let i in this.urlInfo.params)this.urlInfo.url=this.urlInfo.url+"&"+i+"="+this.urlInfo.params[i]}},getGlobalParamsValue(a){if(this.getCanvasSetting==null||this.getCanvasSetting.data==null||this.getCanvasSetting.data.globalParams==null||this.getCanvasSetting.data.globalParams.paramsValue==null||this.getCanvasSetting.data.globalParams.paramsValue.length<1)return"";let t=this.$$lib__.find(this.getCanvasSetting.data.globalParams.paramsValue,i=>i.paramName==a);if(!t)return this.getCanvasSetting.data.globalParams.params[a];let e=this.getURLParams[t.urlParams];return e||(e=this.getCanvasSetting.data.globalParams.params[a]),e},getUrlInfo(){this.urlInfo.url=this.replaceParamValue(this.widgetInfo.config.url);let a=decodeURI(this.urlInfo.url),t=a.indexOf("?");if(t!=-1){this.urlInfo.host=a.substr(0,t+1);let s=a.substr(t+1).split("&");for(var e=0;e<s.length;e++)this.urlInfo.params[s[e].split("=")[0]]=decodeURI(s[e].split("=")[1])}},getParam(a,t){for(let e in a)for(let i in t)i==e&&(a[e]=t[i]);return a},replaceParamValue(a){return this.$$lib__.each(this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode,t=>{let e=new RegExp("[${]([^$]"+t.name+")[}]","g");a=a.replace(e,this.getParamValue(t))}),a},getParamValue(a){return a.type==this.globalEditor.iframeUrlParamsType.static.code?a.staticValue:a.type==this.globalEditor.iframeUrlParamsType.globalParams.code?this.getGlobalParamsValue(a.globalParamName):a.type==this.globalEditor.iframeUrlParamsType.dataSet.code&&this.widgetInfo.dataset[this.widgetInfo.dataset.type].source&&this.widgetInfo.dataset[this.widgetInfo.dataset.type].source.length>0?this.getFieldVal(this.widgetInfo.dataset[this.widgetInfo.dataset.type].source[0],this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions,a.dataSetField):""}}},S=L,$=r(68141),U=(0,$.Z)(S,v,l,!1,null,"5daa4c3a",null),E=U.exports}}]);
