"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[6173],{106173:function(U,p,t){var E=t(29870),r=t(465557),P=t(787879),D=t(183393),d=t(419534);Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var Y=d(t(298924)),T=d(t(122777)),G=d(t(42762)),L=d(t(330044)),O=d(t(299085)),R=d(t(234009)),W=d(t(519704)),F=d(t(828659)),w=d(t(458117)),$=d(t(758397)),N=d(t(602791)),M=t(59269),c=m(t(351502)),A=d(t(289517));function C(n){if(typeof P!="function")return null;var a=new P,u=new P;return(C=function(v){return v?u:a})(n)}function m(n,a){if(!a&&n&&n.__esModule)return n;if(n===null||E(n)!=="object"&&typeof n!="function")return{default:n};var u=C(a);if(u&&u.has(n))return u.get(n);var f={},v=Object.defineProperty&&D;for(var x in n)if(x!=="default"&&Object.prototype.hasOwnProperty.call(n,x)){var B=v?D(n,x):null;B&&(B.get||B.set)?Object.defineProperty(f,x,B):f[x]=n[x]}return f.default=n,u&&u.set(n,f),f}function y(n){var a=s();return function(){var f=(0,R.default)(n),v;if(a){var x=(0,R.default)(this).constructor;v=r(f,arguments,x)}else v=f.apply(this,arguments);return(0,O.default)(this,v)}}function s(){if(typeof Reflect>"u"||!r||r.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(r(Boolean,[],function(){})),!0}catch{return!1}}var i=function(n){(0,L.default)(u,n);var a=y(u);function u(f,v){var x;return(0,T.default)(this,u),x=a.call(this,f,v),x.options=v||(0,Y.default)(c),x.sourceId=M.DRAWLAYER_ID,f.layerManager.createDrawLayer({id:M.DRAWLAYER_ID,drawLayerType:M.DRAWLAYER_TYPE,label:"\u9ED8\u8BA4\u56FE\u5C42"}),x}return(0,G.default)(u,[{key:"generateControlByName",value:function(v){var x=A.default[v];switch(x){case c.POINT:return new F.default({drawname:v,source:this.drawSource});case c.POLYLINE:return new F.default({drawname:v,type:"LineString",source:this.drawSource});case c.POLYGON:return new F.default({drawname:v,type:"Polygon",source:this.drawSource});case c.RECTANGLE:case c.CIRCLE:case c.ELLIPSE:case c.ELLIPSOID:case c.CURVE:case c.ARROW:case c.ARROW_ATTACK:case c.ARROW_PINCERLIKE:case c.SURFACE_CLOSED:case c.ASSEMBLY_SITE:return new w.default({drawname:v,type:v,source:this.drawSource});case c.MODIFY:return new N.default({sourceId:this.sourceId});case c.CLEAR:return new $.default({source:this.drawSource})}}}]),u}(W.default),h=i;p.default=h},458117:function(U,p,t){var E=t(465557),r=t(419534);Object.defineProperty(p,"__esModule",{value:!![]}),p.default=void 0;var P=r(t(828866)),D=r(t(342579)),d=r(t(122777)),Y=r(t(42762)),T=r(t(553144)),G=r(t(330044)),L=r(t(299085)),O=r(t(234009)),R=r(t(383698)),W=r(t(525661)),F=t(101117);function w(c){var A=$();return function(){var m=(0,O.default)(c),y;if(A){var s=(0,O.default)(this).constructor;y=E(m,arguments,s)}else y=m.apply(this,arguments);return(0,L.default)(this,y)}}function $(){if(typeof Reflect>"u"||!E)return![];if(E.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(E(Boolean,[],function(){})),!![]}catch{return![]}}var N=function(c){(0,G.default)(C,c);var A=w(C);function C(m){var y=this,s;return(0,d.default)(this,C),s=A.call(this,m),s.isDraw=!![],s.source=m.source,s.type=m.type,s.drawname=m.drawname,s.drawInteraction=new W.default({type:m.type}),s.drawInteraction.on("drawend",function(i){if((0,D.default)(this,y),s.source){!i.feature.originStyle&&s.originStyle&&(i.feature.originStyle=s.originStyle),s.initAttr&&i.feature.setProperties(s.initAttr);var h=(0,F.v4)();i.feature.setId(h),i.feature.set("id",h),i.feature.set("layerId",s.sourceId),s.source.addFeature(i.feature)}s.dispatchEvent(i)}.bind(this)),s.drawInteraction.on("drawstart",function(i){(0,D.default)(this,y),s.dispatchEvent(i)}.bind(this)),s}return(0,Y.default)(C,[{key:"activate",value:function(y,s){this.originStyle=y,this.initAttr=s,y&&this.drawInteraction.setStyle(y),(0,P.default)(this).addInteraction(this.drawInteraction),(0,T.default)((0,O.default)(C.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(y){(0,P.default)(this).removeInteraction(this.drawInteraction),(0,T.default)((0,O.default)(C.prototype),"deactivate",this).call(this,y)}}]),C}(R.default),M=N;p.default=M},602791:function(U,p,t){var E=t(465557),r=t(419534);Object.defineProperty(p,"__esModule",{value:!![]}),p.default=void 0;var P=r(t(828866)),D=r(t(342579)),d=r(t(122777)),Y=r(t(42762)),T=r(t(387507)),G=r(t(553144)),L=r(t(330044)),O=r(t(299085)),R=r(t(234009)),W=r(t(383698)),F=t(612768),w=r(t(647598)),$=t(505775),N=r(t(10257)),M=t(986200),c=r(t(777871));function A(s){var i=C();return function(){var n=(0,R.default)(s),a;if(i){var u=(0,R.default)(this).constructor;a=E(n,arguments,u)}else a=n.apply(this,arguments);return(0,O.default)(this,a)}}function C(){if(typeof Reflect>"u"||!E)return![];if(E.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(E(Boolean,[],function(){})),!![]}catch{return![]}}var m=function(s){(0,L.default)(h,s);var i=A(h);function h(n){var a=this,u;return(0,d.default)(this,h),u=i.call(this,n),u.isModify=!![],u.sourceId=n.sourceId,u.selectInteraction=new c.default({layers:function(v){return(0,D.default)(this,a),v.get("id")===u.sourceId}.bind(this)}),u.selectInteraction.on("select",function(f){(0,D.default)(this,a),(0,P.default)(u).removeInteraction(u.modifyInteraction),f.deselected&&f.deselected.length>0&&u.dispatchEvent(new M.ModifyEvent("edit-stop")),f.selected&&f.selected.length>0&&u.featureSelected(f.selected[0])}.bind(this)),u.bindModifyInteractionEvent_=u.bindModifyInteractionEvent.bind((0,T.default)(u)),u}return(0,Y.default)(h,[{key:"bindModifyInteractionEvent",value:function(a){this.bindModifyInteraction(a.target)}},{key:"featureSelected",value:function(a){this.dispatchEvent(new M.ModifyEvent("edit-start",a)),this.bindModifyInteraction(a),a.getGeometry().isPlot&&a.getGeometry().isPlot()&&(a.un("change",this.bindModifyInteractionEvent_),a.on("change",this.bindModifyInteractionEvent_))}},{key:"bindModifyInteraction",value:function(a){var u=this;(0,P.default)(this).removeInteraction(this.modifyInteraction);var f=this.getModifyFeature(a);this.modifyInteraction=new F.Modify({features:new N.default([f])}),this.modifyInteraction.on("modifyend",function(v){(0,D.default)(this,u);var x=v.features;a.getGeometry().isPlot&&a.getGeometry().isPlot()&&(a.getGeometry().setPoints(x.getArray()[0].getGeometry().getCoordinates()),a.originStyle=a.getGeometry().style),this.dispatchEvent(new M.ModifyEvent("modifyend",new N.default([a]),v.mapBrowserEvent))}.bind(this)),(0,P.default)(this).addInteraction(this.modifyInteraction)}},{key:"getModifyFeature",value:function(a){if(a.getGeometry().isPlot&&a.getGeometry().isPlot()){var u=new w.default,f=new $.MultiPoint(a.getGeometry().getPoints());return u.setGeometry(f),u}else return a}},{key:"activate",value:function(){(0,G.default)((0,R.default)(h.prototype),"activate",this).call(this),(0,P.default)(this).addInteraction(this.selectInteraction)}},{key:"deactivate",value:function(a){clearTimeout(this.cursorTimeout),this.selectInteraction.getFeatures().clear(),(0,P.default)(this).removeInteraction(this.selectInteraction),(0,P.default)(this).removeInteraction(this.modifyInteraction),(0,G.default)((0,R.default)(h.prototype),"deactivate",this).call(this,a)}},{key:"stopEditing",value:function(){this.selectInteraction.getFeatures().getArray().length>0&&this.dispatchEvent(new M.ModifyEvent("edit-stop")),this.selectInteraction.getFeatures().clear(),(0,P.default)(this).removeInteraction(this.modifyInteraction)}},{key:"setSelectFeature",value:function(a){this.selectInteraction.getFeatures().push(a),this.featureSelected(a)}},{key:"setEditLayer",value:function(a){this.sourceId=a}}]),h}(W.default),y=m;p.default=y},525661:function(U,p,t){var E=t(29870),r=t(465557),P=t(787879),D=t(183393),d=t(419534);Object.defineProperty(p,"__esModule",{value:!![]}),p.default=p.DrawEvent=void 0;var Y=d(t(705146)),T=d(t(520314)),G=d(t(636583)),L=d(t(553144)),O=d(t(42762)),R=d(t(122777)),W=d(t(330044)),F=d(t(299085)),w=d(t(234009)),$=d(t(12207)),N=d(t(724101)),M=t(561280),c=d(t(505085)),A=d(t(692405)),C=d(t(787914)),m=t(339211),y=d(t(647598)),s=t(505775),i=d(t(17369)),h=t(355217),n=u(t(351502));function a(g){if(typeof P!="function")return null;var V=new P,I=new P;return(a=function(e){return e?I:V})(g)}function u(g,V){if(!V&&g&&g.__esModule)return g;if(g===null||E(g)!=="object"&&typeof g!="function")return{default:g};var I=a(V);if(I&&I.has(g))return I.get(g);var l={},e=Object.defineProperty&&D;for(var o in g)if(o!=="default"&&Object.prototype.hasOwnProperty.call(g,o)){var S=e?D(g,o):null;S&&(S.get||S.set)?Object.defineProperty(l,o,S):l[o]=g[o]}return l.default=g,I&&I.set(g,l),l}function f(g){var V=v();return function(){var l=(0,w.default)(g),e;if(V){var o=(0,w.default)(this).constructor;e=r(l,arguments,o)}else e=l.apply(this,arguments);return(0,F.default)(this,e)}}function v(){if(typeof Reflect>"u"||!r)return![];if(r.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(r(Boolean,[],function(){})),!![]}catch{return![]}}var x={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWMOVING:"drawmoving",DRAWABORT:"drawabort"},B=function(g){(0,W.default)(I,g);var V=f(I);function I(l,e,o){var S;return(0,R.default)(this,I),S=V.call(this,l),S.feature=e,S.points=o,S}return(0,O.default)(I)}($.default);p.DrawEvent=B;var H=function(g){(0,W.default)(I,g);var V=f(I);function I(l){var e;(0,R.default)(this,I);var o=l;!o.stopDown&&(o.stopDown=M.FALSE),e=V.call(this,o),e.type=l.type,e.style_={},e.source_=l.source?l.source:null,e.features_=l.features?l.features:null,e.snapTolerance_=l.snapTolerance?l.snapTolerance:12;var S=(0,h.getPlotCount)(e.type);return e.fixPointCount_=S.fixPointCount,e.minPointCount_=S.minPointCount,e.sketchFeature_=null,e.drawingPoints=[],e.overlay_=new c.default({source:new A.default({useSpatialIndex:![],wrapX:l.wrapX?l.wrapX:![]}),style:l.style?l.style:(0,m.createEditingStyle)()[i.default.POINT],updateWhileInteracting:!![]}),e.addChangeListener(C.default.ACTIVE,e.updateState_),e}return(0,O.default)(I,[{key:"abortDrawing_",value:function(){this.isStayDraw=![];var e=this.sketchFeature_;return this.sketchFeature_=null,this.drawingPoints=[],this.overlay_.getSource().clear(!![]),e}},{key:"abortDrawing",value:function(){var e=this.abortDrawing_();e&&this.dispatchEvent(new B(x.DRAWABORT,e,this.drawingPoints))}},{key:"updateState_",value:function(){var e=this.getMap(),o=this.getActive();(!e||!o)&&this.abortDrawing(),this.overlay_.setMap(o?e:null)}},{key:"setMap",value:function(e){(0,L.default)((0,w.default)(I.prototype),"setMap",this).call(this,e),this.updateState_()}},{key:"setStyle",value:function(e){this.style_=e||{}}},{key:"getOverlay",value:function(){return this.overlay_}},{key:"handleDownEvent",value:function(){return!![]}},{key:"handleUpEvent",value:function(e){if(!this.isStayDraw)this.startDrawing_(e.coordinate);else if(this.drawingPoints&&this.drawingPoints.length>0){if(this.atFinish_(e.pixel))return this.finishDrawing(),e.preventDefault(),![];var o=this.drawingPoints.length+1;o<=this.fixPointCount_&&this.addPoint(e.coordinate),o>=this.minPointCount_&&this.buildDrawingFeature(this.drawingPoints),o===this.fixPointCount_&&this.finishDrawing()}return e.preventDefault(),![]}},{key:"handleMoveEvent",value:function(e){var o;if(this.isStayDraw&&((o=this.drawingPoints)===null||o===void 0?void 0:o.length)>=this.minPointCount_){var S,X=(0,Y.default)(S=[]).call(S,(0,G.default)(this.drawingPoints),[e.coordinate]);this.buildDrawingFeature(X),this.dispatchEvent(new B(x.DRAWMOVING,this.sketchFeature_,this.drawingPoints))}}},{key:"atFinish_",value:function(e){var o=![],S=this.drawingPoints.length;if(S>this.minPointCount_&&this.fixPointCount_===Number.MAX_VALUE){var X=this.drawingPoints[this.drawingPoints.length-1],j=this.getMap().getPixelFromCoordinate(X),z=e[0]-j[0],K=e[1]-j[1];o=Math.sqrt(z*z+K*K)<=this.snapTolerance_}return o}},{key:"startDrawing_",value:function(e){this.isStayDraw=!![],this.drawingPoints=[(0,T.default)(e).call(e)],this.sketchFeature_=this.createMultiPointFeature(),this.updateSketchFeatures_(),this.dispatchEvent(new B(x.DRAWSTART,this.sketchFeature_,this.drawingPoints))}},{key:"createMultiPointFeature",value:function(){var e=new s.MultiPoint(this.drawingPoints),o=new y.default;return o.setGeometry(e),o}},{key:"addPoint",value:function(e){this.drawingPoints.push(e),this.sketchFeature_=this.createMultiPointFeature(),this.updateSketchFeatures_()}},{key:"buildDrawingFeature",value:function(e){this.sketchFeature_=new y.default;var o=(0,h.createPlot)(this.type,e);this.sketchFeature_.setGeometry(o);var S=[n.CIRCLE,n.ELLIPSOID,n.ELLIPSE];S.indexOf(this.type)>-1&&(o.setStyle(this.style_),this.style_=o.style),this.sketchFeature_.originStyle=this.style_,o.setMap&&o.setMap(this.getMap()),this.sketchFeature_.setStyle((0,h.getStyle)(this.type,this.style_)),this.updateSketchFeatures_()}},{key:"updateSketchFeatures_",value:function(){var e=this.overlay_.getSource();e.clear(!![]),e.addFeature(this.sketchFeature_)}},{key:"finishDrawing",value:function(){this.buildDrawingFeature(this.drawingPoints);var e=this.drawingPoints,o=this.abortDrawing_();o&&(this.dispatchEvent(new B(x.DRAWEND,o,e)),this.features_&&this.features_.push(o),this.source_&&this.source_.addFeature(o))}}]),I}(N.default),J=H;p.default=J},777871:function(U,p,t){var E=t(465557),r=t(419534);Object.defineProperty(p,"__esModule",{value:!![]}),p.default=void 0;var P=r(t(342579)),D=r(t(122777)),d=r(t(42762)),Y=r(t(387507)),T=r(t(330044)),G=r(t(299085)),L=r(t(234009)),O=r(t(902981)),R=r(t(505085)),W=r(t(692405)),F=t(505775),w=t(91873),$=r(t(647598));function N(C){var m=M();return function(){var s=(0,L.default)(C),i;if(m){var h=(0,L.default)(this).constructor;i=E(s,arguments,h)}else i=s.apply(this,arguments);return(0,G.default)(this,i)}}function M(){if(typeof Reflect>"u"||!E)return![];if(E.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(E(Boolean,[],function(){})),!![]}catch{return![]}}var c=new w.Style({image:new w.Circle({radius:5,fill:new w.Fill({color:"rgba(25,25,125,0.8)"}),stroke:new w.Stroke({color:"rgba(255,255,255,0.6)",width:2})})}),A=function(C){(0,T.default)(y,C);var m=N(y);function y(s){var i;return(0,D.default)(this,y),i=m.call(this,s),i.overlay_=new R.default({source:new W.default({useSpatialIndex:![]}),updateWhileInteracting:!![]}),i.addCorePointEvent_=i.addCorePointEvent.bind((0,Y.default)(i)),i}return(0,d.default)(y,[{key:"applySelectedStyle_",value:function(i){this.overlay_.setMap(this.getMap()),i.on("change",this.addCorePointEvent_),this.addCorePointToOverlay(i)}},{key:"restorePreviousStyle_",value:function(i){i.un("change",this.addCorePointEvent_);var h=this.overlay_.getSource();h.clear(!![]),this.overlay_.setMap(null)}},{key:"addCorePointEvent",value:function(i){this.addCorePointToOverlay(i.target)}},{key:"addCorePointToOverlay",value:function(i){var h=this.overlay_.getSource();h.clear(!![]);var n=new $.default;n.setGeometry(this.getCorePoint(i)),n.setStyle(c),h.addFeature(n)}},{key:"getCorePoint",value:function(i){var h=this,n=[];return i.getGeometry().isPlot&&i.getGeometry().isPlot()?n=i.getGeometry().getPoints():i.getGeometry().getType()==="Polygon"?i.getGeometry().getCoordinates()[0].forEach(function(a){(0,P.default)(this,h),n.push(a)}.bind(this)):i.getGeometry().getType()==="MultiPolygon"?i.getGeometry().getCoordinates()[0].forEach(function(a){var u=this;(0,P.default)(this,h),a.forEach(function(f){(0,P.default)(this,u),n.push(f)}.bind(this)),n.push(a)}.bind(this)):i.getGeometry().getType()==="LineString"?n=i.getGeometry().getCoordinates():n=[i.getGeometry().getCoordinates()],new F.MultiPoint(n)}}]),y}(O.default);p.default=A}}]);
