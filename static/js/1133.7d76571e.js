"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[1133],{56279:function(L,y,l){l.d(y,{P:function(){return M}});var C=l(86892),v=l(49500);const M={mixins:[C.D],created(){},methods:{lifecycleBeforeChartsLoad(m){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&v.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),v.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let x=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[m]);if(x)return x}return m},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&v.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),v.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},44513:function(L,y,l){l.d(y,{Z:function(){return P}});var C=function(){var h=this,_=h._self._c;return h.attr.buttonHide?_("div",{style:{position:"absolute",right:h.attr.buttonHideRight+"px",top:h.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(k){return h.onHide()}}},[h.openTooltip?_("el-tooltip",{attrs:{"open-delay":1e3,content:h.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[_("el-button",{class:h.attr.buttonHideIconClass&&h.attr.buttonHideIconClass!=""?h.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:h.attr.buttonHideColor,fontSize:h.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):_("el-button",{class:h.attr.buttonHideIconClass&&h.attr.buttonHideIconClass!=""?h.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:h.attr.buttonHideColor,fontSize:h.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):h._e()},v=[],M=l(52246),m={props:["attr"],name:"hide-button",data(){return{isPc:M.b}},computed:{openTooltip:function(){let T=!1,h=this.attr.buttonHideTooltipContent;return M.b&&h&&h!=null&&h.trim()!=""&&(T=!0),T}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},E=m,x=l(68141),I=(0,x.Z)(E,C,v,!1,null,"bf399b9a",null),P=I.exports},31133:function(L,y,l){l.r(y),l.d(y,{default:function(){return tt}});var C=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],staticClass:"my-div",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[e("hide-button",{attrs:{attr:t.widgetInfo.attr}}),e("div",{staticStyle:{display:"flex"}},[t.widgetInfo.config.prefixAttr.show?e("div",{style:{flex:"none",width:t.widgetInfo.config.prefixAttr.labelWidth+"px",display:"flex",justifyContent:t.widgetInfo.config.prefixAttr.justifyContent,alignItems:t.widgetInfo.config.prefixAttr.alignItems,fontSize:t.widgetInfo.config.prefixAttr.labelStyle.fontSize+"px",color:t.widgetInfo.config.prefixAttr.labelStyle.color,fontWeight:t.widgetInfo.config.prefixAttr.labelStyle.fontWeight,fontStyle:t.widgetInfo.config.prefixAttr.labelStyle.fontStyle,fontFamily:t.widgetInfo.config.prefixAttr.labelStyle.fontFamily,textDecoration:t.widgetInfo.config.prefixAttr.labelStyle.textDecoration}},[e("span",[t._v(" "+t._s(t.widgetInfo.config.prefixAttr.label)+" ")])]):t._e(),e("div",{style:{flex:"none",marginLeft:t.widgetInfo.config.signatureArea.marginLeft+"px",display:"flex",flexDirection:t.widgetInfo.config.feature.featurePoi==="right"?"row":"column"}},[t.show?e("vueSignature",{ref:"signature",staticClass:"signature-canvas",style:{overflow:"hidden",borderRadius:t.widgetInfo.config.signatureArea.borderRadius+"px",border:`solid ${t.widgetInfo.config.signatureArea.borderWidth}px ${t.widgetInfo.config.signatureArea.borderColor}`},attrs:{disabled:t.widgetInfo.config.signatureArea.disabled?t.widgetInfo.config.signatureArea.disabled:t.done,sigOption:t.getOption,w:t.widgetInfo.config.signatureArea.w+"px",h:t.widgetInfo.config.signatureArea.h+"px"},nativeOn:{touchstart:function(i){return t.touchStart.apply(null,arguments)},touchmove:function(i){return t.touchMove.apply(null,arguments)},touchend:function(i){return t.touchEnd.apply(null,arguments)}}}):t._e(),e("div",{style:{display:"flex",flexDirection:t.widgetInfo.config.feature.featurePoi==="right"?"column":"row",justifyContent:t.widgetInfo.config.feature.justifyContent}},t._l(t.featureList,function(i,n){return e("div",{key:i.value,staticClass:"feature-item",style:{textAlign:"center",lineHeight:t.widgetInfo.config.feature.buttonHeight+"px",width:t.widgetInfo.config.feature.buttonWidth+"px",height:t.widgetInfo.config.feature.buttonHeight+"px",border:`solid ${t.widgetInfo.config.feature.buttonBorderColor} ${t.widgetInfo.config.feature.buttonBorderWidth}px`,borderRadius:t.widgetInfo.config.feature.buttonBorderRadius+"px",marginTop:n===0&&t.widgetInfo.config.feature.featurePoi==="right"?0:t.widgetInfo.config.feature.buttonMarginTop+"px",marginLeft:n===0&&t.widgetInfo.config.feature.featurePoi==="bottom"?0:t.widgetInfo.config.feature.buttonMarginLeft+"px",fontSize:t.widgetInfo.config.feature.featureStyle.fontSize+"px",color:t.widgetInfo.config.feature.featureStyle.color,fontWeight:t.widgetInfo.config.feature.featureStyle.fontWeight,fontFamily:t.widgetInfo.config.feature.featureStyle.fontFamily,fontStyle:t.widgetInfo.config.feature.featureStyle.fontStyle,textDecoration:t.widgetInfo.config.feature.featureStyle.textDecoration,backgroundColor:t.widgetInfo.config.feature.buttonBackgroundColor,overflow:"hidden"},on:{click:function(s){return t.buttonClick(i.value)}}},[t._v(t._s(i.value==="save"&&t.done?"\u91CD\u7B7E":i.text))])}),0)],1)])],1)},v=[],M=l(32590),m=l(77714),E=function(){var t=this,e=t._self._c;return e("div",{style:{width:t.w,height:t.h},on:{touchmove:function(i){i.preventDefault()}}},[e("canvas",{staticClass:"canvas",attrs:{id:t.uid,"data-uid":t.uid,disabled:t.disabled}})])},x=[];/*!
 * Signature Pad v3.0.0-beta.4 | https://github.com/szimek/signature_pad
 * (c) 2020 Szymon Nowak | Released under the MIT license
 */class I{constructor(t,e,i){this.x=t,this.y=e,this.time=i||Date.now()}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y&&this.time===t.time}velocityFrom(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0}}class P{constructor(t,e,i,n,s,r){this.startPoint=t,this.control2=e,this.control1=i,this.endPoint=n,this.startWidth=s,this.endWidth=r}static fromPoints(t,e){const i=this.calculateControlPoints(t[0],t[1],t[2]).c2,n=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new P(t[1],i,n,t[2],e.start,e.end)}static calculateControlPoints(t,e,i){const n=t.x-e.x,s=t.y-e.y,r=e.x-i.x,a=e.y-i.y,f={x:(t.x+e.x)/2,y:(t.y+e.y)/2},u={x:(e.x+i.x)/2,y:(e.y+i.y)/2},c=Math.sqrt(n*n+s*s),p=Math.sqrt(r*r+a*a),b=f.x-u.x,w=f.y-u.y,d=p/(c+p),g={x:u.x+b*d,y:u.y+w*d},S=e.x-g.x,W=e.y-g.y;return{c1:new I(f.x+S,f.y+W),c2:new I(u.x+S,u.y+W)}}length(){let e=0,i,n;for(let s=0;s<=10;s+=1){const r=s/10,a=this.point(r,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),f=this.point(r,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(s>0){const u=a-i,c=f-n;e+=Math.sqrt(u*u+c*c)}i=a,n=f}return e}point(t,e,i,n,s){return e*(1-t)*(1-t)*(1-t)+3*i*(1-t)*(1-t)*t+3*n*(1-t)*t*t+s*t*t*t}}function T(o,t=250){let e=0,i=null,n,s,r;const a=()=>{e=Date.now(),i=null,n=o.apply(s,r),i||(s=null,r=[])};return function(...u){const c=Date.now(),p=t-(c-e);return s=this,r=u,p<=0||p>t?(i&&(clearTimeout(i),i=null),e=c,n=o.apply(s,r),i||(s=null,r=[])):i||(i=window.setTimeout(a,p)),n}}class h{constructor(t,e={}){this.canvas=t,this.options=e,this._handleMouseDown=i=>{i.which===1&&(this._mouseButtonDown=!0,this._strokeBegin(i))},this._handleMouseMove=i=>{this._mouseButtonDown&&this._strokeMoveUpdate(i)},this._handleMouseUp=i=>{i.which===1&&this._mouseButtonDown&&(this._mouseButtonDown=!1,this._strokeEnd(i))},this._handleTouchStart=i=>{if(i.preventDefault(),i.targetTouches.length===1){const n=i.changedTouches[0];this._strokeBegin(n)}},this._handleTouchMove=i=>{i.preventDefault();const n=i.targetTouches[0];this._strokeMoveUpdate(n)},this._handleTouchEnd=i=>{if(i.target===this.canvas){i.preventDefault();const s=i.changedTouches[0];this._strokeEnd(s)}},this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.dotSize=e.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this.onBegin=e.onBegin,this.onEnd=e.onEnd,this._strokeMoveUpdate=this.throttle?T(h.prototype._strokeUpdate,this.throttle):h.prototype._strokeUpdate,this._ctx=t.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:t,canvas:e}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(),this._isEmpty=!0}fromDataURL(t,e={},i){const n=new Image,s=e.ratio||window.devicePixelRatio||1,r=e.width||this.canvas.width/s,a=e.height||this.canvas.height/s;this._reset(),n.onload=()=>{this._ctx.drawImage(n,0,0,r,a),i&&i()},n.onerror=f=>{i&&i(f)},n.src=t,this._isEmpty=!1}toDataURL(t="image/png",e){switch(t){case"image/svg+xml":return this._toSVG();default:return this.canvas.toDataURL(t,e)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",window.PointerEvent?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.removeEventListener("pointerdown",this._handleMouseDown),this.canvas.removeEventListener("pointermove",this._handleMouseMove),document.removeEventListener("pointerup",this._handleMouseUp),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(t){this.clear(),this._fromData(t,({color:e,curve:i})=>this._drawCurve({color:e,curve:i}),({color:e,point:i})=>this._drawDot({color:e,point:i})),this._data=t}toData(){return this._data}_strokeBegin(t){const e={color:this.penColor,points:[]};typeof this.onBegin=="function"&&this.onBegin(t),this._data.push(e),this._reset(),this._strokeUpdate(t)}_strokeUpdate(t){if(this._data.length===0){this._strokeBegin(t);return}const e=t.clientX,i=t.clientY,n=this._createPoint(e,i),s=this._data[this._data.length-1],r=s.points,a=r.length>0&&r[r.length-1],f=a?n.distanceTo(a)<=this.minDistance:!1,u=s.color;if(!a||!(a&&f)){const c=this._addPoint(n);a?c&&this._drawCurve({color:u,curve:c}):this._drawDot({color:u,point:n}),r.push({time:n.time,x:n.x,y:n.y})}}_strokeEnd(t){this._strokeUpdate(t),typeof this.onEnd=="function"&&this.onEnd(t)}_handlePointerEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("pointerdown",this._handleMouseDown),this.canvas.addEventListener("pointermove",this._handleMouseMove),document.addEventListener("pointerup",this._handleMouseUp)}_handleMouseEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor}_createPoint(t,e){const i=this.canvas.getBoundingClientRect();return new I(t-i.left,e-i.top,new Date().getTime())}_addPoint(t){const{_lastPoints:e}=this;if(e.push(t),e.length>2){e.length===3&&e.unshift(e[0]);const i=this._calculateCurveWidths(e[1],e[2]),n=P.fromPoints(e,i);return e.shift(),n}return null}_calculateCurveWidths(t,e){const i=this.velocityFilterWeight*e.velocityFrom(t)+(1-this.velocityFilterWeight)*this._lastVelocity,n=this._strokeWidth(i),s={end:n,start:this._lastWidth};return this._lastVelocity=i,this._lastWidth=n,s}_strokeWidth(t){return Math.max(this.maxWidth/(t+1),this.minWidth)}_drawCurveSegment(t,e,i){const n=this._ctx;n.moveTo(t,e),n.arc(t,e,i,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve({color:t,curve:e}){const i=this._ctx,n=e.endWidth-e.startWidth,s=Math.floor(e.length())*2;i.beginPath(),i.fillStyle=t;for(let r=0;r<s;r+=1){const a=r/s,f=a*a,u=f*a,c=1-a,p=c*c,b=p*c;let w=b*e.startPoint.x;w+=3*p*a*e.control1.x,w+=3*c*f*e.control2.x,w+=u*e.endPoint.x;let d=b*e.startPoint.y;d+=3*p*a*e.control1.y,d+=3*c*f*e.control2.y,d+=u*e.endPoint.y;const g=Math.min(e.startWidth+u*n,this.maxWidth);this._drawCurveSegment(w,d,g)}i.closePath(),i.fill()}_drawDot({color:t,point:e}){const i=this._ctx,n=typeof this.dotSize=="function"?this.dotSize():this.dotSize;i.beginPath(),this._drawCurveSegment(e.x,e.y,n),i.closePath(),i.fillStyle=t,i.fill()}_fromData(t,e,i){for(const n of t){const{color:s,points:r}=n;if(r.length>1)for(let a=0;a<r.length;a+=1){const f=r[a],u=new I(f.x,f.y,f.time);this.penColor=s,a===0&&this._reset();const c=this._addPoint(u);c&&e({color:s,curve:c})}else this._reset(),i({color:s,point:r[0]})}}_toSVG(){const t=this._data,e=Math.max(window.devicePixelRatio||1,1),i=0,n=0,s=this.canvas.width/e,r=this.canvas.height/e,a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("width",this.canvas.width.toString()),a.setAttribute("height",this.canvas.height.toString()),this._fromData(t,({color:w,curve:d})=>{const g=document.createElement("path");if(!isNaN(d.control1.x)&&!isNaN(d.control1.y)&&!isNaN(d.control2.x)&&!isNaN(d.control2.y)){const S=`M ${d.startPoint.x.toFixed(3)},${d.startPoint.y.toFixed(3)} C ${d.control1.x.toFixed(3)},${d.control1.y.toFixed(3)} ${d.control2.x.toFixed(3)},${d.control2.y.toFixed(3)} ${d.endPoint.x.toFixed(3)},${d.endPoint.y.toFixed(3)}`;g.setAttribute("d",S),g.setAttribute("stroke-width",(d.endWidth*2.25).toFixed(3)),g.setAttribute("stroke",w),g.setAttribute("fill","none"),g.setAttribute("stroke-linecap","round"),a.appendChild(g)}},({color:w,point:d})=>{const g=document.createElement("circle"),S=typeof this.dotSize=="function"?this.dotSize():this.dotSize;g.setAttribute("r",S.toString()),g.setAttribute("cx",d.x.toString()),g.setAttribute("cy",d.y.toString()),g.setAttribute("fill",w),a.appendChild(g)});const f="data:image/svg+xml;base64,",u=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="${i} ${n} ${s} ${r}" width="${s}" height="${r}">`;let c=a.innerHTML;if(c===void 0){const w=document.createElement("dummy"),d=a.childNodes;w.innerHTML="";for(let g=0;g<d.length;g+=1)w.appendChild(d[g].cloneNode(!0));c=w.innerHTML}const p="</svg>",b=u+c+p;return f+btoa(b)}}var _=h,k={name:"vueSignature",props:{sigOption:{type:Object,default:()=>({backgroundColor:"rgb(255,255,255)",penColor:"rgb(0, 0, 0)"})},w:{type:String,default:"100%"},h:{type:String,default:"100%"},clearOnResize:{type:Boolean,default:!1},waterMark:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},defaultUrl:{type:String,default:""}},data(){return{sig:()=>{},option:{backgroundColor:"rgb(255,255,255)",penColor:"rgb(0, 0, 0)"},uid:""}},watch:{disabled(o){var t=this;o?t.sig.off():t.sig.on()}},created(){var o=this;this.uid="canvas"+o._uid;var t=Object.keys(o.sigOption);for(var e of t)o.option[e]=o.sigOption[e]},methods:{draw(){var o=this,t=document.getElementById(o.uid);o.sig=new _(t,o.option);function e(i){var n;o.isEmpty()||(n=o.save());var s=Math.max(window.devicePixelRatio||1,1);i.width=i.offsetWidth*s,i.height=i.offsetHeight*s,i.getContext("2d").scale(s,s),o.clear(),!o.clearOnResize&&n!==void 0&&o.fromDataURL(n),Object.keys(o.waterMark).length&&o.addWaterMark(o.waterMark)}window.addEventListener("resize",e(t)),e(t),o.defaultUrl!==""&&o.fromDataURL(o.defaultUrl),o.disabled?o.sig.off():o.sig.on()},clear(){var o=this;o.sig.clear()},save(o){var t=this;return o?t.sig.toDataURL(o):t.sig.toDataURL()},fromDataURL(o){var t=this;t.sig.fromDataURL(o)},isEmpty(){var o=this;return o.sig.isEmpty()},undo(){var o=this,t=o.sig.toData();t&&(t.pop(),o.sig.fromData(t))},addWaterMark(o){var t=this;if(Object.prototype.toString.call(o)!="[object Object]")throw new Error("Expected Object, got "+typeof o+".");var e=document.getElementById(t.uid),i={text:o.text||"",x:o.x||20,y:o.y||20,sx:o.sx||40,sy:o.sy||40},n=e.getContext("2d");n.font=o.font||"20px sans-serif",n.fillStyle=o.fillStyle||"#333",n.strokeStyle=o.strokeStyle||"#333",o.style=="all"?(n.fillText(i.text,i.x,i.y),n.strokeText(i.text,i.sx,i.sx)):o.style=="stroke"?n.strokeText(i.text,i.sx,i.sx):n.fillText(i.text,i.x,i.y),t.sig._isEmpty=!1}},mounted(){var o=this;this.$nextTick().then(()=>{o.draw()})}},D=k,A=l(68141),$=(0,A.Z)(D,E,x,!1,null,null,null),F=$.exports,B=F,H=l(44513),R=l(67467),z=l(67157);const U={mixins:[z.c],data(){return{config_extend:{},filter_config:{prefixAttr:{labelStyle:{fontFamily:"alibabaPuHuiTiRegular",color:"#303133"}},signatureArea:{borderColor:"#DBDFE6",penColor:"rgba(0,0,0,1)",backgroundColor:"rgba(255,255,255,1)"},feature:{waterMartTextStyle:{color:"#4f5053"},featureStyle:{color:"#ffffff",fontFamily:"alibabaPuHuiTiRegular"},buttonBackgroundColor:"#4C84FF",buttonBorderColor:"rgba(122,122,122,1)"}}}},methods:{filterPredefineColoursSchemeConfig(o,t){this.getNewConfigWithArrary(o,t,this.filter_config)}}};var j=l(45061),O=l(23400),N=l(86892),Z=l(26711),V=l(56279),X=l(48836),Y=l(27966),G=l(55616),K=l(49500),J={name:"form-signature",props:["widgetInfo"],components:{HideButton:H.Z,vueSignature:B,Toast:m.Z},mixins:[R.u,U,j.u,O.j,N.D,Z.H,V.P],data(){return{show:!1,done:!1}},watch:{"currentWidget.id":{deep:!0,handler:function(o){if(!o){this.widgetInfo.attr.hide=!0;return}o===this.widgetInfo.id||this.isParent(o,this.widgetInfo.id,this.getWidgetAllArr)?this.widgetInfo.attr.hide=!1:this.widgetInfo.attr.hide=!0}},"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)},"widgetInfo.config.signatureArea.backgroundColor":{deep:!0,handler(){this.show=!1,this.$nextTick(()=>{this.show=!0})}}},methods:{loadInfo(o){this.lifecycleAfterLoad()},reLoadInfo(o){this.loadInfo(o)},clear(){this.done||(this.$refs.signature.clear(),this.widgetInfo.config.feature.clearToast&&(0,m.Z)({type:"success",message:`${this.widgetInfo.config.feature.clearText}\u6210\u529F`}))},undo(){this.done||(this.$refs.signature.undo(),this.widgetInfo.config.feature.undoToast&&(0,m.Z)({type:"success",message:`${this.widgetInfo.config.feature.undoText}\u6210\u529F`}))},waterMark(){this.done||(this.$refs.signature.addWaterMark({text:this.widgetInfo.config.feature.waterMarkContent,font:`${this.widgetInfo.config.feature.waterMartTextStyle.fontSize}px ${this.widgetInfo.config.feature.waterMartTextStyle.fontFamily}`,style:this.widgetInfo.config.feature.waterMarkType,fillStyle:this.widgetInfo.config.feature.waterMartTextStyle.color,strokeStyle:this.widgetInfo.config.feature.waterMartTextStyle.color,x:this.widgetInfo.config.feature.waterMarkPoiX/(this.getCanvasSetting.width/window.innerWidth),y:this.widgetInfo.config.feature.waterMarkPoiY/(this.getCanvasSetting.width/window.innerWidth),sx:this.widgetInfo.config.feature.waterMarkType==="all"?this.widgetInfo.config.feature.waterMarkPoiX/(this.getCanvasSetting.width/window.innerWidth)+30:this.widgetInfo.config.feature.waterMarkPoiX/(this.getCanvasSetting.width/window.innerWidth),sy:this.widgetInfo.config.feature.waterMarkType==="all"?this.widgetInfo.config.feature.waterMarkPoiY/(this.getCanvasSetting.width/window.innerWidth)+30:this.widgetInfo.config.feature.waterMarkPoiY/(this.getCanvasSetting.width/window.innerWidth)}),this.widgetInfo.config.feature.waterMarkToast&&(0,m.Z)({type:"success",message:`${this.widgetInfo.config.feature.waterMarkText}\u6210\u529F`}))},save(){if(this.done)this.done=!1,this.clear();else{const o=this.$refs.signature.save(this.widgetInfo.config.feature.saveType);this.signatureDone(o),this.done=!0,this.widgetInfo.config.feature.saveToast&&(0,m.Z)({type:"success",message:"\u7B7E\u540D\u5B8C\u6210"})}},signatureDone(o){let t=this,e=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(e,i=>{if(i.enabled&&i.code=="done"){let n="done_"+t.widgetInfo.id,s={url:o};if(i.paramsExtend&&i.paramsExtend.length>0&&this.getExtendParams(s,i.paramsExtend),i.script&&i.script.enabled){if(K.log("Execute script for "+this.widgetInfo.name+" component to "+i.name+" component"),i.script.content==""){G.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",i.script.content),s=this.customScript(s)}Y.Z.$emit(n,s),i.postMessage&&this.doPostMessage(s),this.actionNameList.push(n)}})},buttonClick(o){this[o]()},initAction(o){this.actionReceive(o)},touchStart(o){this.widgetInfo.config.signatureArea.stopPropagation&&o.stopPropagation()},touchMove(o){this.widgetInfo.config.signatureArea.stopPropagation&&o.stopPropagation()},touchEnd(o){this.widgetInfo.config.signatureArea.stopPropagation&&o.stopPropagation()}},computed:{...(0,X.Se)(["isView"]),getOption(){return{penColor:this.widgetInfo.config.signatureArea.penColor,backgroundColor:this.widgetInfo.config.signatureArea.backgroundColor}},featureList(){let o=[];o.push({value:"save",text:this.widgetInfo.config.feature.saveText,sort:this.widgetInfo.config.feature.saveSort,open:this.widgetInfo.config.feature.save}),o.push({value:"undo",text:this.widgetInfo.config.feature.undoText,sort:this.widgetInfo.config.feature.undoSort,open:this.widgetInfo.config.feature.undo}),o.push({value:"clear",text:this.widgetInfo.config.feature.clearText,sort:this.widgetInfo.config.feature.clearSort,open:this.widgetInfo.config.feature.clear});let t=[];return t=o.filter(e=>e.open),t.sort((e,i)=>e.sort-i.sort),t}},mounted(){this.show=!0,this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)}},Q=J,q=(0,A.Z)(Q,C,v,!1,null,"1822586d",null),tt=q.exports}}]);
