"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[160],{56279:function(A,I,d){d.d(I,{P:function(){return z}});var M=d(86892),v=d(49500);const z={mixins:[M.D],created(){},methods:{lifecycleBeforeChartsLoad(C){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&v.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),v.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let b=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[C]);if(b)return b}return C},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&v.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),v.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},90160:function(A,I,d){d.r(I),d.d(I,{default:function(){return X}});var M=function(){var i=this,t=i._self._c;return t("div",{style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[t("hide-button",{attrs:{attr:i.widgetInfo.attr}}),t("div",{ref:"countryMapLines",staticStyle:{width:"inherit",height:"inherit"}})],1)},v=[],z=d(44513),C=d(45061),P=d(26711),b=d(27966),O=d(99349),F=d(21300),B=d(87798),G=d(33578),j=d(67157),L=d(50666);const H={mixins:[j.c],data(){return{config_extend:{},filter_config:{title:{textStyle:{color:""}},legend:JSON.parse(JSON.stringify(L.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(L.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(L.Z.charts.toolbox)),visualMap:{inRange:{color:["#98CDFF"]}},geo:{label:{normal:{show:!1,color:"#fff"},emphasis:{show:!1,color:"#fff"}},itemStyle:{normal:{areaColor:"#132937",borderColor:"#0692a4",color:"",opacity:1},emphasis:{areaColor:"#0b1c2d",color:"",opacity:1}},regions:[{itemStyle:{normal:{areaColor:"#f00",borderColor:"#0692a4",color:"",opacity:1},emphasis:{areaColor:"#0b1c2d",color:"",opacity:1}}}]},geo3D:{groundPlane:{show:!1,color:"#aaa"},label:{textStyle:{}},itemStyle:{color:"#374151",areaColor:"#374151",opacity:1,borderWidth:.4,borderColor:"#9ff32b"},emphasis:{itemStyle:{areaColor:"",color:"",opacity:0},label:{show:!1,textStyle:{}}},regions:[{name:"",regionHeight:2,itemStyle:{normal:{areaColor:"#f00",borderColor:"#0692a4",opacity:1},emphasis:{areaColor:"#0b1c2d",opacity:1}}}],light:{main:{color:"#ffffff",intensity:1}}},lines:{beginColor:"rgba(241, 196, 15, 1)",endColor:"rgba(243, 156, 18, 1)",effect:{color:""},lineStyle:{normal:{shadowColor:"",opacity:1,color:"#a6c84c"},color:"#9ae5fc",opacity:.6,emphasis:{}}},effectScatter:{rippleEffect:{color:""},scatterLabel:{textStyle:{}},visualMapColor:!0,itemStyle:{normal:{color:"rgba(18, 220, 243, 1)",opacity:1},emphasis:{color:"",opacity:1}}},graphic:{style:{color:""}}}}},methods:{filterPredefineColoursSchemeConfig(e,i){this.getNewConfigWithArrary(e,i,this.filter_config)}}};var T=d(43156),R=d(55616),J=d(56279),m=d(49500);const x=d(29426);d(8925);var V={name:"CountryMapLines",components:{HideButton:z.Z},mixins:[C.u,P.H,J.P,O.P,B.P,G.u,H],props:["widgetInfo"],data(){return{minMax:[],linesGroup:[],linesData:[],effectScatterData:[],geoData:[],geoType:"2D",identical:!0,pointBase:1,regionParent:{name:null,code:null},currentRegion:{id:null,name:null,cp:null,features:null,childrenCentralPoint:null}}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.mapChart.dispose()},methods:{loadInfo(e){e==null&&(e=this.widgetInfo),this.getCurrentRegionInfo(e.config.geo.mapCode,i=>{this.getDataList(e.dataset),e.config.lines.enableDataMap?this.getLinesGroup(e.dataset):this.linesGroup=[];let t=[],l=this,n=this.getGeoData(e);e.config.lines.labelLayout={align:"center",verticalAlign:"middle"};let c=JSON.parse(JSON.stringify(e.config.lines.label));c.formatter=this.getFormatterString(e.config.lines.label.formatter);let a={tooltip:this.getTooltip(e.config.tooltip),series:t};e.config.visualMap.visualMapMin=="dataMin"&&(e.config.visualMap.min=this.getVisualmapData(e,e.dataset[e.dataset.type].encode.map[1])[0]),e.config.visualMap.visualMapMax=="dataMax"&&(e.config.visualMap.max=this.getVisualmapData(e,e.dataset[e.dataset.type].encode.map[1])[1]);let r=e.config.graphic.style.fontSize+"px solid"+e.config.graphic.style.fontFamily;if(a.graphic=[{type:"group",bounding:"raw",left:e.config.graphic.style.iconLeft+"%",top:e.config.graphic.style.iconTop+"%",ignore:this.ignoreGraphic(),children:[{type:"text",z:100,style:{fill:e.config.graphic.style.color,text:e.config.graphic.style.text?e.config.graphic.style.text:"\u4E0A\u4E00\u7EA7",font:r,x:e.config.graphic.style.iconWidth+e.config.graphic.style.txtLeft,y:e.config.graphic.style.txtTop}},{type:"image",z:-10,bounding:"raw",origin:[25,25],ignore:this.ignoreGraphic(),style:{image:this.getImageUrl(e.config.graphic.style.iconImg),width:e.config.graphic.style.iconWidth,height:e.config.graphic.style.iconHeight}}]}],e.config.geoType=="2D"){if(a.title=e.config.title,a.visualMap=e.config.visualMap.show?this.getVisualMap(e.config.visualMap):"",a.geo={show:e.config.geo.roam,map:e.config.geo.mapCode.toString(),roam:e.config.geo.roam,aspectScale:e.config.geo.aspectScale,zoom:e.config.geo.zoom,label:e.config.geo.label,itemStyle:e.config.geo.itemStyle,layoutCenter:e.config.geo.layoutShow?[e.config.geo.layoutCenter[0]+"%",e.config.geo.layoutCenter[1]+"%"]:"",layoutSize:e.config.geo.layoutShow?e.config.geo.layoutSize:"",regions:e.config.geo.regions},e.config.geo.autoMargin||(a.geo.left=e.config.geo.left+"%",a.geo.top=e.config.geo.top+"%",a.geo.right=e.config.geo.right+"%",a.geo.bottom=e.config.geo.bottom+"%"),a.series.push({name:"",type:"effectScatter",coordinateSystem:"geo",rippleEffect:e.config.effectScatter.rippleEffect,symbol:this.getSymbolPath(e.config.effectScatter.symbol),symbolSize:function(o){let f;return o?f=o[2]/8:f=0,f},symbolRotate:e.config.effectScatter.symbolRotate,symbolKeepAspect:e.config.effectScatter.symbolKeepAspect,symbolOffset:e.config.effectScatter.symbolOffset,cursor:e.config.effectScatter.cursor,label:e.config.effectScatter.label,itemStyle:e.config.effectScatter.itemStyle,zlevel:e.config.effectScatter.zlevel,data:this.effectScatterData.map(function(o){if(e.dataset.regionType==="coordinate"){let f=o[0].size?o[0].size:100,h=l.getSplit(o[0].value);return{name:o[0].name,value:[h[0]?Number(h[0].trim()):"",h[1]?Number(h[1].trim()):"",f.toString()],source:o[0].source,realVal:o[0].realVal,visualMap:l.widgetInfo.config.effectScatter.visualMapColor}}else if(o[0].name){let f=l.getFeatureInfo(o[0].name);if(f){let h=o[0].value?o[0].value:100,p=null;return f.cp&&f.cp.length==2&&(p=f.cp,p.push(f.name)),p&&p.length==3&&(p[2]=h.toString()),{name:f.name,value:p,source:o[0].source,realVal:o[0].realVal,visualMap:l.widgetInfo.config.effectScatter.visualMapColor}}}})}),!e.config.geo.roam){let o={name:"",type:"map",map:e.config.geo.mapCode.toString(),roam:!1,aspectScale:e.config.geo.aspectScale,zoom:e.config.geo.zoom,label:e.config.geo.label,itemStyle:e.config.geo.itemStyle,layoutCenter:e.config.geo.layoutShow?[e.config.geo.layoutCenter[0]+"%",e.config.geo.layoutCenter[1]+"%"]:"",layoutSize:e.config.geo.layoutShow?e.config.geo.layoutSize:"",data:this.geoCconvertData(n)};e.config.geo.autoMargin||(o.left=e.config.geo.left+"%",o.top=e.config.geo.top+"%",o.right=e.config.geo.right+"%",o.bottom=e.config.geo.bottom+"%"),a.series.push(o)}let s=e.config.lines.show?this.convertData(this.linesData):"";s&&s.length>0&&(this.widgetInfo.config.lines.enableDataMap&&this.linesGroup&&this.linesGroup.length>0?this.linesGroup.forEach(o=>{let f=[];o.data.forEach(p=>{s[p]&&f.push(s[p])});let h=JSON.parse(JSON.stringify(e.config.lines.lineStyle));h.normal.width=o.width,h.normal.color=o.color,a.series.push({name:"",type:"lines",coordinateSystem:"geo",polyline:e.config.lines.polyline,effect:{show:e.config.lines.effect.show,period:e.config.lines.effect.period,delay:e.config.lines.effect.delay,constantSpeed:e.config.lines.effect.constantSpeed,symbol:this.getSymbolPath(e.config.lines.effect.symbol),symbolSize:e.config.lines.effect.symbolSize,color:e.config.lines.effect.color,trailLength:e.config.lines.effect.trailLength,loop:e.config.lines.effect.loop},large:e.config.lines.large,largeThreshold:e.config.lines.largeThreshold,symbol:e.config.lines.symbol,symbolSize:e.config.lines.symbolSize,lineStyle:h,label:c,progressive:e.config.lines.progressive,progressiveThreshold:e.config.lines.progressiveThreshold,zlevel:e.config.lines.zlevel,data:f})}):a.series.push({name:"",type:"lines",coordinateSystem:"geo",polyline:e.config.lines.polyline,effect:{show:e.config.lines.effect.show,period:e.config.lines.effect.period,delay:e.config.lines.effect.delay,constantSpeed:e.config.lines.effect.constantSpeed,symbol:this.getSymbolPath(e.config.lines.effect.symbol),symbolSize:e.config.lines.effect.symbolSize,color:e.config.lines.effect.color,trailLength:e.config.lines.effect.trailLength,loop:e.config.lines.effect.loop},large:e.config.lines.large,largeThreshold:e.config.lines.largeThreshold,symbol:e.config.lines.symbol,symbolSize:e.config.lines.symbolSize,lineStyle:JSON.parse(JSON.stringify(e.config.lines.lineStyle)),label:c,progressive:e.config.lines.progressive,progressiveThreshold:e.config.lines.progressiveThreshold,zlevel:e.config.lines.zlevel,data:s}))}else e.config.geoType=="3D"&&(a.visualMap=e.config.visualMap.show?this.getVisualMap(e.config.visualMap):"",a.series=[],a.series.push({name:"",type:"scatter3D",coordinateSystem:"geo3D",symbol:this.getSymbolPath(e.config.effectScatter.symbol),symbolSize:function(s){let o;return s?o=s[2]/8:o=0,o},label:this.getLabelStyle(e.config.effectScatter.scatterLabel),emphasis:{label:this.getLabelStyle(e.config.effectScatter.scatterLabel)},itemStyle:e.config.effectScatter.itemStyle,data:this.effectScatterData.map(function(s){if(s[0].name)if(e.dataset.regionType==="coordinate"){let o=(s[0].size?s[0].size:100)+100,f=l.getSplit(s[0].value);return f[0]&&l.widgetInfo.config.effectScatter.itemStyle.normal.offsetX&&(f[0]=((parseFloat(f[0])*100+l.widgetInfo.config.effectScatter.itemStyle.normal.offsetX)/100).toFixed(5)),f[1]&&l.widgetInfo.config.effectScatter.itemStyle.normal.offsetY&&(f[1]=((parseFloat(f[1])*100+l.widgetInfo.config.effectScatter.itemStyle.normal.offsetY)/100).toFixed(5)),{name:s[0].name,value:[f[0]?f[0]:"",f[1]?f[1]:"",o.toString()],source:s[0].source,realVal:s[0].realVal,visualMap:l.widgetInfo.config.effectScatter.visualMapColor}}else{let o=l.getFeatureInfo(s[0].name);if(o){let f;e.config.geoType=="2D"?f=s[0].value?s[0].value:100:e.config.geoType=="3D"&&(f=(s[0].value?s[0].value:100)+100);let h=null;return o.cp&&o.cp.length==2&&(h=o.cp,h.push(o.name)),h&&h.length==3&&(h[2]=f),l.widgetInfo.config.effectScatter.itemStyle.normal.offsetX&&(h[0]=(parseFloat(h[0])*100+l.widgetInfo.config.effectScatter.itemStyle.normal.offsetX)/100),l.widgetInfo.config.effectScatter.itemStyle.normal.offsetY&&(h[1]=(parseFloat(h[1])*100+l.widgetInfo.config.effectScatter.itemStyle.normal.offsetY)/100),{name:o.name,value:h,source:s[0].source,realVal:s[0].realVal,visualMap:l.widgetInfo.config.effectScatter.visualMapColor}}}})},{name:"",type:"lines3D",coordinateSystem:"geo3D",data:e.config.lines.show?this.convertData(this.linesData):"",effect:{show:e.config.lines.effect.show,period:e.config.lines.effect.period,constantSpeed:e.config.lines.effect.constantSpeed,trailWidth:e.config.lines.effect.trailWidth,trailLength:e.config.lines.effect.trailLength,trailColor:e.config.lines.effect.trailColor,trailOpacity:e.config.lines.effect.trailOpacity},blendMode:"lighter",lineStyle:{color:e.config.lines.lineStyle.color,width:e.config.lines.lineStyle.width,opacity:e.config.lines.lineStyle.opacity}}),e.config.geo.roam||a.series.push({type:"map3D",map:e.config.geo.mapCode.toString(),boxWidth:e.config.geo3D.boxWidth,boxHeight:e.config.geo3D.boxHeight,boxDepth:e.config.geo3D.boxDepth,left:e.config.geo3D.left,top:e.config.geo3D.top,regionHeight:e.config.geo3D.regionHeight,environment:this.getEnvironment(e,e.config.geo3D.environmentStyle),zlevel:-100,groundPlane:{show:e.config.geo3D.groundPlane.show,color:e.config.geo3D.groundPlane.color},label:e.config.geo3D.label,itemStyle:e.config.geo3D.itemStyle,emphasis:e.config.geo3D.emphasis,data:this.geoCconvertData(n),shading:e.config.geo3D.shading,realisticMaterial:e.config.geo3D.realisticMaterial,lambertMaterial:e.config.geo3D.lambertMaterial,light:e.config.geo3D.light,viewControl:{alpha:e.config.geo3D.viewControl.alpha,minAlpha:e.config.geo3D.viewControl.minAlpha,maxAlpha:e.config.geo3D.viewControl.maxAlpha,beta:e.config.geo3D.viewControl.beta,minBeta:e.config.geo3D.viewControl.minBeta,maxBeta:e.config.geo3D.viewControl.maxBeta,autoRotate:e.config.geo3D.viewControl.autoRotate,autoRotateSpeed:e.config.geo3D.viewControl.autoRotateSpeed,orthographicSize:100,maxOrthographicSize:100,minOrthographicSize:100,projection:"orthographic",rotateSensitivity:0}}),a.geo3D={show:e.config.geo.roam,map:e.config.geo.mapCode.toString(),roam:e.config.geo.roam,boxWidth:e.config.geo3D.boxWidth,boxHeight:e.config.geo3D.boxHeight,boxDepth:e.config.geo3D.boxDepth,left:e.config.geo3D.left,top:e.config.geo3D.top,regionHeight:e.config.geo3D.regionHeight,environment:this.getEnvironment(e,e.config.geo3D.environmentStyle),groundPlane:{show:e.config.geo3D.groundPlane.show,color:e.config.geo3D.groundPlane.color},label:e.config.geo3D.label,itemStyle:e.config.geo3D.itemStyle,emphasis:e.config.geo3D.emphasis,shading:e.config.geo3D.shading,realisticMaterial:e.config.geo3D.realisticMaterial,lambertMaterial:e.config.geo3D.lambertMaterial,light:e.config.geo3D.light,viewControl:{alpha:e.config.geo3D.viewControl.alpha,minAlpha:e.config.geo3D.viewControl.minAlpha,maxAlpha:e.config.geo3D.viewControl.maxAlpha,beta:e.config.geo3D.viewControl.beta,minBeta:e.config.geo3D.viewControl.minBeta,maxBeta:e.config.geo3D.viewControl.maxBeta,autoRotate:e.config.geo3D.viewControl.autoRotate,autoRotateSpeed:e.config.geo3D.viewControl.autoRotateSpeed}},e.config.geo.roam||(a.geo3D.viewControl.orthographicSize=100,a.geo3D.viewControl.maxOrthographicSize=100,a.geo3D.viewControl.minOrthographicSize=100,a.geo3D.viewControl.projection="orthographic",a.geo3D.viewControl.rotateSensitivity=0));this.geoType!=e.config.geoType&&(this.mapChart&&this.mapChart.dispose(),this.mapChart=x.init(this.$refs.countryMapLines,null,{devicePixelRatio:2}),this.geoType=e.config.geoType),this.mapChart&&l.mapChart.dispose(),this.mapChart=x.init(this.$refs.countryMapLines,null,{devicePixelRatio:2}),m.log(a),x.registerMap(e.config.geo.mapCode.toString(),i),delete a.visualMap,l.mapChart.setOption(this.lifecycleBeforeChartsLoad(a),!0),this.clickEvent()})},getEnvironment(e,i){let t;return i=="img"?t=this.getImageUrl(e.config.geo3D.environment):i=="color"?t=e.config.geo3D.environment:i=="linearGradient"&&(t=new x.graphic.LinearGradient(0,0,0,1,[{offset:0,color:e.config.geo3D.environmentTop},{offset:.7,color:e.config.geo3D.environmentBottom},{offset:1,color:e.config.geo3D.environmentBottom}],!1)),t},getImageUrl(e){if(e&&e!="")return F.appendImageBaseURL(e)},getGeoData(e){let i=e.dataset[e.dataset.type].source,t=e.dataset[e.dataset.type].encode,l=e.dataset[e.dataset.type].dimensions,n=e.dataset[e.dataset.type].dimensionsAlias,c=[],a={},r=!1;for(let f=l.length-1;f>-1;--f)a[l[f]]=f;let s=e.config.visualMap.min,o=e.config.visualMap.max;return t.map[0]&&t.map[1]&&i.forEach(f=>{let h=f,p=parseFloat(f[a[t.map[1]]]);typeof p<"u"&&(r?(s=s<p?s:p,o=o>p?o:p):(s=p,o=p,r=!0),c.push({name:h[a[t.map[0]]],alias:n[a[t.map[1]]].alias||n[a[t.map[1]]].name,value:p}))}),this.minMax[1]={min:s,max:o},c},getSymbolPath(e){let i=e.path;return e.type=="img"&&e.path!=""&&(i=this.getSymbolURL(e.path)),e.type=="svg"&&e.path!=""&&(i=e.path.indexOf("path://")==-1?"path://"+e.path:e.path),i},getDataList(e){let i=e[e.type];if(this.widgetInfo.dataset.regionType==="coordinate"){let t=-1,l=-1,n=-1,c=-1,a=-1,r=-1;for(let o=0;o<i.dimensions.length;o++)i.dimensions[o]==i.encode.effectScatter[0]&&(t=o),i.dimensions[o]==i.encode.effectScatter[1]&&(l=o),i.dimensions[o]==i.encode.pointerStar[0]&&(n=o),i.dimensions[o]==i.encode.pointerStar[1]&&(c=o),i.dimensions[o]==i.encode.pointerEnd[0]&&(a=o),i.dimensions[o]==i.encode.pointerEnd[1]&&(r=o);let s=this;if(s.linesData=[],s.effectScatterData=[],t>-1&&l>-1){let o=i.source[0][t],f=i.source[0][t];this.$$lib__.each(i.source,h=>{o>h[t]&&(o=h[t]),o>h[l]&&(o=h[l]),f<h[t]&&(f=h[t]),f<h[l]&&(f=h[l])}),this.widgetInfo.config.geoType=="3D"?this.pointBase=o===f?100/parseInt(f):100/parseInt(f-o):this.pointBase=o===f?200/parseInt(f):200/parseInt(f-o)}this.$$lib__.each(i.source,o=>{s.linesData.push([{name:o[n],value:o[c]},{name:o[a],value:o[r]}]),s.effectScatterData.push([{name:o[n],value:o[c],size:o[t]*s.pointBase,realVal:o[t],source:o}]),s.effectScatterData.push([{name:o[a],value:o[r],size:o[l]*s.pointBase,realVal:o[l],source:o}])})}else{let t=-1,l=-1,n=-1,c=-1;for(let r=0;r<i.dimensions.length;r++)i.dimensions[r]==i.encode.lines[0]&&(t=r),i.dimensions[r]==i.encode.lines[1]&&(l=r),i.dimensions[r]==i.encode.effectScatter[0]&&(n=r),i.dimensions[r]==i.encode.effectScatter[1]&&(c=r);let a=this;if(a.linesData=[],a.effectScatterData=[],n>-1&&c>-1){let r=i.source[0][n],s=i.source[0][n];this.$$lib__.each(i.source,o=>{r>o[n]&&(r=o[n]),r>o[c]&&(r=o[c]),s<o[n]&&(s=o[n]),s<o[c]&&(s=o[c])}),this.widgetInfo.config.geoType=="3D"?this.pointBase=r===s?100/parseInt(s):100/parseInt(s-r):this.pointBase=r===s?200/parseInt(s):200/parseInt(s-r)}this.$$lib__.each(i.source,r=>{a.linesData.push([{name:r[t]},{name:r[l]}]),a.effectScatterData.push([{name:r[t],value:r[n]*a.pointBase,realVal:r[n],source:r}]),a.effectScatterData.push([{name:r[l],value:r[c]*a.pointBase,realVal:r[c],source:r}])})}},getLinesGroup(e){this.linesGroup=[],this.widgetInfo.config.lines.lineStyle.normal.color=this.widgetInfo.config.lines.beginColor,this.widgetInfo.config.lines.lineStyle.normal.width=this.widgetInfo.config.lines.minWidth;let i,t,l,n,c=[],a=[],r=e[e.type].encode,s=e[e.type].source,o={};for(let h=e[e.type].dimensions.length-1;h>-1;--h)o[e[e.type].dimensions[h]]=h;(r.map[2]||r.map[3])&&s.forEach(h=>{let p;r.map[2]&&(p=parseFloat(h[o[r.map[2]]]),typeof p<"u"&&((typeof i>"u"||p<i)&&(i=p),(typeof t>"u"||p>t)&&(t=p)),c.push(p)),r.map[3]&&(r.map[2]==r.map[3]?(l=i,n=t):(p=parseFloat(h[o[r.map[3]]]),typeof p<"u"&&(l=typeof l>"u"||p<l?p:l,n=typeof n>"u"||p>n?p:n)),a.push(p))});let f=a.length>0?a.length:c.length>0?c.length:0;if(f>0){let h=[this.widgetInfo.config.lines.minWidth],p=(this.widgetInfo.config.lines.maxWidth-this.widgetInfo.config.lines.minWidth)/9;for(let g=1;g<10;++g)h.push(h[g-1]+p),h[g-1]=Math.round(h[g-1]);h[9]=this.widgetInfo.config.lines.maxWidth;let u=[],S=this.widgetInfo.config.lines.beginColor.split("(")[1];S=S.substring(0,S.length-1);let w=this.widgetInfo.config.lines.endColor.split("(")[1];w=w.substring(0,w.length-1);let E=[];S=S.split(","),w=w.split(",");for(let g=S.length-1;g>-1;--g)S[g]=parseInt(S[g].trim());for(let g=w.length-1;g>-1;--g)w[g]=parseInt(w[g].trim()),E[g]=(w[g]-S[g])/9;u[0]=S;for(let g=1;g<10;g++){u[g]=[];for(let y=u[g-1].length-1;y>-1;--y)u[g][y]=u[g-1][y]+E[y],u[g-1][y]=Math.round(u[g-1][y]);u[g-1]=`rgba(${u[g-1][0]}, ${u[g-1][1]}, ${u[g-1][2]}, ${u[g-1][3]})`}u[9]=this.widgetInfo.config.lines.endColor;let N=n-l,$=t-i,D={};for(let g=f-1;g>-1;--g){a&&a[g]&&N>0?a[g]=Math.round(Math.abs((a[g]-l)/N)*10):a[g]=0,c&&c[g]&&$>0?c[g]=Math.round(Math.abs((c[g]-i)/$)*10):c[g]=0,a[g]=h[a[g]>9?9:a[g]],c[g]=u[c[g]>9?9:c[g]];let y=a[g]+"_"+c[g];D[y]||(D[y]=[]),D[y].push(g)}for(let g in D){let y=g.split("_");this.linesGroup.push({width:parseInt(y[0]),color:y[1],data:D[g]})}}},getSplit(e){let i;return e&&e.toString().includes(",")?i=e.split(","):i=["",""],i},convertData(e){let i=this.widgetInfo.config.geoType,t=[];if(this.widgetInfo.dataset.regionType==="coordinate"){if(i=="2D")for(let l=0;l<e.length;l++){let n=e[l],c,a,r,s;c=this.getSplit(n[0].value),r=[c[0]?Number(c[0].trim()):"",c[1]?Number(c[1].trim()):"",n[0].name],a=this.getSplit(n[1].value),s=[a[0]?Number(a[0].trim()):"",a[1]?Number(a[1].trim()):"",n[1].name],r&&s&&t.push({coords:[c[0]?r:[],a[0]?s:[]]})}else if(i=="3D"){let l=this.widgetInfo.config.geo3D.boxHeight+this.widgetInfo.config.geo3D.regionHeight+100;for(let n=0;n<e.length;n++){let c=e[n],a,r,s,o;if(a=this.getSplit(c[0].value),s=[a[0]?Number(a[0].trim()):"",a[1]?Number(a[1].trim()):"",c[0].name],r=this.getSplit(c[1].value),o=[r[0]?Number(r[0].trim()):"",r[1]?Number(r[1].trim()):"",c[1].name],s&&o){let f=s[0]?[s[0],s[1],l]:[],h=o[0]?[o[0],o[1],l]:[];t.push([f,h])}}}}else if(i=="2D")for(let l=0;l<e.length;l++){let n=e[l],c=this.getFeatureInfo(n[0].name),a=this.getFeatureInfo(n[1].name);if(c&&a){let r=null,s=null;c.cp&&c.cp.length==2?r=c.cp:m.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF0C\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+n[0].name+' ]\u7684\u4E2D\u5FC3\u70B9cp\u5C5E\u6027\uFF0C\u5373properties:{"id":"","name":"","cp":[]}\u5C5E\u6027\u4E2Dcp\u4E0D\u5B58\u5728'),a.cp&&a.cp.length==2?s=a.cp:m.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF0C\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+n[1].name+' ]\u7684\u4E2D\u5FC3\u70B9cp\u5C5E\u6027\uFF0C\u5373properties:{"id":"","name":"","cp":[]}\u5C5E\u6027\u4E2Dcp\u4E0D\u5B58\u5728'),r&&s&&(r.push(c.name),s.push(a.name),t.push({coords:[r,s]}))}}else if(i=="3D"){let l=this.widgetInfo.config.geo3D.boxHeight+this.widgetInfo.config.geo3D.regionHeight+100;for(let n=0;n<e.length;n++){let c=e[n],a=this.getFeatureInfo(c[0].name),r=this.getFeatureInfo(c[1].name);if(a&&r){let s=null,o=null;a.cp&&a.cp.length==2?s=a.cp:m.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF0C\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+c[0].name+' ]\u7684\u4E2D\u5FC3\u70B9cp\u5C5E\u6027\uFF0C\u5373properties:{"id":"","name":"","cp":[]}\u5C5E\u6027\u4E2Dcp\u4E0D\u5B58\u5728'),r.cp&&r.cp.length==2?o=r.cp:m.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF0C\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+c[1].name+' ]\u7684\u4E2D\u5FC3\u70B9cp\u5C5E\u6027\uFF0C\u5373properties:{"id":"","name":"","cp":[]}\u5C5E\u6027\u4E2Dcp\u4E0D\u5B58\u5728'),s&&o&&(s.push(l),o.push(l),t.push([s,o]))}}}return t},geoCconvertData(e){let i=[];for(let t=0;t<e.length;t++){let l=/00+$/;if(typeof e[t].name=="string"){if(e[t].name.match(l))continue}else if(e[t].name.toString().match(l))continue;let n=this.getFeatureInfo(e[t].name);n?i.push({name:n.name,code:e[t].name,alias:e[t].alias,value:e[t].value}):i.push({name:e[t].name,code:e[t].name,alias:e[t].alias,value:e[t].value})}return i},getFeatureInfo(e){let i=this.currentRegion.childrenCentralPoint[e];if(i&&i.cp)return JSON.parse(JSON.stringify(i));if(!this.currentRegion.features)return m.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5F53\u524D\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7F3A\u5C11features\u5C5E\u6027"),null;let t=this.$$lib__.find(this.currentRegion.features,l=>l.properties&&e==l.properties.id);return t?{id:t.properties.id,name:t.properties.name,cp:t.properties.cp}:(m.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+' ]\u7684\u5B50\u8282\u70B9\u4E2D\u5FC3\u4F4D\u7F6E\u548C\u81EA\u8EAB\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF08\u5373properties:{"id":"","name":"","cp":[]}\uFF09\uFF0C\u5747\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ '+e+" ]\u7684\u4F4D\u7F6E\u5750\u6807"),null)},getCurrentRegionInfo(e,i){this.currentRegion.id=null,this.currentRegion.name=null,this.currentRegion.cp=null,this.currentRegion.features=null,this.currentRegion.childrenCentralPoint=null,T.h.getEchartsGeojsonByCodeWithChildrenCentralPoint(e).then(t=>{if(t&&t.status==200){if(!t.data){m.warn("\u672A\u67E5\u8BE2\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+e+" ]\u7684\u76F8\u5173\u6570\u636E");return}this.widgetInfo.config.regionName=t.data.xzqName,this.regionParent.code=t.data.parentCode,this.regionParent.name=t.data.parentName,this.currentRegion.id=e,this.currentRegion.name=t.data.xzqName,this.currentRegion.childrenCentralPoint=t.data.childrenCentralPoint;let l=t.data.geojsonEcharts;if(!l||l==""){m.warn("\u884C\u653F\u533A[ "+t.data.xzqName+" ]\u6CA1\u6709\u8BBE\u7F6E\u884C\u653F\u533A\u8FB9\u754C\u6570\u636E"),i();return}let n=JSON.parse(l);n&&n.cp&&(this.currentRegion.cp=n.cp),n&&n.features&&(this.currentRegion.features=n.features),i(n)}else m.log(t.msg)})},reLoadInfo(e){e&&(this.$refs.countryMapLines.style.width=e.attr.w+"px",this.$refs.countryMapLines.style.height=e.attr.hh+"px",this.$refs.countryMapLines.style.display=e.attr.hide==!0?"none":""),this.loadInfo(e)},initAction(e){this.actionSendout(e),this.actionReceive(e),this.registerAction(e,"openRegion","widgetList",this.doOpenRegion)},doOpenRegion(e,i,t,l){if(i&&t&&i[t]){let n=t==="name"?i.code:i[t];if(l.script&&l.script.enabled){if(m.log("Execute script for "+l.name+" component to "+l.script.title+" component"),l.script.content==""){R.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_openRegion=new Function("region,info,data,param_key",l.script.content),this.customScript_actionSend_openRegion(n,e,i,t)}else this.widgetInfo.config.regionCode!=n&&(this.widgetInfo.config.geo.mapCode=n,this.loadInfo(this.widgetInfo))}},getParams(e,i){if(i.paramsExtend&&i.paramsExtend.length>0){let t=[],l=this.widgetInfo.dataset[this.widgetInfo.dataset.type].source,n=this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode,c=this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions;if(this.widgetInfo.dataset.regionType=="region"){let a=-1,r=-1;this.$$lib__.each(c,(s,o)=>{s==n.lines[0]&&(a=o),s==n.lines[1]&&(r=o)}),this.$$lib__.each(l,s=>{e.code==s[a]&&t.push(s),e.code==s[r]&&t.push(s)})}this.getExtendParamsList(e,i.paramsExtend,t,this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions)}return e},clickEvent(){let e=this;this.mapChart.on("click",function(i){let t=i.componentType=="graphic"?e.regionParent.name:i.name;e.getRegionByNameAndParentCode(t,l=>{let n={code:i.componentType=="graphic"?e.regionParent.code:l!=null?l.xzqCode:null,name:t};if(i.componentType=="graphic"&&(e.widgetInfo.config.geo.mapCode=n.code,e.loadInfo(),e.sendActionFun(n,i)),!l||!l.xzqCode||l.xzqCode==""){e.sendActionFun(n,i);return}e.doDrill(l),e.sendActionFun(n,i)})})},sendActionFun(e,i){let t=this,l=t.widgetInfo.action.sendOut.actionList;t.$$lib__.each(l,n=>{if(n.enabled&&n.code==t.$$global_editor.actionType.clickPoint.code&&n.name=="\u5355\u51FB\uFF08\u6563\u70B9\uFF09"&&i.seriesType&&(i.seriesType=="scatter3D"||i.seriesType=="effectScatter")){let c=t.$$global_editor.actionType.clickPoint.code+"_"+t.widgetInfo.id;if(n.paramsExtend&&n.paramsExtend.length>0){let a=[];i.data.source&&i.data.source.length>0&&(a=i.data.source),t.getExtendParams(e,n.paramsExtend,a,t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions)}if(n.script&&n.script.enabled){if(m.log("Execute script for "+n.name+" component to "+n.script.title+" component"),n.script.content==""){R.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam2=new Function("param, params",n.script.content),e=this.customScript_actionSend_clickParam2(e,i)}b.Z.$emit(c,e),n.postMessage&&t.doPostMessage(e),t.actionNameList.push(c)}else if(n.enabled&&n.code==t.$$global_editor.actionType.clickArea.code&&(n.name=="\u5355\u51FB\uFF08\u5730\u56FE\u533A\u57DF\uFF09"||n.name=="\u5355\u51FB\uFF08\u533A\u57DF\uFF09")&&(!i.seriesType||i.seriesType=="map"||i.seriesType=="map3D")){let c=t.$$global_editor.actionType.clickArea.code+"_"+t.widgetInfo.id;if(e=t.getParams(JSON.parse(JSON.stringify(e)),n),n.script&&n.script.enabled){if(m.log("Execute script for "+n.name+" component to "+n.script.title+" component"),n.script.content==""){R.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam2=new Function("param, params",n.script.content),e=this.customScript_actionSend_clickParam2(e,i)}b.Z.$emit(c,e),n.postMessage&&t.doPostMessage(e),t.actionNameList.push(c)}else if(n.enabled&&n.code==t.$$global_editor.actionType.openLink.code&&i.seriesType&&(i.seriesType=="scatter3D"||i.seriesType=="effectScatter")){if(n.paramsExtend&&n.paramsExtend.length>0){let c=[];t.widgetInfo.dataset[t.widgetInfo.dataset.type].source&&t.widgetInfo.dataset[t.widgetInfo.dataset.type].source.length>0&&(c=t.widgetInfo.dataset[t.widgetInfo.dataset.type].source[i.dataIndex]),t.getExtendParams(e,n.paramsExtend,c,t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions)}t.openLinkAction(n,e)}})},getRegionByNameAndParentCode(e,i){e&&T.h.getEchartsGeojsonByNameAndParentCode(e,this.widgetInfo.config.geo.mapCode).then(t=>{if(t&&t.status==200){if(!t.data){m.warn("\u672A\u67E5\u5230\u884C\u653F\u533A[ "+e+" ]\u7684\u76F8\u5173\u6570\u636E"),i(null);return}if(!t.data.xzqCode||t.data.xzqCode==""){m.warn("\u672A\u67E5\u5230\u884C\u653F\u533A[ "+e+" ]\u7684\u76F8\u5173\u6570\u636E"),i(t.data);return}let l=t.data.geojsonEcharts;if(!l||l==""){m.warn("\u884C\u653F\u533A[ "+t.data.xzqName+" ]\u6CA1\u6709\u8BBE\u7F6E\u884C\u653F\u533A\u8FB9\u754C\u6570\u636E"),i(t.data);return}i(t.data)}else m.log(t.msg)})},doDrill(e){let i=!1,t=this.widgetInfo.config.allowDrillArea;(e.xzqCode=="china"||t==null||t==""||t=="province"&&e.xzqCode.length<=2||t=="city"&&e.xzqCode.length<=4||t=="area"&&e.xzqCode.length<=6||t=="town"&&e.xzqCode.length<=9)&&(i=!0),this.widgetInfo.config.allowDrill&&i&&e&&e.geojsonEcharts&&e.geojsonEcharts!=""&&(this.regionParent.code=e.parentCode,this.regionParent.name=e.parentName,this.widgetInfo.config.geo.mapCode=e.xzqCode,this.loadInfo())},ignoreGraphic(){let e=this.widgetInfo.config.graphic.style.showArea;return this.currentRegion.id=="china"?!0:e=="province"&&this.currentRegion.id.length>2?this.getIgnoreGraphic():e=="city"&&this.currentRegion.id.length>4?this.getIgnoreGraphic():e=="area"&&this.currentRegion.id.length>6?this.getIgnoreGraphic():e=="town"&&this.currentRegion.id.length>9?this.getIgnoreGraphic():e==null||e==""?this.getIgnoreGraphic():!0},getIgnoreGraphic(){return this.regionParent.code&&this.regionParent.code!=""?this.identical=!1:this.identical=!0,!this.widgetInfo.config.allowDrill||this.identical}}},W=V,U=d(68141),Z=(0,U.Z)(W,M,v,!1,null,"0049c943",null),X=Z.exports}}]);
