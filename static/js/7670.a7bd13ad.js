(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[7670],{80247:function(e,c,t){var s=t(49500);e.exports=function(n){var o={};function i(a){if(o[a])return o[a].exports;var u=o[a]={i:a,l:!1,exports:{}};return n[a].call(u.exports,u,u.exports,i),u.l=!0,u.exports}return i.m=n,i.c=o,i.d=function(a,u,l){i.o(a,u)||Object.defineProperty(a,u,{enumerable:!0,get:l})},i.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},i.t=function(a,u){if(u&1&&(a=i(a)),u&8||u&4&&typeof a=="object"&&a&&a.__esModule)return a;var l=Object.create(null);if(i.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:a}),u&2&&typeof a!="string")for(var f in a)i.d(l,f,function(w){return a[w]}.bind(null,f));return l},i.n=function(a){var u=a&&a.__esModule?function(){return a.default}:function(){return a};return i.d(u,"a",u),u},i.o=function(a,u){return Object.prototype.hasOwnProperty.call(a,u)},i.p="/dist/",i(i.s=770)}({0:function(n,o){n.exports=t(42579)},1:function(n,o){n.exports=t(28866)},10:function(n,o){n.exports=t(42762)},15:function(n,o){n.exports=t(63379)},16:function(n,o){n.exports=t(91873)},17:function(n,o){n.exports=t(85208)},2:function(n,o,i){"use strict";i.d(o,"a",function(){return a});function a(u,l,f,w,x,B,T,V){var M=typeof u=="function"?u.options:u;l&&(M.render=l,M.staticRenderFns=f,M._compiled=!0),w&&(M.functional=!0),B&&(M._scopeId="data-v-"+B);var A;if(T?(A=function($){$=$||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!$&&typeof __VUE_SSR_CONTEXT__<"u"&&($=__VUE_SSR_CONTEXT__),x&&x.call(this,$),$&&$._registeredComponents&&$._registeredComponents.add(T)},M._ssrRegister=A):x&&(A=V?function(){x.call(this,(M.functional?this.parent:this).$root.$options.shadowRoot)}:x),A)if(M.functional){M._injectStyles=A;var J=M.render;M.render=function(H,h){return A.call(h),J(H,h)}}else{var F=M.beforeCreate;M.beforeCreate=F?[].concat(F,A):[A]}return{exports:u,options:M}}},21:function(n,o){n.exports=t(81806)},27:function(n,o){n.exports=t(78756)},29:function(n,o){n.exports=t(5775)},35:function(n,o){n.exports=t(49162)},4:function(n,o){n.exports=t(55616)},42:function(n,o){n.exports=t(47598)},498:function(n,o){n.exports=t(83254)},5:function(n,o){n.exports=t(5146)},50:function(n,o){n.exports=t(36583)},52:function(n,o){n.exports=t(7165)},6:function(n,o){n.exports=t(83574)},60:function(n,o){n.exports=t(8421)},61:function(n,o){n.exports=t(19457)},7:function(n,o){n.exports=t(17249)},73:function(n,o){n.exports=t(15550)},770:function(n,o,i){"use strict";i.r(o);var a=function(){var m=this,b=m.$createElement,r=m._self._c||b;return r("div",{directives:[{name:"show",rawName:"v-show",value:m.isShow,expression:"isShow"}],staticClass:"sh-cutting-layer"},[m.$slots.default?r("span",{on:{click:function(){return m.toggle()}}},[m._t("default")],2):r("general-button",{attrs:{"is-column":!!m.isColumn,"icon-class":m.iconClass?m.iconClass:"cutting-layer",active:m.active,"show-img":!!m.showImg,"show-label":!!m.showLabel,"theme-style":m.themeStyle,"drag-enable":m.dragEnable,title:m.title?m.title:"\u88C1\u526A"},on:{click:function(){return m.toggle()}}})],1)},u=[];a._withStripped=!0;var l=i(0),f=i.n(l),w=i(6),x=i.n(w),B=i(7),T=i.n(B),V=i(60),M=i.n(V),A={defaultActive:{type:Boolean,default:function(){return!1}},isShow:{type:Boolean,default:function(){return!0}},cuttingOptions:{type:Object,default:function(){return{geoJson:"",isMask:!1,maskType:"pruning",stopMoveListener:!1,geoLayer:{layer:{},whereInfo:""},targetLayers:[],maskConfig:{fillColor:"",strokeColor:"",strokeWidth:0},locateConfig:{isFit:!1,isLocate:!1,center:"",resolution:""}}}}},J={geoJson:"",isMask:!0,stopMoveListener:!1,maskType:"pruning",targetLayers:["f8d3717c-e84d-1f5c-b8af-b17c2f319b5f2D\u7535\u5B50\u5730\u56FE","35f38315-c80e-cf6a-683b-917c82b67a712D\u7535\u5B50\u5730\u56FE"],geoLayer:{layer:{visibleLayers:["fgy:kj000101a"],type:"dynamic",url:"http://192.168.11.148:6080/arcgis/rest/services/%E8%A1%8C%E6%94%BF%E5%8C%BA%E5%AF%BC%E8%88%AA/MapServer",serverOrigin:"arcgis"},whereInfo:"xzqdm='3301'"},maskConfig:{fillColor:"rgba(0, 0, 0, 0.6)",strokeColor:"rgba(255, 69, 0, 1)",strokeWidth:2},locateConf:{isLocate:!1,center:"",resolution:""}},F=i(50),$=i.n(F),H=i(9),h=i.n(H),v=i(10),L=i.n(v),S=i(1),C=i.n(S),z=i(5),G=i.n(z),ot=i(21),q=i.n(ot),at=i(17),_=i.n(at),ut=i(27),tt=i.n(ut),ft=i(35),lt=i.n(ft),ct=i(73),ht=i.n(ct),W=i(16),dt=i(15),R=i.n(dt),et=i(29),it=i(52),vt=i(42),nt=i.n(vt),pt=i(83),gt=i(96),yt=i(498),k=i(4),xt=function(){function m(b){h()(this,m),this.map=b,this.isAllowCut=!0,this.currentWkid=b.getView().getProjection().getCode(),this.targetLayers=[],this.geoJSON=new lt.a,this.esrijsonFormat=new ht.a,this.prerenderEvtObj={},this.postrenderEvtObj={},this.xzq_features=[],this.isFirstExt=!0}return L()(m,[{key:"initMoveListener",value:function(){var r=this;C()(this).getTargetElement().addEventListener("mousewheel",function(){f()(this,r),this.isAllowCut=!1}.bind(this),!1),C()(this).on("pointerdown",function(){f()(this,r),this.isAllowCut=!1}.bind(this)),C()(this).getView().on("change:resolution",function(){f()(this,r),this.isAllowCut=!1}.bind(this)),C()(this).on("movestart",function(){f()(this,r),this.isAllowCut=!1}.bind(this)),C()(this).on("moveend",function(){f()(this,r),this.isAllowCut||C()(this).render(),this.isAllowCut=!0}.bind(this))}},{key:"initCutting",value:function(r){r?(this.options=r,this.targetLayers=r.targetLayers,r.stopMoveListener||this.initMoveListener(),this.clearCutLayers(),this.isAllowCut=!0,this.startCut(r)):k.Message.warning("\u88C1\u526A\u53C2\u6570\u7F3A\u5931")}},{key:"startCut",value:function(r){var d=this,y=r.geoLayer.layer;if(r.geoJson){var p=[],g=r.geoJson;typeof g=="string"?p.push(JSON.parse(g)):p=C()(g).call(g,function(j){f()(this,d);var E=j.geojsonGis||j;return JSON.parse(E)}.bind(this)),this.unionGeometry(p)}else if(y&&r.geoLayer.whereInfo){var I=r.geoLayer.whereInfo;setTimeout(function(){var j=this;f()(this,d),r.geoLayer.whereInfo&&this.customGeometry(y,I,function(E){f()(this,j),this.unionGeometry(E)}.bind(this))}.bind(this),800)}else k.Message.error("\u672A\u83B7\u53D6\u5230\u88C1\u526A\u8303\u56F4\u6570\u636E\uFF01")}},{key:"customGeometry",value:function(r,d,y){var p=this;this.whereClause===d&&this.geomLayerUrl===r.url&&this.xzq_features.length>0?y(this.xzq_features):(this.whereClause=d,this.geomLayerUrl=r.url,r.type.indexOf("geoserver")>-1?this.requestGeo(r,d,function(g){f()(this,p),this.xzq_features=g,y(g)}.bind(this)):(r.type==="dynamic"||r.type==="feature"||r.type==="feature-zj")&&this.requestArc(r,d,function(g){f()(this,p),this.xzq_features=g,y(g)}.bind(this)))}},{key:"unionGeometry",value:function(r){var d=this;if(this.targetLayers.length>0)if(r&&r.length>0){var y=[];r.forEach(function(I){var j;f()(this,d);var E=I.geometry,O=[];if(E)E.type&&E.type==="MultiPolygon"?O=E.coordinates:O.push(E.coordinates);else{var P=I.getGeometry(),U=P.getType();U==="Polygon"?O=[I.getGeometry().getCoordinates()]:O=I.getGeometry().getCoordinates()}y=G()(j=[]).call(j,$()(y),$()(O))}.bind(this));var p=new et.MultiPolygon(y),g=new nt.a(p);this.setCutting(g)}else k.Message.error("\u6CA1\u6709\u88C1\u526A\u533A\u57DF\u6570\u636E")}},{key:"setCutting",value:function(r){var d=this,y=r.getGeometry();this.currentWkid!=="EPSG:4490"&&(y=y.transform("EPSG:4490",this.currentWkid)),this.dataGeometry=y;var p=new W.Fill({color:[0,0,0,0]});this.styleVC=new W.Style({fill:p}),this.dataGeometry&&(this.targetLayers.forEach(function(g){f()(this,d);var I=C()(this).getLayerById(g);I?this.cutPrender(I):s.error(g+"\u56FE\u5C42\u672A\u52A0\u8F7D")}.bind(this)),setTimeout(function(){f()(this,d),this.setExtentLocate()}.bind(this),500)),this.setMask(r)}},{key:"setExtentLocate",value:function(){var r=this.dataGeometry.getExtent(),d=this.options.locateConf||this.options.locateConfig;if(!(!d||q()(r).call(r,1/0))){var y=d.isLocate,p=d.center,g=d.resolution,I=d.isFit;I?C()(this).getView().fit(r):y&&p&&this.isFirstExt&&(C()(this).getView().setCenter(p),C()(this).getView().setResolution(g||9),this.isFirstExt=!1)}}},{key:"addCuttingLayer",value:function(r){var d=C()(this).getLayerById(r);d&&(this.cutPrender(d),C()(this).render())}},{key:"cutPrender",value:function(r){var d=this,y=r.on("prerender",function(g){f()(this,d),this.isAllowCut&&this.styleVC&&this.dataGeometry&&this.changeCtx(g)}.bind(this)),p=r.on("postrender",function(g){if(f()(this,d),this.isAllowCut){var I=g.context;I.restore()}}.bind(this));this.prerenderEvtObj[r.values_.id]=y,this.postrenderEvtObj[r.values_.id]=p}},{key:"changeCtx",value:function(r){var d=r.context,y=Object(yt.getVectorContext)(r);d.save(),y.setStyle(this.styleVC),y.drawGeometry(this.dataGeometry),d.lineWidth=2,d.strokeStyle="rgba(0,0,0,0.5)",d.stroke(),d.clip()}},{key:"clearCutLayers",value:function(){for(var r in this.prerenderEvtObj)this.removeCutLayerById(r,!1);this.prerenderEvtObj={},this.postrenderEvtObj={},this.removeMask(),C()(this).render()}},{key:"removeCutLayerById",value:function(r){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,y=_()(this.prerenderEvtObj);if(q()(y).call(y,r)){var p=this.prerenderEvtObj[r],g=this.postrenderEvtObj[r];Object(it.unByKey)(p),Object(it.unByKey)(g),delete this.prerenderEvtObj[r],delete this.postrenderEvtObj[r],d&&C()(this).render()}else k.Message.error(r+"\u56FE\u5C42\u4E3A\u52A0\u8F7D!")}},{key:"removeMask",value:function(){var r=C()(this).getLayerById("cuttingMask");r&&C()(this).removeLayer(r)}},{key:"setMask",value:function(r){this.removeMask();var d=this.options,y=d.maskType;if(d.isMask){var p=this.getMaskPolygon(y,r);this.setMaskLayer(p)}}},{key:"getMaskPolygon",value:function(r,d){var y=this,p=[[[-180,-90],[-180,90],[180,90],[180,-90],[-180,-90]]];r==="fill"&&(p=[]);var g=d.getGeometry().getType(),I=d.getGeometry().getCoordinates();return g.toLowerCase()==="polygon"?p=G()(p).call(p,I):I.forEach(function(j){f()(this,y),p=G()(p).call(p,j)}.bind(this)),p}},{key:"setMaskLayer",value:function(r){var d=[r],y=new gt.Vector,p=new et.MultiPolygon(d),g=new nt.a(p);y.addFeature(g);var I=new pt.Vector({id:"cuttingMask",zIndex:this.options.maskIndex||1099,source:y,style:this.setLineStyle()});C()(this).addLayer(I)}},{key:"setLineStyle",value:function(){var r="rgba(0, 191, 255, 1)",d="rgba(255, 255, 255, 0.5)",y=0,p=this.options.maskConfig,g=p.strokeColor,I=p.fillColor,j=p.strokeWidth,E=new W.Stroke({color:g||r,width:j||y}),O=new W.Fill({color:I||d}),P=new W.Style({fill:O});return j>0&&P.setStroke(E),P}},{key:"requestGeo",value:function(r,d,y){var p=this,g=r.url,I=g.lastIndexOf("/");g=g.substring(0,I)+"/wfs";var j=r.visibleLayers[0],E=C()(this).getView().getProjection().getCode();R.a.ajax({url:g,data:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:j,outputFormat:"application/json",maxFeatures:3200,srsName:E,CQL_FILTER:d},success:function(P){f()(this,p),P&&P.features.length>0?y(P.features):y(null)}.bind(this),error:function(P){f()(this,p),s.error(P),k.Message.error("\u83B7\u53D6\u88C1\u526A\u533A\u57DF\u6570\u636E\u51FA\u9519")}.bind(this)})}},{key:"requestArc",value:function(r,d,y){var p=this,g=this.currentWkid;g=g.split(":")[1];var I=r.url,j={f:"json"};R.a.ajax({url:I,data:j,success:function(O){var P=this;if(f()(this,p),O&&(O=JSON.parse(O),O.layers&&O.layers.length>0)){var U=[];O.layers.forEach(function(X){var Y=this;f()(this,P);var N=X.id,D=I+"/"+N+"/query",rt={f:"json",outFields:"*",outSR:g,returnGeometry:!0,where:d},Mt=new tt.a(function(Q){var st=this;f()(this,Y),this._ajax(D,rt,Q),R.a.ajax({url:D,data:rt,success:function(K){if(f()(this,st),K){K=JSON.parse(K);var jt=this.esrijsonFormat.readFeatures(K);Q(jt)}}.bind(this),error:function(){f()(this,st),Q([])}.bind(this)})}.bind(this));U.push(Mt)}.bind(this)),tt.a.all(U).then(function(X){var Y=this;f()(this,P);var N=[];X.forEach(function(D){f()(this,Y),D.length>0&&(N=G()(N).call(N,D))}.bind(this)),y(N)}.bind(this))}}.bind(this),error:function(O){f()(this,p),s.error(O),k.Message.error("\u83B7\u53D6\u88C1\u526A\u533A\u57DF\u6570\u636E\u51FA\u9519")}.bind(this)})}},{key:"getCutLayersIds",value:function(){return _()(this.prerenderEvtObj)}},{key:"_ajax",value:function(r,d,y){var p=this;R.a.ajax({url:r,data:d,success:function(I){if(f()(this,p),I){I=JSON.parse(I);var j=this.esrijsonFormat.readFeatures(I);y(j)}}.bind(this),error:function(){f()(this,p),y([])}.bind(this)})}}]),m}(),mt=i(61),Ct=i.n(mt),bt={name:"ShCuttingLayer",components:{GeneralButton:M.a},mixins:[x.a,T.a,Ct.a],props:A,data:function(){return this.cutting,{active:!1}},mounted:function(){var b=this;this.$map&&setTimeout(function(){f()(this,b),this.begin()}.bind(this),0)},methods:{toggle:function(){this.active?this.deactivate():this.activate(),this.active=!this.active},begin:function(){this.defaultActive&&this.activate()},activate:function(){this.cutting||(this.cutting=new xt(this.$map)),this.cutting.initCutting(this.cuttingOptions)},deactivate:function(){this.cutting&&this.cutting.clearCutLayers()},addCuttingLayerById:function(b){this.cutting&&this.cuttingOptions&&this.cutting.addCuttingLayer(b)},removeCuttingLayerById:function(b){this.cutting&&this.cuttingOptions&&this.cutting.removeCutLayerById(b)},getCutLayersIds:function(){return this.cutting?this.cutting.getCutLayersIds():[]}},render:function(){return null}},It=bt,Lt=i(2),wt=Object(Lt.a)(It,a,u,!1,null,null,null),Z=wt.exports;Z.install=function(m){m.component(Z.name,Z)};var Ot=o.default=Z},83:function(n,o){n.exports=t(83062)},9:function(n,o){n.exports=t(22777)},96:function(n,o){n.exports=t(74183)}})},83574:function(e,c,t){"use strict";var s=t(19534);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var n=s(t(28866)),o=s(t(42579)),i={data:function(){return{isSetMap_common:!1}},inject:{reactiveConfigInstance:{default:function(){var l=this;return function(){return(0,o.default)(this,l),null}.bind(this)}},reactiveViewMode:{default:function(){var l=this;return function(){return(0,o.default)(this,l),"23D"}.bind(this)}},reactiveView:{default:function(){var l=this;return function(){return(0,o.default)(this,l),"map"}.bind(this)}},reactiveMap:{default:function(){var l=this;return function(){return(0,o.default)(this,l),null}.bind(this)}},reactiveEarth:{default:function(){var l=this;return function(){return(0,o.default)(this,l),null}.bind(this)}},reactiveInteraction:{default:function(){var l=this;return function(){return(0,o.default)(this,l),null}.bind(this)}},reactiveShinegaUrl:{default:function(){var l=this;return function(){return(0,o.default)(this,l),null}.bind(this)}},reactiveShinegaDatabaseId:{default:function(){var l=this;return function(){return(0,o.default)(this,l),null}.bind(this)}},shinegaInitData:{default:null},token:{default:null},emitterId:{default:null},fastApplicationId:{default:null},publishId:{default:null}},computed:{configInstance:function(){return this.reactiveConfigInstance()},$map:function(){return this.isSetMap_common?this.$_map:this.reactiveMap()},$earth:function(){return this.isSetMap_common?this.$_earth:this.reactiveEarth()},viewMode:function(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()},currentView:function(){return this.reactiveView()},currentInteraction:function(){return this.reactiveInteraction()},shinegaUrl:function(){return this.reactiveShinegaUrl()},shinegaDatabaseId:function(){return this.reactiveShinegaDatabaseId()}},methods:{setMap:function(l){var f=(0,n.default)(l),w=l.earth,x=l.viewMode;this.$_map=f,this.$_earth=w,this.$_viewMode=x,this.isSetMap_common=!0,this.begin&&this.begin()}}},a=i;c.default=a},19457:function(e,c,t){"use strict";var s=t(19534);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var n=s(t(52909)),o=s(t(42579)),i=void 0,a={props:{isShow:{type:Boolean,default:!0},position:{type:Object,default:function(){return(0,o.default)(this,i),{type:"absolute",top:"1px",left:"1px"}}.bind(void 0)},isColumn:{type:Boolean,default:!1},title:{type:String},iconClass:{type:String},dragEnable:{type:Boolean,default:!1},showImg:{type:Boolean,default:!0},showLabel:{type:Boolean,default:!0},themeStyle:{type:Object}},data:function(){return{theme:"light"}},watch:{currentView:{handler:function(f){f==="earth"?this.theme="dark":this.theme="light"},immediate:!0}},mounted:function(){var f,w=this;this.$_mixin_generalButton=(0,n.default)(f=this.$children).call(f,function(x){return(0,o.default)(this,w),x.$options.name==="ShGeneralButton"}.bind(this))},methods:{getPosition:function(){var f;return(f=this.$_mixin_generalButton)===null||f===void 0?void 0:f.getPosition()}}},u=a;c.default=u},56279:function(e,c,t){"use strict";t.d(c,{P:function(){return o}});var s=t(86892),n=t(49500);const o={mixins:[s.D],created(){},methods:{lifecycleBeforeChartsLoad(i){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&n.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),n.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let u=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[i]);if(u)return u}return i},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&n.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),n.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},42709:function(e,c,t){"use strict";var s=t(48836);const n={data(){return this.map=null,this.timer="",{isEditor:window.location.href.indexOf("editor.html")>0}},inject:{reactiveViewMode:{default:function(){return()=>"23D"}}},computed:{viewMode(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()}},mounted(){!this.widgetInfo.parentId&&this.isEditor&&this.widgetInfo.action.gisMapId&&this.$nextTick(function(){this.updateWidgetParentId({widgetId:this.widgetInfo.id,parentId:this.widgetInfo.action.gisMapId,keepPosition:!0})})},methods:{...(0,s.nv)(["updateWidgetParentId"]),getBindMap(){typeof this.widgetInfo.action.gisMapId<"u"}}};c.Z=n},44513:function(e,c,t){"use strict";t.d(c,{Z:function(){return f}});var s=function(){var x=this,B=x._self._c;return x.attr.buttonHide?B("div",{style:{position:"absolute",right:x.attr.buttonHideRight+"px",top:x.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(T){return x.onHide()}}},[x.openTooltip?B("el-tooltip",{attrs:{"open-delay":1e3,content:x.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[B("el-button",{class:x.attr.buttonHideIconClass&&x.attr.buttonHideIconClass!=""?x.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:x.attr.buttonHideColor,fontSize:x.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):B("el-button",{class:x.attr.buttonHideIconClass&&x.attr.buttonHideIconClass!=""?x.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:x.attr.buttonHideColor,fontSize:x.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):x._e()},n=[],o=t(52246),i={props:["attr"],name:"hide-button",data(){return{isPc:o.b}},computed:{openTooltip:function(){let w=!1,x=this.attr.buttonHideTooltipContent;return o.b&&x&&x!=null&&x.trim()!=""&&(w=!0),w}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},a=i,u=t(68141),l=(0,u.Z)(a,s,n,!1,null,"bf399b9a",null),f=l.exports},67670:function(e,c,t){"use strict";t.r(c),t.d(c,{default:function(){return H}});var s=function(){var v=this,L=v._self._c;return L("div",{directives:[{name:"show",rawName:"v-show",value:v.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"gis-cutting",style:{width:v.widgetInfo.attr.w+"px",height:v.widgetInfo.attr.hh+"px"},attrs:{map:v.map}},[L("hide-button",{attrs:{attr:v.widgetInfo.attr}}),L("cutting-layer",{ref:"cuttingLayer",attrs:{"is-show":!1,"cutting-options":v.widgetInfo.config}})],1)},n=[],o=t(80247),i=t.n(o),a=t(86892),u=t(44513),l=t(45061),f=t(50681),w=t(27966),x=t(42709),B=t(83574),T=t(43156),V=t(56279),M=t(49500),A={name:"GisCutting",components:{HideButton:u.Z,CuttingLayer:i()},mixins:[a.D,V.P,f.Z,l.u,B.default,x.Z],props:["widgetInfo"],data(){return{map:null,cutCls:void 0,stratedGetId:!1,firstInit:!0}},watch:{"widgetInfo.action.gisMapId":{handler(h){this.stratedGetId||(this.getBindMap(h),this.stratedGetId=!0)}}},destroyed(){this.cutCls&&this.cutCls.clearEvt()},created(){this.initAction(this.widgetInfo)},mounted(){this.widgetInfo.config.mapLayers=[],w.Z.$emit("register-save-event",{widget:this,handler:this.saveMapInfo}),w.Z.$on("refreshLayer",h=>{if(h&&(h=JSON.parse(h),this.widgetInfo.config.treeLayer=h,this.$refs.cuttingLayer.cutting)){let v=this.widgetInfo.config.filterConfig.filterIds,L=[];h.forEach(S=>{v.indexOf(S.id)>-1&&L.push(S.id)}),this.widgetInfo.config.filterConfig.filterIds=L,this.$refs.cuttingLayer.cutting.initCutting(this.lifecycleBeforeChartsLoad(this.widgetInfo.config))}}),w.Z.$on("refreshCutingList",()=>{this.$map&&this.getLayers(this.$map)}),this.$nextTick(()=>{this.$refs.cuttingLayer.activate()}),this.$map&&this.$map.layerManager.on("afterAddLayer",h=>{let v=h.layer.get("id");this.widgetInfo.config.targetLayers.indexOf(v)>-1&&(this.$refs.cuttingLayer.deactivate(),this.$refs.cuttingLayer.activate())}),this.onCuttingInited()},methods:{initAction(h){if(M.log("\u88C1\u526A\u6570\u636E\u521D\u59CB\u5316"),!h.config.geoJson||h.config.geoJson.length===0){const v=h.config.cutConfig.currentXZQ;v&&v.length>0&&this._getGeojson(v)}this.actionReceive(this.lifecycleBeforeChartsLoad(h))},_getGeojson(h){T.h.getGisGeojsonByCode({xzqCode:h}).then(v=>{v.status===200&&v.data&&v.data.length>0&&(this.widgetInfo.config.geoJson=v.data||[])})},actionReceive(h){if(h.action===void 0||h.action.receive===void 0)return;let v=h.action.receive.mapCutting;v&&v.enabled&&v.cutList&&v.cutList.length>0&&this.$$lib__.each(v.cutList,C=>{let z=C[0][1];w.Z.$on(z,G=>{v.script&&v.script.enabled&&(M.log("Execute the script to locate temp graphic to the "+h.name+" component"),this.actionMapCutting=new Function("info","data","action",v.script.content)),this.actionMapCutting(h,G,C)})});let L=h.action.receive.show;L&&L.enabled&&L.showList&&L.showList.length>0&&this.doActionShowOrHide(L.showList,L.value,L.script,h.name,"show",!1);let S=h.action.receive.hide;S&&S.enabled&&S.hideList&&S.hideList.length>0&&this.doActionShowOrHide(S.hideList,S.value,S.script,h.name,"hide",!0)},getMapId(){if(!this.stratedGetId){let h=setInterval(()=>{this.widgetInfo.action.gisMapId&&(clearInterval(h),this.getBindMap(this.widgetInfo.action.gisMapId))},500);this.stratedGetId=!0}},reLoadInfo(){this.$refs.cuttingLayer.activate()},getBindMap(h){let v=this.getWidgetObject(h);v&&this.initCutFun(v)},initCutFun(h){this.map=h.$refs.gismap},getLayers(h){let v=h.getLayers().getArray(),L=[];v.forEach(S=>{S.values_.id!=="drawLayer"&&S.values_.id!=="localLayer"&&S.values_.layerTag&&L.push(S)}),this.widgetInfo.config.mapLayers=L},saveMapInfo(){let h=this.$map,v=h.getView().getCenter(),L=h.getView().getResolution();this.widgetInfo.config.locateConf.center=v,this.widgetInfo.config.locateConf.resolution=L},actionMapCutting(h,v,L){},doShow(){this.$refs.cuttingLayer&&this.$refs.cuttingLayer.activate()},doHide(){this.$refs.cuttingLayer&&this.$refs.cuttingLayer.deactivate()},biPostMessage(h,v){let L=this,S=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(S,C=>{if(C.enabled&&h.indexOf(C.code)>-1){let z=C.code+"_"+L.widgetInfo.id;if(C.paramsExtend&&C.paramsExtend.length>0&&this.getExtendParams(v,C.paramsExtend,[],[]),C.script&&C.script.enabled&&C.script.content){this.doConfigMap=new Function("data",C.script.content);let G=this.doConfigMap(v);G&&(v=G)}w.Z.$emit(z,v),C.postMessage&&this.doPostMessage(v)}})},onCuttingInited(){let h=this.widgetInfo.config;this.biPostMessage([this.$$global_editor.actionType.mapConfiged.code],h)}}},J=A,F=t(68141),$=(0,F.Z)(J,s,n,!1,null,"1ec8c57a",null),H=$.exports},80876:function(e){function c(t,s){(s==null||s>t.length)&&(s=t.length);for(var n=0,o=new Array(s);n<s;n++)o[n]=t[n];return o}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports},96159:function(e,c,t){var s=t(47578),n=t(80876);function o(i){if(s(i))return n(i)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},22777:function(e){function c(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports},42762:function(e,c,t){var s=t(57448),n=t(68871);function o(a,u){for(var l=0;l<u.length;l++){var f=u[l];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),s(a,n(f.key),f)}}function i(a,u,l){return u&&o(a.prototype,u),l&&o(a,l),s(a,"prototype",{writable:!1}),a}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},54581:function(e,c,t){var s=t(94464),n=t(22780),o=t(35842);function i(a){if(typeof s<"u"&&n(a)!=null||a["@@iterator"]!=null)return o(a)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},12260:function(e){function c(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports},36583:function(e,c,t){var s=t(96159),n=t(54581),o=t(77297),i=t(12260);function a(u){return s(u)||n(u)||o(u)||i()}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},48943:function(e,c,t){var s=t(11484),n=t(29870).default;function o(i,a){if(n(i)!="object"||!i)return i;var u=i[s];if(u!==void 0){var l=u.call(i,a||"default");if(n(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(i)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},68871:function(e,c,t){var s=t(29870).default,n=t(48943);function o(i){var a=n(i,"string");return s(a)=="symbol"?a:String(a)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},77297:function(e,c,t){var s=t(97968),n=t(35842),o=t(80876);function i(a,u){var l;if(a){if(typeof a=="string")return o(a,u);var f=s(l=Object.prototype.toString.call(a)).call(l,8,-1);if(f==="Object"&&a.constructor&&(f=a.constructor.name),f==="Map"||f==="Set")return n(a);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return o(a,u)}}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},75833:function(e,c,t){"use strict";var s=t(5567);e.exports=s},14963:function(e,c,t){"use strict";var s=t(76694);e.exports=s},67479:function(e,c,t){"use strict";var s=t(75576);e.exports=s},19727:function(e,c,t){"use strict";var s=t(11165);e.exports=s},97339:function(e,c,t){"use strict";var s=t(56345);e.exports=s},15748:function(e,c,t){"use strict";t(41809);var s=t(94388);e.exports=s.Array.isArray},296:function(e,c,t){"use strict";t(49614);var s=t(94388),n=s.Object,o=e.exports=function(a,u,l){return n.defineProperty(a,u,l)};n.defineProperty.sham&&(o.sham=!0)},3953:function(e,c,t){"use strict";t(76258),t(53977);var s=t(99215);e.exports=s.f("toPrimitive")},35842:function(e,c,t){"use strict";e.exports=t(16276)},47578:function(e,c,t){"use strict";e.exports=t(20486)},97968:function(e,c,t){"use strict";e.exports=t(70348)},57448:function(e,c,t){"use strict";e.exports=t(76876)},11484:function(e,c,t){"use strict";e.exports=t(54090)},16276:function(e,c,t){"use strict";var s=t(75833);e.exports=s},20486:function(e,c,t){"use strict";var s=t(14963);e.exports=s},70348:function(e,c,t){"use strict";var s=t(67479);e.exports=s},76876:function(e,c,t){"use strict";var s=t(19727);e.exports=s},54090:function(e,c,t){"use strict";var s=t(97339);e.exports=s},41809:function(e,c,t){"use strict";var s=t(90434),n=t(67170);s({target:"Array",stat:!0},{isArray:n})},76258:function(){},49614:function(e,c,t){"use strict";var s=t(90434),n=t(14451),o=t(51032).f;s({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!n},{defineProperty:o})},76694:function(e,c,t){"use strict";var s=t(15748);e.exports=s},11165:function(e,c,t){"use strict";var s=t(296);e.exports=s},56345:function(e,c,t){"use strict";var s=t(3953);e.exports=s}}]);
