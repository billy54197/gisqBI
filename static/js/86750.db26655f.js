"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[86750],{56279:function(R,u,r){r.d(u,{P:function(){return c}});var g=r(386892),f=r(149500);const c={mixins:[g.D],created(){},methods:{lifecycleBeforeChartsLoad(w){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&f.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let b=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[w]);if(b)return b}return w},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&f.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},752246:function(R,u,r){r.d(u,{X:function(){return g},b:function(){return f}});let g={versions:function(){var c=navigator.userAgent;return{trident:c.indexOf("Trident")>-1,presto:c.indexOf("Presto")>-1,webKit:c.indexOf("AppleWebKit")>-1,gecko:c.indexOf("Gecko")>-1&&c.indexOf("KHTML")==-1,mobile:!!c.match(/AppleWebKit.*Mobile.*/),ios:!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:c.indexOf("Android")>-1,iPhone:c.indexOf("iPhone")>-1,iPad:c.indexOf("iPad")>-1,webApp:c.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},f;g.versions.mobile||g.versions.ios||g.versions.android||g.versions.iPhone||g.versions.iPad?f=!1:f=!0},844513:function(R,u,r){r.d(u,{Z:function(){return M}});var g=function(){var s=this,x=s._self._c;return s.attr.buttonHide?x("div",{style:{position:"absolute",right:s.attr.buttonHideRight+"px",top:s.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(O){return s.onHide()}}},[s.openTooltip?x("el-tooltip",{attrs:{"open-delay":1e3,content:s.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[x("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):x("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):s._e()},f=[],c=r(752246),w={props:["attr"],name:"hide-button",data(){return{isPc:c.b}},computed:{openTooltip:function(){let C=!1,s=this.attr.buttonHideTooltipContent;return c.b&&s&&s!=null&&s.trim()!=""&&(C=!0),C}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},P=w,b=r(768141),I=(0,b.Z)(P,g,f,!1,null,"bf399b9a",null),M=I.exports},286750:function(R,u,r){r.r(u),r.d(u,{default:function(){return j}});var g=function(){var i=this,e=i._self._c;return e("div",{style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[e("hide-button",{attrs:{attr:i.widgetInfo.attr}}),e("div",{ref:"countryMapScatter",staticClass:"charts chart-bar map-mount-node",style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"},attrs:{id:"mapChart"}})],1)},f=[],c=r(927966),w=r(321300),P=r(103540),b=r(67157),I=r(150813),M=r(738002);const C={mixins:[b.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(I.Z.charts.title)),legend:JSON.parse(JSON.stringify(I.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(I.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(I.Z.charts.toolbox)),itemStyle:{normal:{areaColor:"rgba(0, 0, 0,0)",opacity:1,color:"#389BB7",borderColor:"rgba(147, 235, 248)",shadowColor:"rgba(128, 217, 248,.6)",label:{areaColor:"rgba(255,50,50,1)",color:"rgba(0,0,0,1)"}},emphasis:{label:{color:"rgba(0,0,0,1)"},itemStyle:{color:"#f66"}}},VisualMap:Object.assign(JSON.parse(JSON.stringify(M.default.visualMap)),{inRange:{color:["#4C84FF"]}}),map3D:{label:{textStyle:{color:"#333",borderColor:"#fff",backgroundColor:"rgba(0,0,0,0)"}},itemStyle:{color:"rgb(5,101,123)",opacity:1,borderWidth:1,borderColor:"rgb(62,215,213)"},emphasis:{label:{textStyle:{color:"#333",borderColor:"#fff",backgroundColor:"rgba(0,0,0,0)"}},itemStyle:{color:"#f66",opacity:1}}},groundPlane:{color:"#aaa"},light:{main:{color:"#fff"},ambient:{color:"#fff",intensity:.2}},graphic:{style:{color:"#294D99"}}}}},methods:{filterPredefineColoursSchemeConfig(t,i){this.getNewConfigWithArrary(t,i,this.filter_config),this.getNewConfig_charts_visualMap_inRange_color(t.VisualMap,i.visualMap)}}};var s=r(445061),x=r(126711),O=r(99349),V=r(179966),A=r(844513),z=r(143156),E=r(555616),N=r(56279),h=r(149500);const L=r(954255);var H={props:["widgetInfo","currentWidget"],name:"country-map-scatter",mixins:[s.u,x.H,N.P,O.P,P.baseConfig,C],data(){return{historyRegion:[],dimensionsEx:null,dimensionsAliasEx:null,identical:!0,regionParent:{name:null,code:null},currentRegion:{id:null,name:null,cp:null,features:null,childrenCentralPoint:null}}},components:{HideButton:A.Z},mounted(){this.mapChart||(this.mapChart=L.init(this.$refs.countryMapScatter,null,{devicePixelRatio:2})),this.loadInfo(),this.initAction(this.widgetInfo)},destroyed(){this.mapChart.dispose()},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(t){t==null&&(t=this.widgetInfo),this.getCurrentRegionInfo(t.config.regionCode,i=>{let e=t.dataset[t.dataset.type].source,a=t.dataset[t.dataset.type].dimensions,n=t.dataset[t.dataset.type].dimensionsAlias,d=t.dataset[t.dataset.type].encode;this.dimensionsEx=a,this.dimensionsAliasEx=n;let m=this.getTooltip(t.config.tooltip);if(!t.config.tooltip.formatter.show&&!t.config.tooltip.formatter.script){let o="";t.config.map.tooltip&&(o=t.config.map.tooltip.unit),Object.assign(m,{formatter:function(l){let y="";return l.data&&l.data.value&&(y=l.data.alias+" : "+l.data.value+o+"<br>"),l.name+"<br>"+y}})}t.config.VisualMap.visualMapMin=="dataMin"&&(t.config.VisualMap.min=this.getVisualmapData(t,d.data)[0]),t.config.VisualMap.visualMapMax=="dataMax"&&(t.config.VisualMap.max=this.getVisualmapData(t,d.data)[1]);let p={tooltip:m,visualMap:t.config.VisualMap.show?this.getVisualMap(t.config.VisualMap):""},v=[],J=e.length,S={};for(let o=a.length-1;o>-1;--o)S[a[o]]=o;if(d.data&&d.region)for(let o=0;o<J;++o){let l=e[o],y=parseFloat(l[S[d.data]]);typeof y<"u"&&v.push({name:l[S[d.region]],alias:this.dimensionsAliasEx[S[d.data]].alias||this.dimensionsAliasEx[S[d.data]].name,value:y})}let G=t.config.graphic.style.fontSize+"px solid"+t.config.graphic.style.fontFamily;if(p.graphic=[{type:"group",bounding:"raw",left:t.config.graphic.style.iconLeft+"%",top:t.config.graphic.style.iconTop+"%",ignore:this.ignoreGraphic(),children:[{type:"text",z:100,style:{fill:t.config.graphic.style.color,text:t.config.graphic.style.text?t.config.graphic.style.text:"\u4E0A\u4E00\u7EA7",font:G,x:t.config.graphic.style.iconWidth+t.config.graphic.style.txtLeft,y:t.config.graphic.style.txtTop}},{type:"image",z:-10,bounding:"raw",origin:[25,25],ignore:this.ignoreGraphic(),style:{image:this.getImageUrl(t.config.graphic.style.iconImg),width:t.config.graphic.style.iconWidth,height:t.config.graphic.style.iconHeight}}]}],t.config.mapType==="map3D"){let o=JSON.parse(JSON.stringify(t.config.map3D));o.label.formatter=this.getFormatterString(t.config.map3D.label.formatter),o.left=o.left+"%",o.top=o.top+"%",o.right=o.right+"%",o.bottom=o.bottom+"%",o.type="map3D",o.name=d.data,o.map=t.config.regionCode.toString(),o.data=this.convertData(v),p.series=[];for(let l=0;l<o.data.length;l++)(o.data[l].name==o.data[l].code||o.data[l].code==o.map)&&(o.data.splice(l,1),l=l-1);p.series[0]=o}else{let o={name:d.data,type:"map",map:t.config.regionCode.toString(),data:this.convertData(v),label:{show:t.config.itemStyle.normal.label.show,textStyle:{fontSize:t.config.itemStyle.normal.label.fontSize,fontFamily:t.config.itemStyle.normal.label.fontFamily,color:t.config.itemStyle.normal.label.color},formatter:function(l){let y="";if(l.data&&t.config.itemStyle.normal.label.showValue){let B=t.config.itemStyle.normal.label.unit||"";y=`
`+l.data.value+B}return l.name+y},emphasis:{color:t.config.itemStyle.emphasis.label.color}},itemStyle:{areaColor:t.config.itemStyle.normal.areaColor,opacity:t.config.itemStyle.normal.opacity,color:t.config.itemStyle.normal.areaColor,borderColor:t.config.itemStyle.normal.borderColor,borderType:t.config.itemStyle.normal.borderType,borderWidth:.5},emphasis:{label:{show:t.config.showTooltip},itemStyle:{areaColor:t.config.itemStyle.normal.label.areaColor,color:t.config.itemStyle.normal.label.areaColor}}};t.config.autoMargin||(o.left=t.config.left+"%",o.right=t.config.right+"%",o.top=t.config.top+"%",o.bottom=t.config.bottom+"%"),p.series=[o]}L.registerMap(t.config.regionCode.toString(),i),this.mapChart&&this.mapChart.clear(),this.mapChart.setOption(this.lifecycleBeforeChartsLoad(p)),this.mapChart.resize()})},reLoadInfo(t){t&&(this.$refs.countryMapScatter.style.width=t.attr.w+"px",this.$refs.countryMapScatter.style.height=t.attr.hh+"px",this.$refs.countryMapScatter.style.display=t.attr.hide===!0?"none":""),this.loadInfo(t),this.mapChart.resize()},getCurrentRegionInfo(t,i){this.currentRegion.id=null,this.currentRegion.name=null,this.currentRegion.cp=null,this.currentRegion.features=null,this.currentRegion.childrenCentralPoint=null,z.h.getEchartsGeojsonByCodeWithChildrenCentralPoint(t).then(e=>{if(e&&e.status==200){if(!e.data){h.warn("\u672A\u67E5\u8BE2\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+t+" ]\u7684\u76F8\u5173\u6570\u636E");return}this.widgetInfo.config.regionName=e.data.xzqName,this.regionParent.code=e.data.parentCode,this.regionParent.name=e.data.parentName,this.currentRegion.id=t,this.currentRegion.name=e.data.xzqName,this.currentRegion.childrenCentralPoint=e.data.childrenCentralPoint;let a=e.data.geojsonEcharts;if(!a||a==""){h.warn("\u884C\u653F\u533A[ "+e.data.xzqName+" ]\u6CA1\u6709\u8BBE\u7F6E\u884C\u653F\u533A\u8FB9\u754C\u6570\u636E"),i();return}let n=JSON.parse(a);n&&n.cp&&(this.currentRegion.cp=n.cp),n&&n.features&&(this.currentRegion.features=n.features),i(n)}else h.log(e.msg)})},getFeatureInfo(t){let i=this.currentRegion.childrenCentralPoint[t];if(i&&i.cp)return JSON.parse(JSON.stringify(i));if(!this.currentRegion.features)return h.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5F53\u524D\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7F3A\u5C11features\u5C5E\u6027"),null;let e=this.$$lib__.find(this.currentRegion.features,a=>a.properties&&t==a.properties.id);return e?{id:e.properties.id,name:e.properties.name,cp:e.properties.cp}:(h.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF0C\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+t+' ]\u7684\u76F8\u5173\u5C5E\u6027\uFF0C\u5373properties:{"id":"","name":"","cp":[]}\u4E0D\u5B58\u5728'),null)},convertData(t){let i=[];for(let e=0;e<t.length;e++){let a=this.getFeatureInfo(t[e].name);a?i.push({name:a.name,code:t[e].name,alias:t[e].alias,value:t[e].value}):i.push({name:t[e].name,code:t[e].name,alias:t[e].alias,value:t[e].value})}return i},initAction(t){this.actionSendout(t),this.actionReceive(t),this.registerAction(t,"openRegion","widgetList",this.doOpenRegion),this.clickEvent()},doOpenRegion(t,i,e,a){if(i&&e&&i[e]){let n=i[e];if(a.script&&a.script.enabled){if(h.log("Execute script for "+a.name+" component to "+a.script.title+" component"),a.script.content==""){E.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_openRegion=new Function("region,info,data,param_key",a.script.content),this.customScript_actionSend_openRegion(n,t,i,e)}else this.widgetInfo.config.regionCode!=n&&(this.widgetInfo.config.regionCode=n,this.loadInfo(this.widgetInfo))}},getParams(t,i){if(i.paramsExtend&&i.paramsExtend.length>0){let e=[],a=this.widgetInfo.dataset[this.widgetInfo.dataset.type].source,n=this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode,d=this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions;if(this.widgetInfo.dataset.regionType=="region"){let m=-1;this.$$lib__.each(d,(p,v)=>{p==n.region&&(m=v)});for(let p=0;p<a.length;p++)if(t.code==a[p][m]){e=a[p];break}}this.getExtendParams(t,i.paramsExtend,e,this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions)}return t},clickEvent(){let t=this;this.mapChart.on("click",function(i){let e=i.componentType=="graphic"?t.regionParent.name:i.name;t.getRegionByNameAndParentCode(e,a=>{let n={code:i.componentType=="graphic"?t.regionParent.code:a!=null?a.xzqCode:null,name:e};if(i.componentType=="graphic"&&(t.widgetInfo.config.regionCode=n.code,t.loadInfo(),t.sendActionFun(n,i)),!a||!a.xzqCode||a.xzqCode==""){t.sendActionFun(n,i);return}t.doDrill(a),t.sendActionFun(n,i)})})},sendActionFun(t,i){let e=this,a=e.widgetInfo.action.sendOut.actionList;e.$$lib__.each(a,n=>{if(n.enabled&&n.code==e.$$global_editor.actionType.click.code){let d=e.$$global_editor.actionType.click.code+"_"+e.widgetInfo.id;if(n.paramsExtend&&n.paramsExtend.length>0){let m=[];e.widgetInfo.dataset[e.widgetInfo.dataset.type].source&&e.widgetInfo.dataset[e.widgetInfo.dataset.type].source.length>0&&(m=e.widgetInfo.dataset[e.widgetInfo.dataset.type].source[i.dataIndex]),e.getExtendParams(t,n.paramsExtend,m,e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions)}if(n.script&&n.script.enabled){if(h.log("Execute script for "+n.name+" component to "+n.script.title+" component"),n.script.content==""){E.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam2=new Function("param, params",n.script.content),t=this.customScript_actionSend_clickParam2(t,i)}c.Z.$emit(d,t),n.postMessage&&e.doPostMessage(t),e.actionNameList.push(d)}else if(n.enabled&&n.code==e.$$global_editor.actionType.openLink.code){if(n.paramsExtend&&n.paramsExtend.length>0){let d=[];e.widgetInfo.dataset[e.widgetInfo.dataset.type].source&&e.widgetInfo.dataset[e.widgetInfo.dataset.type].source.length>0&&(d=e.widgetInfo.dataset[e.widgetInfo.dataset.type].source[i.dataIndex]),e.getExtendParams(t,n.paramsExtend,d,e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions)}if(n.script&&n.script.enabled){if(h.log("Execute script for "+n.name+" component to "+n.script.title+" component"),n.script.content==""){E.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_openLink=new Function("param",n.script.content),t=this.customScript_actionSend_openLink(t)}e.openLinkAction(n,t)}})},getRegionByNameAndParentCode(t,i){t&&z.h.getEchartsGeojsonByNameAndParentCode(t,this.widgetInfo.config.regionCode).then(e=>{if(e&&e.status==200){if(!e.data){h.warn("\u672A\u67E5\u5230\u884C\u653F\u533A[ "+t+" ]\u7684\u76F8\u5173\u6570\u636E"),i(null);return}if(!e.data.xzqCode||e.data.xzqCode==""){h.warn("\u672A\u67E5\u5230\u884C\u653F\u533A[ "+t+" ]\u7684\u76F8\u5173\u6570\u636E"),i(e.data);return}let a=e.data.geojsonEcharts;if(!a||a==""){h.warn("\u884C\u653F\u533A[ "+e.data.xzqName+" ]\u6CA1\u6709\u8BBE\u7F6E\u884C\u653F\u533A\u8FB9\u754C\u6570\u636E"),i(e.data);return}i(e.data)}else h.log(e.msg)})},doDrill(t){let i=!1,e=this.widgetInfo.config.allowDrillArea;(t.xzqCode=="china"||e==null||e==""||e=="province"&&t.xzqCode.length<=2||e=="city"&&t.xzqCode.length<=4||e=="area"&&t.xzqCode.length<=6||e=="town"&&t.xzqCode.length<=9)&&(i=!0),this.widgetInfo.config.allowDrill&&i&&t&&t.geojsonEcharts&&t.geojsonEcharts!=""&&(this.regionParent.code=t.parentCode,this.regionParent.name=t.parentName,this.widgetInfo.config.regionCode=t.xzqCode,this.loadInfo())},ignoreGraphic(){let t=this.widgetInfo.config.graphic.style.showArea;return this.currentRegion.id=="china"?!0:t=="province"&&this.currentRegion.id.length>2?this.getIgnoreGraphic():t=="city"&&this.currentRegion.id.length>4?this.getIgnoreGraphic():t=="area"&&this.currentRegion.id.length>6?this.getIgnoreGraphic():t=="town"&&this.currentRegion.id.length>9?this.getIgnoreGraphic():t==null||t==""?this.getIgnoreGraphic():!0},getIgnoreGraphic(){return this.regionParent.code&&this.regionParent.code!=""?this.identical=!1:this.identical=!0,!this.widgetInfo.config.allowDrill||this.identical},getImageUrl(t){if(t&&t!=="")return w.appendImageBaseURL(t)}}},T=H,F=r(768141),$=(0,F.Z)(T,g,f,!1,null,"21ccc086",null),j=$.exports}}]);
