"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[2460],{59738:function(Z,h,o){o.d(h,{OW:function(){return g},m3:function(){return F},nm:function(){return m},vP:function(){return d},xC:function(){return v}});var p=o(53258);function g(t,n,l){let e=t;const s=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find(f=>(0,p.mf)(e[f]));if(!(0,p.mf)(e[s]))return!1;do{if(e[s](n))return!0;if(e===l)return!1;e=e.parentNode}while(e);return!1}function m(t){const n=window.getComputedStyle(t);return[parseFloat(n.getPropertyValue("width"),10),parseFloat(n.getPropertyValue("height"),10)]}function d(t,n,l){t&&(t.attachEvent?t.attachEvent("on"+n,l):t.addEventListener?t.addEventListener(n,l,!0):t["on"+n]=l)}function v(t,n,l){t&&(t.detachEvent?t.detachEvent("on"+n,l):t.removeEventListener?t.removeEventListener(n,l,!0):t["on"+n]=null)}function F(t,n,l,e){var s=0,f=setInterval(()=>{s<l?(s++,t()):(clearInterval(f),e&&e())},n);return f}},53258:function(Z,h,o){o.d(h,{ew:function(){return d},le:function(){return v},mf:function(){return p},sg:function(){return F},xn:function(){return g}});function p(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Function]"}function g(t,n,l,e=1){const s=Math.round(n/e/t[0])*t[0],f=Math.round(l/e/t[1])*t[1];return[s,f]}function m(t){const n=t.getBoundingClientRect();return[parseInt(n.width),parseInt(n.height)]}function d(t,n,l){return t-n-l}function v(t,n,l){return t-n-l}function F(t,n,l){return n!==null&&t<n?n:l!==null&&l<t?l:t}},44513:function(Z,h,o){o.d(h,{Z:function(){return n}});var p=function(){var e=this,s=e._self._c;return e.attr.buttonHide?s("div",{style:{position:"absolute",right:e.attr.buttonHideRight+"px",top:e.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(f){return e.onHide()}}},[e.openTooltip?s("el-tooltip",{attrs:{"open-delay":1e3,content:e.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[s("el-button",{class:e.attr.buttonHideIconClass&&e.attr.buttonHideIconClass!=""?e.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:e.attr.buttonHideColor,fontSize:e.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):s("el-button",{class:e.attr.buttonHideIconClass&&e.attr.buttonHideIconClass!=""?e.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:e.attr.buttonHideColor,fontSize:e.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):e._e()},g=[],m=o(52246),d={props:["attr"],name:"hide-button",data(){return{isPc:m.b}},computed:{openTooltip:function(){let l=!1,e=this.attr.buttonHideTooltipContent;return m.b&&e&&e!=null&&e.trim()!=""&&(l=!0),l}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},v=d,F=o(68141),t=(0,F.Z)(v,p,g,!1,null,"bf399b9a",null),n=t.exports},42460:function(Z,h,o){o.r(h),o.d(h,{default:function(){return T}});var p=function(){var i=this,r=i._self._c;return r("div",{directives:[{name:"show",rawName:"v-show",value:i.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"gisBase",staticClass:"my-gisBase",style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[r("hide-button",{attrs:{attr:i.widgetInfo.attr}})],1)},g=[],m=o(44513),d=o(27966),v=o(29340),F=o(45061),t=o(26711),n=o(86892),l=o(37564),e=o(76094),s=o(82571),f=o(60316),c=o(68640),w=o(23230),S=o(5689),L=o(13798),k=o(13811),C=o(2487),M=o(72449),H=o(59738),y=o(49500),E={name:"GisXmlocation",components:{HideButton:m.Z},mixins:[v.u,n.D,F.u,t.H],props:["widgetInfo"],data(){return{timer:"",map:null,iconLayer:null,blockLayer:null,solutionStyle:null,solution1Style:null,solution2Style:null,highlightStyle:null,normalStyle:null,blockSource:null,solutionSource:null,solutionLayer:null,currentBlockId:null,solutionFeature:null,blockFeature:null}},watch:{},beforeDestroy(){},mounted(){this.initAction(this.widgetInfo),this.timer=(0,H.m3)(this.getBindMap,500,50,()=>{y.error("gis-xmlocation\u7EC4\u4EF6getBindMap\u7ED1\u5B9A\u8D85\u65F6")})},methods:{loadInfo(a){y.log(a)},reLoadInfo(a){y.log("\u914D\u7F6E\u66F4\u65B0\u4E86"),this.loadInfo(a)},initAction(a){this.registerAction(a,"configMap","mapList",this.doConfigMap);let i=this;d.Z.$on("searchBlock",r=>{i.initBlockLayer()}),d.Z.$on("locateBlock",r=>{i.locateBlock(r)}),d.Z.$on("showSolution",r=>{i.showSolution(r)}),this.actionReceive(a)},initBlockLayer(){this.blockLayer&&this.map.removeLayer(this.blockLayer),this.solutionLayer&&this.map.removeLayer(this.solutionLayer),this.iconLayer&&this.map.removeLayer(this.iconLayer);let a=[];var i=new s.ZP({image:new f.Z({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"xmlocation/locate.png"})}),r=new k.Z({geometry:new L.Z([120.57081369709772,30.599520021203983]),name:"\u5730\u57571",population:4e3,rainfall:500});r.setStyle(i);var u=new k.Z({geometry:new L.Z([120.59287885888347,30.643132218627763]),name:"\u5730\u57572",population:4e3,rainfall:500});u.setStyle(i);var I=new k.Z({geometry:new L.Z([120.59109639854998,30.611971580883083]),name:"\u5730\u57573",population:4e3,rainfall:500});I.setStyle(i),a.push(r),a.push(u),a.push(I);var b=new C.default({features:a});this.highlightStyle=new s.ZP({fill:new c.Z({color:"rgba(	0,255,255, 0.3)"}),stroke:new w.Z({color:"#00FA9A",width:1.5}),image:new S.Z({radius:7,fill:new c.Z({color:"#ffcc33"})})}),this.normalStyle=new s.ZP({fill:new c.Z({color:"rgba(	255,0,0, 0.3)"}),stroke:new w.Z({color:"#FF0000",width:1.5}),image:new S.Z({radius:7,fill:new c.Z({color:"#ffcc33"})})}),this.solutionStyle=new s.ZP({fill:new c.Z({color:"rgba(	255,0,0, 0.0)"}),stroke:new w.Z({color:"rgba(	255,0,0, 0.0)",width:1}),image:new S.Z({radius:7,fill:new c.Z({color:"#ffcc33"})})}),this.solution1Style=new s.ZP({fill:new c.Z({color:"rgba(255,255,0, 0.2)"}),stroke:new w.Z({color:"#FFFF00",width:1.5}),image:new S.Z({radius:7,fill:new c.Z({color:"#ffcc33"})})}),this.solution2Style=new s.ZP({fill:new c.Z({color:"rgba(255,0,0, 0.2)"}),stroke:new w.Z({color:"#FF0000",width:1.5}),image:new S.Z({radius:7,fill:new c.Z({color:"#ffcc33"})})});let x={type:"FeatureCollection",name:"block",crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::4490"}},features:[{type:"Feature",properties:{Key:"FID",Value:"0"},geometry:{type:"MultiPolygon",coordinates:[[[[120.56955207106705,30.597881454202366],[120.56939113852616,30.597881454202366],[120.56970227477177,30.600874799462872],[120.57204116103287,30.600971358987522],[120.57235229727848,30.59877194759531],[120.5714188885413,30.598374980661163],[120.57059276816483,30.598149675103855],[120.56993830916508,30.59794582721878],[120.56955207106705,30.597881454202366]]]]}},{type:"Feature",properties:{Key:"FID",Value:"3"},geometry:{type:"MultiPolygon",coordinates:[[[[120.59447785572843,30.641418852214088],[120.59321185307351,30.641139902476482],[120.59188147740201,30.641247190837078],[120.59186001972989,30.641547598246802],[120.59196730809049,30.641933836344833],[120.59173127369729,30.642534651164226],[120.59065839009133,30.64296380460661],[120.59087296681253,30.64463750303196],[120.594198905991,30.644980825785865],[120.59424182133512,30.644916452769394],[120.59482117848245,30.642362989787216],[120.59447785572843,30.641418852214088]]]]}},{type:"Feature",properties:{Key:"FID",Value:"6"},geometry:{type:"MultiPolygon",coordinates:[[[[120.59154842293606,30.613143826075316],[120.59205267823086,30.610965872355223],[120.59028242028103,30.611040974207754],[120.59038970864162,30.611985111780882],[120.59033606446133,30.61300435120654],[120.59034679329739,30.612982893534422],[120.59154842293606,30.613143826075316]]]]}}]};this.blockSource=new C.default({features:new l.default().readFeatures(x)}),this.blockLayer=new M.default({source:this.blockSource,style:this.normalStyle,zIndex:99}),this.map.addLayer(this.blockLayer);let P={type:"FeatureCollection",name:"solution",crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::4490"}},features:[{type:"Feature",properties:{Key:"FID",Value:"1"},geometry:{type:"MultiPolygon",coordinates:[[[[120.57378637405759,30.599479047825582],[120.5723594389467,30.598773337204136],[120.57203968172553,30.600977850281254],[120.57345646251349,30.60159103273611],[120.5739687642706,30.599811641743543],[120.57378637405759,30.599479047825582]]]]}},{type:"Feature",properties:{Key:"FID",Value:"2"},geometry:{type:"MultiPolygon",coordinates:[[[[120.5683951341714,30.59774376749749],[120.56768703099146,30.59770085215331],[120.56735443707385,30.59774376749749],[120.56729006405726,30.59780277609582],[120.56760656472102,30.598092454669427],[120.56853997345831,30.59914924502135],[120.56968741535911,30.60090732118067],[120.56968795879959,30.600906092027003],[120.56938486883564,30.59788055998183],[120.5683951341714,30.59774376749749]]]]}},{type:"Feature",properties:{Key:"FID",Value:"4"},geometry:{type:"MultiPolygon",coordinates:[[[[120.5944837739346,30.641416256736136],[120.59423701070523,30.640279000113765],[120.59178010724747,30.64048821241687],[120.59187666677212,30.641196315596858],[120.59188739560807,30.641249959777156],[120.5932070424434,30.64113730699853],[120.5944837739346,30.641416256736136]]]]}},{type:"Feature",properties:{Key:"FID",Value:"5"},geometry:{type:"MultiPolygon",coordinates:[[[[120.59419357315596,30.64498046149629],[120.59087299839575,30.64466396083253],[120.5908998204859,30.645237953561605],[120.59161865250167,30.64551153888118],[120.59410237804957,30.64571002234834],[120.59419357315596,30.64498046149629]]]]}},{type:"Feature",properties:{Key:"FID",Value:"7"},geometry:{type:"MultiPolygon",coordinates:[[[[120.59155110430368,30.613143450439622],[120.59034411263838,30.61298788262502],[120.59033606602736,30.613002634745442],[120.59026364397653,30.613299018594432],[120.59148673128732,30.613540417405773],[120.59155110430368,30.613143450439622]]]]}},{type:"Feature",properties:{Key:"FID",Value:"8"},geometry:{type:"MultiPolygon",coordinates:[[[[120.59038433976309,30.611962270344748],[120.58968160100119,30.611817431058057],[120.58967355465586,30.61294664098415],[120.59033337676613,30.61299223844702],[120.59038433976309,30.611962270344748]]]]}}]};this.solutionSource=new C.default({features:new l.default().readFeatures(P)}),this.solutionLayer=new M.default({source:this.solutionSource,style:this.solutionStyle,zIndex:99}),this.map.addLayer(this.solutionLayer),this.iconLayer=new M.default({source:b,zIndex:99}),this.map.addLayer(this.iconLayer)},locateBlock(a){this.solutionFeature&&this.solutionFeature.setStyle(this.solutionStyle),this.blockFeature&&this.blockFeature.setStyle(this.normalStyle);let i=this.blockSource.getFeatures();for(var r=0;r<i.length;r++)if(i[r].get("Value")===a.id){this.blockFeature=i[r],this.currentBlockId=a.id;break}this.blockFeature.setStyle(this.highlightStyle);let u=this.map.getView().getResolutionForExtent(this.blockFeature.getGeometry().getExtent());this.map.getView().animate({center:(0,e.getCenter)(this.blockFeature.getGeometry().getExtent()),resolution:u}),this.flyTo((0,e.getCenter)(this.blockFeature.getGeometry().getExtent()),function(){})},flyTo(a,i){var r=2e3;let u=this.map.getView();var I=15,b=2,x=!1;function P(B){--b,!x&&(b===0||!B)&&(x=!0,i(B))}u.setCenter(a),u.animate({zoom:I-1,duration:r/2},{zoom:I,duration:r/2},P)},showSolution(a){let i=this.solutionSource.getFeatures();if(a.solution1==!0){let u=parseInt(this.currentBlockId)+1;for(var r=0;r<i.length;r++)if(i[r].get("Value")===u.toString()){this.solutionFeature=i[r];break}this.solutionFeature.setStyle(this.solution1Style)}else{let u=parseInt(this.currentBlockId)+2;for(var r=0;r<i.length;r++)if(i[r].get("Value")===u.toString()){this.solutionFeature=i[r];break}this.solutionFeature.setStyle(this.solution2Style)}},getBindMap(){if(typeof this.widgetInfo.action.gisMapId<"u"){y.log(this.widgetInfo.action.gisMapId);let a=this.getWidgetObject(this.widgetInfo.action.gisMapId);if(a){clearInterval(this.timer);let i=a.$refs.gismap;i&&(this.map=i.map)}}},doConfigMap(a,i,r){let u=i[r];y.info("======xmlocation get map========="),y.info(a),y.info(u),this.map=u,y.info("===============")}}},V=E,z=o(68141),D=(0,z.Z)(V,p,g,!1,null,"5af85dbe",null),T=D.exports}}]);
