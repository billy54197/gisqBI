"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[36192],{56279:function(w,h,s){s.d(h,{P:function(){return r}});var c=s(386892),f=s(149500);const r={mixins:[c.D],created(){},methods:{lifecycleBeforeChartsLoad(g){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&f.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let m=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[g]);if(m)return m}return g},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&f.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},833264:function(w,h,s){s.d(h,{t:function(){return r}});var c=s(470709),f=s(321300);const r={created(){},methods:{getConfigForPublic(g){return(0,c.M0)("/visual/boardPublish/getConfigForPublic",g)},savePublicWidgetDataApi(g){return(0,c.M0)("/visual/boardPublish/savePublicWidgetData",g)},getAggregateDataEx(g){return(0,c.M0)("/dashboard/editor/getAggregateDataEx",(0,f.enc)(g))},getDataLocalByDatalocalId(g){return(0,c.xV)("/data/local/getDataLocalByDatalocalId/"+g)},getAggregateDataForExcel(g){return(0,c.Fb)("/dashboard/editor/getAggregateDataForExcel",(0,f.enc)(g))}}}},752246:function(w,h,s){s.d(h,{X:function(){return c},b:function(){return f}});let c={versions:function(){var r=navigator.userAgent;return{trident:r.indexOf("Trident")>-1,presto:r.indexOf("Presto")>-1,webKit:r.indexOf("AppleWebKit")>-1,gecko:r.indexOf("Gecko")>-1&&r.indexOf("KHTML")==-1,mobile:!!r.match(/AppleWebKit.*Mobile.*/),ios:!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:r.indexOf("Android")>-1,iPhone:r.indexOf("iPhone")>-1,iPad:r.indexOf("iPad")>-1,webApp:r.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},f;c.versions.mobile||c.versions.ios||c.versions.android||c.versions.iPhone||c.versions.iPad?f=!1:f=!0},844513:function(w,h,s){s.d(h,{Z:function(){return y}});var c=function(){var l=this,u=l._self._c;return l.attr.buttonHide?u("div",{style:{position:"absolute",right:l.attr.buttonHideRight+"px",top:l.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(C){return l.onHide()}}},[l.openTooltip?u("el-tooltip",{attrs:{"open-delay":1e3,content:l.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[u("el-button",{class:l.attr.buttonHideIconClass&&l.attr.buttonHideIconClass!=""?l.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:l.attr.buttonHideColor,fontSize:l.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):u("el-button",{class:l.attr.buttonHideIconClass&&l.attr.buttonHideIconClass!=""?l.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:l.attr.buttonHideColor,fontSize:l.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):l._e()},f=[],r=s(752246),g={props:["attr"],name:"hide-button",data(){return{isPc:r.b}},computed:{openTooltip:function(){let b=!1,l=this.attr.buttonHideTooltipContent;return r.b&&l&&l!=null&&l.trim()!=""&&(b=!0),b}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},v=g,m=s(768141),I=(0,m.Z)(v,c,f,!1,null,"bf399b9a",null),y=I.exports},136192:function(w,h,s){s.r(h),s.d(h,{default:function(){return A}});var c=function(){var t=this,a=t._self._c;return a("div",{style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.h+"px",overflow:"hidden"},attrs:{id:`tree_select_${t.widgetInfo.id}`}},[a("hide-button",{attrs:{attr:t.widgetInfo.attr}}),a("div",[a("span",{staticClass:"tree_select_label"},[t._v(" "+t._s(t.widgetInfo.config.part.label.text)+" ")]),a("div",{ref:"treeSelect",style:{display:"inline-block",float:"left"}},[a("treeselect",{ref:"vueTreeselect",attrs:{id:"treeselect_"+t.widgetInfo.id,"append-to-body":!0,clearable:t.widgetInfo.config.part.option.clearable,"clear-value-text":t.widgetInfo.config.part.option.clearValueText,"default-expand-level":t.widgetInfo.config.part.option.defaultExpandLevel,"disable-branch-nodes":t.widgetInfo.config.part.option.disableBranchNodes,disabled:t.widgetInfo.config.part.option.disabled,"no-results-text":t.widgetInfo.config.part.option.noResultsText,placeholder:t.widgetInfo.config.part.option.placeholder,searchable:t.widgetInfo.config.part.option.searchable,"search-nested":t.widgetInfo.config.part.option.searchNested,"show-count":t.widgetInfo.config.part.option.showCount,"show-count-of":t.widgetInfo.config.part.option.showCountOf,"show-count-on-search":t.widgetInfo.config.part.option.showCountOnSearch,multiple:t.widgetInfo.config.part.option.multiple,limit:t.widgetInfo.config.part.option.limit,"clear-on-select":t.widgetInfo.config.part.option.clearOnSelect,"close-on-select":t.widgetInfo.config.part.option.closeOnSelect,"clear-all-text":t.widgetInfo.config.part.option.clearAllText,"sort-value-by":t.widgetInfo.config.part.option.sortValueBy,"value-consists-of":t.widgetInfo.config.part.option.valueConsistsOf,flat:t.widgetInfo.config.part.option.flat,"loading-text":t.widgetInfo.config.part.option.loadingText,"no-children-text":t.widgetInfo.config.part.option.noChildrenText,"load-options":t.loadOptions,options:t.treeSelectData},on:{close:t.closeEvent,open:t.openEvent},model:{value:t.selectValue,callback:function(e){t.selectValue=e},expression:"selectValue"}})],1)])],1)},f=[],r=s(844513),g=s(445061),v=s(126711),m=s(56279),I=s(275345),y=s.n(I),b=s(555616),l=s(42160),u=s(113067),C=s(833264),T=s(148836),P=s(927966),D=s(364803),F=s(67157);const L={mixins:[F.c],data(){return{config_extend:{config:{part:{label:{paddingLeft:8,marginTop:5},select:{color:"#616266",fontSize:14,fontFamily:"alibabaPuHuiTiRegular",borderColor:"#DCDFE5",borderRadius:4,textAlign:"left",paddingTop:0,background:"#FFFFFF"}}}},filter_config:{part:{label:{fontFamily:"alibabaPuHuiTiRegular",color:"#616266"},select:{dropBackground:null,color:"#616266",fontFamily:"alibabaPuHuiTiRegular",borderColor:"#DCDFE5",background:""}}}}},methods:{filterPredefineColoursSchemeConfig(i,t){this.getNewConfigWithArrary(i,t,this.filter_config)}}};var x=s(321300),$=s(149500),_={name:"TreeSelect",components:{HideButton:r.Z,Treeselect:y()},mixins:[g.u,v.H,m.P,C.t,D.baseConfig,L],props:["widgetInfo"],data(){return{treeSelectData:[],selectValue:null}},computed:{...(0,T.Se)(["viewType","getCanvasSettingInfo"]),canvasSetting(){return this.getCanvasSettingInfo}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)},"widgetInfo.config":{deep:!0,handler:function(){this.setStyle(this.widgetInfo)}}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},methods:{loadInfo(i){this.treeSelectData=this.getTreeData(i.dataset[i.dataset.type].encode,i.dataset[i.dataset.type].dimensions,i.dataset[i.dataset.type].source),this.setStyle(i),this.$nextTick(()=>{this.selectValue=this.getSelectValue(i)}),this.lifecycleAfterLoad()},setStyle(i){let t=this.getCssString(i);t+=this.getLabelCssString(i);let a=`css_widget_${i.id}`,e=document.getElementById(a);e?e.innerHTML=t:(e=document.createElement("style"),e.id=a,e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e))},getCssString(i){let t=this.widgetInfo.config.part.select,a="",e={};e.width=this.mUtils.getNewPxW(t.width)+"px",e.height=this.mUtils.getNewPxH(t.height)+"px",e.borderRadius=t.borderRadius+"px",e.background=t.background,e.borderColor=t.borderColor,e.borderWidth=`${t.borderTop}px ${t.borderRight}px ${t.borderBottom}px ${t.borderLeft}px`,e.fontSize=this.mUtils.getNewFontSize(t.fontSize)+"px",e.lineHeight=this.mUtils.getNewPxH(t.height)+"px",e.color=t.color,a+=`#tree_select_${i.id} .vue-treeselect__control {
                     ${this.mUtils.style2CSSStr(e)};
                     ${this.getCustomCss(t.customSelectCss)}
                 }
                 `;let o={};o.paddingLeft=this.mUtils.getNewPxW(t.paddingLeft)+"px",o.paddingTop=this.mUtils.getNewPxH(t.paddingTop)+"px",o.color=t.color,o.fontSize=this.mUtils.getNewFontSize(t.fontSize)+"px",o.fontFamily=t.fontFamily,o.textAlign=t.textAlign,o.lineHeight=e.height,a+=`#tree_select_${i.id} .vue-treeselect__placeholder, .vue-treeselect__single-value, .vue-treeselect__multi-value, .vue-treeselect__multi-value-label {
                    ${this.mUtils.style2CSSStr(o)};
                }
                `;let n=this.$refs.vueTreeselect.getInstanceId();t.customDropItemActiveCss&&(a+=`div[data-instance-id='${n}'] .vue-treeselect__option--selected {
                      ${this.getCustomCss(t.customDropItemActiveCss)}
                }
                `),t.customDropItemHoverCss&&(a+=`div[data-instance-id='${n}'] .vue-treeselect__option--highlight:hover,
                div[data-instance-id='${n}'] .vue-treeselect__option--highlight:hover {
                    ${this.getCustomCss(t.customDropItemHoverCss)}
                }
                `),t.customDropItemCss&&(a+=`div[data-instance-id='${n}'] .vue-treeselect__option {
                    ${this.getCustomCss(t.customDropItemHoverCss)}
                }
                `);let d={};return t.dropWidth&&(d.width=this.mUtils.getNewFontSize(t.dropWidth,i.attr.lockedW)+"px"),t.dropBackgroundImage&&(d.backgroundImage=`url(${this.mUtils.appendImageBaseURL(t.dropBackgroundImage)})`),t.dropColor&&(d.color=t.dropColor),t.dropFontFamily&&(d.fontFamily=t.dropFontFamily),t.dropFontSize&&(d.fontSize=this.mUtils.getNewFontSize(t.dropFontSize)+"px"),t.dropBackground&&(d.backgroundColor=t.dropBackground),a+=` div[data-instance-id='${n}'] .vue-treeselect__menu {
                        ${this.mUtils.style2CSSStr(d)};
                        ${this.getCustomCss(t.customDropCss)}
                        }
                        `,a},getLabelCssString:function(i){let t;if(i.config.part.label.show){let a=i.config.part.label.width,e=i.config.part.label.height;i.config.part.label.paddingLeft&&(a=a-i.config.part.label.paddingLeft),i.config.part.label.marginTop&&(e=e-i.config.part.label.marginTop),t={display:"inline-block",width:this.mUtils.getNewPxW(a)+"px",height:this.mUtils.getNewPxH(e)+"px",lineHeight:this.mUtils.getNewPxH(e)+"px",paddingLeft:this.mUtils.getNewPxW(i.config.part.label.paddingLeft)+"px",marginTop:this.mUtils.getNewPxH(i.config.part.label.marginTop)+"px",fontSize:this.mUtils.getNewFontSize(i.config.part.label.fontSize)+"px",fontFamily:i.config.part.label.fontFamily,color:i.config.part.label.color,textAlign:i.config.part.label.textAlign}}else t={display:"none"};return`
                #tree_select_${i.id} .tree_select_label {
                    ${x.style2CSSStr(t)};
                    ${this.getCustomCss(i.config.part.label.customCss)}
                }`},resize(){this.setStyle(this.widgetInfo)},reLoadInfo(i){this.loadInfo(i)},initAction(i){i.action&&i.action.receive&&i.action.receive.replaceFirstPid&&i.action.receive.replaceFirstPid.enabled&&this.doReplaceFirstPid(i.action.receive.replaceFirstPid,i),this.actionReceive(i)},doReplaceFirstPid(i,t){this.$$lib__.each(i.replaceList,a=>{let e=a[0][1]+"_"+a[0][0];a[0][1].indexOf("_")>-1&&(e=a[0][1]),P.Z.$on(e,o=>{let n=a[0][2],d=n.indexOf("|");d>-1&&(n=a[0][2].substring(d+1)),t.action.receive.replaceFirstPid.script&&t.action.receive.replaceFirstPid.script.enabled&&($.log("Execute the script to"+i.name+" to the "+t.name+" component"),this.replaceFirstPid=new Function("info","data","param_key",t.action.receive.replaceFirstPid.script.content)),this.replaceFirstPid(t,o,n)})})},replaceFirstPid(i,t,a){this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode.firstPid=t[a],this.loadInfo(this.widgetInfo),this.selectValue=null},openEvent(i){this.widgetInfo.config.part.option.closeOnMouseLeave&&this.$nextTick(function(){this.autoCloseSelected=!0;let t=this.$refs.vueTreeselect,a=t.getInstanceId();document.querySelector(`.vue-treeselect[data-instance-id="${a}"] .vue-treeselect__menu`).addEventListener("mouseleave",function(){setTimeout(function(){t.closeMenu()},200)})})},closeEvent(i){if(i==null)return;let t=this,a=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(a,e=>{if(e.enabled&&e.code==t.$$global_editor.actionType.change.code){let o=t.$$global_editor.actionType.change.code+"_"+t.widgetInfo.id,n=this.getActionParam(i,e);if(e.script&&e.script.enabled){if($.log("Execute script for "+this.widgetInfo.name+" component to "+e.name+" component"),e.script.content==""){b.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",e.script.content),n=this.customScript(n)}P.Z.$emit(o,n),e.postMessage&&this.doPostMessage(n),this.actionNameList.push(o)}}),setTimeout(()=>{this.setStyle()},1)},getActionParam(i,t){let a={value:i};return t.paramsExtend&&t.paramsExtend.length>0&&this.$$lib__.each(t.paramsExtend,e=>{if(e.type==this.$$global_editor.dataSourcType.static.code&&e.fieldS&&e.fieldS!="")l.default.set(a,e.fieldS,e.value);else if(e.type=="global"&&e.fieldG!=""){let o=this.getGlobalParamsVaule(e.fieldG);l.default.set(a,e.fieldG,o)}else if((e.type==this.$$global_editor.dataSourcType.dynamic.code||e.type==this.$$global_editor.dataSourcType.local.code)&&e.fieldD!="")if(i instanceof Array&&i.length>0){let o=[];for(let n=0;n<i.length;n++)o.push(this.getParamValue(i[n],e.fieldD));l.default.set(a,e.fieldD,o)}else l.default.set(a,e.fieldD,this.getParamValue(i,e.fieldD))}),a},getParamValue(i,t){let a=null,e=-1,o=-1,n=this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode,d=this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions,S=this.widgetInfo.dataset[this.widgetInfo.dataset.type].source;for(let p=0;p<d.length;p++)d[p]==n.id&&(e=p),d[p]==t&&(o=p);if(e>-1&&o>-1)for(let p=0;p<S.length;p++)S[p][e]==i&&(a=S[p][o]);return a},loadOptions({action:i,parentNode:t,callback:a}){let e=this;if((!e.widgetInfo.config.part.option.parentParams||e.widgetInfo.config.part.option.parentParams=="")&&b.Message.warning("\u672A\u9009\u62E9\u7236\u8282\u70B9\u53C2\u6570"),i===I.LOAD_CHILDREN_OPTIONS&&e.widgetInfo.config.part.option.delayedLoading){let o=e.replaceParentParams(t.id,e.widgetInfo.config.part.option.parentParams,e.widgetInfo.dataset[e.widgetInfo.dataset.type]);switch(this.viewType){case this.$$global.editType.original.code:u.o.getAggregateDataEx(o).then(n=>{if(n&&n.status==200){let d=this.listToObj(e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions,n.data.data);t.children=this.handleDataList(d,e.widgetInfo.dataset[e.widgetInfo.dataset.type].encode),a()}else a(new Error(n.msg))});break;case this.$$global.editType.public.code:this.getAggregateDataEx(o).then(n=>{if(n&&n.status==200){let d=this.listToObj(e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions,n.data.data);t.children=this.handleDataList(d,e.widgetInfo.dataset[e.widgetInfo.dataset.type].encode),a()}else a(new Error(n.msg))});break;default:u.o.getAggregateDataEx(o).then(n=>{if(n&&n.status==200){let d=this.listToObj(e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions,n.data.data);t.children=this.handleDataList(d,e.widgetInfo.dataset[e.widgetInfo.dataset.type].encode),a()}else a(new Error(n.msg))})}}},replaceParentParams(i,t,a){return a&&a.query&&a.query.params&&a.query.params.length>0&&this.$$lib__.each(a.query.params,e=>{e.name&&e.name==t&&(e.defaultVal=i)}),a.source=[],{dataSet:JSON.stringify(a)}},getTreeData(i,t,a){let e=[];if(i.id&&i.pid&&i.label){let o=this.listToObj(t,a);if(o.length==0)return e;this.widgetInfo.config.part.option.delayedLoading?e=this.handleDataList(o,i):e=this.handleDataTree(o,i)}return e},listToObj(i,t){let a=[];for(let e=0;e<t.length;e++){let o={};for(let n=0;n<i.length;n++)l.default.set(o,i[n],t[e][n]);a.push(JSON.parse(JSON.stringify(o)))}return a},handleDataList(i,t){let a=[];return this.$$lib__.each(i,e=>{e.id=e[t.id],e.label=e[t.label],e.children=null,this.$$lib__.isUndefined(e[t.disabled])||(e.isDisabled=x.stringToBoolean(e[t.disabled])),a.push(JSON.parse(JSON.stringify(e)))}),a},handleDataTree(i,t){let a={},e=[];return this.$$lib__.each(i,o=>{o.id=o[t.id],o.label=o[t.label],this.$$lib__.isUndefined(o[t.disabled])||(o.isDisabled=x.stringToBoolean(o[t.disabled])),o[t.pid]!=null&&o[t.pid]!=""&&o[t.pid]!=t.firstPid?(a[o[t.pid]]||(a[o[t.pid]]=[]),a[o[t.pid]].push(o)):e.push(o)}),this.transferFl(e,a,t.id),JSON.parse(JSON.stringify(e))},transferFl(i,t,a){this.$$lib__.each(i,e=>{let o=t[e[a]];o&&(e.children=o,this.transferFl(o,t,a))})},getValue(){return this.selectValue},getGlobalParams(i){let t;return this.$$lib__.each(this.canvasSetting.data.globalParams.params,(a,e)=>{i.split("globalParams_")[1]==e&&(t=a)}),t},getSelectValue(i){let t=null,a=i.dataset[i.dataset.type].encode.defaultValType,e=i.dataset[i.dataset.type].encode.defaultVal,o=i.dataset[i.dataset.type].encode.defaultParams;this.treeSelectData.length>0&&(a=="static"&&e&&e!=""?t=e:(a=="dynamic"||a=="local")&&o&&o!=""?t=this.getGlobalParams(o):a=="first"&&(i.config.part.option.disableBranchNodes?t=this.getFirstTreeNode(this.treeSelectData):t=this.treeSelectData[0].id));let n=null;return this.widgetInfo.config.part.option.multiple?(n=[],t&&t.split(",").length>1?n=t.split(","):t&&n.push(t)):n=t,n},getFirstTreeNode(i){let t=null;return i.length>0&&(i[0].children&&i[0].children.length>0?t=this.getFirstTreeNode(i[0].children):t=i[0].id),t},getCustomCss(i){return i?(i.indexOf(".cls")>-1&&(i=i.replace(".cls","").replace(".cls","").replace("{","").replace("}","")),i):""}}},O=_,H=s(768141),E=(0,H.Z)(O,c,f,!1,null,"3716b7fe",null),A=E.exports}}]);
