"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[14543],{414543:function(l,s,a){a.r(s),a.d(s,{default:function(){return b}});var m=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"form",attrs:{model:e.currentWidget.dataset.props,size:"mini","label-width":"80px"}},[t("el-form-item",{attrs:{label:"\u5728\u7EBF\u8868\u5355"}},[t("el-row",{staticClass:"form_config"},[t("el-input",{staticClass:"chioceForm",attrs:{"suffix-icon":e.formDialogVisible?"el-icon-arrow-up":"el-icon-arrow-down",placeholder:"\u8BF7\u9009\u62E9\u5728\u7EBF\u8868\u5355",readonly:""},nativeOn:{click:function(r){return e.chioceForm.apply(null,arguments)}},model:{value:e.currentWidget.dataset.props.formName,callback:function(r){e.$set(e.currentWidget.dataset.props,"formName",r)},expression:"currentWidget.dataset.props.formName"}}),t("el-tooltip",{attrs:{content:"\u6DFB\u52A0\u5728\u7EBF\u8868\u5355","open-delay":300,effect:"dark",placement:"top"}},[t("el-button",{attrs:{type:"text"},on:{click:e.addForm}},[t("i",{staticClass:"iconfont bi_add1",staticStyle:{"margin-left":"5px",color:"#67c23a"}})])],1),t("el-tooltip",{attrs:{content:"\u8BBE\u8BA1\u5728\u7EBF\u8868\u5355","open-delay":300,effect:"dark",placement:"top"}},[t("el-button",{attrs:{type:"text"},on:{click:e.designForm}},[t("i",{staticClass:"iconfont bi_design"})])],1)],1)],1)],1),t("el-dialog",{ref:"treeAppendDialog",attrs:{"append-to-body":"","close-on-click-modal":!1,visible:e.formDialogVisible,title:"\u9009\u62E9\u5728\u7EBF\u8868\u5355",width:"80vw","custom-class":"select_form_dialog",top:"3vh",height:"70vh"},on:{"update:visible":function(r){e.formDialogVisible=r}}},[t("el-container",[t("el-aside",{attrs:{width:"250px"}},[t("div",{staticClass:"data-tree menu"},[t("el-tree",{ref:"ElTree",attrs:{data:e.treeList,props:e.defaultProps,"default-expanded-keys":[e.defaultGroupId],"current-node-key":e.defaultGroupId,"expand-on-click-node":!1,"node-key":"groupId","highlight-current":""},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:r}){return t("div",{staticClass:"custom-tree-node"},[t("span",[t("i",{staticClass:"iconfont bi_form",staticStyle:{color:"#467cf3"}}),e._v(" "+e._s(r.label)+" ")])])}}])})],1)]),t("el-container",{staticClass:"card-form"},[t("div",{staticClass:"search-form"},[t("el-input",{staticStyle:{width:"400px"},attrs:{size:"small",placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5185\u5BB9","auto-complete":"off","suffix-icon":"el-icon-search",clearable:""},on:{input:e.newSearch},model:{value:e.keyword,callback:function(r){e.keyword=r},expression:"keyword"}})],1),t("el-main",[e.formList.length?t("div",{staticClass:"card-container small"},[e._l(e.formList,function(r){return t("el-card",{key:r.formId,class:{select:e.dialogFormCode===r.formCode,"my-card-content":!0},nativeOn:{click:function(I){return e.selectCard(r)}}},[t("div",{staticClass:"clearfix"},[t("span",{staticClass:"span-weight"},[e._v(e._s(r.formName))])]),t("div",{staticClass:"imgCard mini"},[t("div",{staticClass:"img mini"},[t("div",{style:e.setBackground(r)})]),t("div",{staticClass:"imgMask mini"})])])}),e._l(5,function(r){return t("div",{key:r+"supp",staticClass:"my-card-supp"})})],2):t("div",{staticClass:"empty-text"},[t("span",[e._v(" \u6682\u65E0\u6570\u636E ")])])])],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.formClose}},[e._v("\u53D6\u6D88")]),t("el-button",{staticStyle:{background:"rgb(85, 124, 236)",color:"rgb(255, 255, 255)"},attrs:{size:"mini",type:"primary"},on:{click:e.formDefine}},[e._v(" \u786E\u5B9A ")])],1)],1),t("el-dialog",{ref:"addFormDialog",staticClass:"dialog-publish",attrs:{"append-to-body":"",visible:e.addFormVisible,"close-on-click-modal":!1,title:"\u6DFB\u52A0\u5728\u7EBF\u8868\u5355","custom-class":"add_form_dialog",width:"500px"},on:{"update:visible":function(r){e.addFormVisible=r}}},[t("el-form",{ref:"addform",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"90px"}},[t("el-form-item",{attrs:{label:"\u8868\u5355\u5206\u7EC4",prop:"groupName"}},[t("el-select",{ref:"refSelect",staticClass:"white-bgc",attrs:{value:e.formData.groupName,"popper-class":"gisq-form-select","popper-append-to-body":!1,placeholder:"\u8BF7\u9009\u62E9\u8868\u5355\u5206\u7EC4\u540D\u79F0","allow-create":"",filterable:"","default-first-option":""},on:{"visible-change":e.visibleChange,change:e.selectChange}},[t("el-option",{staticStyle:{height:"auto"},attrs:{value:e.formData.groupId||"groupId",label:e.formData.groupName}},[t("el-tree",{ref:"selectTree",attrs:{data:e.selectList,props:e.defaultProps,"node-key":"groupId","default-expand-all":!0,"highlight-current":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick2}})],1)],1)],1),t("el-form-item",{attrs:{label:"\u8868\u5355\u540D\u79F0",prop:"formName"}},[t("el-input",{attrs:{maxlength:"50",placeholder:"\u8BF7\u8F93\u516550\u5B57\u4EE5\u5185\u7684\u8868\u5355\u540D\u79F0","show-word-limit":""},model:{value:e.formData.formName,callback:function(r){e.$set(e.formData,"formName",r)},expression:"formData.formName"}})],1),t("el-form-item",{attrs:{label:"\u8868\u5355\u63CF\u8FF0",prop:"formDesc"}},[t("el-input",{staticStyle:{height:"100px","margin-top":"5px"},attrs:{type:"textarea",resize:"none",rows:4,placeholder:"\u8BF7\u8F93\u5165\u8868\u5355\u63CF\u8FF0"},model:{value:e.formData.formDesc,callback:function(r){e.$set(e.formData,"formDesc",r)},expression:"formData.formDesc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.addFormClose}},[e._v("\u53D6\u6D88")]),t("el-button",{staticStyle:{background:"rgb(85, 124, 236)",color:"rgb(255, 255, 255)"},attrs:{size:"mini",type:"primary"},on:{click:e.addformDefine}},[e._v(" \u786E\u5B9A ")])],1)],1)],1)},n=[],p=a(723400),i=a(935051),f=a(148836),c=a(321300),v=a(155946);const d=()=>((1+Math.random())*4294967296|0).toString(16).substring(1);var u={name:"ListGisqFormData",mixins:[p.j],props:["currentWidget"],data(){return{defaultProps:{id:"groupId",children:"modelGroup",label:"groupName"},selectList:[],treeList:[{groupCode:"allGroup",groupId:"allGroup",groupName:"\u6240\u6709\u5206\u7EC4",parentId:"",modelGroup:[]}],formList:[],formAllList:[],keyword:"",defaultGroupId:"",dialogFormCode:"",dialogFormId:"",formDialogVisible:!1,addFormVisible:!1,formData:{formId:"",groupId:"",groupName:"",formCode:"",formName:"",formDesc:"",formImg:""},rules:{groupName:[{required:!0,message:"\u8868\u5355\u5206\u7EC4\u5FC5\u586B",trigger:"blur"}],formName:[{required:!0,max:50,message:"\u8868\u5355\u540D\u79F0\u5FC5\u586B",trigger:"blur"}],formCode:[{required:!0,max:50,message:"\u8868\u5355\u7F16\u7801\u5FC5\u586B",trigger:"blur"}],formDesc:[{required:!1,max:200,message:"\u5B57\u7B26\u4E0A\u9650200",trigger:"blur"}]}}},computed:{...(0,f.Se)(["getApplication"])},watch:{defaultGroupId:{handler(o){o&&this.getFormList(o)},deep:!0}},mounted(){this.getMenuTree()},methods:{chioceForm(){this.getMenuTree(),this.formDialogVisible=!0,this.dialogFormCode=this.currentWidget.dataset.props.formCode,this.dialogFormId=this.currentWidget.dataset.props.formId,this.dialogFormName=this.currentWidget.dataset.props.formName},addForm(){this.getMenuTree(),this.formData={formId:"",groupId:"",groupName:"",formCode:"",formName:"",formDesc:"",formImg:""},this.formData.formCode="gisqBI"+d(),this.addFormVisible=!0},designForm(){if(!this.currentWidget.dataset.props.formCode){this.$message.warning({message:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u8868\u5355",offset:60});return}const o=`/gisqForm/editor.html?formCode=${this.currentWidget.dataset.props.formCode}&formId=${this.currentWidget.dataset.props.formId}&applicationId=${this.getApplication.applicationId}&formType=design&preview=true`;window.open(o)},getMenuTree(){(0,i.formGetRequest)("/gisqForm/api/formGroup/getAllByTree").then(o=>{o&&o.code===200&&(o.data.length===0&&this.addMenuTree(),this.selectList=o.data,this.treeList[0].modelGroup=[],this.treeList[0].modelGroup=[...o.data],o.data[0]&&(this.defaultGroupId=o.data[0].groupId))})},addMenuTree(){const o=c.getStore("applicationInfo"),e=new FormData;e.append("groupCode",o.applicationId||d()),e.append("groupName",o.applicationName||"\u5728\u7EBF\u8868\u5355"),(0,i.formPostRequest)("/gisqForm/api/formGroup/insert",e,{"Content-Type":"application/x-www-form-urlencoded"})},async addformDefine(){if(!await this.$refs.addform.validate())return;const e=new FormData;e.append("formId",this.formData.formId),this.isFindGroupName(this.selectList,this.formData.groupName)&&e.append("groupId",this.formData.groupId),e.append("groupName",this.formData.groupName),e.append("formCode",this.formData.formCode),e.append("formName",this.formData.formName),e.append("formDesc",this.formData.formDesc),e.append("formImg",this.formData.formImg);const t=await(0,i.formPostRequest)("/gisqForm/api/form/insert",e,{"Content-Type":"application/x-www-form-urlencoded"});this.currentWidget.dataset.props.formCode=t.data.formCode,this.currentWidget.dataset.props.formId=t.data.formId,this.currentWidget.dataset.props.formName=t.data.formName,this.addFormClose(),this.designForm()},isFindGroupName(o,e){for(let t=0;t<o.length;t++){if(o[t].groupName==e)return!0;o[t].modelGroup&&o[t].modelGroup.length>0&&this.isFindGroupName(o[t].modelGroup,e)}return!1},selectChange(o){this.formData.groupName=o},visibleChange(o){o&&this.formData.groupId!=""&&this.$refs.selectTree.setCurrentKey(this.formData.groupId)},handleNodeClick2(o){this.formData.groupId=o.groupId,this.formData.groupName=o.groupName,this.$refs.refSelect.blur()},getFormList(o){let e="getFormByApplicationId";o==="allGroup"?e="/gisqForm/api/form/getFormByApplicationId?ApplicationId="+this.getApplication.applicationId:e="/gisqForm/api/form/getAllForm?groupId="+o,(0,i.formGetRequest)(e).then(t=>{t&&t.code===200&&(this.formList=t.data,this.formAllList=t.data)})},handleNodeClick(o){this.defaultGroupId=o.groupId},setBackground(o){let e=o.formImg;const t={width:"210px",height:"118px",marginTop:"-2px",marginLeft:"-2px",backgroundRepeat:"no-repeat"};return e?t.backgroundSize="cover":(e=a(114020),t.backgroundSize="100% 100%"),t.backgroundImage="url("+e+")",t},selectCard(o){this.dialogFormCode=o.formCode,this.dialogFormId=o.formId,this.dialogFormName=o.formName},formDefine(){this.formDialogVisible=!1,this.dialogFormId&&this.dialogFormCode&&(this.currentWidget.dataset.props.formCode=this.dialogFormCode,this.currentWidget.dataset.props.formId=this.dialogFormId,this.currentWidget.dataset.props.formName=this.dialogFormName,this.getConfigData())},formClose(){this.formDialogVisible=!1,this.dialogFormCode="",this.dialogFormId=""},addFormClose(){this.addFormVisible=!1,this.formData.groupName="",this.$refs.addform.resetFields()},newSearch(o){function e(t){return t.formName&&t.formName.includes(o)||t.formCode&&t.formCode.includes(o)||t.formId&&t.formId.includes(o)}this.formList=this.formAllList.filter(e)}}},g=u,h=a(768141),C=(0,h.Z)(g,m,n,!1,null,"7ad2d0c2",null),b=C.exports},114020:function(l,s,a){l.exports=a.p+"static/img/card.95b723ca.png"}}]);
