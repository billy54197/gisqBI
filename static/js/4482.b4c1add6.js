"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[4482],{74482:function($,c,o){o.r(c),o.d(c,{default:function(){return T}});var p=function(){var e=this,t=e._self._c;return t("div",{style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px",overflow:"hidden"}},[t("hide-button",{attrs:{attr:e.widgetInfo.attr}}),t("div",{ref:"heatmapCartesian",style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px"}})],1)},f=[],u=o(44513),m=o(27966),x=o(49385),v=o(45061),y=o(26711),I=o(99349),w=o(55616),S=o(75770),A=o(49500);const N=o(29426);var M={name:"heatmap-cartesian",props:["widgetInfo"],mixins:[v.u,y.H,I.P,x.u],components:{HideButton:u.Z},data(){return{}},mounted(){this.echarts=N.init(this.$refs.heatmapCartesian,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.echarts.dispose()},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{initAction(a){this.actionSendout(a),this.actionReceive(a)},loadInfo(a){let e=[],t={},i={},s=a.dataset[a.dataset.type];if(e=this.sourceInit(s.source,s.dimensions,s.encode,s.xAxis,s.yAxis),t=JSON.parse(JSON.stringify(s.xAxis)),i=JSON.parse(JSON.stringify(s.yAxis)),t.data=t.dataEdit,i.data=i.dataEdit,!t.data||!i.data)return;t=this.getxAxis(t),i=this.getyAxis(i);let n=this.getTitle(a.config.title),r=this.getGrid(a.config.grid),h=this.getTooltip(a.config.tooltip),g=JSON.parse(JSON.stringify(a.config.toolbox)),l=JSON.parse(JSON.stringify(a.config));l.series.label=this.getLabelStyle(l.series.label),l.series.tooltip=this.getTooltip(a.config.series.tooltip),l.series.name=this.getDataName(a);let d=a.dataset[a.dataset.type].encode;a.config.visualMap.visualMapMin=="dataMin"&&(l.visualMap.min=this.getVisualmapData(a,d.data)[0]),a.config.visualMap.visualMapMax=="dataMax"&&(l.visualMap.max=this.getVisualmapData(a,d.data)[1]);let C={title:n,grid:r,tooltip:h,toolbox:g,xAxis:t,yAxis:i,visualMap:l.visualMap,series:[l.series],dataset:{source:e}};this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(C,{notMerge:!0})},getDataName(a){let e=-1,t="";for(let i=0;i<a.dataset[a.dataset.type].dimensions.length;i++)a.dataset[a.dataset.type].dimensions[i]===a.dataset[a.dataset.type].encode.data&&(e=i);return e>-1&&(t=a.dataset[a.dataset.type].dimensionsAlias[e].alias),t},reLoadInfo(a){a&&(this.$refs.heatmapCartesian.style.width=a.attr.w+"px",this.$refs.heatmapCartesian.style.height=a.attr.h+"px"),this.loadInfo(a),this.echarts.resize()},sourceInit(a,e,t,i,s){let n=JSON.parse(JSON.stringify(a)),r=[],h,g,l;for(let d=0;d<e.length;d++)e[d]===t.x&&(h=d),e[d]===t.y&&(g=d),e[d]===t.data&&(l=d);for(let d=0;d<a.length;d++)r[d]=[n[d][h],n[d][g],Number(n[d][l])];return r=this.changeSourceType(r,i,s),r},changeSourceType(a,e,t){let i=JSON.parse(JSON.stringify(a));for(let s=0;s<a.length;s++)if(e.data){for(let n=0;n<e.data.length;n++)a[s][0]==e.data[n]&&(i[s][0]=n);for(let n=0;n<t.data.length;n++)a[s][1]==t.data[n]&&(i[s][1]=n)}return i},numToData(a,e){let t="";for(let i=0;i<e.length;i++)a==i&&(t=e[i]);return t},actionSendout(a){let e=this;this.$$lib__.each(a.action.sendOut.actionList,t=>{if(t.enabled){let i=t.code+"_"+a.id;if(t.paramsExtend&&t.paramsExtend.length>0){let s={};this.getParamsExtend(s,t.paramsExtend,a)}t.code==S.Z.click.code&&e.onClick(i,t)}})},onClick(a,e){let t=this;t.echarts.on("click",i=>{let s={};if(t.widgetInfo.dataset.type==t.$$global_editor.dataSourcType.static.code)s.x=t.numToData(i.data[0],t.widgetInfo.dataset.static.xAxis.data),s.y=t.numToData(i.data[1],t.widgetInfo.dataset.static.yAxis.data);else{let r=t.widgetInfo.dataset[t.widgetInfo.dataset.type].source[i.dataIndex],h=t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions;for(var n in s)s[n]=r[h.indexOf(n)];s.x=t.numToData(i.data[0],t.widgetInfo.dataset[t.widgetInfo.dataset.type].xAxis.data),s.y=t.numToData(i.data[1],t.widgetInfo.dataset[t.widgetInfo.dataset.type].yAxis.data)}if(s.val=i.data[2],e.script&&e.script.enabled){if(A.log("Execute script for "+t.widgetInfo.name+" component to "+e.name+" component"),e.script.content==""){w.Message.warning({message:e.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",e.script.content),s=this.customScript(s)}m.Z.$emit(a,s),e.postMessage&&t.doPostMessage(s),t.actionNameList.push(a)})}}},O=M,D=o(68141),J=(0,D.Z)(O,p,f,!1,null,"1fd16914",null),T=J.exports}}]);
