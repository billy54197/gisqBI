"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[8792],{56279:function(F,y,n){n.d(y,{P:function(){return S}});var L=n(86892),d=n(49500);const S={mixins:[L.D],created(){},methods:{lifecycleBeforeChartsLoad(x){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&d.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),d.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let p=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[x]);if(p)return p}return x},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&d.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),d.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},18792:function(F,y,n){n.r(y),n.d(y,{default:function(){return j}});var L=function(){var i=this,e=i._self._c;return e("div",{style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[e("hide-button",{attrs:{attr:i.widgetInfo.attr}}),e("div",{ref:"ganttChart",style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}})],1)},d=[],S=n(44513),x=n(27966),A=n(56279),p=n(45061),B=n(26711),T=n(99349),D=n(55616),R=n(75770),P=n(30103),Z=n(67157),f=n(50666);const $={mixins:[Z.c],data(){return{config_extend:{config:{series:[{nameTxtColor:"rgba(15, 21, 99, 1)",typeTxtColor:"#C4C4C4"}]}},filter_config:{title:JSON.parse(JSON.stringify(f.Z.charts.title)),legend:JSON.parse(JSON.stringify(f.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(f.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(f.Z.charts.toolbox)),xAxis:JSON.parse(JSON.stringify(f.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(f.Z.charts.yAxis)),series:[{color:"#C4C4C4",nameTxtColor:"rgba(15, 21, 29, 1)",typeTxtColor:"#C4C4C4"},{strColor:"#18DEA7",endColor:"#4C84FF",tagColor:"#0F151D"}]}}},methods:{filterPredefineColoursSchemeConfig(t,i){if(this.getNewConfig(t,i,this.filter_config),i.series instanceof Array&&i.series.length>0&&t.series instanceof Array&&t.series.length>0)for(let e=0;e<t.series.length;e++)this.getNewConfig(t.series[e],i.series[e],this.filter_config.series[e])}}};var J=n(49500);const u=n(29426);var E={name:"GanttChart",components:{HideButton:S.Z},mixins:[A.P,p.u,B.H,T.P,P.u,$],props:["widgetInfo"],data(){return{heightRatio:.6,dimCategoryIndex:0,dimTimeArrival:1,dimTimeDepature:2,cartesianXBounds:[],cartesianYBounds:[],progressX:1,progressY:0,progressLabel:3,widthScale:1,maxBarLength:180,coordSysWidth:450}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=u.init(this.$refs.ganttChart,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{loadInfo(t){let i={};i=this.getSeriesData(t.dataset[t.dataset.type].source,t.dataset[t.dataset.type].dimensionsAlias,t.dataset[t.dataset.type].encode);let e=this,l=[{id:"progress",type:"custom",renderItem:function(r,a){var h=a.value(e.progressY),m=a.coord([a.value(e.progressX),h]),c=a.coord([a.value(2),h]),s=r.coordSys;e.cartesianXBounds[0]=s.x,e.cartesianXBounds[1]=s.x+s.width,e.cartesianYBounds[0]=s.y,e.cartesianYBounds[1]=s.y+s.height;var g=c[0]-m[0];e.maxBarLength=e.maxBarLength>g?e.maxBarLength:g,e.coordSysWidth=r.coordSys.width;var v=a.size([0,1])[1]*e.heightRatio,C=m[0],w=m[1]-v,b=a.value(e.progressLabel)+"",H=u.format.getTextRect(b).width,z=g>H+40&&C+g>=180?b:"",I=e.clipRectByRect(r,{x:C,y:w,width:g,height:v}),N=e.clipRectByRect(r,{x:C,y:w,width:g/2,height:v}),O=e.clipRectByRect(r,{x:C,y:w,width:g,height:v});return{type:"group",children:[{type:"rect",ignore:!I,shape:I,style:a.style({fill:t.config.series[1].endColor})},{type:"rect",ignore:!N&&!a.value(3),shape:N,style:a.style({fill:t.config.series[1].strColor})},{type:"rect",ignore:!O,shape:O,style:a.style({fill:"transparent",stroke:"transparent",text:z,textFill:t.config.series[1].tagColor})}]}},dimensions:["\u7D22\u5F15\u503C"].concat(i.progress.dimensions),data:this.initDataArr(i.progress.list).map(function(r,a){return[a].concat(r)}),encode:{x:[e.progressX,2],y:e.progressY}},{id:"itemList",type:"custom",renderItem:function(r,a){var h=a.coord([0,a.value(0)])[1];if(!(h<r.coordSys.y+5))return{type:"group",position:[10,h],children:[{type:"path",shape:{d:"M0,0 L0,-20 L30,-20 C42,-20 38,-1 50,-1 L70,-1 L70,0 Z",x:0,y:-20,width:90,height:20,layout:"cover"},style:{fill:t.config.series[0].color}},{type:"text",style:{x:24,y:-3,text:a.value(1),textVerticalAlign:"bottom",textAlign:"center",textFill:t.config.series[0].nameTxtColor||"#fff"}},{type:"text",style:{x:75,y:-2,textVerticalAlign:"bottom",textAlign:"center",text:a.value(2),textFill:t.config.series[0].typeTxtColor||"#000"}}]}},encode:{x:-1,y:0},data:this.initDataArr(i.itemList).map(function(r,a){return[a].concat(r)})}];t.config.yAxis.max=this.initDataArr(i.itemList).length,t.config.xAxis.axisPointer=this.getAxisPointer(t.config.xAxis.axisPointer),t.config.xAxis.axisLine.lineStyle.color=this.getColorInfo(t.config.xAxis.axisLine.lineStyle.colorInfo),t.config.yAxis.axisLine.lineStyle.color=this.getColorInfo(t.config.yAxis.axisLine.lineStyle.colorInfo),t.config.xAxis.axisTick.lineStyle.color=this.getColorInfo(t.config.xAxis.axisTick.lineStyle.colorInfo),t.config.yAxis.axisTick.lineStyle.color=this.getColorInfo(t.config.yAxis.axisTick.lineStyle.colorInfo),t.config.xAxis.splitLine.lineStyle.color=this.getColorInfo(t.config.xAxis.splitLine.lineStyle.colorInfo),t.config.yAxis.splitLine.lineStyle.color=this.getColorInfo(t.config.yAxis.splitLine.lineStyle.colorInfo),t.config.xAxis.splitNumber=t.config.xAxis.splitNumber?t.config.xAxis.splitNumber-1:"";let o={animation:!1,dataZoom:[t.config.dataZoomX,t.config.dataZoomY],grid:t.config.grid,series:l,toolbox:t.config.toolbox,tooltip:this.getTooltip(t.config.tooltip),xAxis:Object.assign(this.getxAxis(t.config.xAxis),{max:function(r){return r.max=r.max+(r.max-r.min)*((e.maxBarLength+200)/e.coordSysWidth),r.max},min:function(r){return r.min}}),yAxis:this.getyAxis(t.config.yAxis)};o.xAxis.axisLabel.formatter=t.config.xAxis.axisLabel.formatterArr[0]+`{MM}-{dd}
{yyyy}`+t.config.xAxis.axisLabel.formatterArr[1],this.getAnimation(o,t),this.setOption(o),this.setAnimationLoop(t,()=>{this.setOption(o,t)})},setOption(t){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!1})},initDataArr(t){for(var i=this.getMaxLength(t),e=[],l=[],o=0;o<t.length;o++)for(var r=0;r<i;r++)e[r]||(e[r]=[]),e[r].push(t[o][r]),l[r]||(l[r]=[]),l[r].push(t[o][r]);return e},getMaxLength(t){for(var i=0,e=0;e<t.length;e++)t[e].length>i&&(i=t[e].length);return i},unique(t){return t.reduce((i,e)=>i.includes(e)?i:[...i,e],[])},clipRectByRect(t,i){return u.graphic.clipRectByRect(i,{x:t.coordSys.x,y:t.coordSys.y,width:t.coordSys.width,height:t.coordSys.height})},reLoadInfo(t){t&&(this.$refs.ganttChart.style.width=t.attr.w+"px",this.$refs.ganttChart.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},getSeriesData(t,i,e){let l=[];for(let c in e.itemList)for(let s=0;s<i.length;s++)e.itemList[c]==i[s].name&&l.push(this.getSourceData(s,t));let o=[],r=[],a,h;for(let c in e.x)for(let s=0;s<i.length;s++)e.x[c]==i[s].name&&(o.push(this.getSourceData(s,t).map(g=>new Date(g).getTime())),r.push(i[s].alias?i[s].alias:i[s].name));for(let c in e.progress)for(let s=0;s<i.length;s++)e.progress[c]==i[s].name&&(o.push(this.getSourceData(s,t)),r.push(i[s].alias?i[s].alias:i[s].name));return o[1]&&o[1].length>0&&this.$$lib__.each(o[1],c=>{a=a?a>Number(c)?Number(c):a:Number(c),h=h&&h>Number(c)?h:Number(c)}),o[1]=o[1].map((c,s)=>Number(o[0][s])+Number(c*1e3)),this.widthScale=h===a?h:h-a,{itemList:l,progress:{list:o,dimensions:r}}},getSourceData(t,i){let e=[];for(let l=0;l<i.length;l++)e.push(i[l][t]);return e},initAction(t){this.actionSendout(t),this.actionReceive(t)},getItemStyleColor(t){let i=null;return t.pureColor&&t.type==this.$$global_editor.colorType.pureColor.code?i=t.pureColor:t.type==this.$$global_editor.colorType.gradation.code&&(i=new u.graphic.LinearGradient(0,0,0,1,[{offset:0,color:t.gradation.top!=null&&t.gradation.top!=""?t.gradation.top:"#FFFFFF"},{offset:1,color:t.gradation.bottom!=null&&t.gradation.bottom!=""?t.gradation.bottom:"#FFFFFF"}])),i},actionSendout(t){let i=this;this.$$lib__.each(t.action.sendOut.actionList,e=>{if(e.enabled){let l=e.code+"_"+t.id;if(e.paramsExtend&&e.paramsExtend.length>0){let o={};this.getParamsExtend(o,e.paramsExtend,t)}e.code==R.Z.click.code&&i.onClick(l,e)}})},onClick(t,i){let e=this;e.echarts.on("click",l=>{let o={};if(o.time=l.data[1],o.value=l.data[2],o.target=l.data[3],i.script&&i.script.enabled){if(J.log("Execute script for "+e.widgetInfo.name+" component to "+i.name+" component"),i.script.content==""){D.Message.warning({message:i.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",i.script.content),o=this.customScript(o)}x.Z.$emit(t,o),i.postMessage&&e.doPostMessage(o),e.actionNameList.push(t)})}}},M=E,X=n(68141),Y=(0,X.Z)(M,L,d,!1,null,"48d9a3a7",null),j=Y.exports}}]);
