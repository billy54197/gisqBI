"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[38923],{764604:function(O,x,n){n.r(x),n.d(x,{bubbleJson:function(){return z}});let z={geojson:void 0,layerUrl:"http://192.168.11.25:6080/arcgis/rest/services/XZQ/MapServer",layerType:"arc-vector",layerName:"pg:zj_xzqh",center:[120.40446,29.31152],zoomLevel:7,centerWkid:"EPSG:4490",isShowXzqName:!0,fillColor:"rgba(5, 121, 138, 0.4)",borderColor:"rgba(5, 121, 138, 0.8)",bubbleMaxR:50,bubbleMinR:38,isBubbleImage:!1,bubbleFloat:!0,isShowTitle:!1,fontSize:14,xzqdm_field:"xzqdm",xzqmc_field:"xzqmc",boxShadowSize:5,fontConfig:[{name:"\u5E74\u5EA6\u5B8C\u6210\u6295\u8D44\u989D",color:"rgb(186,247,223)",imgUrl:"",bubbleColor:"rgba(7, 214, 52, 0.9)",bubbleShadowColor:""},{name:"\u9879\u76EE\u6570",color:"rgb(247,226,155)",imgUrl:"",bubbleColor:"rgba(249, 207, 4, 0.8)",bubbleShadowColor:""}],bubbleNumTop:32,bubbleNumLeft:-3,totaldata:{3301:[{value:18636,positionPoint:[119.8938,30.1355],wkid:"EPSG:4490"},{value:1233,positionPoint:[119.2596,29.7149],wkid:"EPSG:4490"}],3302:[{value:9625,positionPoint:[121.3934,29.9371],wkid:"EPSG:4490"},{value:390,positionPoint:[121.6956,29.3994],wkid:"EPSG:4490"}],3303:[{value:12729,positionPoint:[120.7672,28.2237],wkid:"EPSG:4490"},{value:1100,positionPoint:[120.1547,27.6224],wkid:"EPSG:4490"}],3304:[{value:8822,positionPoint:[121.0968,30.7123],wkid:"EPSG:4490"},{value:1091,positionPoint:[120.5035,30.5476],wkid:"EPSG:4490"}],3305:[{value:10178,positionPoint:[119.5367,30.6409],wkid:"EPSG:4490"},{value:1294,positionPoint:[120.2041,30.7947],wkid:"EPSG:4490"}],3306:[{value:9213,positionPoint:[120.7507,30.0201],wkid:"EPSG:4490"},{value:1027,positionPoint:[120.8496,29.5697],wkid:"EPSG:4490"}],3307:[{value:9325,positionPoint:[119.7015,29.111],wkid:"EPSG:4490"},{value:1065,positionPoint:[120.3772,29.1577],wkid:"EPSG:4490"}],3308:[{value:4984,positionPoint:[118.515,29.0149],wkid:"EPSG:4490"},{value:1303,positionPoint:[119.1376,28.9835],wkid:"EPSG:4490"}],3309:[{value:6579,positionPoint:[122.2339,29.9487],wkid:"EPSG:4490"},{value:483,positionPoint:[122.4751,30.4756],wkid:"EPSG:4490"}],3310:[{value:8905,positionPoint:[120.7892,28.7897],wkid:"EPSG:4490"},{value:1200,positionPoint:[121.366,28.8995],wkid:"EPSG:4490"}],3311:[{value:3414,positionPoint:[119.1687,28.0811],wkid:"EPSG:4490"},{value:1430,positionPoint:[119.8499,28.3005],wkid:"EPSG:4490"}]}}},56279:function(O,x,n){n.d(x,{P:function(){return E}});var z=n(386892),b=n(149500);const E={mixins:[z.D],created(){},methods:{lifecycleBeforeChartsLoad(I){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&b.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),b.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let u=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[I]);if(u)return u}return I},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&b.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),b.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},202234:function(O,x,n){n.r(x),n.d(x,{default:function(){return mt}});var z=function(){var t=this,i=t._self._c;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"gis-theme-bubble",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"},attrs:{map:t.map}},[i("hide-button",{attrs:{attr:t.widgetInfo.attr}})],1)},b=[],E=n(844513),I=n(42160),C=n(56279),u=n(445061),f=n(126711),p=n(337564),c=n(519065),y=n(975029),A=n(653183),g=n.n(A),X=n(372449),q=n(2487),J=n(181121),D=n(313927),G=n(390583),K=n(682571),$=n(195659),Q=n(23230),W=n(762735),M=n(568640),Y=n(131751),_=n(129907),j=n(568433),tt=n(313811),et=n(144727),it=n(507522),ot=n(109602),st=n.n(ot),Z=n.p+"static/img/greenBubble.f0a741be.png",U=n.p+"static/img/yellowBubble.45498762.png",nt=n(143156),R=n(149500);class lt{constructor(t,i){this.map=t,this.callback=i,this.setAnimation(),this.geoJSON=new p.default,this.esrijsonFormat=new Y.Z,this.imgList=[Z,U,Z,U],this.isFirst=!0,this.mapId=this.map.getTarget().id,this.isFiting=!1,this.timeout=!1}initBubble(t){if(setTimeout(()=>{this.timeout=!1},1e3),!this.timeout){if(t)this.options=t;else{let i=n(764604);this.options=i.bubbleJson}this.unit=this.options.unit,this.numFontSize=this.options.numFontSize,this.xzqdm_field=this.options.xzqdm_field,this.xzqmc_field=this.options.xzqmc_field,this.currentZoom=this.currentZoom?this.currentZoom:this.options.zoomLevel?this.options.zoomLevel:7,this.XzqNameColor=t&&t.XzqNameColor?t.XzqNameColor:"#FFF",this.xzqFill=t&&t.fillColor?t.fillColor:"rgba(5, 121, 138, 0.4)",this.xzqBorder=t&&t.borderColor?t.borderColor:"rgba(5, 121, 138, 0.8)",this.clear(),this.calculation_R_Size_K(),this.setXzqKey(),this.loadXZQ(),this.createLegend(),this.map.render(),this.timeout=!0}}setXzqKey(){let t=Object.keys(this.options.totaldata)[0],i=t.length;t.length>6?t=t.substring(0,t.length-3):t=t.substring(0,t.length-2),this.xzqdm=t,this.xzqdm_length=i}loadXZQ(){let t=this.options.layerType;this.options.isGeojson?this.createFeature(this.options.geojson):t==="geoserver-wfs"?this.loadGeoserverWFS():t==="geoserver-wms"?this.loadGeoserverWMS():t==="dynamic"?this._Ajax(this.options.layerUrl,{f:"json"},i=>{let e=i.layers;for(let o=0;o<e.length;o++){const s=e[o].id;this.loadArcgisVector(s)}}):t==="tiled"?this.loadArcgisTile():this.loadGeojson(),this.initDrillDown()}loadGeoJson(){return new Promise(t=>{n.e(75305).then(function(){let i=n(575305);t(i)}.bind(null,n)).catch(n.oe)})}async createFeature(t){t||(t=await this.loadGeoJson());let i=[],e=t.features,o=t.wkid+"";o.indexOf("EPSG:")===-1&&(o="EPSG:"+o);for(let s=0;s<e.length;s++){const l=e[s].geometry,a=e[s].properties;let r=l.type,h;if(r.toLowerCase()==="polygon")h=new et.ZP(l.coordinates);else if(r.toLowerCase()==="multipolygon")h=new it.Z(l.coordinates);else{R.log("\u4E0D\u652F\u6301polygon/multiPolygon\u4EE5\u5916\u7684\u6570\u636E");return}h.applyTransform((0,G.getTransform)(o,this.map.getView().getProjection().getCode()));let v={geometry:h};for(const m in a)v[m]=a[m];let P=new tt.Z(v);i.push(P),this.createBubble(a[this.xzqdm_field])}this._GeoJson(i,"geojson")}loadGeojson(){nt.h.getListByWhereClause({parentCode:this.xzqdm}).then(t=>{if(t.status===200&&t.data.length>0){let i={type:"FeatureCollection",features:[]};t.data.forEach(o=>{let s=JSON.parse(o.geojsonGis);if(s&&s.type){if(o.xzqCode&&(s.properties.xzqdm=o.xzqCode),o.xzqName&&(s.properties.xzqmc=o.xzqName),s.type==="FeatureCollection"){let l=null;s.features.forEach(a=>{let r=null;a.geometry.type==="Polygon"?r=(0,c.yu)(a.geometry.coordinates):a.geometry.type==="MultiPolygon"&&(r=(0,c.tw)(a.geometry.coordinates)),l==null?l=r:l=(0,y.Z)(l,r)}),l.properties=s.properties,s=l}s.features?i.features.push(...s.features):i.features.push(s);for(const l in s.properties){let a=s.properties[l]+"";if(a.indexOf(this.xzqdm+"")>-1&&a.length===this.xzqdm_length){let r=o.centralPoint;if(r){r=r.split(",");for(let h in r)r[h]=Number(r[h])}this.createBubble(a,r);break}}}else R.warn("\u6570\u636E\u7BA1\u7406\u4E2D\u884C\u653F\u533A\u6570\u636E,"+o.xzqName+"\u7684geojsonGis\u6570\u636E\u4E22\u5931")}),this._GeoJson(i,"geo-wfs")}})}loadGeoserverWFS(){var t=this.options.layerUrl;let i=this.xzqdm,e=this.xzqdm_length;var o={service:"WFS",version:"1.1.0",request:"GetFeature",typeName:this.options.layerName,outputFormat:"application/json",maxFeatures:3200,srsName:this.map.getView().getProjection().getCode(),CQL_FILTER:this.xzqdm_field+" like '"+i+"%' and length("+this.xzqdm_field+")="+e};this._Ajax(t,o,s=>{this._GeoJson(s,"geo-wfs"),s.features.forEach(l=>{let a=l.properties;this.createBubble(a[this.xzqdm_field])})})}loadGeoserverWMS(){let t=new J.Z({url:this.options.layerUrl,params:{layers:this.options.layerName,VERSION:"1.1.0"},serverType:"geoserver",crossOrigin:"anonymous",projection:this.map.getView().getProjection().getCode()}),i=this.options.isShowXzq?.8:0,e=new D.default({source:t,opacity:i,id:"bubble_xzq",zIndex:9999});setTimeout(()=>{this.options.isShowXzq&&this.map.addLayer(e),this.options.isFit&&this.setZoom(e);let o=this.options.totaldata;for(const s in o)this.createBubble(s)},1500)}loadArcgisVector(t){let i=this.map.getView().getProjection().getCode().split(":")[1],e=this.options.layerUrl+"/"+t+"/query",o=this.xzqdm,s=this.xzqdm_length,l={f:"json",outFields:"*",outSR:i,where:this.xzqdm_field+" like '"+o+"%' AND char_length("+this.xzqdm_field+")="+s};this._Ajax(e,l,a=>{a&&a.error?R.log(a.error):a&&a.features.length>0&&this._GeoJson(a,"arc-vector").forEach(h=>{let v=h.values_?h.values_:{};this.createBubble(v[this.xzqdm_field])})})}loadArcgisTile(){var t=new D.default({source:new _.Z({url:this.options.layerUrl}),zIndex:9999});setTimeout(()=>{this.options.isShowXzq&&this.map.addLayer(t),this.options.isFit&&this.setZoom(t);let i=this.options.totaldata;for(const e in i)this.createBubble(e)},1500)}_GeoJson(t,i){let e;i==="geo-wfs"||i==="geoserver-wfs"?e=this.geoJSON.readFeatures(t):i==="arc-vector"?e=this.esrijsonFormat.readFeatures(t):i==="geojson"&&(e=t);let o=new q.default;o.addFeatures(e);let s=this.options.isShowXzq?1:0,l=new X.default({id:"bubble_xzq",source:o,zIndex:9999,opacity:s,style:a=>{let r=a.values_[this.xzqmc_field];return this._getStyle(this.xzqFill,this.xzqBorder,r)}});return this.map.addLayer(l),this.options.isFit&&this.setZoom(o),e}createBubble(t,i){let e=this.options.totaldata[t],o=this.options.fontConfig;if(!e)return;let s="";e.forEach((l,a)=>{if(o[a]){let r=l.value==="null"||l.value==="NULL"?0:l.value,h=Number(r),P=2*(this.K*(h-this.minValue)+this.minR),m=this.newGuid(),L="<div class='labelTooltip2' id='bubblecharts_"+m+"' title='"+o[a].name+" : "+h+"' style='cursor: pointer;'></div>";g()(".ol-overlaycontainer").append(L);let w=l.positionPoint?l.positionPoint:i,S=o[a].imgUrl?o[a].imgUrl:this.imgList[a];if(this.options.isBubbleImage)s=this.createImgBubble(P,o[a],l,S);else{let T=P-32;s=this.createDomBubble(o[a],T,h)}g()("#bubblecharts_"+m).append(s);let bt=this.map.getView().getProjection().getCode();w=(0,G.transform)(w,l.wkid,bt);let gt=this.options.positioning?this.options.positioning:"center-center",H=document.getElementById("bubblecharts_"+m),vt=new W.Z({position:w,positioning:gt,stopEvent:!1,element:H});if(H.addEventListener("click",()=>{let T={...e[a],xzqdm:t,center:i};this.onBubbleClickListener(T)}),this.map.addOverlay(vt),this.options.bubbleFloat){let T=g()("#bubblecharts_"+m),k=T.parent();g()(k).css("-webkit-animation","bubbleAnimation "+(Math.random()+2)+"s linear infinite alternate"),g()(k).css("-o-animation","bubbleAnimation "+(Math.random()+2)+"s linear infinite alternate"),g()(k).css("animation","bubbleAnimation "+(Math.random()+2)+"s linear infinite alternate"),setTimeout(()=>{let F=T.find(".bubbleDivClass"),B=F.height(),N=F.width();B<N?(N=B,g()(F).css("width",N)):(B=N,g()(F).css("height",B))},100)}}}),this.isZoom=!0}createLegend(){if(this.options.legendConfig){let t=this.options.legendConfig;if(t.isShow){let i=n(407490),e=`<div id="bubbleLegend" style="position:absolute;z-index:10;${t.style}">
                            <div id="legendContainer" style="background:rgb(255, 255, 255,${t.opacity});border-radius: 3px;">`;t.hideTitle||(e+=`<div class="legendTitle" style="font-size: 14px;background: #409eff;color: #fff;border-top-left-radius: 3px;border-top-right-radius: 3px;text-align: center">
                        \u56FE\u4F8B<span class="legendHide" style="cursor: pointer;position:relative;float:right;right:5px;top:0px;" title="\u6700\u5C0F\u5316">&#8801;</span></div>`),e+=`</div>
                        <div id="showLegend" style="display:none;cursor: pointer;position: relative;float: right;" title="\u6C14\u6CE1\u56FE\u4F8B">
                        <img src="${i}" style="background:rgb(255, 255, 255,${t.opacity});">
                      </div>
                    </div>`,g()("#"+this.mapId).append(e);let o=this.options.fontConfig,s=20;o.forEach((l,a)=>{let r="",h=l.name||l.staticField;if(this.options.isBubbleImage){let v=l.imgUrl?l.imgUrl:this.imgList[a];r=`<div style="padding:5px;">
                            <div class="bubbleDivClass" style="font-family: ${this.options.fontFamily}">
                              <div style="position: relative;float: left;">
                                <img class="bubbleImg" style="width: ${s}px;height:${s}px;padding:1px;" src=" ${v}"/>
                              </div>
                              <div style="font-size: ${this.options.fontSize}px;"> ${h} </div>
                            </div>
                          </div>`}else r+='<div style="padding:5px;">',r+=this.createDomBubble(l,s,null,!0),r+='<div style="font-size:'+this.options.fontSize+'px;">'+h+"</div>",r+="</div>";g()("#legendContainer").append(r)}),g()(".legendHide").off("click").click(()=>{g()("#legendContainer").hide(),g()("#showLegend").show()}),g()("#showLegend").off("click").click(()=>{g()("#legendContainer").show(),g()("#showLegend").hide()})}}}createDomBubble(t,i,e,o){let s="rgb(255,255,253)",l=t.bubbleColor||"#000",a=t.numFontColor,r=t.fontColor||"#000",h=t.name,v=t.bubbleShadowColor||"rgba(170, 170, 170, 0.8)",P=this.getDarkColor(l,.6),m=this.getDarkColor(r,.5),L=this.options.fontSize?this.options.fontSize:"16",w="3px 6px 9px 0px";t.boxShadowSize&&(w=t.boxShadowSize-2+"px "+t.boxShadowSize+"px 7px 0px");let S='<div class="bubbleDivClass" style="border-radius: 50%;border-style: solid;border-width: 1px;border-color: '+l+";font-family: "+this.options.fontFamily+";background-image: -moz-linear-gradient( -50deg, "+s+" 0%,"+l+" 50%);background-image: -webkit-linear-gradient( -50deg, "+s+" 0%,"+l+" 50% );background-image: -ms-linear-gradient( -50deg, "+s+" 0%,"+l+" 50% );position: relative;";return o?S+="float:left;":S+="box-shadow:  "+w+" "+v+",inset 10px 15px 13px -10px rgba(255, 255, 255, 0.8),inset -8px -7px 13px -10px "+P+";",S+="width: "+i+"px;height: "+i+'px;text-align: center;vertical-align: middle;display: table-cell;opacity: 0.9;">',o||(this.options.isShowTitle&&(S+='<span class="nameTag" style="font-size:'+L+"px;-webkit-text-fill-color:"+this.getLightColor(r,.6)+"; text-shadow: -1px 0 "+m+", 0 1px "+m+", 1px 0 "+m+", 0 -1px "+m+';">'+h+"</span></br>"),S+='<span style="-webkit-text-fill-color:'+this.getLightColor(a||r,.6)+"; text-shadow: -1px 0 "+m+", 0 1px "+m+", 1px 0 "+m+", 0 -1px "+m+"; font-size: "+(this.numFontSize?this.numFontSize:L)+'px">'+e+`</span><span style="color: transparent;-webkit-text-fill-color: ${this.getLightColor(r,.6)};font-size:${L}">${this.unit}</span>`),S+="</div>",S}createImgBubble(t,i,e,o){let s=i.name,l=i.color||"#000",a=i.numFontColor,r=l||"#000",h=this.options.bubbleNumTop?this.options.bubbleNumTop:32,v=this.getLightColor(r,.6),P=this.getDarkColor(l,.5),m="-1px 0 "+P+",0 1px "+P+",1px 0 "+P+",0 -1px "+P,L=this.options.fontSize?this.options.fontSize:18,w=`<div class="bubbleDivClass" style="font-family: ${this.options.fontFamily}">`;this.options.isShowTitle&&(w+='<div class="bubbleText" style="position:absolute;width:100% ;text-align:center;top:'+((t-h)/2-8)+"px;left:"+(this.options.bubbleNumLeft?this.options.bubbleNumLeft:-3)+"px; font-size:"+L+"px; color: transparent;-webkit-text-fill-color: "+v+";text-shadow:"+m+`;font-family: ${this.options.fontFamily};">`+s+"</div>"),w+='<div class="bubbleText" style="position:absolute;width:100% ;text-align:center;top:';let S=this.options.bubbleNumTwoPadding?this.options.bubbleNumTwoPadding:3;return this.options.isShowTitle?w+=(t-h)/2-8+this.options.fontSize+S:w+=(t-h)/2,w+="px;left:"+(this.options.bubbleNumLeft?this.options.bubbleNumLeft:-3)+"px; font-size:"+(this.numFontSize?this.numFontSize:L)+"px; color: transparent;-webkit-text-fill-color: "+(a||v)+";text-shadow:"+m+`;font-family: ${this.options.fontFamily};">`+e.value+`<span style="color: transparent;-webkit-text-fill-color: ${v};font-size:${L}px;top: -2px;position:relative;"> ${this.unit}</span></div><img class="bubbleImg" style="width:`+t+"px;height:"+t+'px;padding:1px;" src="'+o+'"/></div>',w}calculation_R_Size_K(){let t=this.options.totaldata,i=this.options.bubbleMaxR,e=this.options.bubbleMinR;this.maxValue=-1/0,this.minValue=1/0;for(const s in t)t[s].forEach(a=>{let r=a.value==="null"||a.value==="NULL"?0:a.value,h=Number(r);this.maxValue<h&&(this.maxValue=h),this.minValue>h&&(this.minValue=h)});let o=this.maxValue-this.minValue;o=o===0?1:o,this.maxR=i||50,this.minR=e||38,this.K=(this.maxR-this.minR)/o}setZoom(t){let i=t.getExtent();i[0]!==1/0&&i[0]!==-1/0?this.fit2Map(i):this.map.getView().setZoom(parseInt(this.currentZoom))}fit2Map(t){let i=this.map.getSize(),e=this.options.zoomRatio;if(this.options.zoomToCenter){let o=[i[0]*e,i[1]*e];this.isFiting=!0,this.map.getView().fit(t,{size:o,duration:500,callback:()=>{this.isFiting=!1;let s=this.map.getView().getZoom();this.currentZoom=s}})}else if(!this.mapResolution){this.mapResolution=this.map.getView().getResolution();let o=this.mapResolution/e;this.map.getView().setResolution(o)}}_getStyle(t,i,e){let o=new M.Z({color:t}),s=new Q.Z({color:i,width:2}),l=new $.Z({text:e,font:"16px bold Microsoft YaHei ",fill:new M.Z({color:this.XzqNameColor})}),a=new K.ZP({fill:o,stroke:s});return this.options.isShowXzqName&&a.setText(l),a}newGuid(){for(var t="",i=1;i<=32;i++){var e=Math.floor(Math.random()*16).toString(16);t+=e,(i==8||i==12||i==16||i==20)&&(t+="-")}return t}getDarkColor(t,i){let e=[];t.indexOf("#")!==-1?e=this.HexToRgb(t):t.indexOf("rgb")!==-1?e=t.split("(")[1].split(")")[0].split(","):t.indexOf(",")!==-1?e=t.split(","):e=t;for(let o=0;o<3;o++)e[o]=Math.floor(Number((e[o]+"").trim())*(1-i));return this.RgbToHex(e[0],e[1],e[2])}HexToRgb(t){t=t.replace("#","");let i=t.match(/../g);for(let e=0;e<3;e++)i[e]=parseInt(i[e],16);return i}RgbToHex(t,i,e){let o=[t.toString(16),i.toString(16),e.toString(16)];for(let s=0;s<3;s++)o[s].length==1&&(o[s]="0"+o[s]);return"#"+o.join("")}getLightColor(t,i){let e=[];t.indexOf("#")!==-1?e=this.HexToRgb(t):t.indexOf("rgb")!==-1?e=t.split("(")[1].split(")")[0].split(","):t.indexOf(",")!==-1?e=t.split(","):e=t;for(let o=0;o<3;o++)e[o]=Math.floor((255-Number((e[o]+"").trim()))*i+Number((e[o]+"").trim()));return this.RgbToHex(e[0],e[1],e[2])}setAnimation(){let t=document.styleSheets[0];t.insertRule(`@keyframes bubbleAnimation
    {
      from {margin-top:0px;margin-bottom:0px;}
      to {margin-top:12px;margin-bottom:-12px;}
    }`),t.insertRule(`@-webkit-keyframes bubbleAnimation
    {
      from {margin-top:0px;margin-bottom:0px;}
      to {margin-top:12px;margin-bottom:-12px;}
    }`)}clearXZQ(){this.isZoom=!1,this.drillDownEvt&&(0,j.B)(this.drillDownEvt);let t=this.map.getLayers().getArray(),i=[];t.forEach(e=>{e.values_.id==="bubble_xzq"&&i.push(e)}),i.forEach(e=>{this.map.removeLayer(e)})}_Ajax(t,i,e){g().ajax({url:t,type:"POST",dataType:"json",data:i,success:o=>{e(o)},error:o=>{R.log(o)}})}initDrillDown(){this.options.isDrill?(this.initMousePosition(),this.drillDown()):this.drillDownEvt&&this.removeListener()}drillDown(){let t=this;this.drillDownEvt=this.map.on("moveend",st().debounce(function(){if(t.isFiting)return;let i=t.map.getView().getZoom();if(Math.abs(t.currentZoom-i)>=1){let e=t.map.getView().getCenter(),o=t.options.drillFromMouse;if(t.drillPoint=o?t.mousePosition:e,t.callback){let s=i>=t.currentZoom,l=t.getXZQDM(t.drillPoint,s);(s&&l&&l!==t.xzqdm||!s&&l&&l!==t.xzqdm&&l)&&t.callback(l)}t.currentZoom=i}},500))}getXZQDM(t,i){let e=this.map.getLayerById("bubble_xzq");if(!e)return;let o=this.xzqdm,s=o.length;if(!i)s<=6?o=o.substring(0,s-2):o=o.substring(0,s-3);else{let l=e.getSource().getFeaturesAtCoordinate(t);if(!l||l.length<1)return"";o=l[0].values_[this.xzqdm_field]}return R.log(o),o}initMousePosition(){this.map.getViewport().removeEventListener("mousemove",()=>{}),this.map.getViewport().addEventListener("mousemove",t=>{this.mousePosition=this.map.getEventCoordinate(t)})}removeListener(t){t=t||this,t.map.getViewport().removeEventListener("mousemove",()=>{}),(0,j.B)(t.drillDownEvt),this.clickEvt&&this.map.un(this.clickEvt.type,this.clickEvt.listener)}clear(){var t=g()("[id^=bubblecharts_]");if(g()("#bubbleLegend").length>0&&g()("#bubbleLegend")[0].remove(),t.length>0)for(let i=0;i<t.length;i++)t[i].parentElement.remove();this.clearXZQ()}addOnClickListener(t){this.onBubbleClickListener=t}}var at=n(641739),rt=n(386892),V=n(927966),dt=n(242709),ht=n(783574),ut={name:"GisThemeBubble",components:{HideButton:E.Z},mixins:[rt.D,C.P,u.u,f.H,dt.Z,ht.default],props:["widgetInfo"],data(){return this.bubble,{xzqdm:null,zoomwatch:!1,actionName:null,actionParam:null,isPostMessage:null}},watch:{xzqdm:function(d){this.zoomwatch&&(this.actionParam.xzq_code=d,V.Z.$emit(this.actionName,this.actionParam),this.isPostMessage&&this.doPostMessage(this.actionParam))}},beforeDestroy(){this.bubble&&this.bubble.clear()},mounted(){this.initBubble(),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},methods:{loadInfo(){let d=this;at.default.$on("mapSearch",t=>{d.zoomwatch=!t})},reLoadInfo(d){this.loadInfo(d),this.initBubble()},initAction(d){this.actionSendout(d),this.actionReceive(d)},initBubble(){this.$map&&(this.bubble||(this.bubble=new lt(this.$map,d=>{this.xzqdm=d}),this.bubble.addOnClickListener(d=>{this.bubbleClick(d)})),this.initTotalData(this.widgetInfo),this.widgetInfo.config.totaldata&&Object.keys(this.widgetInfo.config.totaldata).length>0&&this.bubble.initBubble(this.lifecycleBeforeChartsLoad(this.widgetInfo.config)))},initTotalData(d){d.config.totaldata={};let t=d.dataset.type||"",e=(d.dataset||{})[t]||{},o=e.encode.x,l=e.dimensions.indexOf(o);d.dataset[d.dataset.type].source.forEach(a=>{let r=[];d.config.fontConfig.forEach(v=>{let P=d.dataset[d.dataset.type].dimensions.indexOf(v.staticField),m=null,L=null;v.name=v.name||v.staticField,d.config.positions.forEach(S=>{if(S.key===v.position)return m=S.points[0][a[l]],L=S.wkid,!1});let w={value:a[P],positionPoint:m,wkid:L};r.push(w)});let h=a[l].toString();I.default.set(d.config.totaldata,h,r)})},onZoom(d,t,i){this.zoomwatch=!0,this.actionName=d,this.actionParam=t,this.isPostMessage=i},bubbleClick(d){let t=this,i=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(i,e=>{if(e.enabled&&e.code==t.$$global_editor.actionType.identify.code){let o=e.code+"_"+t.widgetInfo.id,s={...d};if(e.paramsExtend&&e.paramsExtend.length>0&&this.getExtendParams(s,e.paramsExtend,d,[]),e.script&&e.script.enabled&&e.script.content){this.doConfigMap=new Function("data",e.script.content);let l=this.doConfigMap(s);l&&(s=l)}V.Z.$emit(o,s),e.postMessage&&this.doPostMessage(s),this.actionNameList.push(o)}})},doShow(){this.initBubble()},doHide(){this.bubble&&this.bubble.clear()}}},ft=ut,pt=n(768141),ct=(0,pt.Z)(ft,z,b,!1,null,"330866d0",null),mt=ct.exports},407490:function(O){O.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAC4UlEQVRYR+2XQVLbQBBF/5+YJLsILoBdhb2NOUHMCTAniLNE3pATxJwgZmGzjHOC+AaIE+BsbaogFzDaAq7pVA+RLIOUSMLs4pWsmp5+6pn5/YdI/LzBtENyH4CXfL/G51DAcejvfI/mpD54X688vr4/I9lcY7LMqURkIncbe+HnWugANoezgMAHFyE8sUQASrhWGKFnBC2hdAi8EyC48et79AbTpiEvNJkl9sLDepA3scaG3cYk73hX7WQ+8IBbg1kPxBcBzm/8eivvZDoRwTO5q9S0lHnjXMUHszGJfQiOYwD9M+/We3knipdNeDLv7hzljdNx0UeXBvCGl20D+REltSK7RZbi2QCbg9k1ie0IINpQeavwLIA4+FE2Cx6E/s44D0RpAO/0qkq7uCCfCpUIlhuRmAhxnHWiSgNsDacjgB/zfKU71iKfwm5j9Hh8KQDvdNYygrO8yZ2mCUIxld3wsHadjCsFsKKWBSjS9kZhAG1ShvxWIO9yaIq+lAMAq2kAQhyptmfBpcl7YYC/fXnWsXR7APLzxm886bBrBVjR9gSpCH4JpJ2mkGsHcF1O5VnQAq1nwQluK6OsJvUiAEU26H+AUhVwWmAYd8Co5PPD+nHc4w3ESTBwDivVNBku7QeUWg2L6wfklSYxFi19pzIN5/mk6caoywKQZXBKVUCDLB86noE0raBvwLYm2RxOJ3reFU7AKgXOV74IwJ/kgXHKSE/tmHo8MehrRRTSyEO7Xj+AqYwgi22I1HR942XR6kDGMPQUIt4fGR6z9BK49R5MmyBbICbRHliCXPbt3ase3sIzdtEpVIF/2fJoY60IDqU69xsdPSEwGwHsvafSq84JsmiHfr2fJlCxsVFbvnJRKOhui6hfNDZp69QrrFzN1MGQGFkgl7ksDCCil5meesqoUy4vp2/uA4LvC09aIkCTCzfaatUcQFye4UzNRRuCatL3l8jxJETbM4hr0eomOuVvp7hPE51KsTcAAAAASUVORK5CYII="},15130:function(O,x,n){var z=n(166583),b=n(89663),E=n(545059),I=function(){var u=function(f,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,y){c.__proto__=y}||function(c,y){for(var A in y)Object.prototype.hasOwnProperty.call(y,A)&&(c[A]=y[A])},u(f,p)};return function(f,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");u(f,p);function c(){this.constructor=f}f.prototype=p===null?Object.create(p):(c.prototype=p.prototype,new c)}}(),C=function(u){I(f,u);function f(p){var c=this,y=p||{},A=(0,E.f0)({},y);return delete A.preload,delete A.useInterimTilesOnError,c=u.call(this,A)||this,c.on,c.once,c.un,c.setPreload(y.preload!==void 0?y.preload:0),c.setUseInterimTilesOnError(y.useInterimTilesOnError!==void 0?y.useInterimTilesOnError:!0),c}return f.prototype.getPreload=function(){return this.get(b.Z.PRELOAD)},f.prototype.setPreload=function(p){this.set(b.Z.PRELOAD,p)},f.prototype.getUseInterimTilesOnError=function(){return this.get(b.Z.USE_INTERIM_TILES_ON_ERROR)},f.prototype.setUseInterimTilesOnError=function(p){this.set(b.Z.USE_INTERIM_TILES_ON_ERROR,p)},f.prototype.getData=function(p){return u.prototype.getData.call(this,p)},f}(z.Z);x.Z=C},313927:function(O,x,n){n.r(x);var z=n(15130),b=n(727464),E=function(){var C=function(u,f){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,c){p.__proto__=c}||function(p,c){for(var y in c)Object.prototype.hasOwnProperty.call(c,y)&&(p[y]=c[y])},C(u,f)};return function(u,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");C(u,f);function p(){this.constructor=u}u.prototype=f===null?Object.create(f):(p.prototype=f.prototype,new p)}}(),I=function(C){E(u,C);function u(f){return C.call(this,f)||this}return u.prototype.createRenderer=function(){return new b.Z(this)},u}(z.Z);x.default=I},845503:function(O,x,n){n.d(x,{e:function(){return z}});var z="1.3.0"},610416:function(O,x,n){n.d(x,{B:function(){return z}});function z(b,E){var I=[];Object.keys(E).forEach(function(u){E[u]!==null&&E[u]!==void 0&&I.push(u+"="+encodeURIComponent(E[u]))});var C=I.join("&");return b=b.replace(/[?&]$/,""),b=b.indexOf("?")===-1?b+"?":b+"&",b+C}}}]);
