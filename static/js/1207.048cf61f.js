"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[1207],{56279:function(b,h,a){a.d(h,{P:function(){return p}});var u=a(86892),l=a(49500);const p={mixins:[u.D],created(){},methods:{lifecycleBeforeChartsLoad(c){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&l.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),l.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let r=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[c]);if(r)return r}return c},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&l.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),l.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},44513:function(b,h,a){a.d(h,{Z:function(){return I}});var u=function(){var i=this,g=i._self._c;return i.attr.buttonHide?g("div",{style:{position:"absolute",right:i.attr.buttonHideRight+"px",top:i.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(S){return i.onHide()}}},[i.openTooltip?g("el-tooltip",{attrs:{"open-delay":1e3,content:i.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[g("el-button",{class:i.attr.buttonHideIconClass&&i.attr.buttonHideIconClass!=""?i.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:i.attr.buttonHideColor,fontSize:i.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):g("el-button",{class:i.attr.buttonHideIconClass&&i.attr.buttonHideIconClass!=""?i.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:i.attr.buttonHideColor,fontSize:i.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):i._e()},l=[],p=a(52246),c={props:["attr"],name:"hide-button",data(){return{isPc:p.b}},computed:{openTooltip:function(){let m=!1,i=this.attr.buttonHideTooltipContent;return p.b&&i&&i!=null&&i.trim()!=""&&(m=!0),m}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},y=c,r=a(68141),w=(0,r.Z)(y,u,l,!1,null,"bf399b9a",null),I=w.exports},51207:function(b,h,a){a.r(h),a.d(h,{default:function(){return z}});var u=function(){var e=this,n=e._self._c;return n("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],ref:"buttonGroup",style:{width:e.widgetInfo.attr.w+"px",cursor:"pointer",height:e.widgetInfo.attr.hh+"px"},attrs:{"element-loading-text":"\u6B63\u5728\u4E0B\u8F7D\u4E2D","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.6)"},on:{click:function(o){return e.onDownloadExcel()}}},[n("hide-button",{attrs:{attr:e.widgetInfo.attr}}),n("div",{style:e.getStyle(e.widgetInfo.config)},[n("i",{class:e.widgetInfo.config.text.icon}),e._v(e._s(e.widgetInfo.config.text.label)+" ")])],1)},l=[],p=a(44513),c=a(93575),y=a(75416),r=a(55616),w=a(42160),I=a(27966),m=a(45061),i=a(56279),g=a(67157);const S={mixins:[g.c],data(){return{config_extend:{config:{text:{fontStyle:{color:"#99C999"},padding:{top:3,left:7}}}},filter_config:{text:{fontStyle:{color:"#99C999"}}}}},methods:{filterPredefineColoursSchemeConfig(t,e){this.getNewConfigWithArrary(t,e,this.filter_config)}}};var C=a(75770),x=a(49500),P={props:["widgetInfo"],name:"download-excel",components:{HideButton:p.Z},mixins:[y.u,c.E,m.u,i.P,S],data(){return{fullscreenLoading:!1}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(t){t.dataset&&t.dataset.type!="static"&&(t.dataset[t.dataset.type].source=[]),this.lifecycleAfterLoad()},reLoadInfo(t){this.loadInfo(t)},initAction(t){this.actionReceive(t),this.replaceParams(t)},onDownloadExcel(){if(this.widgetInfo.dataset[this.widgetInfo.dataset.type].dataSetId==null||this.widgetInfo.dataset[this.widgetInfo.dataset.type].dataSetId==""||this.widgetInfo.dataset[this.widgetInfo.dataset.type].dataSetId==null){r.Message.warning("\u5C1A\u672A\u914D\u7F6E\u6570\u636E\u96C6\u4FE1\u606F");return}if(this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode.columns){let t=this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode.columns.split(",");if(t.length>0){let e=this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensionsAlias,n=[];t.forEach(o=>{let d=e.find(s=>s.name==o);d&&n.push(d)}),n.length>0&&(this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensionsAlias=n)}}this.sendOutAction(),this.downloadExcel(JSON.stringify(this.widgetInfo.dataset))},getStyle(t){return{paddingLeft:this.mUtils.getNewPxW(t.text.padding.left)+"px",paddingTop:this.mUtils.getNewPxH(t.text.padding.top)+"px",fontSize:this.mUtils.getNewFontSize(t.text.fontStyle.fontSize)+"px",color:t.text.fontStyle.color,fontWeight:t.text.fontStyle.fontWeight,fontFamily:t.text.fontStyle.fontFamily,fontStyle:t.text.fontStyle.fontStyle,textDecoration:t.text.fontStyle.textDecoration,textAlign:t.text.fontStyle.horizontalAlignment}},replaceParams(t){if(t.action==null||t.action.receive==null)return;let e=t.action.receive.replaceParams;if(e&&e.enabled){let n=e.replaceList;this.doParams(n,t)}},doParams(t,e){let n={};if(this.$$lib__.each(t,o=>{let d=o.replaceParam;for(let s=0;s<d.length;s++)if(d[s].length==3){let f="",v=d[s][2],L=v.indexOf("|");d[s][1].indexOf("_")>-1&&(f=d[s][1]),L>-1&&(v=d[s][2].substring(L+1)),n[f]||w.default.set(n,f,{}),n[f][o.param]||w.default.set(n[f],o.param,v)}}),!this.$$lib__.isEmpty(n))for(let o in n)I.Z.$on(o,d=>{(e.dataset[e.dataset.type].query==null||!e.dataset[e.dataset.type].query.params==null)&&(e.dataset[e.dataset.type].query={params:[],page:{enabled:!1,pageNum:1,pageSize:10},orders:[]});let s=!0;if(e.action.receive.replaceParams.script&&e.action.receive.replaceParams.script.enabled){if(x.log("Execute script for "+e.name+" component to replace dataset parameters"),e.action.receive.replaceParams.script.content==""){r.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60}),s=!1;return}this.doActionParams=new Function("info","data","param_key",e.action.receive.replaceParams.script.content)}s&&this.doActionParams(e,d,n[o])})},doActionParams(t,e,n){let o=t.dataset[t.dataset.type].query.params;for(let d in n)this.$$lib__.each(o,s=>{if(s.name==d){let f=n[d];s.defaultVal=e[f]}});x.info(o),this.widgetInfo.dataset[this.widgetInfo.dataset.type].query.params=JSON.parse(JSON.stringify(o)),x.info(this.widgetInfo.dataset[this.widgetInfo.dataset.type].query.params)},sendOutAction(){this.$$lib__.each(this.widgetInfo.action.sendOut.actionList,t=>{if(t.enabled&&t.code==C.Z.click.code){let e={text:this.widgetInfo.config.text.label};if(t.paramsExtend&&t.paramsExtend.length>0){let o=[];this.widgetInfo.dataset[this.widgetInfo.dataset.type].source&&this.widgetInfo.dataset[this.widgetInfo.dataset.type].source.length>0&&(o=this.widgetInfo.dataset[this.widgetInfo.dataset.type].source[0]),this.getExtendParams(e,t.paramsExtend,o,this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions)}let n=t.code+"_"+this.widgetInfo.id;if(t.script&&t.script.enabled){if(x.log("Execute script for "+this.widgetInfo.name+" component to "+t.name+" component"),t.script.content==""){r.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}e=new Function("param",t.script.content).apply(this,[e])}I.Z.$emit(n,e),t.postMessage&&this.doPostMessage(e),this.actionNameList.push(n)}})}}},H=P,E=a(68141),N=(0,E.Z)(H,u,l,!1,null,"0ef29a46",null),z=N.exports}}]);
