"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[1e3],{41e3:function(k,c,o){o.r(c),o.d(c,{default:function(){return v}});var a=function(){var e=this,i=e._self._c;return i("div",[i("button-tooltip",{attrs:{button_config:e.button_info}},[i("el-popover",{attrs:{trigger:e.button_info.trigger,placement:"bottom-end","popper-class":"query-popover-customer-condition"}},[e.accessType!=e.global_query.accessType.public.code?i("div",{style:{overflowY:"auto",maxHeight:e.table_height+"px"}},[i("el-tree",{ref:"refCustomerConditionsTree",attrs:{data:e.customer_conditions_tree,"default-checked-keys":e.default_checked_keys!=null?e.default_checked_keys:e.displayCustomerConditions,"node-key":"id","show-checkbox":""},on:{check:e.handleCheck},scopedSlots:e._u([{key:"default",fn:function({node:s,data:r}){return i("span",{},[r.id=="check_all"?i("el-tooltip",{attrs:{"open-delay":1e3,content:"\u5168\u9009/\u53D6\u6D88\u5168\u9009",effect:"light",placement:"top"}},[i("span",{class:r.isCustomerField==!0?"query-popover-customer-condition-tree-node-active":""},[e._v(" "+e._s(s.label)+" ")])]):r.isCustomerCondition?i("el-tooltip",{attrs:{"open-delay":1e3,content:"\u5DF2\u8BBE\u7F6E\u6B64\u6761\u4EF6\u81EA\u5B9A\u4E49\u663E\u793A",effect:"light",placement:"top"}},[i("span",{staticClass:"query-popover-customer-condition-tree-node-active"},[e._v(" "+e._s(s.label)+" ")])]):i("el-tooltip",{attrs:{"open-delay":1e3,content:"\u5C1A\u672A\u81EA\u5B9A\u4E49\u663E\u793A",effect:"light",placement:"top"}},[i("span",[e._v(" "+e._s(s.label)+" ")])])],1)}}],null,!1,3699789798)})],1):e._e(),i("div",{staticClass:"query-popover-customer-condition-button"},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(s){return e.saveCustomerConditions(e.button_info,"new")}}},[e._v("\u4FDD\u5B58\u8BBE\u7F6E ")]),i("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(s){return e.saveCustomerConditions(e.button_info,"recovery")}}},[e._v("\u8FD8\u539F\u9ED8\u8BA4 ")])],1),e.accessType!=e.global_query.accessType.public.code?i("el-button",{class:`gisq-query-button el-button--${e.button_info.colorType}`,style:e.buttonStyle(e.button_info),attrs:{slot:"reference",circle:e.button_info.style=="circle",disabled:e.button_info.disabled,plain:e.button_info.style=="plain",round:e.button_info.style=="round",size:e.button_info.size,type:e.button_info.style=="text"?"text":""},on:{click:function(s){return e.onClickButton(e.button_info)}},slot:"reference"},[!e.button_info.icon_align||e.button_info.icon_align==e.global_query.position.left.code?i("i",{class:e.button_info.icon}):e._e(),e._v(" "+e._s(e.button_info.label)+" "),e.button_info.icon_align==e.global_query.position.right.code?i("i",{class:e.button_info.icon}):e._e(),i("i",{staticClass:"el-icon-arrow-down el-icon--right"})]):e._e()],1)],1)],1)},d=[],f=o(78931),n=o(55616),u=o(48836),h=o(52013),_=o(79876),p=o(50707),l=o(49500),y={name:"customer-condition",components:{ButtonTooltip:h.Z},props:{button_info:{}},mixins:[_.G],data(){return{global_query:this.$$global_query,displayCustomerConditions:[],default_checked_keys:null,all_keys:[]}},computed:{...(0,u.Se)(["view_height_fun","customerConditionsFun"]),view_height(){return this.view_height_fun(this.widgetId)},customerConditions(){return this.customerConditionsFun(this.widgetId)},customer_conditions_tree(){let t=this,e=[];return t.all_keys=[],t.default_checked_keys=t.customerConditions,t.displayCustomerConditions=[],t.$$lib__.each(t.queryConfig.condition,i=>{JSON.parse(JSON.stringify(i)).hide||(t.all_keys.push(i.guid),t.displayCustomerConditions.push(i.guid),e.push({id:i.guid,label:i.label&&i.label!=""?i.label:i.name,isCustomerCondition:t.getIsCustomerCondition(i.guid)}))}),e=t.$$lib__.sortBy(e,"order"),e.length>0&&(t.default_checked_keys!=null?t.$$lib__.difference(t.all_keys,t.default_checked_keys).length==0&&t.default_checked_keys.push("check_all"):t.displayCustomerConditions&&t.$$lib__.difference(t.all_keys,t.displayCustomerConditions).length==0&&t.displayCustomerConditions.push("check_all"),e.unshift({id:"check_all",label:"\u5168\u9009",isCustomerCondition:t.getIsCustomerCondition("check_all")})),e},table_height(){return this.view_height.page-this.view_height.header-this.view_height.footer}},methods:{...(0,u.nv)(["setCustomerConditions"]),handleCheck(t,e){let i=[];if(t.id=="check_all")this.$$lib__.difference(this.all_keys,e.checkedKeys).length>0&&(i=JSON.parse(JSON.stringify(this.all_keys)));else{let s=this.$refs.refCustomerConditionsTree.getCheckedNodes();i=this.$$lib__.pluck(s,"id"),this.$$lib__.difference(this.all_keys,e.checkedKeys).length==0?i.push("check_all"):i=this.$$lib__.without(i,"check_all")}this.setCustomerConditions({customerConditions:i,widgetId:this.widgetId})},saveCustomerConditions(t,e){let i=null;if(e=="new"){let s=this.$refs.refCustomerConditionsTree.getCheckedNodes();i=this.$$lib__.pluck(s,"id")}if(t.is_click){if(!t.script_click||t.script_click==""){l.warn("\u6309\u94AE\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+t.name+" \u811A\u672C\u4E3A\u7A7A");return}l.info("\u6267\u884C\u6309\u94AE\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+t.name+" \u811A\u672C"),new Function("customerConditionsInfo",t.script_click).apply(this,[i])}else this.doSaveCustomerConditions(i)},doSaveCustomerConditions(t,e){let i=t!=null?JSON.stringify(t):null;if(this.accessType){if(this.queryId==null&&this.queryPublishId==null){l.error("\u67E5\u8BE2\u5217\u8868ID\u548C\u7248\u672CID  \u81F3\u5C11\u6709\u4E00\u4E2A"),n.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60});return}switch(this.accessType){case this.global.editType.original.code:p._.saveCustomerConditions(i,this.queryId,this.queryPublishId).then(s=>{this.afterSave(t,s,e)});break;case this.global.editType.public.code:n.Message.error({message:"\u516C\u5F00\u7248\u672C\uFF0C\u65E0\u6CD5\u83B7\u53D6\u7528\u6237\u4FE1\u606F\uFF0C\u5373\u65E0\u6CD5\u4F7F\u7528\u6B64\u529F\u80FD",offset:60});break;default:n.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60})}}else this.queryId?f.y.saveCustomerConditions(i,this.queryId).then(s=>{this.afterSave(t,s,e)}):n.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u8BBE\u67E5\u8BE2\u5217\u8868\u4E3B\u952E\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60})},afterSave(t,e,i){e&&e.status==200?(this.setCustomerConditions({customerConditions:t,widgetId:this.widgetId}),i&&i(),n.Message.success({message:t!=null?"\u4FDD\u5B58\u6210\u529F":"\u8FD8\u539F\u6210\u529F",offset:60})):n.Message.error({message:e.msg,offset:60})},getIsCustomerCondition(t){let e=this.default_checked_keys!=null?this.default_checked_keys:this.displayCustomerConditions;return this.$$lib__.contains(e,t)},onClickButton(t){this.buttonClick(t)},buttonClick(t){if(!t.is_click)return;if(!t.script_click||t.script_click==""){l.warn("\u6309\u94AE\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+t.name+" \u811A\u672C\u4E3A\u7A7A");return}l.info("\u6267\u884C\u6309\u94AE\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+t.name+" \u811A\u672C"),new Function(t.script_click).apply(this)}}},m=y,C=o(68141),g=(0,C.Z)(m,a,d,!1,null,"2d71b352",null),v=g.exports}}]);
