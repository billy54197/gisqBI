"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[3238],{703238:function(B,g,d){d.r(g),d.d(g,{default:function(){return D}});var f=function(){var e=this,n=e._self._c;return n("div",[n("el-form",{ref:"form",attrs:{size:"mini","label-width":"70px","label-position":"right",model:e.currentWidget.dataset},nativeOn:{submit:function(t){t.preventDefault()}}},[n("div",[n("el-form-item",{attrs:{label:"\u6570\u636E\u7C7B\u578B"}},[n("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90\u7C7B\u578B"},on:{change:e.changeDatasetType},model:{value:e.currentWidget.dataset.type,callback:function(t){e.$set(e.currentWidget.dataset,"type",t)},expression:"currentWidget.dataset.type"}},e._l(e.$$global_editor.dataSourcTypeList,function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),n("div",[n("el-form-item",{attrs:{label:"\u884C\u653F\u533A"}},[n("el-select",{ref:"encodeX",attrs:{size:"mini",placeholder:"\u8BF7\u9009\u62E9\u884C\u653F\u533A\u5B57\u6BB5"},on:{change:e.getConfigData},model:{value:e.currentWidget.dataset[e.currentWidget.dataset.type].encode.x,callback:function(t){e.$set(e.currentWidget.dataset[e.currentWidget.dataset.type].encode,"x",t)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.x"}},e._l(e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias,function(t){return n("el-option",{key:t.name,attrs:{label:t.alias!=""?t.alias:t.name,value:t.name}})}),1)],1),n("el-form-item",{attrs:{label:"\u7EDF\u8BA1\u5B57\u6BB5"}},[n("div",{staticStyle:{width:"0px",height:"0px"},domProps:{innerHTML:e._s(e.initCreateBubble)}}),n("el-select",{ref:"encodeY",attrs:{size:"mini",multiple:!0,"multiple-limit":3,placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u5B57\u6BB5"},on:{change:e.changeDimensionsAlias},model:{value:e.currentWidget.dataset[e.currentWidget.dataset.type].encode.y,callback:function(t){e.$set(e.currentWidget.dataset[e.currentWidget.dataset.type].encode,"y",t)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.y"}},e._l(e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias,function(t){return n("el-option",{key:t.name,attrs:{label:t.alias!=""?t.alias:t.name,value:t.name}})}),1)],1)],1),n("setting-dataset",{ref:"settingDataset",attrs:{"current-widget":e.currentWidget},on:{getDataSetData:e.getConfigData,clearDynamicEncode:e.clearDynamicEncode}})],1)])],1)},b=[],h=d(723400),p=d(589908),E=d(927966),m=d(42160),W={name:"GisThemeBubbleData",components:{SettingDataset:p.Z},mixins:[h.j],props:["currentWidget"],data(){return{isInit:!1}},computed:{initCreateBubble(){this.isInit||(this.isInit=!0)}},mounted(){this.getConfigData()},methods:{changeDatasetType(){this.$refs.settingDataset.loadPreview(),this.currentWidget.config.fontConfig=[],this.initBubble(),this.getConfigData()},initBubble(){let a=this;a.currentWidget.dataset[a.currentWidget.dataset.type].dimensionsAlias.forEach((e,n)=>{if(e.name!=a.currentWidget.dataset[a.currentWidget.dataset.type].encode.x){let t=!1;if(a.currentWidget.config.fontConfig.forEach((r,i)=>{if(r.staticField==e.name){let o=e.alias;return e.alias==""&&(o=e.name),r.name=r.name||o,t=!0,!1}}),!t){let r=e.alias;e.alias==""&&(r=e.name);let i={name:r,staticField:e.name,color:"rgba(199, 21, 133, 1)",bubbleColor:"rgba(210, 203, 76, 0.9)",bubbleShadowColor:"rgba(162, 235, 16, 1)",imgUrl:"",imgBI:"",position:a.currentWidget.config.positions[0].key};a.currentWidget.config.fontConfig.push(i)}}}),a.currentWidget.config.fontConfig.forEach((e,n)=>{a.currentWidget.dataset[a.currentWidget.dataset.type].dimensionsAlias.some((r,i)=>e.staticField===r.name)||a.currentWidget.config.fontConfig.splice(n,1)}),a.initTotalData()},initTotalData(){this.currentWidget.config.totaldata={};let a=this;a.currentWidget.dataset[a.currentWidget.dataset.type].source.forEach((e,n)=>{let t=[];a.currentWidget.config.fontConfig.forEach((i,o)=>{let s=a.currentWidget.dataset[a.currentWidget.dataset.type].dimensions.indexOf(i.staticField),l=null,c=null;i.name=i.name||i.staticField,a.currentWidget.config.positions.forEach((u,F)=>{if(u.key===i.position)return l=u.points[0][e[0]],c=u.wkid,!1});let x={value:e[s],positionPoint:l,wkid:c};t.push(x)});let r=e[0].toString();m.default.set(a.currentWidget.config.totaldata,r,t)})},clearDynamicEncode(){this.currentWidget.dataset.dynamic.encode.x="",this.currentWidget.dataset.dynamic.encode.y=[]},addBubble(a,e){this.config.fontConfig.push(fontConfitItem),this.currentWidget.config.fontConfig=this.config.fontConfig},changeDimensionsAlias(a){let e=this;a.forEach((t,r)=>{let i=null;i=e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias.filter((s,l)=>s.name===t);let o=!1;if(e.currentWidget.config.fontConfig.forEach((s,l)=>{if(s.staticField==t)return i&&i.length>0&&(s.name=s.name||i[0].alias),o=!0,!1}),!o){let s=i[0].alias;s==""&&(s=i[0].name);let l=0;e.currentWidget.config.fontConfig.length==0?l=0:(e.currentWidget.config.fontConfig.length<=1,l=1);let c={name:s,staticField:i[0].name,color:"rgba(199, 21, 133, 1)",bubbleColor:"rgba(210, 203, 76, 0.9)",bubbleShadowColor:"rgba(162, 235, 16, 1)",position:e.currentWidget.config.positions[l].key};e.currentWidget.config.fontConfig.push(c)}});let n=a;this.currentWidget.config.fontConfig.forEach((t,r)=>{n.some((o,s)=>t.staticField===o)||this.currentWidget.config.fontConfig.splice(r,1)}),e.initTotalData(),e.getConfigData()}}},y=W,v=d(768141),C=(0,v.Z)(y,f,b,!1,null,"2dabcaab",null),D=C.exports}}]);
