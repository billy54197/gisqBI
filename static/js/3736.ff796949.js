(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[3736],{1018:function(et,L,g){et.exports=function(a){var C={};function s(f){if(C[f])return C[f].exports;var y=C[f]={i:f,l:!1,exports:{}};return a[f].call(y.exports,y,y.exports,s),y.l=!0,y.exports}return s.m=a,s.c=C,s.d=function(f,y,B){s.o(f,y)||Object.defineProperty(f,y,{enumerable:!0,get:B})},s.r=function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},s.t=function(f,y){if(y&1&&(f=s(f)),y&8||y&4&&typeof f=="object"&&f&&f.__esModule)return f;var B=Object.create(null);if(s.r(B),Object.defineProperty(B,"default",{enumerable:!0,value:f}),y&2&&typeof f!="string")for(var k in f)s.d(B,k,function(S){return f[S]}.bind(null,k));return B},s.n=function(f){var y=f&&f.__esModule?function(){return f.default}:function(){return f};return s.d(y,"a",y),y},s.o=function(f,y){return Object.prototype.hasOwnProperty.call(f,y)},s.p="/dist/",s(s.s=790)}({0:function(a,C){a.exports=g(42579)},1:function(a,C){a.exports=g(28866)},2:function(a,C,s){"use strict";s.d(C,"a",function(){return f});function f(y,B,k,S,R,G,t,X){var E=typeof y=="function"?y.options:y;B&&(E.render=B,E.staticRenderFns=k,E._compiled=!0),S&&(E.functional=!0),G&&(E._scopeId="data-v-"+G);var w;if(t?(w=function(N){N=N||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!N&&typeof __VUE_SSR_CONTEXT__<"u"&&(N=__VUE_SSR_CONTEXT__),R&&R.call(this,N),N&&N._registeredComponents&&N._registeredComponents.add(t)},E._ssrRegister=w):R&&(w=X?function(){R.call(this,(E.functional?this.parent:this).$root.$options.shadowRoot)}:R),w)if(E.functional){E._injectStyles=w;var F=E.render;E.render=function(q,D){return w.call(D),F(q,D)}}else{var $=E.beforeCreate;E.beforeCreate=$?[].concat($,w):[w]}return{exports:y,options:E}}},22:function(a,C){a.exports=g(69033)},28:function(a,C){a.exports=g(32726)},30:function(a,C){a.exports=g(32569)},32:function(a,C){a.exports=g(17745)},4:function(a,C){a.exports=g(55616)},43:function(a,C){a.exports=g(47806)},482:function(a,C){a.exports=g(36158)},6:function(a,C){a.exports=g(83574)},63:function(a,C){a.exports=g(36161)},69:function(a,C){a.exports=g(99245)},7:function(a,C){a.exports=g(17249)},790:function(a,C,s){"use strict";s.r(C);var f=s(0),y=s.n(f),B=function(){var n=this,c=n.$createElement,o=n._self._c||c;return o("div",{directives:[{name:"show",rawName:"v-show",value:n.shouldShow,expression:"shouldShow"}],staticClass:"sh-clip-tools"},[o("general-container",{attrs:{"is-show":n.visible,title:n.title?n.title:"\u4EFB\u610F\u88C1\u5207\u9762","img-src":n.imgSrc?n.imgSrc:"clip-tools","style-config":n.styleConfig,position:n.position,theme:n.theme,"drag-enable":n.dragEnable,"append-to-body":n.appendToBody,"theme-style":n.cardThemeStyle,"only-container":n.onlyContainer},on:{"update:isShow":function(p){n.visible=p},"update:is-show":function(p){n.visible=p},"change:isShow":n.onChangeIsShow}},[o("div",{staticClass:"clip_content"},[o("div",{staticClass:"clip_layers",class:{more:n.select_layers.length==1}},[o("span",{staticClass:"layers_label"},[n._v("\u88C1\u526A\u74E6\u7247\uFF1A")]),o("el-select",{attrs:{size:"mini",multiple:"","collapse-tags":"",placeholder:"\u8BF7\u9009\u62E9"},on:{change:function(p){return n.changeTileset()}},model:{value:n.select_layers,callback:function(p){n.select_layers=p},expression:"select_layers"}},n._l(n.layer3dtiles,function(p){return o("el-option",{key:p.value,attrs:{label:p.label,value:p.id}})}),1),o("icon-svg",{staticStyle:{cursor:"pointer","margin-left":"15px"},attrs:{"icon-class":n.isEntityShow?"display":"hide"},nativeOn:{click:function(p){return n.handleShow()}}})],1),o("div",{staticClass:"clip_type"},[o("el-radio-group",{on:{change:function(p){return n.changeType()}},model:{value:n.clip_type,callback:function(p){n.clip_type=p},expression:"clip_type"}},[o("el-radio",{attrs:{label:0}},[n._v("\u6C34\u5E73\u9762")]),o("el-radio",{attrs:{label:1}},[n._v("\u7ACB\u9762")]),o("el-radio",{attrs:{label:2}},[n._v("\u76D2\u5B50")]),o("el-radio",{attrs:{label:3}},[n._v("\u51F8\u591A\u8FB9\u5F62")])],1)],1),n.clip_type==2?o("div",{staticClass:"clip_nw"},[o("el-radio-group",{attrs:{size:"mini"},on:{change:function(p){return n.changeUnionClippingRegions()}},model:{value:n.isOutside,callback:function(p){n.isOutside=p},expression:"isOutside"}},[o("el-radio-button",{attrs:{label:!1}},[n._v("\u88C1\u5207\u76D2\u5185")]),o("el-radio-button",{attrs:{label:!0}},[n._v("\u88C1\u5207\u76D2\u5916")])],1)],1):n._e(),o("div",{staticClass:"btnBox"},[o("div",{staticClass:"btn",on:{click:function(p){return n.startClip()}}},[n._v("\u5F00\u59CB\u88C1\u526A")]),o("div",{staticClass:"btn",on:{click:function(p){return n.delPlane()}}},[n._v("\u6E05\u9664")])])])])],1)},k=[];B._withStripped=!0;var S=s(69),R=s.n(S),G=s(8),t=s.n(G),X=s(1),E=s.n(X),w=s(22),F=s.n(w),$=s(80),N=s(90),q=s(63),D=s(97),b=s(482),e=s(32),i=s.n(e),d=s(30),l=s.n(d),r=s(6),u=s.n(r),h=s(43),v=s.n(h),x=s(7),T=s.n(x),H=s(4),P,m,O,I,M=[],j=[],V={name:"ShClipTools",components:{GeneralContainer:l.a,IconSvg:i.a},mixins:[u.a,v.a,T.a],data:function(){return{shouldShow:!1,layer3dtiles:[],clip_type:0,select_layers:[],isSelected:!1,isOutside:!1,checkedLayers:null,rotation:0,isEntityShow:!0}},watch:{currentView:{handler:function(c){this.shouldShow=c==="earth"},immediate:!0},clip_type:function(c){c===4?m.hasEdit(!1):m.hasEdit(!0)},checkedLayers:function(c){var o=this;this.layer3dtiles=[],j=t()(c).call(c,function(p){return y()(this,o),p.type==="3dtiles"||p.type==="S3M"||p.type==="I3S"}.bind(this)),E()(j).call(j,function(p){y()(this,o);var z={};z.label=p.label,z.id=p.id,this.layer3dtiles.push(z)}.bind(this)),j.length===0&&(this.select_layers=[],m.clearDraw())}},mounted:function(){var c=this;this.$earth&&setTimeout(function(){y()(this,c),this.begin()}.bind(this),0)},beforeDestroy:function(){for(var c=0;c<M.length;c++)M[c].backFaceCulling=!0;this.delPlane()},methods:{onChangeIsShow:function(c){if(this.$emit("change:isShow",c),!c){for(var o=0;o<M.length;o++)M[o].backFaceCulling=!0;this.delPlane(),this.stopDraw()}},begin:function(){P=this.$earth.viewer,this.initDraw()},initDraw:function(){var c=this,o=this;this.checkedLayers=P.shine.layerManager.checkedLayers;var p={hasEdit:!0,horizontalBar:!1,labelShow:!0,polygonShow:!0,polylineShow:!0,showToolbar:!0,verticalBar:!0};m=new $.Draw(P,p);var z={visible:!0,id:"clip-tools",type:"geojson-draw"};P.shine.addLayer(z),m.setEditLayer(z.id,!0),m.on("change:active",function(A){y()(this,c),this.$emit("change:active",A.active)}.bind(this));var U=m.getDataSource();I=new b.ClipTools(P,U),m.on(N.DrawCreated,function(A){O=A.entity,o.startEditing(A.entity),o.toClip(),o.clip_type===2&&I.createIndicator(A.entity)}),m.on(N.EditStart,function(A){O=A.entity,o.startEditing(A.entity)})},test:function(){var c=M[0].boundingSphere,o=c.radius;P.zoomTo(M[0],new $.Cesium.HeadingPitchRange(.5,-.2,o*2))},startDraw:function(){this.delPlane();var c={height:50,fill:!0,color:"#FFFFFF",opacity:.2,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.9,rotation:0,clampToGround:!1,zIndex:0,isMoveHeightPlane:!0},o={extrudedHeight:20,fill:!0,color:"#fff",opacity:.2,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.9,clampToGround:!1},p={fill:!0,color:"#fff",opacity:.2,outline:!0,outlineWidth:1,outlineColor:"#ffffff",outlineOpacity:.9,extrudedHeight:10,perPositionHeight:!0,zIndex:0,rotation:this.rotation,isBoxbelow:!0,clampToGround:!1},z={color:"#fff",opacity:.2,outline:!0,outlineWidth:1,outlineColor:"#ffffff",clampToGround:!1,zIndex:0,extrudedHeight:20,isDragBelow:!0};switch(this.clip_type){case 0:m.startDraw({drawtype:"rectangle",style:c,attr:{isClip:!0}});break;case 1:{var U={minPointNum:2,maxPointNum:2,height:!0,isContour:!0,isSameHeight:!0,attr:{isClip:!0}};m.startDraw({drawtype:"wall",style:o,config:U});break}case 2:m.startDraw({drawtype:"polygon",style:p,config:{height:!1,minPointNum:4,maxPointNum:4,isSameHeight:!0,isBox:!0},attr:{isClip:!0}});break;case 3:m.startDraw({drawtype:"polygon",style:z,config:{height:!1,isSameHeight:!0},attr:{isClip:!0}});break}},startEditing:function(){var c=this,o=O.editing.draggers;o.forEach(function(p){var z=this;y()(this,c),p.callback=function(U,A){y()(this,z),I.updatePlane(U,A)}.bind(this)}.bind(this))},startClip:function(){this.select_layers&&this.select_layers.length>0?this.startDraw():H.Message.error("\u8BF7\u9009\u62E9\u88C1\u526A\u74E6\u7247")},handleShow:function(){if(O){this.isEntityShow=!this.isEntityShow;var c=m.getDataSource();c.show=this.isEntityShow}},changeTileset:function(){M=[];for(var c=0;c<this.select_layers.length;c++){var o=P.shine.getLayer(this.select_layers[c],"id");if(o.model)M.push(o.model);else{var p;H.Message.error("\u6682\u65F6\u4E0D\u652F\u6301\u6B64\u7C7B\u670D\u52A1\u7684\u88C1\u5207\uFF01"),F()(p=this.select_layers).call(p,c,1)}}I.setTilesetArr(M)},changeType:function(){I.setType(this.clip_type),m.clearDraw()},changeUnionClippingRegions:function(){I.setOutside(this.isOutside),this.toClip()},delPlane:function(){m.clearDraw(),O=null,I.clearClippingPlane(),this.isEntityShow=!0},toClip:function(){if(O){var c=[],o;switch(this.clip_type){case 0:{var p=Object(q.cartesian2lonlat)(O.editing._positions_draw[0]),z=Object(q.cartesian2lonlat)(O.editing._positions_draw[1]),U=this.computeLonLat(p,z),A=R()(U,4),at=A[0],tt=A[1],ot=A[2],st=A[3],it=p[2],ut=[at,st,it],ct=[tt,st,it],ht=[tt,ot,it],dt=[at,ot,it];o=O.editing.heightDraggers[0].position._value,c=Object(q.lonlats2cartesians)([ut,ct,ht,dt]);break}case 1:{var lt=O.wall.maximumHeights.getValue();c=O.wall.positions.getValue();var gt=Object(D.addPositionsHeight)(c[0],lt[0]),pt=Object(D.addPositionsHeight)(c[1],lt[1]);o=[gt,pt];break}case 2:o=O.editing.heightDraggers[0].position._value,c=O.editing._positions_draw;break;case 3:o=O.editing.heightDraggers[0].position._value,c=O._positions_draw;break}I.toClip(c,o)}},computeLonLat:function(c,o){var p,z,U,A;return c[0]<o[0]?(p=c[0],z=o[0]):(p=o[0],z=c[0]),c[1]<o[1]?(U=c[1],A=o[1]):(U=o[1],A=c[1]),[p,z,U,A]},stopDraw:function(){m&&m.stopDraw()}}},W=V,_=s(2),J=Object(_.a)(W,B,k,!1,null,null,null),K=J.exports,nt=s(28),rt=s.n(nt),Y=void 0,Z=rt()(K,{transform:function(c){y()(this,Y);var o=c.show,p=c.label,z=c.position;return{isShow:o,title:p,position:z}}.bind(void 0)});Z.install=function(n){n.component(Z.name,Z)};var Q=C.default=Z},8:function(a,C){a.exports=g(22466)},80:function(a,C){a.exports=g(25074)},90:function(a,C){a.exports=g(69973)},97:function(a,C){a.exports=g(92672)}})},36158:function(et,L,g){"use strict";var a=g(29870),C=g(87879),s=g(83393),f=g(19534);Object.defineProperty(L,"__esModule",{value:!![]}),L.ClipTools=void 0;var y=f(g(28866)),B=f(g(5146)),k=f(g(36583)),S=f(g(42579)),R=f(g(22777)),G=f(g(42762)),t=N(g(87647)),X=g(80823),E=g(36161),w=g(68821),F=N(g(25794));function $(D){if(typeof C!="function")return null;var b=new C,e=new C;return($=function(d){return d?e:b})(D)}function N(D,b){if(!b&&D&&D.__esModule)return D;if(D===null||a(D)!=="object"&&typeof D!="function")return{default:D};var e=$(b);if(e&&e.has(D))return e.get(D);var i={},d=Object.defineProperty&&s;for(var l in D)if(l!=="default"&&Object.prototype.hasOwnProperty.call(D,l)){var r=d?s(D,l):null;r&&(r.get||r.set)?Object.defineProperty(i,l,r):i[l]=D[l]}return i.default=D,e&&e.set(D,i),i}var q=function(){function D(b,e){(0,R.default)(this,D),this.viewer=b||{},this.dataSource=e,this.arrDistance=[],this.arrNormal=[],this.arrHeight=[],this.tilesetArr=[],this.flattenP=[],this.type=0,this.isOutside=![],this.draggerHandler=null,this.boxEntity=null,this.boxDraggers=[]}return(0,G.default)(D,[{key:"setTilesetArr",value:function(e){this.tilesetArr=e}},{key:"setType",value:function(e){this.type=e}},{key:"setOutside",value:function(e){this.isOutside=e}},{key:"getPosition",value:function(){return this.boxEntity.editing._positions_draw}},{key:"getGraphic",value:function(){return this.boxEntity.polygon}},{key:"getDraggers",value:function(){return this.boxEntity.editing.draggers}},{key:"setPosition",value:function(e){this.boxEntity.editing._positions_draw=e,this.boxEntity._positions_draw=e}},{key:"updatePolygon",value:function(){var e=this;this.boxEntity.polygon.hierarchy=new t.CallbackProperty(function(){var i=e.getPosition();return new t.PolygonHierarchy(i)},![])}},{key:"formatNum",value:function(e,i){return(0,E.formatNum)(e,i)}},{key:"createIndicator",value:function(e){var i,d=this,l;this.boxEntity=e,this.boxDraggers=e.editing.draggers;var r=this.boxDraggers[4].position.getValue(),u=(0,E.cartesian2lonlat)(r);this.dataSource.entities.add({id:"clip_move_surface",name:"move_surface",position:r,ellipse:{semiMinorAxis:4,semiMajorAxis:4,material:t.Color.ORANGE.withAlpha(.5),height:e.polygon.extrudedHeight.getValue()+.02,outline:![]}}),this.dataSource.entities.add({id:"clip_move_line1",name:"move_line1",polyline:{positions:t.Cartesian3.fromDegreesArrayHeights([u[0],u[1],e.polygon.extrudedHeight.getValue()+.06,u[0]+6e-5,u[1],e.polygon.extrudedHeight.getValue()+.06]),width:20,material:new t.PolylineArrowMaterialProperty(t.Color.YELLOW)}}),this.dataSource.entities.add({id:"clip_move_line2",name:"move_line2",polyline:{positions:t.Cartesian3.fromDegreesArrayHeights([u[0],u[1],e.polygon.extrudedHeight.getValue()+.06,u[0],u[1]+5e-5,e.polygon.extrudedHeight.getValue()+.06]),width:20,material:new t.PolylineArrowMaterialProperty(t.Color.YELLOW)}});var h=(0,E.cartesian2lonlat)(r),v={steps:60,units:"meters"},x=F.circle(h,4.5,v),T=F.circle(h,4,v),H=(0,y.default)(i=x.geometry.coordinates[0]).call(i,function(m){return(0,S.default)(this,d),t.Cartesian3.fromDegrees.apply(this,m)}.bind(this)),P=(0,y.default)(l=T.geometry.coordinates[0]).call(l,function(m){return(0,S.default)(this,d),t.Cartesian3.fromDegrees.apply(this,m)}.bind(this));this.dataSource.entities.add({id:"clip_move_circle",name:"move_circle",polygon:{hierarchy:{positions:H,holes:[{positions:P}]},height:e.polygon.extrudedHeight.getValue()+.08}}),this.bindEvent()}},{key:"bindEvent",value:function(){var e=this,i=new t.ScreenSpaceEventHandler(this.viewer.canvas);i.dragger=null;var d,l,r;i.setInputAction(function(u){var h=e.viewer.scene.pick(u.position);if(t.defined(h)){var v=h.id||h.primitive.id||h.primitive;(v.id==="clip_move_surface"||v.id==="clip_move_line1"||v.id==="clip_move_line2"||v.id==="clip_move_circle")&&(e.viewer.scene.screenSpaceCameraController.enableRotate=![],e.viewer.scene.screenSpaceCameraController.enableTilt=![],e.viewer.scene.screenSpaceCameraController.enableTranslate=![],e.viewer.scene.screenSpaceCameraController.enableInputs=![],i.dragger=v,e.viewer._container.style.cursor="crosshair",e.boxEntity.editing.activate(),t.defined(h.id.polyline)&&(d=h.id.polyline,d.material=new t.PolylineArrowMaterialProperty(t.Color.RED)),t.defined(h.id.ellipse)&&(l=h.id.ellipse,l.material=t.Color.RED),t.defined(h.id.polygon)&&(r=h.id.polygon,r.material=t.Color.RED))}},t.ScreenSpaceEventType.LEFT_DOWN),i.setInputAction(function(u){var h=i.dragger;if(h){var v=e.viewer.camera.getPickRay(u.startPosition),x=e.viewer.scene.globe.pick(v,e.viewer.scene,new t.Cartesian3),T=e.viewer.camera.getPickRay(u.endPosition),H=e.viewer.scene.globe.pick(T,e.viewer.scene,new t.Cartesian3),P=t.Cartesian3.subtract(H,x,new t.Cartesian3),m=h.id;switch(m){case"clip_move_surface":var O=t.Cartesian3.subtract(H,x,new t.Cartesian3),I=t.Cartesian3.normalize(O,new t.Cartesian3);e.dragIndicator(P,I);break;case"clip_move_line1":var M=e.dataSource.entities.getById("clip_move_line1").polyline,j=M.positions.getValue(),V=t.Cartesian3.subtract(j[0],j[1],new t.Cartesian3),W=t.Cartesian3.normalize(V,new t.Cartesian3);e.dragIndicator(P,W);break;case"clip_move_line2":var _=e.dataSource.entities.getById("clip_move_line2").polyline,J=_.positions.getValue(),K=t.Cartesian3.subtract(J[0],J[1],new t.Cartesian3),nt=t.Cartesian3.normalize(K,new t.Cartesian3);e.dragIndicator(P,nt);break;case"clip_move_circle":var rt=e.getDraggers(),Y=t.SceneTransforms.wgs84ToWindowCoordinates(e.viewer.scene,rt[4].position.getValue()),Z=u.startPosition,Q=u.endPosition,n=t.Cartesian2.subtract(Z,Y,new t.Cartesian2),c=t.Cartesian2.subtract(Q,Y,new t.Cartesian2),o=t.Cartesian2.cross(n,c),p=t.Cartesian2.angleBetween(n,c),z=t.Math.toDegrees(p),U=o>0?-z:z;e.rotateIndicator(U);break}}},t.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(function(){var u=this;i.dragger&&(e.boxEntity.editing&&(e.boxEntity.editing.updateDraggers(),e.boxEntity.editing.draggers.forEach(function(h){var v=this;(0,S.default)(this,u),h.callback=function(x,T){(0,S.default)(this,v),e.updatePlane(x,T)}.bind(this)}.bind(this))),d&&(d.material=new t.PolylineArrowMaterialProperty(t.Color.YELLOW)),l&&(l.material=t.Color.ORANGE.withAlpha(.5)),r&&(r.material=t.Color.WHITE),i.dragger=null,e.viewer._container.style.cursor="default",e.viewer.scene.screenSpaceCameraController.enableRotate=!![],e.viewer.scene.screenSpaceCameraController.enableTilt=!![],e.viewer.scene.screenSpaceCameraController.enableTranslate=!![],e.viewer.scene.screenSpaceCameraController.enableInputs=!![])},t.ScreenSpaceEventType.LEFT_UP),this.draggerHandler=i}},{key:"dragIndicator",value:function(e,i){var d=this,l=this.getPosition(),r=this.getDraggers(),u=t.Cartesian3.projectVector(e,i,new t.Cartesian3);u=t.Cartesian3.multiplyByScalar(u,1,new t.Cartesian3);for(var h=[],v=0;v<l.length;v++){var x=t.Cartesian3.add(l[v],u,new t.Cartesian3);h.push(x)}d.setPosition(h),d.updatePolygon();for(var T=0;T<r.length;T++)r[T].position=t.Cartesian3.add(r[T].position.getValue(),u,new t.Cartesian3),d.updatePlane(r[T].position.getValue(),"box-"+(T+1));var H=r[4].position.getValue();this.updateIndicatorPositions(H)}},{key:"rotateIndicator",value:function(e){for(var i=this,d=this.getPosition(),l=this.getDraggers(),r=l[4].position.getValue(),u=l[5].position.getValue(),h=t.Cartesian3.midpoint(r,u,r.clone()),v=t.Matrix3.fromRotationZ(t.Math.toRadians(e)),x=0;x<this.tilesetArr.length;x++){for(var T=this.tilesetArr[x],H=(0,w.getInverseTransform)(T),P=0;P<4;P++){this.arrNormal[x][P]=t.Matrix3.multiplyByVector(v,this.arrNormal[x][P],new t.Cartesian3),l[P].position=this.rotatedPointByAngle(l[P].position.getValue(),h,-e);var m=(0,w.getOriginCoordinateSystemPoint)(l[P].position.getValue(),H),O=t.Plane.fromPointNormal(m,this.arrNormal[x][P]);this.arrDistance[x][P]=O.distance}for(var I=[],M=0;M<d.length;M++){var j=this.rotatedPointByAngle(d[M],u,-e);I.push(j)}i.setPosition(I),i.updatePolygon()}}},{key:"updateIndicatorPositions",value:function(e){var i=this,d,l,r=(0,E.cartesian2lonlat)(e),u=[r[0]+6e-5,r[1],r[2]+.06],h=[r[0],r[1]+5e-5,r[2]+.06],v=this.dataSource.entities.getById("clip_move_line1").polyline,x=[e,(0,E.lonlat2cartesian)(u)];v.positions=new t.CallbackProperty(function(){return x},![]);var T=this.dataSource.entities.getById("clip_move_line2").polyline,H=[e,(0,E.lonlat2cartesian)(h)];T.positions=new t.CallbackProperty(function(){return H},![]);var P=this.dataSource.entities.getById("clip_move_surface"),m=t.Cartographic.fromCartesian(e).height;P.position=new t.CallbackProperty(function(){return(0,S.default)(this,i),e}.bind(this),![]),P.ellipse.height=new t.CallbackProperty(function(){return(0,S.default)(this,i),m+.02}.bind(this),![]);var O=this.dataSource.entities.getById("clip_move_circle");O.polygon.height=new t.CallbackProperty(function(){return(0,S.default)(this,i),m+.08}.bind(this),![]);var I=(0,E.cartesian2lonlat)(e),M={steps:60,units:"meters"},j=F.circle(I,4.5,M),V=F.circle(I,4,M),W=(0,y.default)(d=j.geometry.coordinates[0]).call(d,function(K){return(0,S.default)(this,i),t.Cartesian3.fromDegrees.apply(this,K)}.bind(this)),_=(0,y.default)(l=V.geometry.coordinates[0]).call(l,function(K){return(0,S.default)(this,i),t.Cartesian3.fromDegrees.apply(this,K)}.bind(this)),J={positions:W,holes:[{positions:_}]};O.polygon.hierarchy=new t.CallbackProperty(function(){return(0,S.default)(this,i),J}.bind(this),![])}},{key:"toClip",value:function(e,i){var d,l;this.arrDistance=[],this.arrNormal=[];for(var r=0;r<this.tilesetArr.length;r++){this.arrDistance.push([0,0,0,0,0,0]),this.arrNormal.push([0,0,0,0,0,0]),this.arrHeight.push(0);var u=this.tilesetArr[r],h=(0,w.getInverseTransform)(u);switch(this.type){case 0:var v=this.getPolygonPlane(u,e),x=(0,w.getOriginCoordinateSystemPoint)(i,h),T=new t.Cartesian3(0,0,-1),H=this.computePlaneTmp(T,x);this.isOutside=![],this.createClippingPlanes(u,(0,B.default)(d=[H]).call(d,(0,k.default)(v)),r,i);break;case 1:var P=(0,w.getOriginCoordinateSystemPoint)(e[0],h),m=(0,w.getOriginCoordinateSystemPoint)(e[1],h),O=(0,w.getOriginCoordinateSystemPoint)(i[0],h),I=new t.Cartesian3(0,0,-1),M=this.computePlaneTmp(I,P,m),j=t.Cartesian3.subtract(P,m,new t.Cartesian3);j=t.Cartesian3.normalize(j,j);var V=this.computePlaneTmp(j,P),W=t.Cartesian3.subtract(m,P,new t.Cartesian3);W=t.Cartesian3.normalize(W,W);var _=this.computePlaneTmp(W,m),J=new t.Cartesian3(0,0,1),K=this.computePlaneTmp(J,O),nt=new t.Cartesian3(0,0,-1),rt=this.computePlaneTmp(nt,P);this.isOutside=![],this.createClippingPlanes(u,[M,V,_,K,rt],r,i);break;case 2:var Y=(0,w.getOriginCoordinateSystemPoint)(e[0],h),Z=(0,w.getOriginCoordinateSystemPoint)(e[1],h),Q=(0,w.getOriginCoordinateSystemPoint)(e[2],h),n=(0,w.getOriginCoordinateSystemPoint)(e[3],h),c=(0,w.getOriginCoordinateSystemPoint)(i,h),o=this.isOutside?t.Cartesian3.subtract(Y,n,new t.Cartesian3):t.Cartesian3.subtract(n,Y,new t.Cartesian3);o=t.Cartesian3.normalize(o,o);var p=this.computePlaneTmp(o,n),z=this.isOutside?t.Cartesian3.subtract(n,Q,new t.Cartesian3):t.Cartesian3.subtract(Q,n,new t.Cartesian3);z=t.Cartesian3.normalize(z,z);var U=this.computePlaneTmp(z,Q),A=this.isOutside?t.Cartesian3.subtract(Q,Z,new t.Cartesian3):t.Cartesian3.subtract(Z,Q,new t.Cartesian3);A=t.Cartesian3.normalize(A,A);var at=this.computePlaneTmp(A,Z),tt=this.isOutside?t.Cartesian3.subtract(Z,Y,new t.Cartesian3):t.Cartesian3.subtract(Y,Z,new t.Cartesian3);tt=t.Cartesian3.normalize(tt,tt);var ot=this.computePlaneTmp(tt,Y),st=this.isOutside?new t.Cartesian3(0,0,-1):new t.Cartesian3(0,0,1),it=this.computePlaneTmp(st,c),ut=this.isOutside?new t.Cartesian3(0,0,1):new t.Cartesian3(0,0,-1),ct=this.computePlaneTmp(ut,Y);this.createClippingPlanes(u,[p,U,at,ot,it,ct],r,i);break;case 3:var ht=this.getPolygonPlane(u,e),dt=(0,w.getOriginCoordinateSystemPoint)(e[0],h),lt=new t.Cartesian3(0,0,-1),gt=this.computePlaneTmp(lt,dt),pt=(0,w.getOriginCoordinateSystemPoint)(i,h),ft=new t.Cartesian3(0,0,1),vt=this.computePlaneTmp(ft,pt);this.isOutside=![],this.createClippingPlanes(u,(0,B.default)(l=[vt,gt]).call(l,(0,k.default)(ht)),r,i);break}}}},{key:"createClippingPlanes",value:function(e,i,d,l){var r=this;e.backFaceCulling=![],e.clippingPlanes=new t.ClippingPlaneCollection({planes:i,edgeWidth:1,edgeColor:t.Color.WHITE,enabled:!![],unionClippingRegions:this.isOutside});for(var u=0;u<e.clippingPlanes.length;++u){var h=e.clippingPlanes.get(u);this.dataSource.entities.add({position:l,plane:{dimensions:new t.Cartesian2(300,300),material:t.Color.RED.withAlpha(0),plane:new t.CallbackProperty(r.createPlaneUpdateFunction(h,d,u),![])}})}}},{key:"updatePlane",value:function(e,i){if(i!==0&&i.indexOf("box")!==-1){var d=this.getDraggers(),l=d[4].position.getValue();this.updateIndicatorPositions(l)}for(var r=0;r<this.tilesetArr.length;r++){var u=this.tilesetArr[r],h=(0,w.getInverseTransform)(u),v=void 0,x=void 0,T=void 0;switch(Array.isArray(e)?(x=(0,w.getOriginCoordinateSystemPoint)(e[0],h),T=(0,w.getOriginCoordinateSystemPoint)(e[1],h)):v=(0,w.getOriginCoordinateSystemPoint)(e,h),i){case 0:this.arrDistance[r][0]=v.z;break;case"facade1":var H=new t.Cartesian3(0,0,-1),P=this.computePlaneTmp(H,x,T);this.arrDistance[r][0]=P.distance;break;case"facade2":var m=t.Cartesian3.subtract(x,T,new t.Cartesian3);m=t.Cartesian3.normalize(m,m);var O=this.computePlaneTmp(m,x);this.arrDistance[r][1]=O.distance;break;case"facade3":var I=t.Cartesian3.subtract(T,x,new t.Cartesian3);I=t.Cartesian3.normalize(I,I);var M=this.computePlaneTmp(I,T);this.arrDistance[r][2]=M.distance;break;case"facade4":this.arrDistance[r][3]=-v.z;break;case"facade5":this.arrDistance[r][4]=v.z;break;case"box-5":this.arrDistance[r][4]=this.isOutside?v.z:-v.z;break;case"box-6":this.arrDistance[r][5]=this.isOutside?-v.z:v.z;break;case"box-1":this.arrDistance[r][0]=this.computePlaneDistance(v,this.arrNormal[r][0]);break;case"box-3":this.arrDistance[r][2]=this.computePlaneDistance(v,this.arrNormal[r][2]);break;case"box-2":this.arrDistance[r][1]=this.computePlaneDistance(v,this.arrNormal[r][1]);break;case"box-4":this.arrDistance[r][3]=this.computePlaneDistance(v,this.arrNormal[r][3]);break;case"polygon-1":this.arrDistance[r][0]=-v.z;break;case"polygon-2":this.arrDistance[r][1]=v.z;break}}}},{key:"computePlaneDistance",value:function(e,i){var d=t.Plane.fromPointNormal(e,i);return d.distance}},{key:"createPlaneUpdateFunction",value:function(e,i,d){var l=this;return this.arrDistance[i][d]=e.distance,this.arrNormal[i][d]=e.normal,function(){return e.distance=l.arrDistance[i][d],e.normal=l.arrNormal[i][d],e}}},{key:"computePlaneTmp",value:function(e,i,d){if(d){var l=t.Cartesian3.subtract(d,i,new t.Cartesian3),r=t.Cartesian3.cross(l,e,new t.Cartesian3);r=t.Cartesian3.normalize(r,r);var u=t.Plane.fromPointNormal(i,r);return t.ClippingPlane.fromPlane(u)}else{var h=t.Plane.fromPointNormal(i,e);return t.ClippingPlane.fromPlane(h)}}},{key:"clearClippingPlane",value:function(){this.draggerHandler&&(this.draggerHandler.destroy(),this.draggerHandler=void 0);for(var e=0;e<this.tilesetArr.length;e++){var i=this.tilesetArr[e].clippingPlanes;i&&i.length>0&&i.removeAll(),this.tilesetArr[e].backFaceCulling=!![]}}},{key:"updateRotationPosition",value:function(e,i){var d=t.Cartesian3.midpoint(e[0],e[1],e[0].clone()),l=this.rotatedPointByAngle(e[0],d,i),r=this.rotatedPointByAngle(e[1],d,i);return[l,r]}},{key:"rotatedPointByAngle",value:function(e,i,d){var l=t.Transforms.eastNorthUpToFixedFrame(i),r=t.Matrix4.inverse(l,new t.Matrix4),u=t.Matrix4.multiplyByPoint(r,e,new t.Cartesian3),h=u.x*Math.cos(t.Math.toRadians(d))+u.y*Math.sin(t.Math.toRadians(d)),v=u.y*Math.cos(t.Math.toRadians(d))-u.x*Math.sin(t.Math.toRadians(d)),x=u.z;return t.Matrix4.multiplyByPoint(l,new t.Cartesian3(h,v,x),new t.Cartesian3)}},{key:"getPolygonPlane",value:function(e,i){if(i.length>2){var d,l=[];switch(!![]){case i[0]instanceof t.Cartesian3:l=i,d=(0,X.ringIsClockwise)(l);break;case i[0]instanceof t.Cartographic:for(var r=[],u=0;u<i.length;u++){var h=i[u];l.push(t.Cartesian3.fromDegrees(h.longitude,h.latitude,h.height));var v=[2];v[0]=h.longitude,v[1]=h.latitude,r.push(v)}d=(0,X.ringIsClockwise)(r);break;default:for(var x=0;x<i.length;x++){var T=i[x];l.push(t.Cartesian3.fromDegrees(T[0],T[1],T[2]))}d=(0,X.ringIsClockwise)(i)}for(var H=[],P=l.length,m=(0,w.getInverseTransform)(e),O=d,I=0;I<P;++I){var M=(I+1)%P,j=new t.Cartesian3(0,0,10),V=void 0;if(O?V=t.Cartesian3.subtract((0,w.getOriginCoordinateSystemPoint)(l[I],m),(0,w.getOriginCoordinateSystemPoint)(l[M],m),new t.Cartesian3):V=t.Cartesian3.subtract((0,w.getOriginCoordinateSystemPoint)(l[M],m),(0,w.getOriginCoordinateSystemPoint)(l[I],m),new t.Cartesian3),V.x===0&&V.y===0&&V.z===0)return H=[];V=t.Cartesian3.normalize(V,V);var W=t.Cartesian3.cross(V,j,new t.Cartesian3);W=t.Cartesian3.normalize(W,W),H.push(new t.ClippingPlane.fromPlane(t.Plane.fromPointNormal((0,w.getOriginCoordinateSystemPoint)(l[I],m),W)))}return H}}}]),D}();L.ClipTools=q},47806:function(et,L,g){"use strict";var a=g(19534);Object.defineProperty(L,"__esModule",{value:!0}),L.default=void 0;var C=a(g(52909)),s=a(g(42579)),f=void 0,y={inject:{generalCardThemeStyle:{default:null}},props:{styleConfig:{type:Object,default:function(){(0,s.default)(this,f)}.bind(void 0)},position:{type:Object,default:function(){return(0,s.default)(this,f),{type:"absolute",top:"100px",right:"135px"}}.bind(void 0)},themeStyle:{type:Object},imgSrc:{type:String},title:{type:String},isShow:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!1},dragEnable:{type:Boolean,default:!0},onlyContainer:{type:Boolean,default:!1}},data:function(){return{visible:this.isShow,theme:"light"}},watch:{currentView:{handler:function(S){S==="earth"?this.theme="dark":this.theme="light"},immediate:!0},isShow:function(S){this.visible=S}},computed:{cardThemeStyle:function(){return this.themeStyle||this.generalCardThemeStyle}},mounted:function(){var S,R=this;this.$_mixin_generalCard=(0,C.default)(S=this.$children).call(S,function(G){return(0,s.default)(this,R),G.$options.name==="ShGeneralCard"}.bind(this))},methods:{changeShow:function(S){var R;if((R=this.$_mixin_generalCard)===null||R===void 0||R.changeShow(S),S===!1||S!==!0&&this.visible){var G;(G=this.deactivate)===null||G===void 0||G.call(this)}},changeStatus:function(S){var R;(R=this.$_mixin_generalCard)===null||R===void 0||R.changeStatus(S)},getPosition:function(){var S;return(S=this.$_mixin_generalCard)===null||S===void 0?void 0:S.getPosition()}}},B=y;L.default=B},42709:function(et,L,g){"use strict";var a=g(48836);const C={data(){return this.map=null,this.timer="",{isEditor:window.location.href.indexOf("editor.html")>0}},inject:{reactiveViewMode:{default:function(){return()=>"23D"}}},computed:{viewMode(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()}},mounted(){!this.widgetInfo.parentId&&this.isEditor&&this.widgetInfo.action.gisMapId&&this.$nextTick(function(){this.updateWidgetParentId({widgetId:this.widgetInfo.id,parentId:this.widgetInfo.action.gisMapId,keepPosition:!0})})},methods:{...(0,a.nv)(["updateWidgetParentId"]),getBindMap(){typeof this.widgetInfo.action.gisMapId<"u"}}};L.Z=C},76010:function(et,L){"use strict";const g={data(){return{isSpecial:!1,isEditor:window.location.href.indexOf("editor.html")>0}},computed:{isBindToPage(){return this.widgetInfo.config.styleConfig.dragEnable||this.isSpecial},position(){return this.isEditor||!this.isBindToPage?{type:"absolute",top:"0px",left:"0px",bottom:"unset",right:"unset",zIndex:this.widgetInfo.attr.z}:{type:"absolute",top:this.widgetInfo.attr.y+"px",left:this.widgetInfo.attr.x+"px",zIndex:this.widgetInfo.attr.z}},styleConfig(){return{isShowBtn:this.widgetInfo.config.styleConfig.isShowBtn,isStartFix:this.isEditor,titleBar:{miniBtn:!0,maxBtn:!1,closeBtn:!1,fixBtn:!this.isEditor,title:!0},autoVisible:!1,btnSize:{size:this.widgetInfo.config.styleConfig.btnSize.size+"px",padding:this.widgetInfo.config.styleConfig.btnSize.padding+"px",radius:this.widgetInfo.config.styleConfig.btnSize.radius+"px"},size:{radius:this.widgetInfo.config.styleConfig.size.radius+"px",width:this.widgetInfo.attr.w>150?this.widgetInfo.attr.w+"px":"275px",height:this.widgetInfo.attr.hh>100?this.widgetInfo.attr.hh+"px":"80vh"},toolBtnSize:{size:this.widgetInfo.config.styleConfig.toolBtnSize.size+"px",margin:(this.widgetInfo.config.styleConfig.btnSize.size-this.widgetInfo.config.styleConfig.toolBtnSize.size)/2+"px"}}},themeConfig(){let a=this.widgetInfo.config.themeStyle.light;return{light:{title:{backgroundImage:"url('"+a.title.backgroundImage+"')",backgroundColor:a.title.backgroundColor?a.title.backgroundColor:a.floatButton.fillcolor,backgroundSize:a.title.backgroundSize,fontSize:a.title.fontSize+"px",color:a.title.fontColor},primaryFont:{fontSize:a.primaryFont.fontSize+"px",fontColor:a.primaryFont.fontColor},toolButton:{color:a.toolButton.color},panel:{backgroundImage:"url('"+a.panel.backgroundImage+"')",backgroundColor:a.panel.fillcolor,backgroundSize:a.panel.backgroundSize,border:a.panel.border},floatButton:{backgroundColor:a.floatButton.fillcolor,shadowColor:a.floatButton.shadowColor,border:a.floatButton.border}}}}},methods:{bindToPage(a){a&&this.isBindToPage&&(a.parentElement.remove(a),document.getElementById("page_"+this.widgetInfo.pageId).append(a),a.style.pointerEvents="auto",document.getElementById("container_child_"+this.widgetInfo.id).remove())}}};L.Z=g},59115:function(et,L,g){"use strict";g.r(L),g.d(L,{default:function(){return w}});var a=function(){var $=this,N=$._self._c;return N("div",{directives:[{name:"show",rawName:"v-show",value:$.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"content",style:{width:$.widgetInfo.attr.w+"px",height:$.widgetInfo.attr.hh+"px"}},[N("ClipTools",{ref:"clipTools",attrs:{position:$.position,"is-show":!0,"theme-style":$.themeConfig,"style-config":$.styleConfig,"drag-enable":$.widgetInfo.config.styleConfig.dragEnable}})],1)},C=[],s=g(1018),f=g.n(s),y=g(86892),B=g(76010),k=g(45061),S=g(26711),R=g(42709),G={name:"GisClipTools",components:{ClipTools:f()},mixins:[y.D,B.Z,k.u,S.H,R.Z],props:["widgetInfo"],data(){return{timer:"",mapAction:this.widgetInfo.action,btnAttr:this.widgetInfo.attr}},mounted(){this.isEditor||this.$nextTick(()=>{let F=this.$refs.clipTools.$el;this.bindToPage(F)}),this.initAction(this.widgetInfo)},methods:{reLoadInfo(F){this.btnAttr=F.attr},initAction(F){this.registerAction(F,"configMap","mapList",this.doConfigMap),this.actionReceive(F)}}},t=G,X=g(68141),E=(0,X.Z)(t,a,C,!1,null,null,null),w=E.exports}}]);
