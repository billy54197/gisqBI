(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[27493],{419457:function(p,g,t){"use strict";var c=t(419534);Object.defineProperty(g,"__esModule",{value:!0}),g.default=void 0;var s=c(t(452909)),a=c(t(342579)),e=void 0,n={props:{isShow:{type:Boolean,default:!0},position:{type:Object,default:function(){return(0,a.default)(this,e),{type:"absolute",top:"1px",left:"1px"}}.bind(void 0)},isColumn:{type:Boolean,default:!1},title:{type:String},iconClass:{type:String},dragEnable:{type:Boolean,default:!1},showImg:{type:Boolean,default:!0},showLabel:{type:Boolean,default:!0},themeStyle:{type:Object}},data:function(){return{theme:"light"}},watch:{currentView:{handler:function(r){r==="earth"?this.theme="dark":this.theme="light"},immediate:!0}},mounted:function(){var r,C=this;this.$_mixin_generalButton=(0,s.default)(r=this.$children).call(r,function(y){return(0,a.default)(this,C),y.$options.name==="ShGeneralButton"}.bind(this))},methods:{getPosition:function(){var r;return(r=this.$_mixin_generalButton)===null||r===void 0?void 0:r.getPosition()}}},i=n;g.default=i},132726:function(p,g,t){"use strict";var c=t(149500),s=t(985208),a=t(659791),e=t(22466),n=t(183393),i=t(105077),l=t(419534);Object.defineProperty(g,"__esModule",{value:!0}),g.default=B;var r=l(t(611323)),C=l(t(543389)),y=l(t(934749)),I=l(t(342579)),P=l(t(985208)),R=l(t(828866)),o=l(t(22466)),v=l(t(581806)),G=l(t(705146));function D(h,$){var x=s(h);if(a){var f=a(h);$&&(f=e(f).call(f,function(F){return n(h,F).enumerable})),x.push.apply(x,f)}return x}function d(h){for(var $=1;$<arguments.length;$++){var x=arguments[$]!=null?arguments[$]:{};$%2?D(Object(x),!0).forEach(function(f){(0,C.default)(h,f,x[f])}):i?Object.defineProperties(h,i(x)):D(Object(x)).forEach(function(f){Object.defineProperty(h,f,n(x,f))})}return h}function U(h,$){for(var x=!1,f=h,F=function(){var Z=this;f=f.$parent;var W=f.$refs;W&&(0,P.default)(W).forEach(function(K){(0,I.default)(this,Z),W[K]===h&&(W[K]=$,x=!0)}.bind(this))};f.$parent&&!x;)F()}function B(h){var $,x,f=this,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},X=F.configName,Z=F.componentName,W=F.transform,K=(0,R.default)($=(0,o.default)(x=h.mixins||[]).call(x,function(E){return(0,I.default)(this,f),!!E.props}.bind(this))).call($,function(E){return(0,I.default)(this,f),{props:E.props}}.bind(this));return{name:Z||h.name,props:h.props,mixins:K,inject:{reactiveConfigInstance:{default:function(){var S=this;return function(){return(0,I.default)(this,S),null}.bind(this)}}},data:function(){return this.$configInfo={},{ready:!1}},computed:{configInstance:function(){return this.reactiveConfigInstance()}},mounted:function(){this.initConfig()},methods:{initConfig:function(){var S=this;return(0,y.default)(r.default.mark(function V(){var z,M;return r.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!S.configInstance){m.next=17;break}return z=S.$options.name.replace("Sh",""),M={},m.prev=3,m.next=6,S.configInstance.getWidgetInfoByTag(X||z);case 6:M=m.sent,m.next=13;break;case 9:return m.prev=9,m.t0=m.catch(3),c.error(m.t0),m.abrupt("return");case 13:if(M.stat){m.next=15;break}return m.abrupt("return");case 15:typeof W=="function"&&M.data?M=W(M.data,S.configInstance.widgetInfo.mapConfig,{url:S.configInstance.url.replace("/role/getResources",""),schemeId:S.configInstance.schemeId}):M=M.data,S.$configInfo=d({},M);case 17:S.ready=!0;case 18:case"end":return m.stop()}},V,null,[[3,9]])}))()},forwordRef:function(){var S;U(this._self,this._self.$children[0]),(S=this._self.$children[0])===null||S===void 0||S.$emit("mounted",this._self.$children[0])}},render:function(S){var V,z=this,M;if((0,v.default)(V=(0,P.default)(this.$listeners)).call(V,"hook:mounted")){var Y;M=d(d({},this.$listeners),{},{"hook:mounted":(0,G.default)(Y=[this.forwordRef]).call(Y,this.$listeners["hook:mounted"])})}else M=d(d({},this.$listeners),{},{"hook:mounted":this.forwordRef});var m=this.$options.propsData;return(0,P.default)(m).forEach(function(J){(0,I.default)(this,z),m[J]===void 0&&delete m[J]}.bind(this)),this.ready?S(h,{on:M,scopedSlots:this.$scopedSlots,props:d(d({},this.$configInfo),m),attrs:this.$attrs},this.$slots.default):null}}}},598427:function(p,g,t){var c=t(149500);p.exports=function(s){var a={};function e(n){if(a[n])return a[n].exports;var i=a[n]={i:n,l:!1,exports:{}};return s[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=s,e.c=a,e.d=function(n,i,l){e.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:l})},e.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,i){if(i&1&&(n=e(n)),i&8||i&4&&typeof n=="object"&&n&&n.__esModule)return n;var l=Object.create(null);if(e.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:n}),i&2&&typeof n!="string")for(var r in n)e.d(l,r,function(C){return n[C]}.bind(null,r));return l},e.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(i,"a",i),i},e.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},e.p="/dist/",e(e.s=781)}({0:function(s,a){s.exports=t(342579)},1:function(s,a){s.exports=t(828866)},10:function(s,a){s.exports=t(42762)},105:function(s,a){s.exports=t(614843)},2:function(s,a,e){"use strict";e.d(a,"a",function(){return n});function n(i,l,r,C,y,I,P,R){var o=typeof i=="function"?i.options:i;l&&(o.render=l,o.staticRenderFns=r,o._compiled=!0),C&&(o.functional=!0),I&&(o._scopeId="data-v-"+I);var v;if(P?(v=function(d){d=d||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!d&&typeof __VUE_SSR_CONTEXT__<"u"&&(d=__VUE_SSR_CONTEXT__),y&&y.call(this,d),d&&d._registeredComponents&&d._registeredComponents.add(P)},o._ssrRegister=v):y&&(v=R?function(){y.call(this,(o.functional?this.parent:this).$root.$options.shadowRoot)}:y),v)if(o.functional){o._injectStyles=v;var G=o.render;o.render=function(U,B){return v.call(B),G(U,B)}}else{var D=o.beforeCreate;o.beforeCreate=D?[].concat(D,v):[v]}return{exports:i,options:o}}},21:function(s,a){s.exports=t(581806)},28:function(s,a){s.exports=t(132726)},36:function(s,a){s.exports=t(59269)},4:function(s,a){s.exports=t(555616)},58:function(s,a){s.exports=t(165594)},6:function(s,a){s.exports=t(783574)},60:function(s,a){s.exports=t(308421)},61:function(s,a){s.exports=t(419457)},67:function(s,a){s.exports=t(31694)},7:function(s,a){s.exports=t(17249)},781:function(s,a,e){"use strict";e.r(a);var n=e(0),i=e.n(n),l=function(){var u=this,w=u.$createElement,T=u._self._c||w;return T("div",{directives:[{name:"show",rawName:"v-show",value:u.shouldShow,expression:"shouldShow"}],staticClass:"sh-paste-tool"},[T("div",{directives:[{name:"show",rawName:"v-show",value:u.isShow,expression:"isShow"}]},[u.$slots.default?T("span",{staticClass:"geomPasteTool",on:{click:u.startPaste}},[u._t("default")],2):T("general-button",{attrs:{position:u.position,"is-column":u.isColumn,"icon-class":u.iconClass?u.iconClass:"paste-tool","show-img":u.showImg,"drag-enable":u.dragEnable,"show-label":u.showLabel,"theme-style":u.themeStyle,title:u.title?u.title:"\u7C98\u8D34"},on:{click:u.startPaste}})],1)])},r=[];l._withStripped=!0;var C=e(6),y=e.n(C),I=e(7),P=e.n(I),R=e(9),o=e.n(R),v=e(10),G=e.n(v),D=e(1),d=e.n(D),U=e(21),B=e.n(U),h=e(4),$=e(67),x=e.n($),f=e(58),F=e.n(f),X=e(105),Z=e(36),W=function(){function u(w,T,O,j,b){var L;o()(this,u),this.name="pasteGraphics",this.map=T,this.emitter=w,this.baseUrl=O&&O!==""?O:"http://192.168.9.84:8099/spatial/",this.shinegaDatabaseId=j,this.token=b.token,this.applicationId=b.applicationId,this.adminUrl=b.adminUrl,this.schemeId=b.schemeId,this.publishId=b.publishId,this.layerManager=T.layerManager,this.Wkid=d()(this).getView().getProjection().getCode(),this.spatialReference=B()(L=this.Wkid).call(L,":")?this.Wkid.split(":")[1]:this.Wkid}return G()(u,[{key:"startPaste",value:function(){var T=this,O=this.layerManager.getEditLayer();this.currentTargetLayer=O?O.metadata:void 0,this.emitter.$emit("getCopyFeatures",function(j,b){i()(this,T),j?(this.copyiedLayer=b,this._validate(j)):h.Message.warning("\u8BF7\u5148\u9009\u62E9\u9700\u8981\u590D\u5236\u7684\u56FE\u5F62")}.bind(this))}},{key:"_popBox",value:function(T){var O=this;if(this.currentTargetLayer){var j=this.currentTargetLayer.label;h.MessageBox.confirm('\u662F\u5426\u5C06\u590D\u5236\u7684\u56FE\u5F62\u7C98\u8D34\u5230 "'.concat(j,'" \u5C42?'),"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(function(){var b=this;i()(this,O),new F.a(this.baseUrl,this.shinegaDatabaseId).getPrimaryKey({layerTable:this.currentTargetLayer.layerTable,token:this.token}).then(function(L){var A=this;i()(this,b),L.success&&(this.primaryKey=L.data.key,this.primaryType=L.data.type,Object(X.getSaveRuleOptions)({url:this.adminUrl,tocId:this.currentTargetLayer.id,token:this.token,applicationId:this.applicationId,schemeId:this.schemeId,publishId:this.publishId,hasRules:this.currentTargetLayer.hasRules}).then(function(N){i()(this,A),this.ruleOptions=N,this._processData(T)}.bind(this)))}.bind(this)).catch(function(L){i()(this,b),c.error(L)}.bind(this))}.bind(this)).catch(function(){i()(this,O)}.bind(this))}else h.Message.warning("\u65E0\u53EF\u7F16\u8F91\u56FE\u5C42")}},{key:"_validate",value:function(T){if(this.currentTargetLayer){var O=this.currentTargetLayer.label,j=this.copyiedLayer.label;if(O===j){Object(h.Message)({message:"\u4E0D\u80FD\u628A\u590D\u5236\u7684\u56FE\u5F62\u7C98\u8D34\u5230\u81EA\u5DF1\u6240\u5728\u7684\u56FE\u5C42,\u8BF7\u5207\u6362\u7F16\u8F91\u56FE\u5C42",type:"warning",showClose:!0});return}if(!this.currentTargetLayer.layerTable){Object(h.Message)({message:"\u56FE\u5C42\u672A\u914D\u7F6E\u6570\u636E\u6E90\uFF0C\u8BF7\u68C0\u67E5",type:"warning",showClose:!0});return}this._popBox(T)}else Object(h.Message)({message:"\u8BF7\u9009\u62E9\u5F53\u524D\u53EF\u7F16\u8F91\u5C42",type:"warning",showClose:!0})}},{key:"_processData",value:function(T){var O=this,j=[];T.forEach(function(b){i()(this,O);var L=[],A={},N=b.values_;N=N||{};for(var H in N)H!=="geometry"&&H!=="isSelected"&&H!=="tempSelected"&&H!==this.primaryKey&&L.push({name:H,value:N[H]});A.attribute=L,A.featureClass=this.currentTargetLayer.layerTable,A.topological=!0,A.checkLevel=0;var et=new x.a,nt=b.getGeometry();A.geometry=et.writeGeometry(nt),A.spatialReference=this.spatialReference,A.filter="",j.push(A)}.bind(this)),this._save(j)}},{key:"_save",value:function(T){var O=this,j=h.Loading.service({target:d()(this).getTargetElement(),lock:!0,text:"\u4FDD\u5B58\u4E2D...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});new F.a(this.baseUrl,this.shinegaDatabaseId).save({features:T,ruleOptions:this.ruleOptions,token:this.token}).then(function(b){if(i()(this,O),j.close(),b.success){var L=d()(this).getLayerById(Z.BASE_DRAWLAYER_ID);L.getSource().clear();var A=this.currentTargetLayer.id,N=d()(this).getLayerById(A);N.getSource().refresh(),h.Message.success("\u56FE\u5F62\u7C98\u8D34\u6210\u529F"),this.emitter.$emit("clearCopyFeatures")}else Object(h.Message)({message:b.message?b.message:"\u56FE\u5F62\u7C98\u8D34\u5931\u8D25",type:"warning",dangerouslyUseHTMLString:!0,showClose:!0})}.bind(this)).catch(function(b){i()(this,O),h.Message.error("\u56FE\u5F62\u7C98\u8D34\u5931\u8D25:"+b.message),j.close()}.bind(this))}}]),u}(),K=e(60),E=e.n(K),S=e(61),V=e.n(S),z=void 0,M={name:"ShPasteTool",components:{GeneralButton:E.a},mixins:[y.a,P.a,V.a],props:{url:{type:String},adminUrl:{type:String},schemeId:{type:String},position:{type:Object,default:function(){return i()(this,z),{type:"absolute",top:"1px",left:"420px"}}.bind(void 0)}},data:function(){return{shouldShow:!1}},watch:{currentView:{handler:function(w){this.shouldShow=w==="map"},immediate:!0}},mounted:function(){var w=this;this.$map&&setTimeout(function(){i()(this,w),this.begin()}.bind(this),0)},methods:{begin:function(){this.initPaste()},initPaste:function(){this.PasteTool=new W(this,this.$map,this.url?this.url:this.shinegaUrl,this.shinegaDatabaseId,{adminUrl:this.adminUrl,schemeId:this.schemeId,publishId:this.publishId,token:this.token,fastApplicationId:this.fastApplicationId})},execute:function(){this.PasteTool.startPaste()},startPaste:function(){this.execute()}}},Y=M,m=e(2),J=Object(m.a)(Y,l,r,!1,null,null,null),k=J.exports,q=e(28),_=e.n(q),tt=void 0,Q=_()(k,{transform:function(w,T,O){i()(this,tt);var j=w.show,b=w.label,L=w.position,A=O.url,N=O.schemeId;return{isShow:j,title:b,position:L,adminUrl:A,schemeId:N}}.bind(void 0)});Q.install=function(u){u.component(Q.name,Q)};var st=a.default=Q},9:function(s,a){s.exports=t(122777)}})},614843:function(p,g,t){"use strict";var c=t(419534);Object.defineProperty(g,"__esModule",{value:!0}),g.getDeleteRuleOptions=l,g.getSaveRuleOptions=i;var s=c(t(342579)),a=c(t(578756)),e=c(t(66273)),n=t(159602);function i(r){var C=this,y=r.url,I=r.schemeId,P=r.publishId,R=r.tocId,o=r.token,v=r.applicationId,G=r.hasRules;return new a.default(function(D){var d=this;(0,s.default)(this,C);var U;if(G&&y){var B=y.split("/"),h=B[0]+"//"+B[2]+"/"+B[3],$=I||P?"/subschemePublish/getPublishTocRule":"/tocRule/getInfo";(0,n.postFromAdmin)(h+$,{tocId:R,schemeId:I,id:P},{token:o,applicationId:v}).then(function(x){(0,s.default)(this,d);var f=(0,n.parseResult)(x);f.success&&f.data&&f.data.saveRule&&(U=(0,e.default)(f.data.saveRule)),D(U)}.bind(this)).catch(function(){(0,s.default)(this,d),D()}.bind(this))}else D()}.bind(this))}function l(r){var C=this,y=r.url,I=r.schemeId,P=r.publishId,R=r.tocId,o=r.token,v=r.applicationId,G=r.hasRules;return new a.default(function(D){var d=this;(0,s.default)(this,C);var U;if(G&&y){var B=y.split("/"),h=B[0]+"//"+B[2]+"/"+B[3],$=I||P?"/subschemePublish/getPublishTocRule":"/tocRule/getInfo";(0,n.postFromAdmin)(h+$,{tocId:R,schemeId:I,id:P},{token:o,applicationId:v}).then(function(x){(0,s.default)(this,d);var f=(0,n.parseResult)(x);f.success&&f.data&&f.data.delRule&&(U=(0,e.default)(f.data.delRule)),D(U)}.bind(this)).catch(function(){(0,s.default)(this,d),D()}.bind(this))}else D()}.bind(this))}},327493:function(p,g,t){"use strict";t.r(g),t.d(g,{default:function(){return P}});var c=function(){var o=this,v=o._self._c;return v("div",{directives:[{name:"show",rawName:"v-show",value:o.widgetInfo.attr.hide!=!0,expression:"widgetInfo.attr.hide != true"}],ref:"gisBase",staticClass:"my-gisBase",style:{width:o.widgetInfo.attr.w+"px",height:o.widgetInfo.attr.hh+"px"}},[v("PasteTool",o._b({style:{width:o.widgetInfo.attr.w+"px",height:o.widgetInfo.attr.hh+"px"},attrs:{position:o.btnPosition,"theme-style":o.themeConfig}},"PasteTool",o.widgetInfo.config.btnConfig,!1))],1)},s=[],a=t(598427),e=t.n(a),n=t(386892),i=t(445061),l=t(950681),r={name:"GisPaste",components:{PasteTool:e()},mixins:[n.D,i.u,l.Z],props:["widgetInfo"],data(){return{width:"16px",height:"16px",fontSize:"12px;"}},mounted(){this.initAction(this.widgetInfo)},methods:{reLoadInfo(R){this.btnAttr=R.attr},initAction(R){this.actionReceive(R)}}},C=r,y=t(768141),I=(0,y.Z)(C,c,s,!1,null,"23944deb",null),P=I.exports},105077:function(p,g,t){p.exports=t(272873)},659791:function(p,g,t){p.exports=t(169127)},543389:function(p,g,t){var c=t(857448),s=t(168871);function a(e,n,i){return n=s(n),n in e?c(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}p.exports=a,p.exports.__esModule=!0,p.exports.default=p.exports},259631:function(p,g,t){"use strict";t(125902);var c=t(594388);p.exports=c.Object.getOwnPropertyDescriptors},481640:function(p,g,t){"use strict";t(46932);var c=t(594388);p.exports=c.Object.getOwnPropertySymbols},125902:function(p,g,t){"use strict";var c=t(190434),s=t(714451),a=t(883419),e=t(204036),n=t(168428),i=t(259063);c({target:"Object",stat:!0,sham:!s},{getOwnPropertyDescriptors:function(r){for(var C=e(r),y=n.f,I=a(C),P={},R=0,o,v;I.length>R;)v=y(C,o=I[R++]),v!==void 0&&i(P,o,v);return P}})},272873:function(p,g,t){"use strict";var c=t(259631);p.exports=c},169127:function(p,g,t){"use strict";var c=t(481640);p.exports=c}}]);
