"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[22076],{659073:function(O,f,a){a.r(f),a.d(f,{default:function(){return M}});var h=function(){var e=this,t=e._self._c;return t("div",[t("el-collapse",[t("el-collapse-item",[t("template",{slot:"title"},[t("div",{staticClass:"my-title"},[e._v("\u5730\u56FE\u8BBE\u7F6E")])]),t("vue-lazy-component",[t("el-form",{ref:"form",attrs:{size:"mini","label-width":"75px"},nativeOn:{submit:function(i){i.preventDefault()}}},[t("el-form-item",{attrs:{label:"\u5730\u56FE\u6A21\u5F0F"}},e._l(e.viewModeRadios,function(i,r){return t("el-radio",{key:r,attrs:{label:i.label},on:{change:e.getConfigData},model:{value:e.currentWidget.config.viewMode,callback:function(o){e.$set(e.currentWidget.config,"viewMode",o)},expression:"currentWidget.config.viewMode"}},[e._v(e._s(i.text)+" ")])}),1),t("el-form-item",{attrs:{label:"\u5E95\u56FE\u9009\u62E9"}},[t("layer-directory-multiple",{attrs:{toc:e.currentWidget.mapLayer.toc,"lyr-info-setting":e.lyrConfig,"show-setting":!0},on:{"on-toc-change":e.onLayerChange}})],1),t("el-form-item",{attrs:{label:"\u5B9A\u4F4D\u7C7B\u578B"}},e._l(e.radios,function(i,r){return t("el-radio",{key:r,attrs:{label:i.label},on:{change:e.getConfigData},model:{value:e.currentWidget.config.isXZQ,callback:function(o){e.$set(e.currentWidget.config,"isXZQ",o)},expression:"currentWidget.config.isXZQ"}},[e._v(e._s(i.text)+" ")])}),1),e.currentWidget.config.isXZQ?t("div",[t("el-form-item",{attrs:{label:"\u884C\u653F\u533A\u5212",prop:"currentXZQ"}},[t("el-select",{ref:"xzqSelect",staticStyle:{width:"195px"},attrs:{value:e.currentWidget.config.currentXZQMC}},[t("el-option",{attrs:{id:"xzq-select-tree",value:e.currentWidget.config.currentXZQ,label:e.currentWidget.config.currentXZQMC}},[t("el-tree",{attrs:{data:e.$$region_data.citiesTree,"default-expanded-keys":["china"],"check-on-click-node":!0,"expand-on-click-node":!1,"node-key":"id","current-node-key":e.currentWidget.config.currentXZQ},on:{"node-click":e.handleNodeClickXzq}})],1)],1)],1)],1):t("div",[t("el-form-item",{attrs:{label:"\u4E2D\u5FC3\u70B9"}},[t("el-input",{staticStyle:{width:"195px"},on:{change:e.changeCenter},model:{value:e.center,callback:function(i){e.center=i},expression:"center"}})],1),t("el-form-item",{attrs:{label:"\u7F29\u653E\u500D\u6570"}},[t("el-input-number",{staticStyle:{width:"195px"},attrs:{step:1,max:e.currentWidget.config.maxZoom,min:e.currentWidget.config.minZoom},on:{change:e.getConfigData},model:{value:e.currentWidget.config.zoom,callback:function(i){e.$set(e.currentWidget.config,"zoom",i)},expression:"currentWidget.config.zoom"}})],1),t("el-form-item",{attrs:{label:"\u6700\u5C0F\u7EA7\u6570"}},[t("el-input-number",{staticStyle:{width:"195px"},attrs:{step:1,max:24,min:0},on:{change:e.changeZoom},model:{value:e.currentWidget.config.minZoom,callback:function(i){e.$set(e.currentWidget.config,"minZoom",i)},expression:"currentWidget.config.minZoom"}})],1),t("el-form-item",{attrs:{label:"\u6700\u5927\u7EA7\u6570"}},[t("el-input-number",{staticStyle:{width:"195px"},attrs:{step:1,max:24,min:1},on:{change:e.changeZoom},model:{value:e.currentWidget.config.maxZoom,callback:function(i){e.$set(e.currentWidget.config,"maxZoom",i)},expression:"currentWidget.config.maxZoom"}})],1),e.isCurrentView3D?t("el-form-item",{attrs:{label:"\u65B9\u4F4D\u89D2"}},[t("el-input-number",{staticStyle:{width:"195px"},attrs:{step:1,min:-360,max:360},on:{change:e.getConfigData},model:{value:e.currentWidget.config.heading,callback:function(i){e.$set(e.currentWidget.config,"heading",i)},expression:"currentWidget.config.heading"}})],1):e._e(),e.isCurrentView3D?t("el-form-item",{attrs:{label:"\u4FEF\u4EF0\u89D2"}},[t("el-input-number",{staticStyle:{width:"195px"},attrs:{step:1,min:-90,max:90},on:{change:e.getConfigData},model:{value:e.currentWidget.config.pitch,callback:function(i){e.$set(e.currentWidget.config,"pitch",i)},expression:"currentWidget.config.pitch"}})],1):e._e(),e.isCurrentView3D?t("el-form-item",{attrs:{label:"\u65CB\u8F6C\u89D2"}},[t("el-input-number",{staticStyle:{width:"195px"},attrs:{step:1,min:-360,max:360},on:{change:e.getConfigData},model:{value:e.currentWidget.config.roll,callback:function(i){e.$set(e.currentWidget.config,"roll",i)},expression:"currentWidget.config.roll"}})],1):e._e()],1),t("el-collapse-item",{attrs:{title:"\u63A7\u4EF6\u914D\u7F6E"}},[t("el-form-item",{attrs:{label:"\u653E\u5927\u7F29\u5C0F"}},[t("el-switch",{on:{change:function(i){return e.controlChange("controls","Zoom")}},model:{value:e.Zoom,callback:function(i){e.Zoom=i},expression:"Zoom"}})],1),t("el-form-item",{attrs:{label:"\u5730\u7406\u4F4D\u7F6E"}},[t("el-switch",{on:{change:function(i){return e.controlChange("controls","Geolocation")}},model:{value:e.Geolocation,callback:function(i){e.Geolocation=i},expression:"Geolocation"}})],1),t("el-form-item",{attrs:{label:"\u6BD4\u4F8B\u5C3A"}},[t("el-switch",{on:{change:function(i){return e.controlChange("controls","ScaleLine")}},model:{value:e.ScaleLine,callback:function(i){e.ScaleLine=i},expression:"ScaleLine"}})],1),t("el-form-item",{attrs:{label:"\u5168\u5C4F"}},[t("el-switch",{on:{change:function(i){return e.controlChange("controls","FullScreen")}},model:{value:e.FullScreen,callback:function(i){e.FullScreen=i},expression:"FullScreen"}})],1),t("el-form-item",{attrs:{label:"\u5168\u56FE"}},[t("el-switch",{on:{change:function(i){return e.controlChange("controls","FullFigure")}},model:{value:e.FullFigure,callback:function(i){e.FullFigure=i},expression:"FullFigure"}})],1),t("el-form-item",{attrs:{label:"\u6307\u5317\u9488"}},[t("el-switch",{on:{change:function(i){return e.controlChange("controls","Rotate")}},model:{value:e.Rotate,callback:function(i){e.Rotate=i},expression:"Rotate"}})],1),e._e()],1),e.currentWidget.config.viewMode!=="3D"?t("el-collapse-item",{attrs:{title:"\u4EA4\u4E92\u914D\u7F6E"}},[t("el-form-item",{attrs:{label:"\u6EDA\u8F6E\u53D8\u7126"}},[t("el-switch",{on:{change:e.getConfigData},model:{value:e.currentWidget.config.mouseWheelZoomEnable,callback:function(i){e.$set(e.currentWidget.config,"mouseWheelZoomEnable",i)},expression:"currentWidget.config.mouseWheelZoomEnable"}})],1),t("el-form-item",{attrs:{label:"\u53CC\u51FB\u7F29\u653E"}},[t("el-switch",{on:{change:e.getConfigData},model:{value:e.currentWidget.config.doubleClickZoomEnable,callback:function(i){e.$set(e.currentWidget.config,"doubleClickZoomEnable",i)},expression:"currentWidget.config.doubleClickZoomEnable"}})],1),t("el-form-item",{attrs:{label:"\u9F20\u6807\u62D6\u62C9"}},[t("el-switch",{on:{change:e.getConfigData},model:{value:e.currentWidget.config.dragPanEnable,callback:function(i){e.$set(e.currentWidget.config,"dragPanEnable",i)},expression:"currentWidget.config.dragPanEnable"}})],1)],1):e._e(),e.currentWidget.config.viewMode==="23D"?t("el-collapse-item",{attrs:{title:"\u5207\u6362\u6A21\u5F0F"}},[t("el-form-item",{attrs:{label:"\u5F53\u524D\u6A21\u5F0F"}},[t("el-button",{on:{click:e.changeMode}},[e._v(e._s(e.currentViewMode==="map"?"2D":"3D"))]),t("span",[e._v("(\u8BBE\u8BA1\u754C\u9762\u7528,\u4EC5\u7528\u4E8E\u5207\u6362\u540E\u7F16\u8F91\u5176\u4ED6\u4E8C/\u4E09\u7EF4\u7EC4\u4EF6)")])],1),t("el-form-item",{attrs:{label:"\u521D\u59CB\u6A21\u5F0F"}},[e._l(e.viewRadios,function(i,r){return t("el-radio",{key:r,attrs:{label:i.label},on:{change:e.getConfigData},model:{value:e.currentWidget.config.view,callback:function(o){e.$set(e.currentWidget.config,"view",o)},expression:"currentWidget.config.view"}},[e._v(" "+e._s(i.text)+" ")])}),t("span",[e._v("(\u9884\u89C8\u754C\u9762\u7528,\u7528\u4E8E\u521D\u59CB\u89C6\u56FE\u7684\u914D\u7F6E)")])],2)],1):e._e()],1)],1)],2)],1),e.zjLayers&&e.zjLayers.length>0?t("el-collapse",[t("el-collapse-item",[t("template",{slot:"title"},[t("div",{staticClass:"my-title"},[e._v("\u6807\u6CE8\u6837\u5F0F\u914D\u7F6E")])]),t("vue-lazy-component",[e._l(e.zjLayers,function(i,r){return t("el-collapse-item",{key:r},[t("template",{slot:"title"},[t("div",{staticClass:"my-title"},[t("span",[e._v(e._s(i.label))])])]),t("el-form",{ref:"form",refInFor:!0,attrs:{size:"mini","label-width":"75px"},nativeOn:{submit:function(o){o.preventDefault()}}},[t("el-form-item",{attrs:{label:"\u5B57\u53F7"}},[t("el-input-number",{staticClass:"my-style-number",staticStyle:{width:"160px"},attrs:{placeholder:"\u5B57\u53F7\u5927\u5C0F","controls-position":"right",step:.5,min:10,max:100},on:{change:function(o){return e.refreshZjStyle(i)}},model:{value:e.currentWidget.config.zjOptions[i.layerTag].fontSize,callback:function(o){e.$set(e.currentWidget.config.zjOptions[i.layerTag],"fontSize",o)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].fontSize"}})],1),t("el-form-item",{attrs:{label:"\u5B57\u4F53\u989C\u8272"}},[t("el-row",[t("el-col",{attrs:{span:18}},[t("el-input",{attrs:{placeholder:"\u9009\u62E9\u989C\u8272"},on:{change:function(o){return e.refreshZjStyle(i)}},model:{value:e.currentWidget.config.zjOptions[i.layerTag].fontColor,callback:function(o){e.$set(e.currentWidget.config.zjOptions[i.layerTag],"fontColor",o)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].fontColor"}})],1),t("el-col",{attrs:{span:6}},[t("el-color-picker",{staticStyle:{"margin-left":"5px"},attrs:{"show-alpha":""},on:{change:function(o){return e.refreshZjStyle(i)}},model:{value:e.currentWidget.config.zjOptions[i.layerTag].fontColor,callback:function(o){e.$set(e.currentWidget.config.zjOptions[i.layerTag],"fontColor",o)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].fontColor"}})],1)],1)],1),t("el-form-item",{attrs:{label:"\u63CF\u8FB9\u989C\u8272"}},[t("el-row",[t("el-col",{attrs:{span:18}},[t("el-input",{attrs:{placeholder:"\u9009\u62E9\u989C\u8272"},on:{change:function(o){return e.refreshZjStyle(i)}},model:{value:e.currentWidget.config.zjOptions[i.layerTag].strokeColor,callback:function(o){e.$set(e.currentWidget.config.zjOptions[i.layerTag],"strokeColor",o)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].strokeColor"}})],1),t("el-col",{attrs:{span:6}},[t("el-color-picker",{staticStyle:{"margin-left":"5px"},attrs:{"show-alpha":""},on:{change:function(o){return e.refreshZjStyle(i)}},model:{value:e.currentWidget.config.zjOptions[i.layerTag].strokeColor,callback:function(o){e.$set(e.currentWidget.config.zjOptions[i.layerTag],"strokeColor",o)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].strokeColor"}})],1)],1)],1)],1)],2)}),t("div",{staticStyle:{position:"relative","text-align":"center","margin-top":"10px"}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isStartTranslate,expression:"!isStartTranslate"}],attrs:{size:"mini",type:"primary"},on:{click:e.translate}},[e._v("\u79FB\u52A8 ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isStartTranslate,expression:"isStartTranslate"}],attrs:{size:"mini",type:"danger"},on:{click:e.stopTranslate}},[e._v("\u505C\u6B62\u79FB\u52A8 ")])],1)],2)],2)],1):e._e()],1)},p=[],b=a(716971),v=a(386892),u=a(723400),W=a(944337),C=function(){var e=this,t=e._self._c;return t("div",[t("el-collapse",{model:{value:e.activeNames,callback:function(i){e.activeNames=i},expression:"activeNames"}},[t("el-collapse-item",{attrs:{name:"1"}},[t("template",{slot:"title"},[t("div",{staticClass:"my-title"},[e._v(" "+e._s(e.title))])]),t("el-form",{staticStyle:{"padding-left":"20px"}},[t("el-form-item",{attrs:{label:"\u80CC\u666F\u8272"}},[t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"\u9009\u62E9\u989C\u8272",size:"small"},on:{change:function(i){return e.getConfigData()}},model:{value:e.imgIconConfig.backColor,callback:function(i){e.$set(e.imgIconConfig,"backColor",i)},expression:"imgIconConfig.backColor"}})],1),t("el-col",{staticStyle:{"padding-top":"5px"},attrs:{span:6}},[t("el-color-picker",{staticStyle:{"margin-left":"5px"},attrs:{"show-alpha":"",predefine:this.$$global_editor.predefineColors},on:{change:function(i){return e.getConfigData()}},model:{value:e.imgIconConfig.backColor,callback:function(i){e.$set(e.imgIconConfig,"backColor",i)},expression:"imgIconConfig.backColor"}})],1)],1),t("el-form-item",{attrs:{label:"\u9009\u62E9\u56FE\u6807"}},[t("select-img",{attrs:{image:e.imgIconConfig.configSrc},on:{openSelectImage:function(i){return e.openSelectImage("normal")},clearSelectImage:function(i){return e.clearSelectImage("normal")},change:e.getConfigData}})],1),t("el-form-item",{attrs:{label:"\u6309\u94AE\u5927\u5C0F"}},[t("el-input-number",{attrs:{size:"mini","controls-position":"right",min:1,max:100},on:{change:e.getConfigData},model:{value:e.imgIconConfig.size,callback:function(i){e.$set(e.imgIconConfig,"size",i)},expression:"imgIconConfig.size"}})],1)],1)],2)],1),t("el-dialog",{staticClass:"my-image-dialog",staticStyle:{padding:"0px"},attrs:{title:"\u9009\u62E9\u56FE\u7247",top:"10px","append-to-body":!0,visible:e.dialogVisible,width:e.dialogWidth},on:{"update:visible":function(i){e.dialogVisible=i}}},[t("div",[t("image-manage",{ref:"imageMange",attrs:{isDialog:!0,type:["image"]}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelEidt}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getImage}},[e._v("\u786E \u5B9A")])],1)])],1)},x=[],y=a(721829),S=a(582333),Z=a(321300),m=a(555616),k={props:["imgIconConfig","title"],name:"gis-mobile-btn-setting",mixins:[u.j],components:{selectImg:y.Z,ImageManage:S.default},data(){return{activeNames:["1"],formLabelWidth:"120px",imgIcon:"",dialogVisible:!1,dialogWidth:"89%"}},mounted(){this.imgIconConfig.img&&this.imgIconConfig.img.indexOf("/images/")!==-1&&(this.imgIcon="/images/"+this.imgIconConfig.img.split("/images/")[1])},methods:{openSelectImage(n){this.currentSelectImage=n,this.dialogVisible=!0},clearSelectImage(n){n=="normal"?(this.imgIconConfig.src="",this.imgIconConfig.configSrc=""):n=="selected"&&(this.imgIconConfig.selectedImg=""),this.getConfigData()},getImage(){let n=this.$refs.imageMange.getSelectImage();if(n!=null){if(this.$$global.fileType.image.indexOf(n.imageFileType)==-1){m.Message.warning("\u9009\u62E9\u7684\u4E0D\u662F\u56FE\u7247");return}this.dialogVisible=!1;let e=Z.appendImageBaseURL(n.fileUrlPath);this.currentSelectImage=="normal"?(this.imgIconConfig.configSrc=n.fileUrlPath,this.imgIconConfig.src=e):this.currentSelectImage=="selected"&&(this.imgIconConfig.selectedImg=n.fileUrlPath),this.getConfigData()}else m.Message.warning("\u672A\u9009\u62E9\u4EFB\u4F55\u56FE\u7247")},cancelEidt(){this.dialogVisible=!1},getConfigData(){this.$emit("change",this.imgIconConfig)}}},w=k,d=a(768141),z=(0,d.Z)(w,C,x,!1,null,"77e3224f",null),$=z.exports,l=a(927966),_=a(143156),D=a(337564),I={name:"GisMapStyle",components:{layerDirectoryMultiple:W.Z,GisSimpleBtnSetting:$},mixins:[b.baseConfig,v.D,u.j],props:["currentWidget"],data(){return{basemap:null,formLabelWidth:"120px",zjLayers:[],isStartTranslate:this.currentWidget.config.isStartTranslate,lyrConfig:{isZoomToLayer:!1,isLegend:!1,isProxy:!1},radiosObj:[{label:!0,text:"\u542F\u7528"},{label:!1,text:"\u5173\u95ED"}],radios:[{label:!1,text:"\u81EA\u5B9A\u4E49\u5B9A\u4F4D"},{label:!0,text:"\u884C\u653F\u533A\u5B9A\u4F4D"}],viewRadios:[{label:"map",text:"\u4E8C\u7EF4"},{label:"earth",text:"\u4E09\u7EF4"}],viewModeRadios:[{label:"2D",text:"\u4E8C\u7EF4\u6A21\u5F0F"},{label:"3D",text:"\u4E09\u7EF4\u6A21\u5F0F"},{label:"23D",text:"\u4E8C\u4E09\u7EF4\u6A21\u5F0F"}],Zoom:!1,Geolocation:!1,ScaleLine:!1,FullScreen:!1,FullFigure:!1,Rotate:!1,center:"120.1448, 30.2472",currentViewMode:"map"}},computed:{isCurrentView3D(){return this.currentWidget.config.viewMode==="3D"||this.currentWidget.config.viewMode==="23D"&&this.currentWidget.config.view==="earth"}},watch:{"currentWidget.mapLayer.toc":{handler(n){this.createZjLayers(n)}}},mounted(){this.createZjLayers(this.currentWidget.mapLayer.toc),this.initControls(this.currentWidget.config.controls),this.currentWidget.config.center&&(this.center=this.currentWidget.config.center.toString()),l.Z.$on("map:changeViewMode",n=>{this.currentViewMode=n})},methods:{changeMode(){l.Z.$emit("map:toChangeViewMode")},submitForm(n){this.$refs[n].validate(e=>{if(e)this.dialogFormVisible=!1;else return!1})},changeCenter(){this.currentWidget.config.center=this.center.split(",");for(let n in this.currentWidget.config.center)this.currentWidget.config.center[n]=Number(this.currentWidget.config.center[n]);this.getConfigData()},changeZoom(){this.currentWidget.config.zoom<this.currentWidget.config.minZoom&&(this.currentWidget.config.zoom=this.currentWidget.config.minZoom),this.currentWidget.config.zoom>this.currentWidget.config.maxZoom&&(this.currentWidget.config.zoom=this.currentWidget.config.maxZoom),this.getConfigData()},addType(n){this.dialogTableVisible=!0},changeType(n){this.currentFileType=n},handleChange(n,e){e.enable=!e.enable},handleEdit(n,e){this.dialogFormVisible=!0,this.ruleForm.name=e.name,this.ruleForm.type=e.suffix},onLayerChange(n){this.currentWidget.mapLayer.toc=n;let e=JSON.stringify(n);l.Z.$emit("refreshLayer",e),this.getConfigData()},newGuid(){for(var n="",e=1;e<=32;e++){var t=Math.floor(Math.random()*16).toString(16);n+=t,(e==8||e==12||e==16||e==20)&&(n+="-")}return n},basemapHandel(n){let e=null;return e={id:n.id,name:n.label,thumbnailUrl:n.thumbUrl,layers:[n]},e},handleNodeClickXzq(n){this.currentWidget.config.currentXZQ=n.id,this.currentWidget.config.currentXZQMC=n.label,this.$refs.xzqSelect.blur(),this.getXZQlist(n.id,()=>{this.getConfigData()})},getXZQlist(n,e){return _.h.getListByWhereClause({xzqCode:n}).then(t=>{if(t.status===200&&t.data&&t.data.length>0){let i=JSON.parse(t.data[0].geojsonGis),o=new D.default().readFeature(i).getGeometry().getExtent();o.forEach((s,g)=>{o[g]=Number(s)}),this.currentWidget.config.center=[(o[0]+o[2])/2,(o[1]+o[3])/2],this.center=this.currentWidget.config.center.toString(),this.currentWidget.config.extent=o;let c=this.getWidgetObject(this.currentWidget.id);if(c&&c.getMap()){let s=c.getMap().getView(),g=s.getResolutionForExtent(o);this.currentWidget.config.zoom=s.getZoomForResolution(g)}e()}}),!1},initXZQ_fun(n){let e=(n||this.currentWidget.config.currentXZQ)+"";if(e){for(;e.length<6;)e+="0";e.indexOf("156")===-1&&(e="156"+e)}return e},createZjLayers(n){this.zjLayers=[];for(let e of n)e.type=="feature-zj"&&(this.zjLayers.push(e),this.currentWidget.config.zjOptions[e.layerTag]||(this.currentWidget.config.zjOptions[e.layerTag]=this.currentWidget.config.zjDefaultOptions))},refreshZjStyle(n){l.Z.$emit("gis-map-zj-refreshStyle",n,this.currentWidget.config.zjOptions[n.layerTag])},translate(){this.isStartTranslate=this.currentWidget.config.isStartTranslate=!0,l.Z.$emit("gis-map-zj-startTranslate")},stopTranslate(){this.isStartTranslate=this.currentWidget.config.isStartTranslate=!1,l.Z.$emit("gis-map-zj-stopTranslate")},initControls(n){if(n)for(let e of n)this[e]=!0},controlChange(n,e){let t=this.currentWidget.config[n].indexOf(e);this[e]?t===-1&&this.currentWidget.config[n].push(e):t>-1&&this.currentWidget.config[n].splice(t,1),this.getConfigData()}}},T=I,j=(0,d.Z)(T,h,p,!1,null,"972a4982",null),M=j.exports}}]);
