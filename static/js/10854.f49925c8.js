(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[10854],{71878:function(f,m,r){"use strict";var p=r(465557),a=r(419534);Object.defineProperty(m,"__esModule",{value:!0}),m.default=m.IdentifyActiveEvent=void 0;var s=a(r(828866)),o=a(r(578756)),l=a(r(342579)),u=a(r(42762)),b=a(r(122777)),y=a(r(330044)),$=a(r(299085)),v=a(r(234009)),D=a(r(407165)),T=a(r(12207));function M(A){var R=x();return function(){var c=(0,v.default)(A),I;if(R){var g=(0,v.default)(this).constructor;I=p(c,arguments,g)}else I=c.apply(this,arguments);return(0,$.default)(this,I)}}function x(){if(typeof Reflect>"u"||!p||p.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(p(Boolean,[],function(){})),!0}catch{return!1}}var L={CHANGEACTIVE:"change:active"},B=function(A){(0,y.default)(P,A);var R=M(P);function P(c,I){var g;return(0,b.default)(this,P),g=R.call(this,c),g.active=I,g}return(0,u.default)(P)}(T.default);m.IdentifyActiveEvent=B;var j=function(A){(0,y.default)(P,A);var R=M(P);function P(c,I){var g;return(0,b.default)(this,P),g=R.call(this),g.active=!1,g.map=c,g.earth=I,g._initIdentify(),g}return(0,u.default)(P,[{key:"_initIdentify",value:function(){var I=this,g=[];(0,s.default)(this)&&g.push(new o.default(function(N){var z=this;(0,l.default)(this,I),Promise.all([r.e(32002),r.e(42551),r.e(21381),r.e(75075)]).then(r.bind(r,375075)).then(function(W){var E=this;(0,l.default)(this,z);var Z=W.default;this.mapIdentify=new Z((0,s.default)(this)),this.mapIdentify.on("identifyed",function(V){(0,l.default)(this,E),this.dispatchEvent(V)}.bind(this)),this.mapIdentify.on("identifyedAll",function(V){(0,l.default)(this,E),this.dispatchEvent(V)}.bind(this)),N()}.bind(this))}.bind(this))),this.earth&&g.push(new o.default(function(N){var z=this;(0,l.default)(this,I),Promise.all([r.e(32002),r.e(8890),r.e(93503),r.e(37661),r.e(15810),r.e(83719),r.e(42551),r.e(21381),r.e(26393)]).then(r.bind(r,426393)).then(function(W){var E=this;(0,l.default)(this,z);var Z=W.default;this.earthIdentify=new Z(this.earth),this.earthIdentify.on("identifyed3d",function(V){(0,l.default)(this,E),this.dispatchEvent(V)}.bind(this)),this.earthIdentify.on("identifyedAll3d",function(V){(0,l.default)(this,E),this.dispatchEvent(V)}.bind(this)),N()}.bind(this))}.bind(this))),o.default.all(g).then(function(){(0,l.default)(this,I),this.dispatchEvent({type:"inited"})}.bind(this))}},{key:"init",value:function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"click";(0,s.default)(this)&&this.mapIdentify.init(I),this.earth&&this.earthIdentify.init(I),this.active=!0,this.dispatchEvent(new B(L.CHANGEACTIVE,this.active,I))}},{key:"clearHighLight",value:function(){var I=this.getCurrentView();I==="map"&&this.mapIdentify.clearHighLight(),I==="earth"&&this.earthIdentify.clearHighLight()}},{key:"highLightFeature",value:function(I){var g=this.getCurrentView();g==="map"&&this.mapIdentify.highLightFeature(I),g==="earth"&&this.earthIdentify.highLightFeature(I)}},{key:"setActive",value:function(I){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"click";I?(this.active&&this.cancel(),this.init(g)):this.active&&this.cancel()}},{key:"cancel",value:function(){(0,s.default)(this)&&this.mapIdentify.cancel(),this.earth&&this.earthIdentify.cancel(),this.active=!1,this.dispatchEvent(new B(L.CHANGEACTIVE,this.active))}},{key:"getCurrentView",value:function(){if((0,s.default)(this))if(this.earth){var I=(0,s.default)(this).getContainer().style.display!=="none";return I?"map":"earth"}else return"map";else return"earth"}}]),P}(D.default),F=j;m.default=F},321963:function(f,m,r){var p=r(149500);f.exports=function(a){var s={};function o(l){if(s[l])return s[l].exports;var u=s[l]={i:l,l:!1,exports:{}};return a[l].call(u.exports,u,u.exports,o),u.l=!0,u.exports}return o.m=a,o.c=s,o.d=function(l,u,b){o.o(l,u)||Object.defineProperty(l,u,{enumerable:!0,get:b})},o.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},o.t=function(l,u){if(u&1&&(l=o(l)),u&8||u&4&&typeof l=="object"&&l&&l.__esModule)return l;var b=Object.create(null);if(o.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:l}),u&2&&typeof l!="string")for(var y in l)o.d(b,y,function($){return l[$]}.bind(null,y));return b},o.n=function(l){var u=l&&l.__esModule?function(){return l.default}:function(){return l};return o.d(u,"a",u),u},o.o=function(l,u){return Object.prototype.hasOwnProperty.call(l,u)},o.p="/dist/",o(o.s=749)}({0:function(a,s){a.exports=r(342579)},1:function(a,s){a.exports=r(828866)},11:function(a,s){a.exports=r(520314)},17:function(a,s){a.exports=r(985208)},18:function(a,s){a.exports=r(659791)},19:function(a,s){a.exports=r(183393)},2:function(a,s,o){"use strict";o.d(s,"a",function(){return l});function l(u,b,y,$,v,D,T,M){var x=typeof u=="function"?u.options:u;b&&(x.render=b,x.staticRenderFns=y,x._compiled=!0),$&&(x.functional=!0),D&&(x._scopeId="data-v-"+D);var L;if(T?(L=function(F){F=F||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!F&&typeof __VUE_SSR_CONTEXT__<"u"&&(F=__VUE_SSR_CONTEXT__),v&&v.call(this,F),F&&F._registeredComponents&&F._registeredComponents.add(T)},x._ssrRegister=L):v&&(L=M?function(){v.call(this,(x.functional?this.parent:this).$root.$options.shadowRoot)}:v),L)if(x.functional){x._injectStyles=L;var B=x.render;x.render=function(A,R){return L.call(R),B(A,R)}}else{var j=x.beforeCreate;x.beforeCreate=j?[].concat(j,L):[L]}return{exports:u,options:x}}},20:function(a,s){a.exports=r(105077)},21:function(a,s){a.exports=r(581806)},24:function(a,s){a.exports=r(452909)},25:function(a,s){a.exports=r(543389)},28:function(a,s){a.exports=r(132726)},30:function(a,s){a.exports=r(832569)},32:function(a,s){a.exports=r(417745)},35:function(a,s){a.exports=r(349162)},357:function(a,s){a.exports=r(125794)},38:function(a,s){a.exports=r(326541)},39:function(a,s){a.exports=r(426352)},40:function(a,s){a.exports=r(230551)},41:function(a,s){a.exports=r(43586)},43:function(a,s){a.exports=r(147806)},453:function(a,s){a.exports=r(71878)},454:function(a,s){a.exports=r(875420)},455:function(a,s){a.exports=r(266880)},456:function(a,s){a.exports=r(612768)},517:function(a,s){a.exports=r(835156)},54:function(a,s){a.exports=r(101117)},6:function(a,s){a.exports=r(783574)},60:function(a,s){a.exports=r(308421)},61:function(a,s){a.exports=r(419457)},7:function(a,s){a.exports=r(17249)},749:function(a,s,o){"use strict";o.r(s);var l=o(0),u=o.n(l),b=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sh-identify-popup"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],staticClass:"button-container"},[t.$slots.default?i("span",{on:{click:function(){return t.toggle()}}},[t._t("default")],2):i("general-button",{attrs:{theme:t.theme,"is-column":t.isColumn,position:t.position,"icon-class":t.iconClass?t.iconClass:"identify-popup",active:t.active,"show-img":t.showImg,"show-label":t.showLabel,"drag-enable":t.dragEnable,"theme-style":t.themeStyle,title:t.title?t.title:"\u67E5\u8BE2"},on:{click:function(){return t.toggle()}}}),t.ready&&(t.viewMode==="23D"||t.viewMode==="2D")?i("MapPopup",{ref:"mapPopup",attrs:{active:t.active,identify:t.identify,"color-config":t.colorConfig,"bind-feature":t.defaultBindFeature,stripe:t.stripe,border:t.border,"stripe-color":t.stripeColor.map,"bind-mode-button":t.bindModeButton,"lock-button":t.lockButton,"popup-card-props":t.popupCardProps,"disabled-popup":t.disabledPopup},on:{"change:feature":t.onChangeFeature,close:t.onClose},scopedSlots:t._u([{key:"popup",fn:function(n){return[t._t("popup",null,null,n)]}},{key:"cardExtend",fn:function(){return[t._t("cardExtend")]},proxy:!0}],null,!0)},[t._t("mapPopup")],2):t._e(),t.ready&&(t.viewMode==="23D"||t.viewMode==="3D")?i("EarthPopup",{ref:"earthPopup",attrs:{active:t.active,identify:t.identify,"bind-feature":t.defaultBindFeature,stripe:t.stripe,border:t.border,"stripe-color":t.stripeColor.earth,"bind-mode-button":t.bindModeButton,"lock-button":t.lockButton,"popup-card-props":t.popupCardProps,"disabled-popup":t.disabledPopup},on:{"change:feature":t.onChangeFeature,close:t.onClose},scopedSlots:t._u([{key:"popup",fn:function(n){return[t._t("popup",null,null,n)]}},{key:"cardExtend",fn:function(){return[t._t("cardExtend")]},proxy:!0}],null,!0)},[t._t("earthPopup")],2):t._e()],1),t.panelShouldShow?i("general-container",{staticStyle:{left:"100px",top:"50px"},attrs:{"style-config":t.panelStyleConfig,position:t.panelPosition,theme:"light",title:t.panelTitle?t.panelTitle:"\u67E5\u8BE2","img-src":t.panelImgSrc?t.panelImgSrc:"identify-popup"},on:{"change:isShow":t.changeIsShow}},[i("el-tabs",{class:["panel-tabs",{"only-one":t.panelConfig.length<2}],model:{value:t.currentTab,callback:function(n){t.currentTab=n},expression:"currentTab"}},[i("el-tab-pane",{attrs:{label:"\u67E5\u8BE2\u65B9\u5F0F",name:"type"}},[t.currentTab==="type"?i("TypeCard",{attrs:{"current-query-type":t.queryType},on:{"update:currentQueryType":function(n){t.queryType=n},"update:current-query-type":function(n){t.queryType=n}}}):t._e()],1),i("el-tab-pane",{attrs:{label:"\u7F13\u51B2\u533A\u67E5\u8BE2",name:"buffer"}},[t.currentTab==="buffer"?i("BufferCard",{attrs:{identify:t.identify,"current-query-type":t.queryType,"default-buffer-radius":t.defaultBufferRadius},on:{"update:currentQueryType":function(n){t.queryType=n},"update:current-query-type":function(n){t.queryType=n}}}):t._e()],1)],1)],1):t._e()],1)},y=[];b._withStripped=!0;var $=o(453),v=o.n($),D=o(6),T=o.n(D),M=o(7),x=o.n(M),L=o(60),B=o.n(L),j=o(30),F=o.n(j),A=o(61),R=o.n(A),P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"sh-map-popup",style:Object.assign({},t.themeVariables)},[t._t("default",function(){return[i("PopupCard",{attrs:{active:t.active,position:t.bindFeatureValue?t.bindPosition:t.unbindPosition,options:t.totalData,"style-config":t.styleConfig,"img-src":t.imgSrc,"bind-feature":t.bindFeatureValue,stripe:t.stripe,border:t.border,"bind-mode-button":t.bindModeButton,"lock-button":t.lockButton},on:{"change:feature":t.onChangeFeature,"change:connectMode":t.onConnectModeChange,"change:lock":t.onChangeLock,zoom:t.onZoom,close:t.onClose},scopedSlots:t._u([{key:"default",fn:function(n){return[t._t("popup",null,null,n)]}},{key:"cardExtend",fn:function(){return[t._t("cardExtend")]},proxy:!0}],null,!0)},[t._t("popup")],2)]})],2)},c=[];P._withStripped=!0;var I=o(17),g=o.n(I),N=o(18),z=o.n(N),W=o(19),E=o.n(W),Z=o(20),V=o.n(Z),Vt=o(25),st=o.n(Vt),Ht=o(38),ht=o.n(Ht),zt=o(8),q=o.n(zt),ct=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("GeneralCard",{ref:"card",staticClass:"sh-popup-card",class:{bind:t.bindFeature,multi:t.layerList.length>1},attrs:{"drag-enable":!t.bindFeature,"style-config":t.styleConfig,position:t.position,"img-src":t.imgSrc?t.imgSrc:"identify-popup",theme:t.theme},on:{"change:isShow":t.onChange}},[i("template",{slot:"title"},[t.layerList.length>1?i("el-select",{staticClass:"select",attrs:{placeholder:"\u8BF7\u9009\u62E9\u56FE\u5C42",size:"mini","popper-append-to-body":!1},model:{value:t.currentLayerId,callback:function(n){t.currentLayerId=n},expression:"currentLayerId"}},[i("template",{slot:"prefix"},[i("IconSvg",{style:{margin:"9px 0"},attrs:{height:"14px",width:"14px",fillcolor:"var(--sh-color-text-primary)","icon-class":"layer-manager-layer"}})],1),t._l(t.layerList,function(n){return i("el-option",{key:n.id,attrs:{label:n.label,value:n.id}},[i("span",[t._v(t._s(n.label))]),i("el-badge",{staticClass:"mark",attrs:{size:"small",max:99,value:n.count}})],1)})],2):[t._v(t._s(t.layerList[0]?t.layerList[0].label:""))]],2),i("template",{slot:"extBtn"},[t.bindModeButton?i("el-tooltip",{attrs:{content:t.bindFeature?"\u4E0D\u505C\u9760":"\u505C\u9760",placement:"top","open-delay":50}},[i("i",{staticClass:"connection-btn el-icon-connection",on:{click:t.onConnectModeChange}})]):t._e(),t.lockButton?i("el-tooltip",{attrs:{content:t.lock?"\u53D6\u6D88\u9501\u5B9A":"\u9501\u5B9A\u5F53\u524D\u67E5\u8BE2",placement:"top","open-delay":50}},[i("IconSvg",{attrs:{height:"16px",width:"16px",fillcolor:t.lock?"#FF5E67":"var(--sh-color-text-primary)","icon-class":"lock"},nativeOn:{click:function(n){return t.onChangeLock.apply(null,arguments)}}})],1):t._e()],1),i("div",{staticClass:"info-container"},[i("el-scrollbar",{staticClass:"table-scrollbar"},[t._t("default",function(){return[t.panelConfig.type==="default"?i("div",{staticClass:"attr-table"},[i("el-table",{attrs:{stripe:t.stripe,border:t.border,"highlight-current-row":!1,data:t.tableData,"show-header":!1}},[i("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"key",label:"\u5C5E\u6027"}}),i("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"data",label:"\u6570\u503C"},scopedSlots:t._u([{key:"default",fn:function(n){return[t.isLinkFied(n.row.key)?i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(d){t.onHrefClick(t.getLinkFiedUrl(n.row.key))}}},[t._v(t._s(n.row.data))]):i("span",[t._v(t._s(n.row.data))])]}}],null,!1,2416108383)},[t._v(`>
            `)])],1)],1):t.panelConfig.type==="iframe"?i("iframe",{attrs:{src:t.panelConfig.url,frameborder:"0",width:t.panelConfig.iframeWidth,height:t.panelConfig.iframeHeight}}):t.panelConfig.type==="video"?i("div",{staticClass:"video-panel"},[i("VideoPlayer",{attrs:{options:t.videoOptions,"video-config":t.panelConfig.video}})],1):t._e()]},{result:t.currentFeature,layerInfo:t.currentLayerInfo})],2),t.$slots.cardExtend?i("div",{staticClass:"extend"},[t._t("cardExtend")],2):t._e()],1),i("el-pagination",{attrs:{"hide-on-single-page":"",layout:"prev, pager, next","page-count":t.totalPage,"pager-count":5,"current-page":t.currentPage},on:{"update:currentPage":function(n){t.currentPage=n},"update:current-page":function(n){t.currentPage=n}}}),i("div",{ref:"footer",staticClass:"info-footer"},[t.bindFeature?t._e():i("el-button",{ref:"zoomBtn",staticClass:"zoom",attrs:{type:"text",size:"small",icon:"el-icon-position"},on:{click:t.onZoom}},[t._v("\u7F29\u653E\u81F3")]),i("div",{ref:"links",staticClass:"links",style:{left:t.bindFeature?"15px":"85px"}},t._l(t.links,function(n,d){return i("el-button",{key:d,attrs:{type:"text",size:"small"},on:{click:function(h){return t.onFooterHrefClick(n)}}},[t._v(t._s(n.name||"\u94FE\u63A5"))])}),1)],1),t.iframePopup?i("GeneralCard",{ref:"iframeCard",attrs:{position:{type:"absolute",top:"100px",right:"200px"},title:t.iframePopup.name,"style-config":t.styleConfig,"theme-style":t.themeStyle,"img-src":t.imgSrc?t.imgSrc:"identify-popup",theme:t.theme},on:{"change:isShow":t.onIframeChangeShow}},[i("iframe",{attrs:{src:t.iframePopup.url,frameborder:"0",width:t.iframePopup.iframeWidth,height:t.iframePopup.iframeHeight}})]):t._e()],2)},Wt=[];ct._withStripped=!0;var Gt=o(24),k=o.n(Gt),Nt=o(21),Ut=o.n(Nt),Zt=o(1),Kt=o.n(Zt),Qt=o(11),Xt=o.n(Qt),Jt=o(39),Yt=o.n(Jt),kt=o(40),qt=o.n(kt),_t=o(41),te=o.n(_t),ee=o(43),ie=o.n(ee),ne=o(32),re=o.n(ne),oe=o(54),vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("video",{ref:"videoPlayer",staticClass:"video-js vjs-big-play-centered",attrs:{width:"300",height:"168.75"}}),!t.error&&t.currentView==="earth"?i("div",{staticClass:"footer"},[i("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.videoProjection}},[t._v("\u5F00\u542F\u6295\u5F71")]),i("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.destroyVideoProjection}},[t._v("\u5173\u95ED\u6295\u5F71")])],1):t._e()])},ae=[];vt._withStripped=!0;var se=o(454),ue=o.n(se),qe=o(517);function yt(t,e){var i=g()(t);if(z.a){var n=z()(t);e&&(n=q()(n).call(n,function(d){return E()(t,d).enumerable})),i.push.apply(i,n)}return i}function gt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?yt(Object(i),!0).forEach(function(n){st()(t,n,i[n])}):V.a?Object.defineProperties(t,V()(i)):yt(Object(i)).forEach(function(n){Object.defineProperty(t,n,E()(i,n))})}return t}var le={name:"ShVideoPlayer",mixins:[T.a,x.a],props:{options:{type:Object,default:function(){return{}}},videoConfig:{type:Object,default:function(){return{}}}},data:function(){return this.beforeVideoPosition=null,{error:!0}},watch:{options:{handler:function(e){this.player&&this.player.src(e.sources[0])},deep:!0}},mounted:function(){var e=this;this.player=ue()(this.$refs.videoPlayer,this.options),this.player.on("canplay",function(){u()(this,e),this.error=!1}.bind(this)),this.player.on("error",function(i){u()(this,e),p.error("error",i),this.error=!0}.bind(this))},beforeDestroy:function(){this.player&&(this.player.isInPictureInPicture()&&this.player.exitPictureInPicture(),this.player.dispose())},methods:{setCurrentPosition:function(){var e=this.$earth.getCenter(),i=this.$earth.getHeight(),n=this.$earth.getOrientation(),d=n.heading,h=n.roll,C=n.pitch;this.beforeVideoPosition={center:e,height:i,heading:d,roll:h,pitch:C}},videoProjection:function(){this.setCurrentPosition(),this.$earth.performVideoProjection(gt(gt({},this.videoConfig),{},{projection:!0,showPlayer:!1,showSketch:!1,showFrustumOutline:!1}));var e=this.videoConfig,i=e.viewPosition,n=e.viewHeading,d=e.viewPitch;this.$earth.centerAt({center:[i[0],i[1]],height:i[2],heading:n,pitch:d,roll:0})},destroyVideoProjection:function(){var e;(e=this.$earth)===null||e===void 0||e.destroyVideoProjection(),this.beforeVideoPosition&&(this.$earth.centerAt(this.beforeVideoPosition),this.beforeVideoPosition=null)}}},de=le,K=o(2),fe=Object(K.a)(de,vt,ae,!1,null,null,null),pe=fe.exports,he=void 0;function ut(t,e){var i=typeof qt.a<"u"&&te()(t)||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=ce(t))||e&&t&&typeof t.length=="number"){i&&(t=i);var n=0,d=function(){};return{s:d,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(O){throw O},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,C=!1,w;return{s:function(){i=i.call(t)},n:function(){var O=i.next();return h=O.done,O},e:function(O){C=!0,w=O},f:function(){try{!h&&i.return!=null&&i.return()}finally{if(C)throw w}}}}function ce(t,e){var i;if(t){if(typeof t=="string")return mt(t,e);var n=Xt()(i=Object.prototype.toString.call(t)).call(i,8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Yt()(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mt(t,e)}}function mt(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var ve={name:"ShPopupCard",components:{GeneralCard:F.a,IconSvg:re.a,VideoPlayer:pe},mixins:[T.a,x.a,ie.a],props:{active:{type:Boolean,default:!1},options:{type:Array,default:function(){return u()(this,he),[]}.bind(void 0)},bindFeature:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},border:{type:Boolean,default:!1},bindModeButton:{type:Boolean,default:!0},lockButton:{type:Boolean,default:!0}},data:function(){return{tableData:[],layerList:[],links:[],currentLayerId:"",totalPage:0,currentPage:1,panelConfig:{type:"default"},iframePopup:null,lock:!1}},computed:{currentFeatureId:function(){return this.currentLayerId+this.currentPage},currentLayerResult:function(){var e,i=this;return k()(e=this.options).call(e,function(n){return u()(this,i),this.queryId+n.layerId===this.currentLayerId}.bind(this))},footerMode:function(){var e=this.bindFeature,i=this.links;return{bindFeature:e,links:i}},isLinkFied:function(){var e=this;return function(i){var n,d,h,C=this;u()(this,e);var w=(n=this.currentLayerResult)===null||n===void 0||(d=n.results)===null||d===void 0?void 0:d[this.currentPage-1];if(w&&((h=g()(w.identifyField.fieldLink||{}))===null||h===void 0?void 0:h.length)>0){var S,O=i,G=w.identifyField.fieldAliases;if(this.currentLayerResult.type==="arcgis"&&G){var U;O=k()(U=g()(G)).call(U,function(Q){return u()(this,C),G[Q]===i}.bind(this))}return Ut()(S=g()(w.identifyField.fieldLink)).call(S,O)}else return!1}.bind(this)},videoOptions:function(){var e,i;return{autoplay:!0,controls:!0,loop:!0,muted:!0,html5:{vhs:{withCredentials:!1}},sources:[{src:(e=this.panelConfig)===null||e===void 0||(i=e.video)===null||i===void 0?void 0:i.videoUrl}]}},currentFeature:function(){var e;return(e=this.currentLayerResult)===null||e===void 0?void 0:e.results[this.currentPage-1]},currentLayerInfo:function(){var e=this.currentLayerResult||{},i=e.type,n=e.layerLabel,d=e.layerId,h=e.isPop,C=e.layerTag;return{type:i,layerLabel:n,layerId:d,isPop:h,layerTag:C}}},watch:{active:function(e){if(e)this.$refs.card.changeStatus(!0);else{var i;(i=this.$earth)===null||i===void 0||i.destroyVideoProjection()}},options:function(e){var i=this,n;this.$refs.card.changeShow(e.length>0),this.queryId=e.id,this.layerList=Kt()(e).call(e,function(d){return u()(this,i),{id:this.queryId+d.layerId,label:d.layerLabel,count:d.results.length}}.bind(this)),this.currentLayerId=(n=this.layerList[0])===null||n===void 0?void 0:n.id},currentLayerId:function(){this.init()},currentPage:function(){this.tableData=this.getFeatureAttributes()},currentFeatureId:function(e){this.$emit("change:feature",this.currentFeature,this.currentLayerInfo),this.resetData(),this.configLinks(),e&&this.getPanelConfig()},footerMode:function(){var e=this;this.$nextTick(function(){var i,n;u()(this,e);var d=((i=this.$refs.zoomBtn)===null||i===void 0||(n=i.$el)===null||n===void 0?void 0:n.clientHeight)||0,h=this.$refs.links.clientHeight;this.$refs.footer.style.height=Math.max(d,h)+"px"}.bind(this))},iframePopup:function(e){var i=this;e&&this.$nextTick(function(){u()(this,i),this.currentView==="map"?this.$map.getContainer().parentNode.appendChild(this.$refs.iframeCard.$el):this.$earth.getContainer().parentNode.appendChild(this.$refs.iframeCard.$el)}.bind(this))},lock:function(e){this.$emit("change:lock",e)}},methods:{init:function(){var e,i,n=this;this.totalPage=((e=k()(i=this.options).call(i,function(d){return u()(this,n),this.queryId+d.layerId===this.currentLayerId}.bind(this)))===null||e===void 0?void 0:e.results.length)||0,this.currentPage=1,this.tableData=this.getFeatureAttributes()},resetData:function(){this.panelConfig={type:"default"},this.iframePopup=null},getFeatureAttributes:function(){var e,i=this,n,d,h=[],C=k()(e=this.options).call(e,function(Y){return u()(this,i),this.queryId+Y.layerId===this.currentLayerId}.bind(this));if(!C)return[];var w=C.results[this.currentPage-1],S=w.attributes,O=w.identifyField,G=(O==null||(n=O.search)===null||n===void 0?void 0:n.split(","))||[],U=(O==null||(d=O.display)===null||d===void 0?void 0:d.split(","))||[],Q=O!=null&&O.config?O.config:[];if(U.length===0||U[0]==="")for(var _ in S)_!=="geometry"&&h.push({key:_,data:S[_]});else for(var X=0;X<U.length;X++){var tt=G[X],H=S[tt],J=void 0;(!H||H.toString().toUpperCase()==="NULL")&&(H="");var rt=ut(Q),Bt;try{for(rt.s();!(Bt=rt.n()).done;){var Tt=Bt.value;if(Tt.search===tt){var pt=Tt.enumData;if(pt&&pt.length>0){var ot=ut(pt),Et;try{for(ot.s();!(Et=ot.n()).done;){var Mt=Et.value;H===Mt.enum&&(H=Mt.transEnum)}}catch(Y){ot.e(Y)}finally{ot.f()}}}}}catch(Y){rt.e(Y)}finally{rt.f()}if(typeof H=="number"){var at=ut(Q),At;try{for(at.s();!(At=at.n()).done;){var Dt=At.value;Dt.display===tt&&(J=Dt.num)}}catch(Y){at.e(Y)}finally{at.f()}var Rt=String(H).indexOf(".")+1,ke=String(H).length-Rt;Rt>0&&ke>J&&J!==!1&&(H=Math.round(H*Math.pow(10,J))/Math.pow(10,J))}h.push({key:U[X],data:H})}return h},getRealLinkUrl:function(e,i){var n=this,d=e.replace(/\{(.+?)\}/g,function(h,C){if(u()(this,n),this.currentLayerResult.type==="arcgis"&&i.identifyField.fieldAliases){var w=i.identifyField.fieldAliases[C],S=i.attributes[w];return S}else{var O=i.attributes[C];return O}}.bind(this));return d},configLinks:function(){var e,i,n,d=this;this.links=[];var h=(e=this.currentLayerResult)===null||e===void 0||(i=e.results)===null||i===void 0?void 0:i[this.currentPage-1];if(h&&((n=h.identifyField.formConfig)===null||n===void 0?void 0:n.length)>0){var C=[];h.identifyField.formConfig.forEach(function(w){u()(this,d);var S=w.id,O=S===void 0?Object(oe.v4)():S,G=w.formUrl,U=w.name,Q=w.type,_=Q===void 0?"blank":Q,X=w.iframeWidth,tt=X===void 0?275:X,H=w.iframeHeight,J=H===void 0?400:H;h.identifyField.panel!==O&&C.push({name:U,href:this.getRealLinkUrl(G,h),type:_,iframeWidth:tt,iframeHeight:J})}.bind(this)),this.links=C}},getPanelConfig:function(){var e,i,n=this,d=(e=this.currentLayerResult)===null||e===void 0||(i=e.results)===null||i===void 0?void 0:i[this.currentPage-1],h=d?.identifyField||{},C=h.formConfig||[];if(d!=null&&d.video)this.panelConfig={type:"video",video:d.video};else if(!h.panel||h.panel==="default")this.panelConfig={type:"default"};else if(C.some(function(G){return u()(this,n),G.id===h.panel}.bind(this))){var w,S,O=k()(C).call(C,function(G){return u()(this,n),G.id===h.panel}.bind(this));this.panelConfig={type:"iframe",url:this.getRealLinkUrl(O.formUrl,d),iframeWidth:(w=O.iframeWidth)!==null&&w!==void 0?w:275,iframeHeight:(S=O.iframeHeight)!==null&&S!==void 0?S:400}}},getLinkFiedUrl:function(e){var i=this,n=this.currentLayerResult.results[this.currentPage-1],d=e,h=n.identifyField.fieldAliases;if(this.currentLayerResult.type==="arcgis"&&h){var C;d=k()(C=g()(h)).call(C,function(S){return u()(this,i),h[S]===e}.bind(this))}var w=n.identifyField.fieldLink[d];return this.getRealLinkUrl(w,n)},onConnectModeChange:function(){this.$emit("change:connectMode")},onChange:function(e){if(!e){var i;this.resetData(),(i=this.$earth)===null||i===void 0||i.destroyVideoProjection(),this.$emit("close")}},onZoom:function(){this.$emit("zoom")},onHrefClick:function(e){window.open(e)},onFooterHrefClick:function(e){var i=e.name,n=e.href,d=e.type,h=e.iframeWidth,C=e.iframeHeight;d==="blank"?window.open(n):d==="outer"?this.iframePopup={name:i,url:n,iframeWidth:h,iframeHeight:C}:d==="inner"&&(this.panelConfig={type:"iframe",url:n,iframeWidth:h,iframeHeight:C})},onIframeChangeShow:function(e){e||(this.iframePopup=null)},onChangeLock:function(){this.lock=!this.lock}}},ye=ve,ge=Object(K.a)(ye,ct,Wt,!1,null,null,null),bt=ge.exports,me=o(35),lt=o.n(me),et=o(89),Ct={type:"sticky"},Pt={type:"absolute",top:"20%",right:"5%"},xt={size:{radius:"4px",width:"fit-content",height:"100%"},titleBar:{miniBtn:!0,maxBtn:!1,closeBtn:!0,fixBtn:!0,title:!0}},_e={strokeWidth:3,fillAlpha:.5,fill:"#ff0000",stroke:"#ff0000"},be=void 0;function It(t,e){var i=g()(t);if(z.a){var n=z()(t);e&&(n=q()(n).call(n,function(d){return E()(t,d).enumerable})),i.push.apply(i,n)}return i}function Ft(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?It(Object(i),!0).forEach(function(n){st()(t,n,i[n])}):V.a?Object.defineProperties(t,V()(i)):It(Object(i)).forEach(function(n){Object.defineProperty(t,n,E()(i,n))})}return t}var dt=new lt.a,Ce={name:"ShMapPopup",components:{PopupCard:bt},mixins:[T.a,x.a],props:{colorConfig:{type:Object},active:{type:Boolean,default:!1},identify:{type:Object,require:!0},bindFeature:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},stripeColor:{type:Array,default:function(){return u()(this,be),["#FFF","#fafafa"]}.bind(void 0)},border:{type:Boolean,default:!1},bindModeButton:{type:Boolean,default:!0},lockButton:{type:Boolean,default:!0},popupCardProps:{type:Object},disabledPopup:{type:Boolean,default:!1}},data:function(){return this.curFeature,this.mapPopup,this.bindPosition=Ct,this.unbindPosition=Pt,{visible:!1,totalData:[],isActive:0,queryId:"",bindFeatureValue:this.bindFeature,lock:!1}},computed:{imgSrc:function(){var e;return(e=this.popupCardProps)===null||e===void 0?void 0:e.imgSrc},styleConfig:function(){var e;return Ft(Ft({},xt),((e=this.popupCardProps)===null||e===void 0?void 0:e.styleConfig)||{})},themeVariables:function(){var e={"--stripeColorFirst":this.stripeColor[0],"--stripeColorSecond":this.stripeColor[1]};return e}},watch:{active:function(e){!e&&this.closePopup()},queryId:function(){!this.$slots.default&&this.closePopup()},bindFeatureValue:function(e){if(e)this.$map.getContainer().removeChild(this.$el),this.createPopup();else{var i;(i=this.mapPopup)===null||i===void 0||i.destroy(),this.$map.getContainer().appendChild(this.$el)}}},beforeDestroy:function(){if(this.closePopup(),this.bindFeatureValue){var e;(e=this.mapPopup)===null||e===void 0||e.destroy()}else this.$map.getContainer().removeChild(this.$el)},mounted:function(){var e=this;this.bindFeatureValue?this.createPopup():this.$map.getContainer().appendChild(this.$el),this.identify.on("identifyed",function(i){u()(this,e);var n=i.result,d=i.queryId;if(!this.lock&&!this.disabledPopup&&n.isPop!==!1)if(this.queryId===d){var h;((h=n.results)===null||h===void 0?void 0:h.length)>0&&this.totalData.push(n)}else{var C;this.queryId=d,this.totalData=[],this.totalData.id=this.queryId,((C=n.results)===null||C===void 0?void 0:C.length)>0&&this.totalData.push(n)}}.bind(this)),this.$map.layerManager.on("afterRemoveLayer",function(i){var n,d=this;u()(this,e);var h=ht()(n=this.totalData).call(n,function(S){return u()(this,d),S.layerId===i.layer.get("id")}.bind(this));if(h>-1){var C,w=q()(C=this.totalData).call(C,function(S){return u()(this,d),S.layerId!==i.layer.get("id")}.bind(this));this.totalData=w}}.bind(this))},methods:{onChangeFeature:function(e,i){this.$emit("change:feature",e,i),this.clearHighLight(),e&&this.highLightFeature(e)},clearHighLight:function(){this.identify.clearHighLight(),this.curFeature=void 0},createPopup:function(){this.mapPopup=this.$map.createPopup({element:this.$el,offset:[0,-6]});var e;if(this.curFeature){var i=dt.readGeometry(this.curFeature.geometry);e=Object(et.getCenter)(i.getExtent())}this.mapPopup.setPosition(e)},closePopup:function(){var e;this.visible=!1,this.clearHighLight(),(e=this.mapPopup)===null||e===void 0||e.setPosition(void 0)},onClose:function(){this.closePopup(),this.$emit("close","map")},resetPopup:function(e){var i=this;this.visible=!0,this.bindFeatureValue&&this.$nextTick(function(){u()(this,i),this.mapPopup.setPosition(e)}.bind(this))},highLightFeature:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=e.geometry;if(this.curFeature=e,i){var d=Object(et.getCenter)(dt.readGeometry(n).getExtent());this.resetPopup(d)}this.identify.highLightFeature(e)},onConnectModeChange:function(){this.bindFeatureValue=!this.bindFeatureValue},onZoom:function(){if(this.curFeature){var e=dt.readGeometry(this.curFeature.geometry);if(e.getType()==="Point"){var i,n=e.getCoordinates();this.$map.centerAt({center:n,zoom:(i=this.$map.getView().getMaxZoom())!==null&&i!==void 0?i:18})}else{var d=e.getExtent();this.$map.setExtent(d,{padding:[300,300,300,300]})}}},onChangeLock:function(e){this.lock=e}}},Pe=Ce,xe=Object(K.a)(Pe,P,c,!1,null,null,null),Ie=xe.exports,$t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"sh-earth-popup",style:Object.assign({},t.themeVariables)},[t._t("default",function(){return[i("PopupCard",{attrs:{active:t.active,position:t.bindFeatureValue?t.bindPosition:t.unbindPosition,options:t.totalData,"style-config":t.styleConfig,"img-src":t.imgSrc,"bind-feature":t.bindFeatureValue,stripe:t.stripe,border:t.border,"bind-mode-button":t.bindModeButton,"lock-button":t.lockButton},on:{"change:feature":t.onChangeFeature,"change:connectMode":t.onConnectModeChange,"change:lock":t.onChangeLock,zoom:t.onZoom,close:t.onClose},scopedSlots:t._u([{key:"default",fn:function(n){return[t._t("popup",null,null,n)]}},{key:"cardExtend",fn:function(){return[t._t("cardExtend")]},proxy:!0}],null,!0)},[t._t("popup")],2)]})],2)},Fe=[];$t._withStripped=!0;var $e=void 0;function St(t,e){var i=g()(t);if(z.a){var n=z()(t);e&&(n=q()(n).call(n,function(d){return E()(t,d).enumerable})),i.push.apply(i,n)}return i}function wt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?St(Object(i),!0).forEach(function(n){st()(t,n,i[n])}):V.a?Object.defineProperties(t,V()(i)):St(Object(i)).forEach(function(n){Object.defineProperty(t,n,E()(i,n))})}return t}var Lt=new lt.a,Se={name:"ShEarthPopup",components:{PopupCard:bt},mixins:[T.a,x.a],props:{colorConfig:{type:Object},active:{type:Boolean,default:!1},identify:{type:Object,require:!0},bindFeature:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},stripeColor:{type:Array,default:function(){return u()(this,$e),["#696969","#555e67"]}.bind(void 0)},border:{type:Boolean,default:!1},bindModeButton:{type:Boolean,default:!0},lockButton:{type:Boolean,default:!0},popupCardProps:{type:Object},disabledPopup:{type:Boolean,default:!1}},data:function(){return this.bindPosition=Ct,this.unbindPosition=Pt,{visible:!1,totalData:[],isActive:0,queryId:"",bindFeatureValue:this.bindFeature,lock:!1}},computed:{imgSrc:function(){var e;return(e=this.popupCardProps)===null||e===void 0?void 0:e.imgSrc},styleConfig:function(){var e;return wt(wt({},xt),((e=this.popupCardProps)===null||e===void 0?void 0:e.styleConfig)||{})},themeVariables:function(){var e={"--stripeColorFirst":this.stripeColor[0],"--stripeColorSecond":this.stripeColor[1]};return e}},watch:{active:function(e){!e&&this.closePopup()},queryId:function(){!this.$slots.default&&this.closePopup()},bindFeatureValue:function(e){if(e)this.$earth.getContainer().removeChild(this.$el),this.createPopup();else{var i;(i=this.earthPopup)===null||i===void 0||i.destroy(),this.earthPopup=null,this.$earth.getContainer().appendChild(this.$el)}}},beforeDestroy:function(){if(this.closePopup(),this.bindFeatureValue){var e;(e=this.earthPopup)===null||e===void 0||e.destroy()}else this.$earth.getContainer().removeChild(this.$el)},mounted:function(){var e=this;this.bindFeatureValue?this.createPopup():this.$earth.getContainer().appendChild(this.$el),this.identify.on("identifyed3d",function(i){u()(this,e);var n=i.result,d=i.queryId;if(!this.lock&&!this.disabledPopup&&n.isPop!==!1)if(this.queryId===d){var h;((h=n.results)===null||h===void 0?void 0:h.length)>0&&this.totalData.push(n)}else{var C;this.queryId=d,this.totalData=[],this.totalData.id=this.queryId,((C=n.results)===null||C===void 0?void 0:C.length)>0&&this.totalData.push(n)}}.bind(this)),this.$earth.layerManager.on("afterRemoveLayer",function(i){var n,d=this;u()(this,e);var h=ht()(n=this.totalData).call(n,function(S){return u()(this,d),S.layerId===i.data.id}.bind(this));if(h>-1){var C,w=q()(C=this.totalData).call(C,function(S){return u()(this,d),S.layerId!==i.data.id}.bind(this));this.totalData=w}}.bind(this))},methods:{createPopup:function(){this.earthPopup=this.$earth.createPopup({element:this.$el,offset:[0,-6]});var e;this.curFeature&&(e=this.getPositionOfFeature(this.curFeature)),e&&(e[2]+=1),this.earthPopup.setPosition(e)},onChangeFeature:function(e,i){this.$emit("change:feature",e,i),this.clearHighLight(),e&&this.highLightFeature(e)},resetPopup:function(e){var i;e[2]+=1,this.visible=!0,(i=this.earthPopup)===null||i===void 0||i.setPosition(e)},highLightFeature:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(this.identify.highLightFeature(e),this.curFeature=e,i){var n=this.getPositionOfFeature(e);this.resetPopup(n)}},clearHighLight:function(){this.identify.clearHighLight(),this.curFeature=void 0},closePopup:function(){var e;this.visible=!1,this.clearHighLight(),(e=this.earthPopup)===null||e===void 0||e.setPosition(void 0)},onClose:function(){this.closePopup(),this.$emit("close","earth")},onConnectModeChange:function(){this.bindFeatureValue=!this.bindFeatureValue},onZoom:function(){if(this.curFeature){var e;if(this.curFeature.position)e=this.curFeature.position;else{var i=Object(et.getCenter)(Lt.readGeometry(this.curFeature.geometry).getExtent());i[2]=1e3,e=i}this.$earth.centerAt({center:e,heading:0,roll:0,pitch:-90})}},getPositionOfFeature:function(e){var i;if(this.curFeature.position)i=e.position;else if(e.geometry){var n=Object(et.getCenter)(Lt.readGeometry(e.geometry).getExtent());i=n}return i},onChangeLock:function(e){this.lock=e}}},we=Se,Le=Object(K.a)(we,$t,Fe,!1,null,null,null),Oe=Le.exports,Ot=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sh-identify-popup-type-card"},[i("el-radio-group",{attrs:{size:"mini"},model:{value:t.queryType,callback:function(n){t.queryType=n},expression:"queryType"}},[i("el-radio",{attrs:{label:"click"}},[t._v("\u70B9")]),i("el-radio",{attrs:{label:"line"}},[t._v("\u7EBF")]),i("el-radio",{attrs:{label:"polygon"}},[t._v("\u9762")]),i("el-radio",{attrs:{label:"box"}},[t._v("\u6846\u9009")])],1)],1)},je=[];Ot._withStripped=!0;var Be=o(455),Te=o.n(Be),Ee={name:"ShIdentifyPopupTypeCard",props:{currentQueryType:{type:String,default:"click"}},data:function(){return{queryType:this.currentQueryType}},watch:{queryType:function(e){this.$emit("update:currentQueryType",e)}},mounted:function(){var e;Te()(e=this.queryType).call(e,"buffer")&&(this.queryType="click")}},Me=Ee,Ae=Object(K.a)(Me,Ot,je,!1,null,null,null),De=Ae.exports,jt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sh-identify-popup-buffer-card"},[i("el-form",{attrs:{"label-width":"80px",size:"mini",model:t.buffer}},[i("el-form-item",{attrs:{label:"\u56FE\u5F62\u6765\u6E90"}},[i("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9\u56FE\u5F62\u6765\u6E90"},model:{value:t.buffer.source,callback:function(n){t.$set(t.buffer,"source",n)},expression:"buffer.source"}},[i("el-option",{attrs:{label:"\u7ED8\u5236",value:"draw"}}),i("el-option",{attrs:{label:"\u9009\u62E9",value:"select"}})],1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.buffer.source==="draw",expression:"buffer.source === 'draw'"}],attrs:{label:"\u7ED8\u5236\u7C7B\u578B"}},[i("el-radio-group",{staticClass:"drawType",model:{value:t.buffer.drawType,callback:function(n){t.$set(t.buffer,"drawType",n)},expression:"buffer.drawType"}},[i("el-radio",{attrs:{label:"Point"}},[t._v("\u70B9")]),i("el-radio",{attrs:{label:"LineString"}},[t._v("\u7EBF")]),i("el-radio",{attrs:{label:"Polygon"}},[t._v("\u9762")])],1)],1),i("el-form-item",{attrs:{label:"\u7F13\u51B2\u534A\u5F84"}},[i("div",{staticClass:"input-group"},[i("el-input-number",{attrs:{"controls-position":"right",min:0,step:10},model:{value:t.buffer.radius,callback:function(n){t.$set(t.buffer,"radius",n)},expression:"buffer.radius"}}),i("div",{staticClass:"append"},[t._v("\u7C73")])],1)])],1),i("div",{staticClass:"btns"},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.bufferIdentify}},[t._v("\u67E5\u8BE2")])],1)],1)},Re=[];jt._withStripped=!0;var Ve=o(456),He=o(357),ft=new lt.a,ze={name:"ShIdentifyPopupBufferCard",mixins:[T.a,x.a],props:{identify:{type:Object},currentQueryType:{type:String},defaultBufferRadius:{type:Number,default:100}},data:function(){return this.draw=null,this.originFeature=null,{buffer:{source:"draw",drawType:"Point",radius:this.defaultBufferRadius}}},watch:{"buffer.source":{handler:function(e,i){i==="select"&&(this.$emit("changeSelect",!1),this.subscribe.$off("select-tool:selected",this.onSelected)),e==="draw"?this.createDraw(this.buffer.drawType):e==="select"&&(this.closeDraw(),this.subscribe.$on("select-tool:selected",this.onSelected),this.$emit("changeSelect",!0)),this.$emit("update:currentQueryType","buffer-".concat(e))},immediate:!0},"buffer.drawType":function(e){this.closeDraw(),this.buffer.source==="draw"&&this.createDraw(e)},"buffer.radius":function(){this.originFeature&&this.setBufferedFeature(this.originFeature)}},beforeDestroy:function(){this.$emit("changeSelect",!1),this.subscribe.$off("select-tool:selected",this.onSelected),this.clearDrawLayer(),this.closeDraw()},methods:{createDraw:function(e){var i=this,n=this.$map.getLayerById("identifyDrawLayer").getSource(),d={source:n,type:e};this.draw=new Ve.Draw(d),this.draw.on("drawend",function(h){var C=this;u()(this,i),this.originFeature=h.feature.clone(),setTimeout(function(){return u()(this,C),this.setBufferedFeature(h.feature)}.bind(this),0)}.bind(this)),this.$map.addInteraction(this.draw)},closeDraw:function(){this.clearDrawLayer(),this.originFeature=null,this.draw&&(this.$map.removeInteraction(this.draw),this.draw=null)},clearDrawLayer:function(){this.$map.getLayerById("identifyDrawLayer").getSource().clear()},onSelected:function(e){if(e){var i=ft.readFeatures(e);i.length>0&&(this.originFeature=i[0],this.setBufferedFeature(i[0]))}},setBufferedFeature:function(e){if(this.clearDrawLayer(),!!e){var i=this.$map.getView().getProjection().getCode(),n=e.getGeometry().transform(i,"EPSG:4326"),d=Object(He.buffer)(ft.writeGeometryObject(n),this.buffer.radius/1e3),h;d?h=ft.readFeature(d):h=e,h.setGeometry(h.getGeometry().transform("EPSG:4326",i)),this.$map.getLayerById("identifyDrawLayer").getSource().addFeature(h)}},bufferIdentify:function(){var e=this,i=this.$map.getLayerById("identifyDrawLayer").getSource().getFeatures()[0];i&&(this.identify.mapIdentify.identifyLayer(i),setTimeout(function(){u()(this,e),this.clearDrawLayer(),this.originFeature=null}.bind(this),500))}}},We=ze,Ge=Object(K.a)(We,jt,Re,!1,null,null,null),Ne=Ge.exports,it=void 0,Ue={name:"ShIdentifyPopup",components:{MapPopup:Ie,EarthPopup:Oe,GeneralButton:B.a,GeneralContainer:F.a,TypeCard:De,BufferCard:Ne},mixins:[T.a,x.a,R.a],props:{isShow:{type:Boolean,default:!0},bindModeButton:{type:Boolean,default:!0},lockButton:{type:Boolean,default:!0},stripe:{type:Boolean,default:!0},stripeColor:{type:Object,default:function(){return u()(this,it),{map:["#FFF","#fafafa"],earth:["#696969","#555e67"]}}.bind(void 0)},border:{type:Boolean,default:!1},colorConfig:{type:Object},defaultActive:{type:Boolean,default:!1},queryMode:{type:String,default:"click"},isStayActive:{type:Boolean,default:!1},showPanel:{type:Boolean,default:!1},panelConfig:{type:Array,default:function(){return u()(this,it),["type","buffer"]}.bind(void 0)},defaultBufferRadius:{type:Number,default:100},panelCardProps:{type:Object,default:function(){u()(this,it)}.bind(void 0)},defaultBindFeature:{type:Boolean,default:!0},popupCardProps:{type:Object,default:function(){u()(this,it)}.bind(void 0)},disabledPopup:{type:Boolean,default:!1}},data:function(){return this.identify,{ready:!1,active:!1,deactivateByOther:!1,isShowBtn:!1,isStartFix:!1,queryType:this.queryMode?this.queryMode:"click",currentTab:this.panelConfig[0]}},computed:{panelShouldShow:function(){return this.showPanel&&this.active&&this.currentView==="map"},buffPanelShouldShow:function(){return this.buffPanel&&this.active&&this.currentView==="map"},panelStyleConfig:function(){var e;return(e=this.panelCardProps)===null||e===void 0?void 0:e.styleConfig},panelPosition:function(){var e;return((e=this.panelCardProps)===null||e===void 0?void 0:e.position)||{type:"absolute",top:"100px",right:"135px"}},panelImgSrc:function(){var e;return(e=this.panelCardProps)===null||e===void 0?void 0:e.imgSrc},panelTitle:function(){var e;return(e=this.panelCardProps)===null||e===void 0?void 0:e.title}},watch:{currentInteraction:function(e){e===""?this.isStayActive&&this.deactivateByOther&&this.activate():e!==this.$options.name&&this.queryType!=="buffer-select"&&this.active&&(this.deactivate(),this.deactivateByOther=!0)},queryType:{handler:function(e,i){i&&(this.deactivate(),this.activate())},immediate:!0}},beforeDestroy:function(){this.deactivate()},mounted:function(){var e=this;(this.$map||this.$earth)&&setTimeout(function(){u()(this,e),this.begin()}.bind(this),0)},methods:{begin:function(){var e=this;this.identify=new v.a(this.$map,this.$earth),this.identify.on("inited",function(){var i=this;u()(this,e),this.identify.on("change:active",function(n){u()(this,i),this.active=n.active,this.$emit("change:active",n.active,n.identifyType)}.bind(this)),this.identify.on("identifyed",function(n){u()(this,i),this.$emit("identifyed",n)}.bind(this)),this.identify.on("identifyed3d",function(n){u()(this,i),this.$emit("identifyed3d",n)}.bind(this)),this.identify.on("identifyedAll",function(n){u()(this,i),this.$emit("identifyedAll",n)}.bind(this)),this.identify.on("identifyedAll3d",function(n){u()(this,i),this.$emit("identifyedAll3d",n)}.bind(this)),this.ready=!0,this.defaultActive&&this.activate()}.bind(this))},activate:function(){var e;(e=this.identify)===null||e===void 0||e.setActive(!0,this.queryType)},deactivate:function(){var e;(e=this.identify)===null||e===void 0||e.setActive(!1,this.queryType),this.deactivateByOther=!1},toggle:function(e){var i;typeof e=="boolean"?i=e:i=!this.identify.active,i?this.activate():this.deactivate()},changeIsShow:function(e){e||this.deactivate()},highLightFeature:function(e){if(this.currentView==="map"){var i=!!this.$scopedSlots.mapPopup;this.$refs.mapPopup.highLightFeature(e,i)}else{var n=!!this.$scopedSlots.earthPopup;this.$refs.earthPopup.highLightFeature(e,n)}},closePopup:function(){this.currentView==="map"?this.$refs.mapPopup.closePopup():this.$refs.earthPopup.closePopup()},onChangeFeature:function(e,i){this.$emit("change:feature",e,i)},onClose:function(e){this.$emit("close",e)}}},Ze=Ue,Ke=Object(K.a)(Ze,b,y,!1,null,null,null),Qe=Ke.exports,Xe=o(28),Je=o.n(Xe),Ye=void 0,nt=Je()(Qe,{transform:function(e){u()(this,Ye);var i=e.show,n=e.position;return{isShow:i,position:n}}.bind(void 0)});nt.install=function(t){t.component(nt.name,nt)};var ti=s.default=nt},8:function(a,s){a.exports=r(22466)},89:function(a,s){a.exports=r(692086)}})},419457:function(f,m,r){"use strict";var p=r(419534);Object.defineProperty(m,"__esModule",{value:!0}),m.default=void 0;var a=p(r(452909)),s=p(r(342579)),o=void 0,l={props:{isShow:{type:Boolean,default:!0},position:{type:Object,default:function(){return(0,s.default)(this,o),{type:"absolute",top:"1px",left:"1px"}}.bind(void 0)},isColumn:{type:Boolean,default:!1},title:{type:String},iconClass:{type:String},dragEnable:{type:Boolean,default:!1},showImg:{type:Boolean,default:!0},showLabel:{type:Boolean,default:!0},themeStyle:{type:Object}},data:function(){return{theme:"light"}},watch:{currentView:{handler:function(y){y==="earth"?this.theme="dark":this.theme="light"},immediate:!0}},mounted:function(){var y,$=this;this.$_mixin_generalButton=(0,a.default)(y=this.$children).call(y,function(v){return(0,s.default)(this,$),v.$options.name==="ShGeneralButton"}.bind(this))},methods:{getPosition:function(){var y;return(y=this.$_mixin_generalButton)===null||y===void 0?void 0:y.getPosition()}}},u=l;m.default=u},147806:function(f,m,r){"use strict";var p=r(419534);Object.defineProperty(m,"__esModule",{value:!0}),m.default=void 0;var a=p(r(452909)),s=p(r(342579)),o=void 0,l={inject:{generalCardThemeStyle:{default:null}},props:{styleConfig:{type:Object,default:function(){(0,s.default)(this,o)}.bind(void 0)},position:{type:Object,default:function(){return(0,s.default)(this,o),{type:"absolute",top:"100px",right:"135px"}}.bind(void 0)},themeStyle:{type:Object},imgSrc:{type:String},title:{type:String},isShow:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!1},dragEnable:{type:Boolean,default:!0},onlyContainer:{type:Boolean,default:!1}},data:function(){return{visible:this.isShow,theme:"light"}},watch:{currentView:{handler:function(y){y==="earth"?this.theme="dark":this.theme="light"},immediate:!0},isShow:function(y){this.visible=y}},computed:{cardThemeStyle:function(){return this.themeStyle||this.generalCardThemeStyle}},mounted:function(){var y,$=this;this.$_mixin_generalCard=(0,a.default)(y=this.$children).call(y,function(v){return(0,s.default)(this,$),v.$options.name==="ShGeneralCard"}.bind(this))},methods:{changeShow:function(y){var $;if(($=this.$_mixin_generalCard)===null||$===void 0||$.changeShow(y),y===!1||y!==!0&&this.visible){var v;(v=this.deactivate)===null||v===void 0||v.call(this)}},changeStatus:function(y){var $;($=this.$_mixin_generalCard)===null||$===void 0||$.changeStatus(y)},getPosition:function(){var y;return(y=this.$_mixin_generalCard)===null||y===void 0?void 0:y.getPosition()}}},u=l;m.default=u},242709:function(f,m,r){"use strict";var p=r(148836);const a={data(){return this.map=null,this.timer="",{isEditor:window.location.href.indexOf("editor.html")>0}},inject:{reactiveViewMode:{default:function(){return()=>"23D"}}},computed:{viewMode(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()}},mounted(){!this.widgetInfo.parentId&&this.isEditor&&this.widgetInfo.action.gisMapId&&this.$nextTick(function(){this.updateWidgetParentId({widgetId:this.widgetInfo.id,parentId:this.widgetInfo.action.gisMapId,keepPosition:!0})})},methods:{...(0,p.nv)(["updateWidgetParentId"]),getBindMap(){typeof this.widgetInfo.action.gisMapId<"u"}}};m.Z=a},752246:function(f,m,r){"use strict";r.d(m,{X:function(){return p},b:function(){return a}});let p={versions:function(){var s=navigator.userAgent;return{trident:s.indexOf("Trident")>-1,presto:s.indexOf("Presto")>-1,webKit:s.indexOf("AppleWebKit")>-1,gecko:s.indexOf("Gecko")>-1&&s.indexOf("KHTML")==-1,mobile:!!s.match(/AppleWebKit.*Mobile.*/),ios:!!s.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:s.indexOf("Android")>-1,iPhone:s.indexOf("iPhone")>-1,iPad:s.indexOf("iPad")>-1,webApp:s.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},a;p.versions.mobile||p.versions.ios||p.versions.android||p.versions.iPhone||p.versions.iPad?a=!1:a=!0},844513:function(f,m,r){"use strict";r.d(m,{Z:function(){return y}});var p=function(){var v=this,D=v._self._c;return v.attr.buttonHide?D("div",{style:{position:"absolute",right:v.attr.buttonHideRight+"px",top:v.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(T){return v.onHide()}}},[v.openTooltip?D("el-tooltip",{attrs:{"open-delay":1e3,content:v.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[D("el-button",{class:v.attr.buttonHideIconClass&&v.attr.buttonHideIconClass!=""?v.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:v.attr.buttonHideColor,fontSize:v.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):D("el-button",{class:v.attr.buttonHideIconClass&&v.attr.buttonHideIconClass!=""?v.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:v.attr.buttonHideColor,fontSize:v.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):v._e()},a=[],s=r(752246),o={props:["attr"],name:"hide-button",data(){return{isPc:s.b}},computed:{openTooltip:function(){let $=!1,v=this.attr.buttonHideTooltipContent;return s.b&&v&&v!=null&&v.trim()!=""&&($=!0),$}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},l=o,u=r(768141),b=(0,u.Z)(l,p,a,!1,null,"bf399b9a",null),y=b.exports},610854:function(f,m,r){"use strict";r.r(m),r.d(m,{default:function(){return R}});var p=function(){var c=this,I=c._self._c;return I("div",{directives:[{name:"show",rawName:"v-show",value:c.widgetInfo.attr.hide!=!0,expression:"widgetInfo.attr.hide != true"}],ref:"gisBase",staticClass:"my-gisBase",style:{width:c.widgetInfo.attr.w+"px",height:c.widgetInfo.attr.hh+"px"}},[I("hide-button",{attrs:{attr:c.widgetInfo.attr}}),I("IdentifyPopup",c._b({ref:"identify",style:{width:c.widgetInfo.attr.w+"px",height:c.widgetInfo.attr.hh+"px"},attrs:{"btn-attr":c.btnAttr,"theme-style":c.themeConfig,position:c.btnPosition,"query-mode":c.widgetInfo.config.queryMode,"default-active":c.widgetInfo.config.openConfig.isEnable,"is-stay-active":c.widgetInfo.config.openConfig.isStayOpen,"color-config":c.widgetInfo.config.colorConfig,"bind-mode-button":!1,"disabled-popup":!c.widgetInfo.config.iframeConfig.isPop},on:{identifyedAll:c.identifyedAll,identifyedAll3d:c.identifyedAll},scopedSlots:c._u([c.widgetInfo.config.iframeConfig.isCustom&&c.widgetInfo.config.iframeConfig.popId&&c.popWidget?{key:"mapPopup",fn:function(){return[I("draggable-component",{ref:"comp_"+c.popWidget.id,staticStyle:{display:"inline-block",float:"left"},attrs:{id:"widget_"+c.widgetInfo.config.iframeConfig.popId,"is-view":!0,"widget-data":c.popWidget}})]},proxy:!0}:null],null,!0)},"IdentifyPopup",c.widgetInfo.config.btnConfig,!1))],1)},a=[],s=r(321963),o=r.n(s),l=r(844513),u=r(927966),b=r(171298),y=r(445061),$=r(126711),v=r(386892),D=r(242709),T=r(950681),M=r(148836),x=r(295338),L=r(149500),B={name:"GisIdnetify",components:{IdentifyPopup:o(),HideButton:l.Z,DraggableComponent:x.Z},mixins:[b.baseConfig,v.D,y.u,$.H,D.Z,T.Z],props:["widgetInfo"],data(){return{timer:"",contentTimer:"",map:null,btnAttr:this.widgetInfo.attr,popAttr:null,popContent:null,imgIconConfig:this.widgetInfo.config.imgIconConfig,iframeConfig:this.widgetInfo.config.iframeConfig}},computed:{...(0,M.Se)(["getWidgets","getWidgetAllArr"]),popWidget(){for(let P in this.getWidgets){let c=JSON.parse(JSON.stringify(this.getWidgets[P]));if(c.id===this.widgetInfo.config.iframeConfig.popId)return c}return null}},mounted(){L.log("isPop",this.widgetInfo.config.iframeConfig.isPop),this.initAction(this.widgetInfo)},methods:{loadInfo(){},reLoadInfo(P){this.loadInfo(P),this.btnAttr=P.attr,this.imgIconConfig=P.config.imgIconConfig},initAction(P){this.actionReceive(P)},getBindContent(){if(typeof this.widgetInfo.config.iframeConfig.popId<"u"&&this.widgetInfo.config.iframeConfig.isCustom){let P=document.getElementById("widget_"+this.widgetInfo.config.iframeConfig.popId),c=this.getWidgetObject(this.widgetInfo.config.iframeConfig.popId);this.popAttr=c.widgetInfo.attr,L.log("popComponent",this.popAttr),P&&(clearInterval(this.contentTimer),this.$refs.identify.bindCustomPop(P,this.popAttr),this.popContent=P)}},identifyedAll(P){if(P.result&&P.result.length>0&&P.result[0].results&&P.result[0].results.length>0){let g=this.$refs["comp_"+this.popWidget?.id];g&&(g.$el.style.display="inline-block"),this.$refs.identify.highLightFeature(P.result[0].results[0])}else this.$refs.identify.closePopup();let c=this,I=c.widgetInfo.action.sendOut.actionList;this.$$lib__.each(I,g=>{if(g.enabled&&g.code==c.$$global_editor.actionType.identify.code){let W=g.code+"_"+c.widgetInfo.id,E={result:P};if(g.paramsExtend&&g.paramsExtend.length>0&&this.getExtendParams(E,g.paramsExtend,[],[]),g.script&&g.script.enabled&&g.script.content){this.doConfigMap=new Function("data",g.script.content);let Z=this.doConfigMap(E);Z&&(E=Z)}u.Z.$emit(W,E),g.postMessage&&this.doPostMessage(E),this.actionNameList.push(W)}if(g.enabled&&g.code==c.$$global_editor.actionType.wgIdentify.code&&P.data.length>0){let W=P.data[0].feature;var N;if(W&&"getProperties"in W){var z=W.getProperties();N={wgid:z.wgid}}else N={wgid:null};let E=g.code+"_"+c.widgetInfo.id;u.Z.$emit(E,N),this.actionNameList.push(E)}})}}},j=B,F=r(768141),A=(0,F.Z)(j,p,a,!1,null,null,null),R=A.exports},266880:function(f,m,r){f.exports=r(914105)},465557:function(f,m,r){f.exports=r(372626)},387507:function(f){function m(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}f.exports=m,f.exports.__esModule=!0,f.exports.default=f.exports},234009:function(f,m,r){var p=r(439155),a=r(601520),s=r(797556);function o(l){var u;return f.exports=o=p?a(u=s).call(u):function(y){return y.__proto__||s(y)},f.exports.__esModule=!0,f.exports.default=f.exports,o(l)}f.exports=o,f.exports.__esModule=!0,f.exports.default=f.exports},330044:function(f,m,r){var p=r(721648),a=r(857448),s=r(372459);function o(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=p(u&&u.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),a(l,"prototype",{writable:!1}),u&&s(l,u)}f.exports=o,f.exports.__esModule=!0,f.exports.default=f.exports},299085:function(f,m,r){var p=r(29870).default,a=r(387507);function s(o,l){if(l&&(p(l)==="object"||typeof l=="function"))return l;if(l!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return a(o)}f.exports=s,f.exports.__esModule=!0,f.exports.default=f.exports},372459:function(f,m,r){var p=r(439155),a=r(601520);function s(o,l){var u;return f.exports=s=p?a(u=p).call(u):function(y,$){return y.__proto__=$,y},f.exports.__esModule=!0,f.exports.default=f.exports,s(o,l)}f.exports=s,f.exports.__esModule=!0,f.exports.default=f.exports},144900:function(f,m,r){"use strict";var p=r(556370);f.exports=p},253005:function(f,m,r){"use strict";r(194495);var p=r(318893);f.exports=p("Function","bind")},817086:function(f,m,r){"use strict";var p=r(832242),a=r(253005),s=Function.prototype;f.exports=function(o){var l=o.bind;return o===s||p(s,o)&&l===s.bind?a:l}},871030:function(f,m,r){"use strict";var p=r(832242),a=r(606047),s=String.prototype;f.exports=function(o){var l=o.startsWith;return typeof o=="string"||o===s||p(s,o)&&l===s.startsWith?a:l}},660382:function(f,m,r){"use strict";r(430897);var p=r(594388);f.exports=p.Reflect.construct},606047:function(f,m,r){"use strict";r(545198);var p=r(318893);f.exports=p("String","startsWith")},601520:function(f,m,r){"use strict";f.exports=r(748691)},748691:function(f,m,r){"use strict";var p=r(144900);f.exports=p},777958:function(f,m,r){"use strict";var p=r(636021),a=r(986735),s=r(942660),o=r(979489),l=r(602529),u=r(982396),b=Function,y=p([].concat),$=p([].join),v={},D=function(T,M,x){if(!o(v,M)){for(var L=[],B=0;B<M;B++)L[B]="a["+B+"]";v[M]=b("C,a","return new C("+$(L,",")+")")}return v[M](T,x)};f.exports=u?b.bind:function(M){var x=a(this),L=x.prototype,B=l(arguments,1),j=function(){var A=y(B,l(arguments));return this instanceof j?D(x,A.length,A):x.apply(M,A)};return s(L)&&(j.prototype=L),j}},194495:function(f,m,r){"use strict";var p=r(190434),a=r(777958);p({target:"Function",proto:!0,forced:Function.bind!==a},{bind:a})},430897:function(f,m,r){"use strict";var p=r(190434),a=r(830889),s=r(119522),o=r(777958),l=r(411298),u=r(987934),b=r(942660),y=r(24136),$=r(427909),v=a("Reflect","construct"),D=Object.prototype,T=[].push,M=$(function(){function B(){}return!(v(function(){},[],B)instanceof B)}),x=!$(function(){v(function(){})}),L=M||x;p({target:"Reflect",stat:!0,forced:L,sham:L},{construct:function(j,F){l(j),u(F);var A=arguments.length<3?j:l(arguments[2]);if(x&&!M)return v(j,F,A);if(j===A){switch(F.length){case 0:return new j;case 1:return new j(F[0]);case 2:return new j(F[0],F[1]);case 3:return new j(F[0],F[1],F[2]);case 4:return new j(F[0],F[1],F[2],F[3])}var R=[null];return s(T,R,F),new(s(o,j,R))}var P=A.prototype,c=y(b(P)?P:D),I=s(j,c,F);return b(I)?I:c}})},545198:function(f,m,r){"use strict";var p=r(190434),a=r(943806),s=r(168428).f,o=r(9505),l=r(847482),u=r(672679),b=r(464734),y=r(302541),$=r(496338),v=a("".slice),D=Math.min,T=y("startsWith"),M=!$&&!T&&!!function(){var x=s(String.prototype,"startsWith");return x&&!x.writable}();p({target:"String",proto:!0,forced:!M&&!T},{startsWith:function(L){var B=l(b(this));u(L);var j=o(D(arguments.length>1?arguments[1]:void 0,B.length)),F=l(L);return v(B,j,j+F.length)===F}})},556370:function(f,m,r){"use strict";var p=r(817086);f.exports=p},914105:function(f,m,r){"use strict";var p=r(871030);f.exports=p},372626:function(f,m,r){"use strict";var p=r(660382);f.exports=p}}]);
