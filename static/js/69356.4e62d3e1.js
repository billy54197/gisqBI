"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[69356],{56279:function(C,g,o){o.d(g,{P:function(){return h}});var u=o(386892),f=o(149500);const h={mixins:[u.D],created(){},methods:{lifecycleBeforeChartsLoad(b){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&f.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let x=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[b]);if(x)return x}return b},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&f.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},752246:function(C,g,o){o.d(g,{X:function(){return u},b:function(){return f}});let u={versions:function(){var h=navigator.userAgent;return{trident:h.indexOf("Trident")>-1,presto:h.indexOf("Presto")>-1,webKit:h.indexOf("AppleWebKit")>-1,gecko:h.indexOf("Gecko")>-1&&h.indexOf("KHTML")==-1,mobile:!!h.match(/AppleWebKit.*Mobile.*/),ios:!!h.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:h.indexOf("Android")>-1,iPhone:h.indexOf("iPhone")>-1,iPad:h.indexOf("iPad")>-1,webApp:h.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},f;u.versions.mobile||u.versions.ios||u.versions.android||u.versions.iPhone||u.versions.iPad?f=!1:f=!0},169356:function(C,g,o){o.r(g),o.d(g,{default:function(){return z}});var u=function(){var s=this,a=s._self._c;return a("div",{style:{width:s.widgetInfo.attr.w+"px",height:s.widgetInfo.attr.hh+"px"}},[a("hide-button",{attrs:{attr:s.widgetInfo.attr}}),a("div",{ref:"pieDoughnut",style:{width:s.widgetInfo.attr.w+"px",height:s.widgetInfo.attr.hh+"px"}})],1)},f=[],h=o(844513),b=o(927966),L=o(56279),x=o(445061),R=o(126711),A=o(490359),D=o(787798),r=o(99349),y=o(555616),N=o(275770),J=o(67157),I=o(150813);const T={mixins:[J.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(I.Z.charts.title)),legend:JSON.parse(JSON.stringify(I.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(I.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(I.Z.charts.toolbox)),xAxis:JSON.parse(JSON.stringify(I.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(I.Z.charts.yAxis)),color:["#29CC97"]}}},methods:{filterPredefineColoursSchemeConfig(t,s){this.getNewConfigWithArrary(t,s,this.filter_config)}}};var p=o(149500);const H=o(954255);var $={name:"PieDoughnut",components:{HideButton:h.Z},mixins:[A.baseConfig,L.P,x.u,R.H,D.P,r.P,T],props:["widgetInfo"],data(){return{autoInterval:null,source:[],dimensions:null,drillDown:{}}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=H.init(this.$refs.pieDoughnut,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo),this.initClick(this.widgetInfo)},destroyed(){this.echarts.dispose(),this.autoInterval&&clearInterval(this.autoInterval)},methods:{loadInfo(t){t.dataset[t.dataset.type]&&(this.source=t.dataset[t.dataset.type].source,this.dimensionsEx=t.dataset[t.dataset.type].dimensions),t.config.drillDown&&t.config.drillDown.enable==!0?(this.drillDown=JSON.parse(JSON.stringify(t.config.drillDown)),delete this.drillDown.graphic,this.drillDown.pid_arrary=[],this.doDrillDown(t,!0)):this.renderEcharts(t,this.source)},renderEcharts(t,s){let a=[],d=[],l={};a=this.getSeriesData(s,t.dataset[t.dataset.type].dimensions,t.dataset[t.dataset.type].encode),d=t.dataset[t.dataset.type].dimensionsAlias,l=t.dataset[t.dataset.type].encode;let e=JSON.parse(JSON.stringify(t.config.grid)),i=JSON.parse(JSON.stringify(t.config.series)),n=JSON.parse(JSON.stringify(t.config.title)),m=this.getLegend(t.config.legend),w=JSON.parse(JSON.stringify(t.config.toolbox)),Z=this.getTooltip(t.config.tooltip),E=[];if(t.config.drillDown&&t.config.drillDown.enable==!0){let c=this.getGraphic(t.config.drillDown.graphic);c&&c.elements&&c.elements.length>0&&(c.elements[0].ignore=this.drillDown.pid_arrary.length<1),E.push(c)}a.length<1&&(m.show=!1),m.data=void 0;let v={color:this.$$global_editor.predefineColors,noDataLoadingOption:{text:"\u6682\u65E0\u6570\u636E",effect:"bubble",effectOption:{effect:{n:0}}},tooltip:Z,toolbox:w,grid:{left:e.left+"%",right:e.right+"%",top:e.top+"%",bottom:e.bottom+"%"},title:{show:n.show,text:n.text,link:n.link,textAlign:n.textAlign,left:n.left+"%",right:n.right+"%",top:n.top+"%",bottom:n.bottom+"%",label:{fontSize:n.label.fontSize,fontFamily:n.label.fontFamily,color:n.label.color},textStyle:{fontSize:n.textStyle.fontSize,fontFamily:n.textStyle.fontFamily,color:n.textStyle.color}},legend:m,graphic:E,series:[{name:this.getLegendData(d,l.y),center:[i.center.x+"%",i.center.y+"%"],radius:[i.radius.in+"%",i.radius.out+"%"],type:"pie",data:a,roseType:i.roseType,startAngle:i.startAngle,minAngle:i.minAngle,avoidLabelOverlap:i.avoidLabelOverlap,clockWise:typeof i.clockWise>"u"?!0:i.clockWise,label:{formatter:this.getFormatterString(i.label.formatter),verticalAlign:"bottom",show:i.label.show,position:i.label.position,color:i.label.color,fontFamily:i.label.fontFamily,fontSize:i.label.fontSize,fontWeight:i.label.fontWeight,alignTo:i.label.alignTo,margin:i.label.margin,emphasis:{show:i.label.emphasis.show,textStyle:{fontWeight:"bold"}}},labelLine:{show:i.labelLine.show,length:i.labelLine.length,length2:i.labelLine.length2,smooth:i.labelLine.smooth,lineStyle:{color:i.labelLine.lineStyle.color,width:i.labelLine.lineStyle.width,type:i.labelLine.lineStyle.type}},emphasis:{itemStyle:i.emphasis.itemStyle},itemStyle:{borderColor:i.itemStyle.borderColor,borderWidth:i.itemStyle.borderWidth,borderRadius:this.borderRadius(i.itemStyle)}}]};if(t.config.colorCustom==!0&&(v.color=t.config.color),i.emphasis)try{let c=i.emphasis;if(c.script&&c.script.enabled){if(c.script.content){let P=new Function("index","item","data",c.script.content),S=v.series[0].data;if(S&&S.length>0)for(let O=0;O<S.length;++O)try{S[O].emphasis=P.call(this,O,S[O],S)}catch(k){p.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",k)}}}else i.emphasis.itemStyle&&i.emphasis.itemStyle.color&&(v.series[0].emphasis={itemStyle:{...i.emphasis.itemStyle}})}catch(c){p.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",c)}this.widgetInfo.action.sendOut.actionList&&this.widgetInfo.action.sendOut.actionList.length>=1?this.$$lib__.find(this.widgetInfo.action.sendOut.actionList,P=>P.enabled)||this.echarts.getZr().on("mousemove",()=>{this.echarts.getZr().setCursorStyle("default")}):this.echarts.getZr().on("mousemove",()=>{this.echarts.getZr().setCursorStyle("default")}),this.getAnimation(v,t),this.setOption(v,t,i),this.setAnimationLoop(t,()=>{this.setOption(v,t)})},setOption(t,s,a){if(this.echarts.getOption()&&this.echarts.clear(),setTimeout(()=>{this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0})},0),this.autoInterval&&(clearInterval(this.autoInterval),this.autoInterval=null),a.auto){let d=this,l=5;a.showTime&&(l=a.showTime),l=l*1e3;let e=0,i=t.series[0].data.length;this.autoInterval=setInterval(function(){d.echarts.dispatchAction({type:"downplay",seriesIndex:0,dataIndex:e}),e=(e+1)%i,d.echarts.dispatchAction({type:"highlight",seriesIndex:0,dataIndex:e})},l)}},reLoadInfo(t){t&&(this.$refs.pieDoughnut.style.width=t.attr.w+"px",this.$refs.pieDoughnut.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},getSeriesData(t,s,a){let d=[],l={},e=-1,i=-1;for(let n=0;n<s.length;n++)s[n]==a.x&&(e=n),s[n]==a.y&&(i=n),l[s[n]]=n;for(let n=0;n<t.length;n++){let m={};for(let w in l)m[w]=t[n][l[w]];d.push({name:t[n][e],value:t[n][i],source:t[n],dimensions:s,row:m})}return d},getLegendData(t,s){let a=this.$$lib__.find(t,d=>d.name==s);return a?a.alias&&a.alias!=""?a.alias:a.name:""},initAction(t){this.initClick(t),this.actionReceive(t)},actionOnClick(t,s){let a=this,d=[],l=t.action.sendOut.actionList;a.$$lib__.each(l,e=>{let i=e.code+"_"+t.id,n={};e.paramsExtend&&e.paramsExtend.length>0&&a.getParamsExtend(n,e.paramsExtend,t);let m=e.postMessage;if(n.x=s.data.name,n.y=s.data.value,e.enabled&&e.code==N.default.click.code){if(t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(d=t.dataset[t.dataset.type].source[s.dataIndex]),a.getExtendParams(n,e.paramsExtend,d,t.dataset[t.dataset.type].dimensions),e.script&&e.script.enabled){if(p.log("Execute script for "+t.name+" component to "+t.name+" component"),e.script.content==""){y.Message.warning({message:e.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam=new Function("param,params",e.script.content),n=this.customScript_actionSend_clickParam(n,s)}b.Z.$emit(i,n),m&&a.doPostMessage(n)}else if(e.enabled&&e.code==N.default.openLink.code){if(e.paramsExtend&&e.paramsExtend.length>0){let w=[];t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(w=t.dataset[t.dataset.type].source[s.dataIndex]),e.type===a.$$global_editor.linkType.dynamic.code&&(e[a.$$global_editor.linkType.dynamic.code].url=a.getActionUrl(e,t.dataset[t.dataset.type].source[s.dataIndex],t.dataset[t.dataset.type].dimensions)),a.getExtendParams(n,e.paramsExtend,w,t.dataset[t.dataset.type].dimensions)}if(e.script&&e.script.enabled){if(p.log("Execute script for "+e.name+" component to "+t.name+" component"),e.script.content==""){y.Message.warning({message:e.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam=new Function("param,params",e.script.content),n=this.customScript_actionSend_clickParam(n,s)}a.openLinkAction(e,n,s)}})},doDrillDown(t,s){let a=[];if(this.drillDown.pidValue&&this.drillDown.id&&this.drillDown.pid){let d={};for(let l=this.dimensionsEx.length-1;l>-1;--l)d[this.dimensionsEx[l]]=l;for(let l=0;l<this.source.length;++l){let e=this.source[l];e[d[this.drillDown.pid]]==this.drillDown.pidValue&&a.push(JSON.parse(JSON.stringify(e)))}}else p.error("\u5FC5\u987B\u914D\u7F6E\u4E0B\u94BB\u7684\u3010\u4E0A\u7EA7\u6570\u503C\u3001\u6570\u636E\u5B57\u6BB5\u3001\u4E0A\u7EA7\u5B57\u6BB5\u3011");if(a.length>0)this.renderEcharts(t,a);else{let d=this.drillDown.pid_arrary.length-1;this.drillDown.pid_arrary.length=d>0?d:0,p.info("\u4E0B\u94BB\u5DF2\u65E0\u6570\u636E"),s&&this.renderEcharts(t,a)}},initClick(t){this.echarts.on("click",s=>{if(s.componentType=="graphic"){if(this.drillDown&&this.drillDown.enable==!0){let a=this.drillDown.pid_arrary.length;a>0?(this.drillDown.pidValue=this.drillDown.pid_arrary[a-1],this.drillDown.pid_arrary.length=a-1,this.drillDown.pidValue?this.doDrillDown(t):p.error("\u4E0B\u94BB\u5B57\u6BB5\u672A\u83B7\u53D6\u5230\u6709\u6548\u503C")):p.error("\u5DF2\u7ECF\u662F\u6700\u9876\u7EA7\uFF0C\u4E0D\u53EF\u4EE5\u518D\u8FD4\u56DE")}}else s.componentType=="series"&&(this.actionOnClick(t,s),this.drillDown&&this.drillDown.enable==!0&&(this.drillDown.pid_arrary.length==0?this.drillDown.pid_arrary.push(t.config.drillDown.pidValue):this.$$lib__.contains(this.drillDown.pid_arrary,this.drillDown.pidValue)||this.drillDown.pid_arrary.push(this.drillDown.pidValue),this.drillDown.pidValue=s.data.row[this.drillDown.id],this.drillDown.pidValue?this.doDrillDown(t):p.error("\u4E0B\u94BB\u5B57\u6BB5\u672A\u83B7\u53D6\u5230\u6709\u6548\u503C")))})},borderRadius(t){let s;return t.borderRadiusType=="one"?s=this.borderRadiusValue(t.barBorderRadiusInfo[0],t.barBorderRadiusInfoUnit[0]):t.borderRadiusType=="tow"?s=[this.borderRadiusValue(t.barBorderRadiusInfo[0],t.barBorderRadiusInfoUnit[0]),this.borderRadiusValue(t.barBorderRadiusInfo[1],t.barBorderRadiusInfoUnit[1])]:t.borderRadiusType=="four"&&(s=[this.borderRadiusValue(t.barBorderRadiusInfo[0],t.barBorderRadiusInfoUnit[0]),this.borderRadiusValue(t.barBorderRadiusInfo[1],t.barBorderRadiusInfoUnit[1]),this.borderRadiusValue(t.barBorderRadiusInfo[2],t.barBorderRadiusInfoUnit[2]),this.borderRadiusValue(t.barBorderRadiusInfo[3],t.barBorderRadiusInfoUnit[3])]),s},borderRadiusValue(t,s){return(!t||t==""?0:t)+(s=="%"?"%":"")}}},B=$,F=o(768141),V=(0,F.Z)(B,u,f,!1,null,"07815275",null),z=V.exports},844513:function(C,g,o){o.d(g,{Z:function(){return A}});var u=function(){var r=this,y=r._self._c;return r.attr.buttonHide?y("div",{style:{position:"absolute",right:r.attr.buttonHideRight+"px",top:r.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(N){return r.onHide()}}},[r.openTooltip?y("el-tooltip",{attrs:{"open-delay":1e3,content:r.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[y("el-button",{class:r.attr.buttonHideIconClass&&r.attr.buttonHideIconClass!=""?r.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:r.attr.buttonHideColor,fontSize:r.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):y("el-button",{class:r.attr.buttonHideIconClass&&r.attr.buttonHideIconClass!=""?r.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:r.attr.buttonHideColor,fontSize:r.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):r._e()},f=[],h=o(752246),b={props:["attr"],name:"hide-button",data(){return{isPc:h.b}},computed:{openTooltip:function(){let D=!1,r=this.attr.buttonHideTooltipContent;return h.b&&r&&r!=null&&r.trim()!=""&&(D=!0),D}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},L=b,x=o(768141),R=(0,x.Z)(L,u,f,!1,null,"bf399b9a",null),A=R.exports}}]);
