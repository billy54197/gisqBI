"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[2214],{5143:function($,y,a){a.d(y,{b:function(){return x}});var w=a(48836),g=a(42160),p=a(49500);const x={created(){},computed:{...(0,w.Se)(["getWidgetAllArr"])},data(){return{containerViewSubWidgetList:[]}},methods:{...(0,w.nv)(["updateWidgetParentArrDataset","updateWidgetAllArrDataset"]),reLoadInfo(s){this.widgetInfo.id!=s.id&&this.$refs["comp_"+s.id]&&setTimeout(this.$refs["comp_"+s.id][0].reLoadInfo(s),500),this.loadInfo(s)},orgWidget(s){let n=[];return this.$$lib__.each(s,l=>{let o=this.$$lib__.find(this.getWidgetAllArr,d=>d.parentId==this.widgetInfo.id&&d.id==l.id);o&&(o.dataset&&o.dataset[o.dataset.type]&&(o.dataset.type==this.$$global_editor.dataSourcType.dynamic.code||o.dataset.type==this.$$global_editor.dataSourcType.local.code)&&o.dataset[o.dataset.type].autoUpdate==!0&&(g.default.set(this.dynamicWidgets,o.id,o),o.attr.hide!=!0&&o.dataset[o.dataset.type].autoUpdate==!0&&g.default.set(this.autoUpdateWidget,o.id,o)),n.push(o))}),g.default.set(this,"containerViewSubWidgetList",n),n},setTitleText(s,n){n?this.$$lib__.each(n,l=>{this.$$lib__.each(this.orgWidget(l.widgets),o=>{o.attr.widgetW||(o.attr.widgetW=o.attr.w),this.$refs["title_"+o.id]&&this.$refs["title_"+o.id][0]&&(this.$refs["title_"+o.id][0].innerHTML=this.initTextPosition(o)),o.title.position||(o.title.position="top")})}):this.$$lib__.each(this.orgWidget(s),l=>{this.$refs["title_"+l.id]&&this.$refs["title_"+l.id][0]&&(this.$refs["title_"+l.id][0].innerHTML=this.initTextPosition(l)),l.title.position||(l.title.position="top")})},initTextPosition(s){return s.title.text===void 0||!s.title.text?"":s.title.text&&(s.title.position==="left"||s.title.position==="right")?s.title.text.split("").join("<br />"):s.title.text},updataWidgetSource(s,n,l){try{switch(s.dataset.type){case this.$$global_editor.dataSourcType.dynamic.code:s.dataset.dynamic.source=n.data,n.total&&(s.dataset.dynamic.total=n.total);break;case this.$$global_editor.dataSourcType.local.code:s.dataset.local.dimensionsAlias=[],s.dataset.local.columnList=[],s.dataset.local.source=[],s.dataset.local.dimensions=[],s.dataset.local.dimensionsAlias=n.dimensionsAlias,s.dataset.local.columnList=n.columnList,s.dataset.local.source=n.source,s.dataset.local.dimensions=n.dimensions;break}}catch(d){p&&p.log&&p.log(d)}let o=this.$refs["comp_"+s.id];o&&o.length>0&&(this.updateWidgetAllArrDataset(s),this.updateWidgetParentArrDataset(s),o[0].reLoadInfo(s),this.sendoutDataloadSuccess(s),this.sendoutResponseData(s,n,l))},fit(s,n){if(!this.isView||!/^mobile/.test(this.getCanvasSetting.transformType))return s+"px";let l=this.getCanvasSetting.width/10,o=this.getCanvasSetting.height/window.innerHeight,d="";switch(this.getCanvasSetting.transformType){case"mobileAutoWidth":n?d=s+"px":d=s/l+"rem";break;case"mobileAutoBoth":d=s/l+"rem";break;default:n?d=s/o+"px":d=s/l+"rem"}return d}}}},52214:function($,y,a){a.r(y),a.d(y,{default:function(){return A}});var w=function(){var t=this,r=t._self._c;return r("div",{ref:"drawer",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[r("el-drawer",{ref:"myDrawer",staticClass:"my-drawer",attrs:{"custom-class":`my-drawer-${t.widgetInfo.id}`,size:t.size,"close-on-press-escape":t.widgetInfo.config.drawer.closeOnPressEscape,modal:!1,direction:t.widgetInfo.config.drawer.direction,showClose:t.widgetInfo.config.drawer.showClose,wrapperClosable:t.widgetInfo.config.drawer.wrapperClosable,withHeader:t.widgetInfo.config.drawer.withHeader,visible:t.drawerVisible},on:{"update:visible":function(e){t.drawerVisible=e},opened:t.opened,open:t.open,close:t.close}},[r("div",{staticStyle:{overflow:"hidden",width:"100%"},style:t.getTitleStyle(t.widgetInfo.config.drawer),attrs:{slot:"title"},slot:"title"},[r("div",{style:{marginLeft:t.widgetInfo.config.drawer.title.label.left+"px",marginTop:t.widgetInfo.config.drawer.title.label.top+"px"}},[r("div",{style:t.getTitleSpanStyle(t.widgetInfo.config.drawer),domProps:{innerHTML:t._s(t.widgetInfo.config.drawer.title.text)}})])]),r("div",{staticClass:"my-div",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh-t.widgetInfo.config.drawer.title.h-3+"px",backgroundColor:t.widgetInfo.config.drawer.background.backgroundColor,backgroundImage:this.getImageUrl(t.widgetInfo.config.drawer.background.backgroundImage),backgroundSize:t.widgetInfo.config.drawer.background.backgroundSize}},[t.widgetInfo.config.container.scroll.show?r("happy-scroll",{attrs:{color:t.widgetInfo.config.container.scroll.color,resize:""}},[r("div",{staticClass:"my-drawer-container",style:{height:t.childMax.height+"px",width:t.childMax.width+"px",overflow:"visible"}},[t._l(t.orgWidget(t.widgetInfo.config.container.widgets),function(e){return[r("div",{style:t.getWidgetStyle(e)},[r("div",{key:"widget_"+e.id,ref:"widget_"+e.id,refInFor:!0,class:t.getWidgetClass(e),style:t.getBindStyle(e),attrs:{id:"widget_"+e.id}},[r("external-frame-svg",{ref:"comp_frame_"+e.id,refInFor:!0,attrs:{"widget-info":e}}),e.title.position==="top"||e.title.position==="left"?r("div",{staticStyle:{overflow:"hidden",float:"left"},style:t.getWidgetTitleStyle(e),on:{click:function(f){return t.openLink(e)}}},[r("div",{style:{marginLeft:e.title.label.left+"px",marginTop:e.title.label.top+"px"}},[r("span",{ref:"title_"+e.id,refInFor:!0,style:t.getTitleSpanStyle(e)})])]):t._e(),r("draggable-component-container",{ref:"comp_"+e.id,refInFor:!0,staticStyle:{display:"inline-block",float:"left"},style:t.getInfoStyle(e),attrs:{widgetData:e},on:{doGetPreviewData:t.getPreviewData,attrChange:t.attrChange}}),e.title.position==="bottom"||e.title.position==="right"?r("div",{staticStyle:{overflow:"hidden",float:"left"},style:t.getWidgetTitleStyle(e),on:{click:function(f){return t.openLink(e)}}},[r("div",{style:{marginLeft:e.title.label.left+"px",marginTop:e.title.label.top+"px"}},[r("span",{ref:"title_"+e.id,refInFor:!0,style:t.getTitleSpanStyle(e)})])]):t._e()],1)])]})],2)]):t._l(t.orgWidget(t.widgetInfo.config.container.widgets),function(e){return[r("div",{style:t.getWidgetStyle(e)},[r("div",{key:"widget_"+e.id,ref:"widget_"+e.id,refInFor:!0,class:t.getWidgetClass(e),style:t.getBindStyle(e),attrs:{id:"widget_"+e.id}},[r("external-frame-svg",{ref:"comp_frame_"+e.id,refInFor:!0,attrs:{"widget-info":e}}),e.title.position==="top"||e.title.position==="left"?r("div",{staticStyle:{overflow:"hidden",float:"left"},style:t.getWidgetTitleStyle(e),on:{click:function(f){return t.openLink(e)}}},[r("div",{style:{marginLeft:e.title.label.left+"px",marginTop:e.title.label.top+"px"}},[r("span",{ref:"title_"+e.id,refInFor:!0,style:t.getTitleSpanStyle(e)})])]):t._e(),r("draggable-component-container",{ref:"comp_"+e.id,refInFor:!0,staticStyle:{display:"inline-block",float:"left"},style:t.getInfoStyle(e),attrs:{widgetData:e},on:{doGetPreviewData:t.getPreviewData,doReSetBoardId:t.doReSetBoardId,attrChange:t.attrChange}}),e.title.position==="bottom"||e.title.position==="right"?r("div",{staticStyle:{overflow:"hidden",float:"left"},style:t.getWidgetTitleStyle(e),on:{click:function(f){return t.openLink(e)}}},[r("div",{style:{marginLeft:e.title.label.left+"px",marginTop:e.title.label.top+"px"}},[r("span",{ref:"title_"+e.id,refInFor:!0,style:t.getTitleSpanStyle(e)})])]):t._e()],1)])]})],2)])],1)},g=[],p=a(80512),x=a(93575),s=a(5143),n=a(27966),l=a(77863),o=a(55477),d=a(26711),T=a(56279),C=a(42160),v=a(55616),I=a(75770),D=a(1783),b=a(49500),W={name:"container-drawer-view",props:["widgetInfo","currentWidget"],components:{ExternalFrameSvg:D.Z,DraggableComponentContainer:p.Z,HappyScroll:l.HappyScroll},mixins:[o.u,x.E,s.b,d.H,T.P],computed:{size:function(){return this.widgetInfo.attr.w.toString()},childMax(){let i=this.orgWidget(this.widgetInfo.config.container.widgets),t=this.widgetInfo.attr.hh-this.widgetInfo.config.drawer.title.h-3,r=this.widgetInfo.attr.w;return this.widgetInfo.config.container.scroll.show&&i&&i.length>0&&i.forEach(e=>{e.attr.hh+e.attr.y>t&&(t=e.attr.hh+e.attr.y),e.attr.w+e.attr.x>r&&(r=e.attr.w+e.attr.x)}),{height:t,width:r}}},data(){return{drawerVisible:!1,timerArr:[],dataSetArr:{},autoUpdateWidget:{},dynamicWidgets:{},prefix:{widget:"widget_"},actionList:{},isOpen:!0,dbClick:!0}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(){if(this.widgetInfo.attr.hide=!0,this.getDynamicWidgetsSource(this.dynamicWidgets),this.lifecycleAfterLoad(),this.widgetInfo.config.drawer&&this.widgetInfo.config.drawer.border){const i=this.widgetInfo.config.drawer.border;let t={borderWidth:`${i.topWidth||0}px ${i.rightWidth||0}px
                    ${i.bottomWidth||0}px ${i.leftWidth||0}px`,borderColor:i.color,borderStyle:i.style},r=`.my-drawer-${this.widgetInfo.id} { ${this.mUtils.style2CSSStr(t)} }`;this.mUtils.appendCss(`container-drawer-${this.widgetInfo.id}`,r)}},reLoadInfo(i){this.loadInfo(i)},initAction(i){this.actionReceive(i)},getCarouselItemStyle(i){return{opacity:i.opacity,backgroundColor:i.backgroundColor,backgroundImage:this.getImageUrl(i.backgroundImage),backgroundSize:i.backgroundSize}},opened(){let i=this.$refs.myDrawer;if(!i)return;let t=i.$el.querySelector(".el-drawer__close-btn");if(t&&(i&&this.widgetInfo.config.drawer.buttonClose.custom?(t.style.top=this.widgetInfo.config.drawer.buttonClose.top+"px",t.style.right=this.widgetInfo.config.drawer.buttonClose.right+"px",t.style.fontSize=this.widgetInfo.config.drawer.buttonClose.fontSize+"px",t.style.zIndex=999,t.childNodes&&t.childNodes.length>0&&(t.childNodes[0].style.color=this.widgetInfo.config.drawer.buttonClose.color,this.widgetInfo.config.drawer.buttonClose.fontWeight&&(t.childNodes[0].style.fontWeight="bolder"))):(t.style.top="10px",t.style.right="15px",t.style.fontSize="16px",t.childNodes&&t.childNodes.length>0&&(t.childNodes[0].style.color="#909399",t.childNodes[0].style.fontWeight="normal"))),this.isOpen){for(let r in this.actionList)n.Z.$emit(r,this.actionList[r]);this.isOpen=!1}},open(){let i=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(i,t=>{if(t.enabled&&t.code==I.Z.open.code){let r=t.code+"_"+this.widgetInfo.id,e={visible:!0};if(t.paramsExtend&&t.paramsExtend.length>0&&this.getExtendParams(e,t.paramsExtend),t.script&&t.script.enabled){if(b.log("Execute script for "+this.widgetInfo.name+" component to "+t.name+" component"),t.script.content==""){v.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",t.script.content),e=this.customScript(e)}n.Z.$emit(r,e),t.postMessage&&this.doPostMessage(e),this.actionNameList.push(r)}})},close(){this.widgetInfo.attr.hide=!0;let i=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(i,t=>{if(t.enabled&&t.code==I.Z.close.code){let r=t.code+"_"+this.widgetInfo.id,e={visible:!1};if(t.paramsExtend&&t.paramsExtend.length>0&&this.getExtendParams(e,t.paramsExtend),t.script&&t.script.enabled){if(b.log("Execute script for "+this.widgetInfo.name+" component to "+t.name+" component"),t.script.content==""){v.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",t.script.content),e=this.customScript(e)}n.Z.$emit(r,e),t.postMessage&&this.doPostMessage(e),this.actionNameList.push(r)}})},actionReceive(i){if(i.action==null||i.action.receive==null)return;let t=i.action.receive.openDrawer;t&&t.enabled&&this.doDrawerVisible(t,i.name,!0);let r=i.action.receive.closeDrawer;r&&r.enabled&&this.doDrawerVisible(r,i.name,!1);let e=i.action.receive.receiveTitle;e&&e.enabled&&e.receiveTitleList&&e.receiveTitleList.length>0&&this.doReceiveTitle(e,i.name)},doDrawerVisible(i,t,r){let e=r==!0?"openDrawerList":"closeDrawerList";this.$$lib__.each(i[e],f=>{let c=f[0][1]+"_"+f[0][0];f[0][1].indexOf("_")>-1&&(c=f[0][1]),n.Z.$on(c,h=>{if(!this.dbClick)return;this.dbClick=!1,C.default.set(this.actionList,c,h);let u=f[0][2],S=u.indexOf("|");if(S>-1&&(u=f[0][2].substring(S+1)),i.script&&i.script.enabled){if(b.log("Execute script for "+t+" component to "+i.name+" component"),i.script.content==""){v.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}r==!0?this.doDrawerTrue=new Function("drawerVisible","data","param_key","value",i.script.content):this.doDrawerFalse=new Function("drawerVisible","data","param_key","value",i.script.content)}let m;r==!0?m=this.doDrawerTrue(this.drawerVisible,h,u,i.value):m=this.doDrawerFalse(this.drawerVisible,h,u,i.value),m instanceof Boolean&&(i.value==null||i.value==""||i.value==null?this.showDrawer(m):i.value==h[u]&&this.showDrawer(m)),setTimeout(()=>{this.dbClick=!0},500)})})},doDrawerTrue(i,t,r,e){e==null||e==""||e==null?this.showDrawer(!0):e==t[r]&&this.showDrawer(!0)},doDrawerFalse(i,t,r,e){e==null||e==""||e==null?this.showDrawer(!1):e==t[r]&&this.showDrawer(!1)},doReceiveTitle(i,t){this.$$lib__.each(i.receiveTitleList,r=>{let e=r[0][1]+"_"+r[0][0];r[0][1].indexOf("_")>-1&&(e=r[0][1]),n.Z.$on(e,f=>{let c=r[0][2],h=c.indexOf("|");if(h>-1&&(c=r[0][2].substring(h+1)),i.script&&i.script.enabled){if(b.log("Execute script for "+t+" component to "+i.name+" component"),i.script.content==""){v.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.dialogTitle=new Function("data","param_key",i.script.content)}this.dialogTitle(f,c)})})},showDrawer(i){this.widgetInfo.attr.hide=!i,this.drawerVisible=i,this.drawerVisible&&this.$nextTick(()=>{this.setTitleText(this.widgetInfo.config.container.widgets)})},dialogTitle(i,t){this.widgetInfo.config.drawer.title.text=i[t]},doReSetBoardId(i){this.$emit("doReSetBoardId",i)}},created:function(){this.clear()},destroyed:function(){this.clear()}},L=W,_=a(68141),k=(0,_.Z)(L,w,g,!1,null,"007815b3",null),A=k.exports}}]);
