"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[25754],{525754:function(W,u,l){l.r(u),l.d(u,{default:function(){return L}});var d=function(){var e=this,t=e._self._c;return t("vue-lazy-component",[t("el-form",{ref:"form",attrs:{size:"mini","label-width":"80px","label-position":"right",model:e.currentWidget.dataset.query}},[t("el-form-item",{attrs:{label:"\u67E5\u8BE2\u5217\u8868"}},[t("el-tooltip",{attrs:{disabled:e.currentWidget.dataset.query.queryListName==null,"open-delay":2e3,placement:"top"}},[t("div",{staticStyle:{"text-align":"center"},attrs:{slot:"content"},slot:"content"},[t("p",{staticStyle:{"line-height":"40px"}},[e._v("\u67E5\u8BE2\u5217\u8868\u540D\u79F0\uFF1A"+e._s(e.currentWidget.dataset.query.queryListName))]),t("el-button",{staticStyle:{padding:"6px 10px"},attrs:{type:"primary"},on:{click:e.copyQueryName}},[e._v("\u590D\u5236\u540D\u79F0")]),t("input",{staticStyle:{opacity:"0",position:"absolute",width:"1px"},attrs:{type:"text",id:"copyTxt"},domProps:{value:e.currentWidget.dataset.query.queryListName}})],1),t("el-select",{ref:"treeSelect",staticClass:"width_full",staticStyle:{width:"160px"},attrs:{filterable:"","filter-method":e.filterMethod,clearable:!0,"popper-append-to-body":!1,placeholder:"\u8BF7\u9009\u62E9\u67E5\u8BE2\u5217\u8868"},on:{"visible-change":e.visibleChange,clear:e.clearSelect},model:{value:e.currentWidget.dataset.query.queryListId,callback:function(r){e.$set(e.currentWidget.dataset.query,"queryListId",r)},expression:"currentWidget.dataset.query.queryListId"}},[t("el-option",{staticStyle:{height:"auto"},attrs:{value:e.currentWidget.dataset.query.queryListId,label:e.currentWidget.dataset.query.queryListName}},[t("el-tree",{ref:"selectTree",attrs:{data:e.treeData,"default-expanded-keys":e.currentWidget.dataset.query.queryListId?[e.currentWidget.dataset.query.queryListId]:[],"filter-node-method":e.filterNodeMethod,"highlight-current":!0,"current-node-key":e.currentWidget.dataset.query.queryListId,"check-on-click-node":!0,"node-key":"id"},on:{"node-click":e.nodeClick},scopedSlots:e._u([{key:"default",fn:function({node:r,data:a}){return t("span",{staticClass:"custom-tree-node"},[a.type=="group"?t("span",{attrs:{title:"\u5206\u7EC4 [ "+r.label+" ]"}},[t("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[r.expanded?t("use",{attrs:{"xlink:href":" #bi_fileOpen"}}):t("use",{attrs:{"xlink:href":"#bi_fileClose"}})]),e._v(" "+e._s(r.label)+" ")]):e._e(),a.type=="query"?t("span",{attrs:{title:"\u67E5\u8BE2\u5217\u8868 [ "+r.label+" ]"}},[t("i",{staticClass:"iconfont bi_shujuji",style:{color:e.theme.btn_bgc}}),e._v(e._s(r.label)+" ")]):e._e()])}}])})],1)],1)],1),t("el-tooltip",{attrs:{content:"\u6DFB\u52A0\u67E5\u8BE2\u5217\u8868","open-delay":1e3,effect:"dark",placement:"top"}},[t("el-button",{attrs:{type:"text"},on:{click:function(r){return e.addQuery()}}},[t("i",{staticClass:"iconfont bi_add1",staticStyle:{"margin-left":"5px",color:"#67c23a"}})])],1),t("el-tooltip",{attrs:{content:"\u8BBE\u8BA1\u67E5\u8BE2\u5217\u8868","open-delay":1e3,effect:"dark",placement:"top"}},[t("el-button",{attrs:{type:"text"},on:{click:function(r){return e.editQuery(e.currentWidget.dataset.query.queryListId)}}},[t("i",{staticClass:"iconfont bi_design"})])],1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.currentWidget.dataset.query.queryListId&&e.currentWidget.dataset.query.queryListId!="",expression:"currentWidget.dataset.query.queryListId && currentWidget.dataset.query.queryListId != ''"}],attrs:{label:"\u53D1\u5E03\u6A21\u5F0F"}},[t("el-tooltip",{attrs:{"open-delay":1e3,effect:"dark",placement:"left"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" \u5F53\u8DDF\u968F\u770B\u677F\u7248\u672C\u65F6\uFF0C\u5219\u83B7\u53D6\u8BE5\u7248\u672C\u7C7B\u578B\u7684\u6700\u65B0\u7248\u672C\uFF1B"),t("br"),e._v(" \u5F53\u770B\u677F\u65E0\u7248\u672C\u7C7B\u578B\u65F6\uFF0C\u5219\u83B7\u53D6\u7684\u662F\u7F16\u8F91\u5668\u9884\u89C8\u5185\u5BB9\uFF1B"),t("br"),e._v(" \u5F53\u4F7F\u7528\u81EA\u8EAB\u7248\u672C\u65F6\uFF0C\u5219\u59CB\u7EC8\u83B7\u53D6\u67E5\u8BE2\u5217\u8868\u6307\u5B9A\u7684\u7248\u672C\u5185\u5BB9\uFF1B"),t("br"),e._v(" \u5F53\u67E5\u8BE2\u5217\u8868\u6CA1\u6709\u53D1\u5E03\u76F8\u5E94\u7248\u672C\u65F6\uFF0C\u5219\u83B7\u53D6\u4E0D\u5230\u6570\u636E ")]),t("el-radio-group",{on:{change:e.changePublishMode},model:{value:e.currentWidget.dataset.query.publishMode,callback:function(r){e.$set(e.currentWidget.dataset.query,"publishMode",r)},expression:"currentWidget.dataset.query.publishMode"}},e._l(e.publishModeList,function(r){return t("el-radio-button",{key:r.value,attrs:{label:r.value}},[e._v(" "+e._s(r.label)+" ")])}),1)],1)],1),e.currentWidget.dataset.query.publishMode==e.publishMode.query.code?[t("el-form-item",{attrs:{label:"\u7248\u672C\u6A21\u5F0F"}},[t("el-radio-group",{on:{change:e.getConfigData},model:{value:e.currentWidget.dataset.query.versionMode,callback:function(r){e.$set(e.currentWidget.dataset.query,"versionMode",r)},expression:"currentWidget.dataset.query.versionMode"}},e._l(e.versionModeList,function(r){return t("el-radio-button",{key:r.value,attrs:{label:r.value}},[e._v(" "+e._s(r.label)+" ")])}),1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.currentWidget.dataset.query.versionMode==e.versionMode.newest.code,expression:"currentWidget.dataset.query.versionMode == versionMode.newest.code"}],attrs:{label:"\u7248\u672C\u7C7B\u578B"}},[t("el-radio-group",{on:{change:e.getConfigData},model:{value:e.currentWidget.dataset.query.publishType,callback:function(r){e.$set(e.currentWidget.dataset.query,"publishType",r)},expression:"currentWidget.dataset.query.publishType"}},e._l(this.$$global.editTypeList,function(r){return t("el-radio-button",{key:r.value,attrs:{label:r.value}},[e._v(" "+e._s(r.label)+" ")])}),1)],1),e.currentWidget.dataset.query.versionMode==e.versionMode.someone.code?t("el-form-item",{attrs:{label:"\u53D1\u5E03\u7248\u672C"}},[t("el-select",{ref:"treeSelectPublish",staticClass:"width_full",staticStyle:{width:"160px"},attrs:{filterable:"","filter-method":e.filterMethodPublish,clearable:!0,"popper-append-to-body":!1,placeholder:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u53D1\u5E03\u7684\u7248\u672C"},on:{"visible-change":e.visibleChangePublish,clear:e.clearSelectPublish},model:{value:e.currentWidget.dataset.query.queryListPublishId,callback:function(r){e.$set(e.currentWidget.dataset.query,"queryListPublishId",r)},expression:"currentWidget.dataset.query.queryListPublishId"}},[t("el-option",{staticStyle:{height:"auto"},attrs:{value:e.currentWidget.dataset.query.queryListPublishId,label:e.currentWidget.dataset.query.queryListPublishName}},[t("el-tree",{ref:"selectTreePublish",attrs:{data:e.publishList,"default-expanded-keys":e.defaultExpandedKeysPublish,"filter-node-method":e.filterNodeMethod,"highlight-current":!0,"check-on-click-node":!0,"current-node-key":e.currentWidget.dataset.query.queryListPublishId,"node-key":"id"},on:{"node-click":e.nodeClickPublish},scopedSlots:e._u([{key:"default",fn:function({node:r,data:a}){return t("span",{staticClass:"custom-tree-node"},[a.type=="group"?t("span",{attrs:{title:"\u53D1\u5E03\u7C7B\u578B [ "+r.label+" ]"}},[t("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[r.expanded?t("use",{attrs:{"xlink:href":" #bi_fileOpen"}}):t("use",{attrs:{"xlink:href":"#bi_fileClose"}})]),e._v(" "+e._s(r.label)+" ")]):e._e(),a.type=="query"?t("span",{attrs:{title:r.label+(a.isFirst==!0?" [\u6700\u65B0\u53D1\u5E03\u7248\u672C] ":" [\u53D1\u5E03\u7248\u672C]")}},[!a.isFirst&&a.editingId==null?t("span",[t("i",{class:"iconfont bi_shujuji",style:{color:e.theme.btn_bgc}})]):e._e(),a.isFirst==!0?t("span",{staticClass:"my-tips"},[t("span",{staticClass:"new-icon"},[t("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"#bi_new"}})]),e._v("\u6700\u65B0 ")])]):e._e(),a.editingId!=null?t("span",{staticClass:"my-tips"},[t("span",{staticClass:"current-icon"},[t("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":"#bi_dq"}})]),e._v("\u5F53\u524D ")])]):e._e(),e._v(" "+e._s(r.label)+" ")]):e._e()])}}],null,!1,4106080685)})],1)],1)],1):e._e()]:e._e(),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.currentWidget.dataset.query.queryListId&&e.currentWidget.dataset.query.queryListId!="",expression:"currentWidget.dataset.query.queryListId && currentWidget.dataset.query.queryListId != ''"}],attrs:{label:"\u5237\u65B0\u6761\u4EF6"}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.refreshQueryKey()}}},[t("i",{staticClass:"iconfont bi_zxbd_refresh"}),e._v("\u5237\u65B0\u5217\u8868\u6761\u4EF6 ")])],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.currentWidget.dataset.query.queryListId&&e.currentWidget.dataset.query.queryListId!="",expression:"currentWidget.dataset.query.queryListId && currentWidget.dataset.query.queryListId != ''"}],attrs:{label:"\u5217\u8868\u6761\u4EF6"}},[t("div",{staticStyle:{color:"#909399","word-wrap":"break-word","margin-right":"30px"},domProps:{innerHTML:e._s(e.keyValueString)}})])],2),t("query-list-dialog-form",{ref:"query_list_dialog_form",staticClass:"new_query_list",on:{saveOk:e.saveOk}})],1)},o=[],c=l(378931),n=l(555616),y=l(723400),h=l(231954),p=l(148836),g=l(546121),b=l(927966),f={name:"list-query-data",components:{QueryListDialogForm:g.default},props:["currentWidget"],mixins:[y.j],data(){return{list:{group:[],list:[],publish:[]},treeData:[],origin:location.origin,publishMode:{board:{code:"board",name:"\u8DDF\u968F\u770B\u677F\u7248\u672C"},query:{code:"query",name:"\u81EA\u8EAB\u7248\u672C"}},versionMode:{newest:{code:"newest",name:"\u6700\u65B0\u7248\u672C"},someone:{code:"someone",name:"\u6307\u5B9A\u7248\u672C"}}}},computed:{...(0,p.Se)(["getApplication"]),publishModeList(){return[{value:this.publishMode.board.code,label:this.publishMode.board.name},{value:this.publishMode.query.code,label:this.publishMode.query.name}]},versionModeList(){return[{value:this.versionMode.newest.code,label:this.versionMode.newest.name},{value:this.versionMode.someone.code,label:this.versionMode.someone.name}]},publishList(){let s={};return this.$$lib__.each(this.list.publish,e=>{if(e.queryListId==this.currentWidget.dataset.query.queryListId){let t={id:e.publishId,label:e.publishName,publishType:e.publishType,editingId:e.editingId,type:"query"};s[e.publishType]==null&&(s[e.publishType]=[],t.isFirst=!0),s[e.publishType].push(t)}}),this.$$lib__.map(this.$$global.editTypeList,e=>(e.id=e.value,e.type="group",e.children=s[e.value],e))},defaultExpandedKeysPublish(){return this.$$lib__.pluck(this.$$global.editTypeList,"value")},keyValueString(){let s=JSON.stringify(this.currentWidget.dataset.query.keyValue);return s?s.replace(/,/g,",</br>"):""}},mounted:function(){this.getTreeData()},methods:{getTreeData(){this.loading=!0,c.y.getQueryListTreeForAuthor("''").then(s=>{this.loading=!1,s&&s.status==200?(this.list.group=s.data.queryListGroupList,this.list.list=s.data.queryListList,this.list.publish=s.data.queryListPublishList,this.buildTreeData()):n.Message.error({message:s.msg,offset:60})})},filterMethod(s){this.$refs.selectTree.filter(s)},filterMethodPublish(s){this.$refs.selectTreePublish.filter(s)},filterNodeMethod(s,e){return s?e.label.indexOf(s)!==-1:!0},changePublishMode(){this.currentWidget.dataset.query.versionMode==null&&(this.currentWidget.dataset.query.versionMode="newest"),this.getConfigData()},nodeClick(s){s.type=="query"&&(this.currentWidget.dataset.query.queryListId=s.id,this.currentWidget.dataset.query.queryListName=s.label,this.currentWidget.dataset.query.queryListPublishId=null,this.currentWidget.dataset.query.queryListPublishName=null,this.currentWidget.dataset.query.publishMode==null&&(this.currentWidget.dataset.query.publishMode="board"),this.$refs.treeSelect.blur(),this.getConfigData())},nodeClickPublish(s,e){s.type=="query"&&(this.currentWidget.dataset.query.queryListPublishId=s.id,this.currentWidget.dataset.query.queryListPublishName=s.label,this.currentWidget.dataset.query.publishType=e.parent.data.id,this.$refs.treeSelectPublish.blur(),this.getConfigData())},clearSelect(){this.currentWidget.dataset.query.queryListId=null,this.currentWidget.dataset.query.queryListName=null,this.currentWidget.dataset.query.publishMode=null,this.currentWidget.dataset.query.versionMode=null,this.currentWidget.dataset.query.queryListPublishId=null,this.currentWidget.dataset.query.queryListPublishName=null,this.currentWidget.dataset.query.publishType=null},clearSelectPublish(){this.currentWidget.dataset.query.queryListPublishId=null,this.currentWidget.dataset.query.queryListPublishName=null,this.currentWidget.dataset.query.publishType=null},addQuery(){this.$refs.query_list_dialog_form.addQueryList()},saveOk(s){this.getTreeData(),this.currentWidget.dataset.query.queryListId=s.queryListId,this.currentWidget.dataset.query.queryListName=s.queryListName,this.getConfigData(),this.$confirm("\u662F\u5426\u6253\u5F00\u5230\u8BBE\u8BA1\u754C\u9762\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning",customClass:"deleteBoardC"}).then(()=>{this.editQuery(this.currentWidget.dataset.query.queryListId)}).catch(()=>{})},editQuery(s){if(s&&s!=""){let e=this.origin+h.Z.baseConfig.projectName+"/query_design.html?queryId="+this.currentWidget.dataset.query.queryListId+"&appId="+this.getApplication.applicationId;window.open(e)}else n.Message.warning({message:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u67E5\u8BE2\u5217\u8868",offset:60})},refreshQueryKey(){b.Z.$emit("refreshQueryKey")},copyQueryName(){document.getElementById("copyTxt").select(),document.execCommand("Copy")?this.$message({message:"\u67E5\u8BE2\u5217\u8868\u540D\u79F0\u590D\u5236\u6210\u529F",type:"success"}):this.$message({message:"\u67E5\u8BE2\u5217\u8868\u540D\u79F0\u590D\u5236\u5931\u8D25\uFF0C\u5F53\u524D\u64CD\u4F5C\u4E0D\u88AB\u652F\u6301\u6216\u672A\u88AB\u542F\u7528",type:"warning"})},visibleChange(){this.$refs.selectTree.filter("")},visibleChangePublish(){this.$refs.selectTreePublish.filter("")},buildTreeData(){let s=JSON.parse(JSON.stringify(this.list.group)),e=JSON.parse(JSON.stringify(this.list.list)),t={},r={},a=[];this.$$lib__.each(e,i=>{i.id=i.queryListId,i.label=i.queryListName,i.type="query",t[i.queryListGroupId]||(t[i.queryListGroupId]=[]),t[i.queryListGroupId].push(i)}),this.$$lib__.each(s,i=>{i.id="type_"+i.groupId,i.label=i.groupName,i.type="group",i.parentId!=null&&i.parentId!=""?(r[i.parentId]||(r[i.parentId]=[]),r[i.parentId].push(i)):a.push(i)}),this.transferFl(a,r,t),this.treeData=a},transferFl(s,e,t){this.$$lib__.each(s,r=>{let a=e[r.groupId];a?(r.children=a,t[r.groupId]&&this.$$lib__.each(t[r.groupId],i=>{r.children.push(i)}),this.transferFl(a,e,t)):t[r.groupId]&&(r.children=t[r.groupId])})}}},q=f,v=l(768141),m=(0,v.Z)(q,d,o,!1,null,"05a84774",null),L=m.exports}}]);
