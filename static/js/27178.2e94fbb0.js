"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[27178],{927178:function(N,h,a){a.r(h),a.d(h,{default:function(){return w}});var f=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}]},[t("el-dialog",{staticClass:"dialog-publish",attrs:{"append-to-body":!0,center:!0,"close-on-click-modal":!1,visible:e.dialogVisible,title:"\u5B58\u4E3A\u65B9\u6848",width:"440px"},on:{"update:visible":function(o){e.dialogVisible=o}}},[t("div",{staticStyle:{"margin-bottom":"10px",color:"rgb(245, 108, 108)","text-align":"left"}},[e._v(" \xA0\xA0\xA0\xA0\xA0\xA0\u5EFA\u8BAE\u7EC4\u4EF6\u5BBD\u5EA6\u5C0F\u4E8E220\uFF0C\u9AD8\u5EA6\u5C0F\u4E8E120"),t("br")]),t("div",{staticStyle:{"margin-bottom":"10px",color:"rgb(245, 108, 108)","text-align":"left"}},[e._v(" \u6CE8\u610F\uFF1A"),t("br"),e._v(" \xA0\xA0\xA0\xA0\xA0\xA01. \u53F3\u4E0A\u89D2\u753B\u5E03\u653E\u7F29\u4E3A100%\uFF0C\u5426\u5219\u7F29\u7565\u56FE\u622A\u53D6\u4E0D\u5168"),t("br"),e._v(" \xA0\xA0\xA0\xA0\xA0\xA02. \u5BB9\u5668\u7EC4\u4EF6\u5185\u4E0D\u8981\u653E\u5B50\u7EC4\u4EF6\uFF0C\u5426\u5219\u4F1A\u622A\u53D6\u5230\u7F29\u7565\u56FE\u91CC"),t("br"),e._v(" \xA0\xA0\xA0\xA0\xA0\xA03. \u770B\u677F\u5B58\u4E3A\u65B9\u6848\u65F6\uFF0C\u4E0D\u533A\u5206\u573A\u666F\u548C\u9875\u9762\uFF0C\u6240\u4EE5\u8BF7\u5728\u540C\u4E00\u4E2A\u573A\u666F\u548C\u9875\u9762\u4E2D\u8FDB\u884C\u65B9\u6848\u7684\u6240\u6709\u7EC4\u4EF6\u7684\u914D\u7F6E"),t("br")]),t("el-form",{ref:"refTheme",attrs:{model:e.object,rules:e.rules,"label-width":"90px",size:"mini"}},[t("el-form-item",{attrs:{label:"\u65B9\u6848\u540D\u79F0",prop:"themeName"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{maxlength:"50","show-word-limit":"",placeholder:"\u8BF7\u8F93\u5165\u65B9\u6848\u540D\u79F0"},model:{value:e.object.themeName,callback:function(o){e.$set(e.object,"themeName",o)},expression:"object.themeName"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:function(o){e.dialogVisible=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.saveTheme}},[e._v(" \u786E \u5B9A ")])],1)],1)],1)},c=[],r=a(42160),d=a(555616),u=a(148836),p=a(274076),v=a(782047),b={name:"theme-editor-toolbar",mixins:[v.v],data(){return{fullscreenLoading:!1,dialogVisible:!1,object:{},rules:{themeName:[{required:!0,max:50,message:"\u5FC5\u586B\uFF1A\u65B9\u6848\u540D\u79F0\uFF08\u957F\u5EA6\u9650\u523650\u5B57\u7B26\uFF09",trigger:"blur"}]},saveThemeInfo:{len:0,index:0,list:[]},example_object:null}},computed:{...(0,u.Se)(["getCanvasSetting","getWidgets"])},watch:{"saveThemeInfo.index":{deep:!0,handler:function(){this.saveThemeInfo.len>0&&this.saveThemeInfo.len==this.saveThemeInfo.index&&this.doSaveTheme()}}},methods:{openDialog(){this.clear(),this.example_object=this.getExampleObject(),this.$$lib__.isEmpty(this.example_object)?JSON.stringify(this.getWidgets)==="{}"&&d.Message.warning({message:"\u8BF7\u5148\u6DFB\u52A0\u9700\u8981\u5B58\u4E3A\u65B9\u6848\u7684\u7EC4\u4EF6",offset:100}):this.dialogVisible=!0},doSaveTheme(){p.Y.addThemeAndExample({theme:this.object,example:this.saveThemeInfo.list}).then(s=>{s&&s.status==200?(this.getThemeAndExample(),this.dialogVisible=!1,d.Message.success({message:"\u65B9\u6848\u4FDD\u5B58\u6210\u529F",offset:60})):d.Message.error({message:"\u65B9\u6848\u4FDD\u5B58\u5931\u8D25\uFF1A"+s.msg,offset:60}),this.fullscreenLoading=!1})},saveTheme(){if(this.$$lib__.isEmpty(this.example_object))d.Message.warning({message:"\u8BF7\u5148\u6DFB\u52A0\u9700\u8981\u5B58\u4E3A\u65B9\u6848\u7684\u7EC4\u4EF6",offset:60});else{this.fullscreenLoading=!0,this.saveThemeInfo.len=Object.keys(this.example_object).length,this.saveThemeInfo.index=0,this.saveThemeInfo.list=[];for(let s in this.example_object){let e=JSON.parse(JSON.stringify(this.example_object[s]));this.exampleImg(e.id,e.width,e.height,t=>{e.exampleImg=t,this.saveThemeInfo.list.push(e),this.saveThemeInfo.index++})}}},getExampleObject(){let s=JSON.parse(JSON.stringify(this.getCanvasSetting));r.default.delete(s,"beforeLoad"),r.default.delete(s,"data"),r.default.delete(s,"action"),r.default.delete(s,"scenes"),r.default.delete(s,"fonts"),r.default.delete(s,"associativeDataset");let e={configJson:{canvasSetting:s}},t={more_key:[]},o={};for(let g in this.getWidgets){let l=this.getWidgets[g],i={exampleName:l.name},n=JSON.parse(JSON.stringify(l)),j=[{childWidget:[],selfWidget:n}];i.configJson=JSON.stringify(j),i.widgetType=n.widgetType,i.widgetGroup=n.widgetGroup,i.widgetName=n.typeName,i.width=n.attr.w,i.height=n.attr.h,i.id=n.id;let m=i.widgetType+"_"+i.widgetGroup+"_"+i.widgetName;o[m]?(t[m].length++,this.$$lib__.contains(t.more_key,m)||t.more_key.push(m)):(t[m]={title:l.typeTitle,length:1},o[m]=i,e[i.widgetType]||(e[i.widgetType]={}),e[i.widgetType][i.widgetGroup]||(e[i.widgetType][i.widgetGroup]={}),e[i.widgetType][i.widgetGroup][i.widgetName.replace(/-/g,"_")]={attr:l.attr,border:l.border,title:l.title,config:l.config,anime:l.anime})}if(t.more_key.length>0){let g=[];return this.$$lib__.each(t.more_key,l=>{g.push("\u7EC4\u4EF6\u3010"+t[l].title+"\u3011\u6709"+t[l].length+"\u4E2A")}),d.Message.warning({message:"\u914D\u8272\u65B9\u6848\u91CC\u4E00\u79CD\u7EC4\u4EF6\u53EA\u5141\u8BB8\u6709\u4E00\u4E2A\uFF0C\u73B0\u5728\u770B\u677F\u4E2D"+g.join("\u3001")+"\uFF0C\u8BF7\u4FDD\u8BC1\u552F\u4E00",offset:120}),null}else return this.object.configJson=JSON.stringify(e),o},clear(){this.object={themeName:null,configJson:null}}}},x=b,y=a(768141),T=(0,y.Z)(x,f,c,!1,null,"a40ec8a8",null),w=T.exports}}]);
