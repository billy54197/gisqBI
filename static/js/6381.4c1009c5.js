"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[6381],{46532:function($,c,o){o.d(c,{D:function(){return z}});var g=function(){var r=this,p=r._self._c;return p("div",{class:r.layOutClass,attrs:{id:"map"}},[p("div",{staticClass:"map",attrs:{id:"mainMap"},on:{contextmenu:r.preventContentMenu}},[r.isLoad?p("LayerMenu",{ref:"myLayerMenu",attrs:{shinemap:r.shinemap}}):r._e()],1)])},u=[],y=o(53183),M=o.n(y),v=o(4840),h=o(58262),S=o(1027);o(83258);var L={props:{mapOption:{},controls:{zoom:{type:Boolean,default:!0},mousePosition:{type:Boolean,default:!0},scaleLine:{type:Boolean,default:!0}},interaction:{mouseWheelZoom:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},dragPan:{type:Boolean,default:!0}}},data(){return{shinemap:{},isLoad:!1,mapLabelIsShow:!1}},components:{LayerMenu:v.Z},watch:{shinemap(m){m instanceof h.Z&&(this.isLoad=!0)}},mounted(){let m=new S.Z(this.mapOption);m.loadConfig().then(()=>{this.shinemap=new h.Z({controls:this.controls,interaction:this.interaction,target:"mainMap",configManager:m}),M()("#mainMap").resize(()=>{this.shinemap.updateSize()})})},methods:{preventContentMenu(m){m.preventDefault()}},computed:{layOutClass(){let m=this.shinemap.linkMap?this.shinemap.linkMap.length:0,r;switch(Number(m)){case 0:r="oneMap";break;case 1:r="twoMap";break;case 2:r="threeMap";break;case 3:r="fourMap";break;default:r="oneMap"}return r}}},C=L,I=o(68141),x=(0,I.Z)(C,g,u,!1,null,"41fcf4d4",null),z=x.exports},32350:function($,c,o){o.r(c),o.d(c,{default:function(){return p}});var g=function(){var a=this,i=a._self._c;return i("div",{directives:[{name:"show",rawName:"v-show",value:a.widgetInfo.attr.hide!=!0,expression:"widgetInfo.attr.hide != true"}],ref:"gisScatter",staticClass:"my-gisScatter",style:{width:a.widgetInfo.attr.w+"px",height:a.widgetInfo.attr.hh+"px"}},[i("hide-button",{attrs:{attr:a.widgetInfo.attr}}),i("ShineMap",{key:"2",ref:"myShineMap",staticClass:"scatter-shineMap",attrs:{controls:a.widgetInfo.config.controls,interaction:a.widgetInfo.config.interaction}})],1)},u=[],y=o(44513),M=o(14888),v=o(46532),h=o(13927),S=o(13910),L=o(46309),C=o(45061),I=o(49500),x={name:"OlScatterMap",components:{ShineMap:v.D,HideButton:y.Z},mixins:[L.u,C.u],props:["widgetInfo"],data(){return{xzqdm:this.widgetInfo.config.xzqdm,mapLayer:{toc:[]},layerRoot:{id:"P6F2D955F5A84BA882CC7B645974376C",label:"\u56FE\u5C42\u76EE\u5F55",showIndex:1}}},mounted(){M.Z.$on("mapInitialized",()=>{this.loadInfo(this.widgetInfo),this.initAction(this.widgetInfo)})},methods:{loadInfo(e){let a;this.setGisConfigJSON(e),setTimeout(()=>{this.$refs.myShineMap.shinemap.addLayerById(e.config.baseLayer)},50),e.config.thematicMapType&&e.dataset.type==this.$$global_editor.dataSourcType.static.code&&(a=()=>{this.addThematicMap(e)}),a?a():e.dataset.type==this.$$global_editor.dataSourcType.dynamic.code&&this.reLoadInfo(e)},reLoadInfo(e){e&&(this.$refs.gisScatter.style.width=e.attr.w+"px",this.$refs.gisScatter.style.height=e.attr.hh+"px");let a=this.$refs.myShineMap.shinemap;if(!a.map)return;this.setGisConfigJSON(e);let i=a.map.getLayers().getArray(),t=!1;for(let n=0,l=i.length;n<l;n++){if(i[n]instanceof h.default||i[n]instanceof S.default)if(i[n].get("id")==e.config.baseLayer){e.config.thematicMapType&&(this.addThematicMap(e),t=!0);break}else a.removeLayerById(i[n].get("id"));n==i.length-1&&setTimeout(()=>{a.addLayerById(e.config.baseLayer,()=>{e.config.thematicMapType&&this.addThematicMap(e)})},50)}t||this.addThematicMap(e)},addThematicMap(e){let a=this.$refs.myShineMap.shinemap,i="";if(e.config.layerTag){let f=this.$$lib__.find(e.mapLayer.toc,N=>N.id==e.config.layerTag);f&&(i=f.layerTag)}let t=new Object;t.mode=e.config.thematicMapType,t.layerTag=i,t.xzqdm=e.config.xzqdm,t.action="create",t.wkid="EPSG:4490",t.isImageMarker=e.config.isImageMarker,t.borderColor=e.config.borderColor,t.fillColor=e.config.fillColor,t.xzqExtentSize=e.config.xzqExtentSize,t.imgSize=e.config.imgSize,t.mark=e.config.mark,t.tooltip=e.config.tooltip,t.regionName=e.config.regionName;let n=e.dataset.type,l=e.dataset[n].encode,s=e.dataset[n].dimensions,d=e.dataset[n].source;t.isImageMarker&&(t.imageMakerList=JSON.parse(JSON.stringify(e.dataset[n].modeColor.imageMakerList))),t.modeColor=JSON.parse(JSON.stringify(e.dataset[n].modeColor.custom)),t.totaldata=this.getTotalData(l,s,d),a.addShowMap(t)},getTotalData(e,a,i){let t=[],n=this.getAttrIndex(a,e);return i.forEach(l=>{let s={};if(n.name>-1?s.name=l[n.name]:s.name="",n.mode>-1?s.mode=l[n.mode]:s.mode="",n.positionPoint>-1){let d=[],f=l[n.positionPoint].split(",");f.length==2?(d.push(Number(f[0].trim())),d.push(Number(f[1].trim()))):I.error("\u5750\u6807\u70B9\u4F4D\u7F6E\u6709\u8BEF"),s.positionPoint=d}n.mark>-1?s.mark=l[n.mark]!=null?l[n.mark]:"":s.mark="",n.discription>-1?s.discription=l[n.discription]:s.discription="",t.push(s)}),t},getAttrIndex(e,a){let i={name:-1,mode:-1,positionPoint:-1,mark:-1,discription:-1};for(let t=0;t<e.length;t++)e[t]==a.name&&(i.name=t),e[t]==a.mode&&(i.mode=t),e[t]==a.positionPoint&&(i.positionPoint=t),e[t]==a.mark&&(i.mark=t),e[t]==a.discription&&(i.discription=t);return i},initAction(e){this.actionReceive(e)},setGisConfigJSON(e){if(e.mapLayer==null||e.mapLayer.toc==null)return;let a=null;if(e.mapLayer.toc.length==0?a=new Object:this.$$lib__.each(e.mapLayer.toc,n=>{let l=this.$$lib__.find(this.mapLayer.toc,s=>s.id==n.id);(l==null||!this.$$lib__.isEqual(l,n))&&(a=n)}),a==null)return;this.mapLayer.toc=JSON.parse(JSON.stringify(e.mapLayer.toc));let i=this.$refs.myShineMap,t=this.getGisConfigJSON(e);if(t&&t.toc){i.shinemap.map.getLayers().getArray().forEach(s=>{s.get("id")!=="drawLayer"&&s.get("id")!=="localLayer"&&i.shinemap.map.removeLayer(s)}),i.shinemap.removeScatter(),i.shinemap.configManager.config.toc=t.toc;let l=i.$refs.myLayerMenu.treeDataTransform(t.toc);i.$refs.myLayerMenu.treeData=l,i.$refs.myLayerMenu.$forceUpdate()}},getGisConfigJSON(e){let a=JSON.parse(JSON.stringify(e.mapLayer));if(a&&a.toc){let i=[];this.$$lib__.each(a.toc,t=>{t.parent=this.layerRoot.id,i.push(t)}),i.push(this.layerRoot),a.toc=i}return a},judgeDataChange(e){let a=e.config,i=!1;return a.xzqdm&&this.xzqdm!==a.xzqdm?(this.xzqdm=a.xzqdm,i=!0):a.imgSize&&this.imgSize!==a.imgSize&&(this.imgSize=a.imgSize,i=!0),i}}},z=x,m=o(68141),r=(0,m.Z)(z,g,u,!1,null,"7c9b0f3e",null),p=r.exports}}]);
