"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[2682],{98521:function(U,T,d){var C=d(75770),b=d(27966),M=d(55616),N=d.n(M),Z=d(49500);T.Z={autoShow(O,L,A){let p=O;if(p.innerAutoShowInterval&&p.innerAutoShowInterval>-1&&(clearInterval(p.innerAutoShowInterval),p.innerAutoShowInterval=-1,L.dispatchAction({type:"downplay",dataIndex:p.innerAutoShowIndex}),p.innerAutoShowIndex=0),!(O&&L&&A&&A.enabled&&A.interval>0))return;let W=A.showTip;typeof p.innerAutoShowIndex>"u"&&(p.innerAutoShowIndex=0),p.innerAutoShowInterval=setInterval(function(){let g=L.getOption(),f=0,S=0;g.series[f].data?S=g.series[f].data.length:g.dataset&&g.dataset.length>0&&(S=g.dataset[0].source.length),S!=0&&(L.dispatchAction({type:"downplay",dataIndex:p.innerAutoShowIndex}),p.innerAutoShowIndex=(p.innerAutoShowIndex+1)%S,L.dispatchAction({type:"highlight",dataIndex:p.innerAutoShowIndex}),W&&L.dispatchAction({type:"showTip",seriesIndex:f,dataIndex:p.innerAutoShowIndex}),j(p,p.innerAutoShowIndex,f,g))},A.interval*1e3);function j(g,f,S,$){let c=g.widgetInfo;g.$$lib__.each(c.action.sendOut.actionList,y=>{if(y.enabled&&y.code==C.Z.autoHighLight.code){let P=c.dataset[c.dataset.type].dimensions,H=y.code+"_"+c.id,w={},E=[];if(c.dataset[c.dataset.type].source&&c.dataset[c.dataset.type].source.length>0&&(E=c.dataset[c.dataset.type].source[f]),w.x=g.getFieldVal(E,P,$.series[S].encode.x),w.y=g.getFieldVal(E,P,$.series[S].encode.y),g.getExtendParams(w,y.paramsExtend,E,P),y.script&&y.script.enabled){if(Z.log("Execute script for "+c.name+" component to "+y.name+" component"),y.script.content==""){M.Message.warning({message:y.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}try{w=new Function("param,autoShowIndex,seriesIndex, opts",y.script.content).apply(g,[w,f,S,$])}catch(B){Z.error(B)}}b.Z.$emit(H,w),y.postMessage&&g.doPostMessage(w)}})}}}},56279:function(U,T,d){d.d(T,{P:function(){return M}});var C=d(86892),b=d(49500);const M={mixins:[C.D],created(){},methods:{lifecycleBeforeChartsLoad(N){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&b.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),b.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let O=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[N]);if(O)return O}return N},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&b.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),b.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},72682:function(U,T,d){d.r(T),d.d(T,{default:function(){return B}});var C=function(){var e=this,i=e._self._c;return i("div",{style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px"}},[i("hide-button",{attrs:{attr:e.widgetInfo.attr}}),i("div",{ref:"barSimple",style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px"}})],1)},b=[],M=d(44513),N=d(27966),Z=d(45061),O=d(26711),L=d(89086),A=d(99349),p=d(75770),W=d(55616),j=d(98521),g=d(67157),f=d(50666);const S={mixins:[g.c],data(){return{config_extend:{config:{series:{barWidth:30}}},filter_config:{title:JSON.parse(JSON.stringify(f.Z.charts.title)),legend:JSON.parse(JSON.stringify(f.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(f.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(f.Z.charts.toolbox)),visualMap:JSON.parse(JSON.stringify(f.Z.charts.visualMap)),dataZoom:JSON.parse(JSON.stringify(f.Z.charts.dataZoom)),xAxis:JSON.parse(JSON.stringify(f.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(f.Z.charts.yAxis))}}},methods:{filterPredefineColoursSchemeConfig(t,e){if(this.getNewConfig(t,e,this.filter_config),this.getNewConfig_charts_visualMap_inRange_color(t.visualMap,e.visualMap),e.color&&e.color instanceof Array&&e.color.length>0)if(t.color&&t.color instanceof Array&&t.color.length>0)for(let i=0;i<t.color.length;i++)t.color[i]=e.color[i];else t.color=JSON.parse(JSON.stringify(e.color));if(e.series.itemStyle&&e.series.itemStyle.colorInfo&&e.series.itemStyle.colorInfo instanceof Array&&e.series.itemStyle.colorInfo.length>0)if(t.series.itemStyle&&t.series.itemStyle.colorInfo&&t.series.itemStyle.colorInfo instanceof Array&&t.series.itemStyle.colorInfo.length>0)for(let i=0;i<t.series.itemStyle.colorInfo.length;i++)this.getNewConfig(t.series.itemStyle.colorInfo[i],e.series.itemStyle.colorInfo[i],f.Z.charts.series.bar.itemStyle.colorInfo);else t.series.itemStyle||(t.series.itemStyle={}),t.series.itemStyle.colorInfo=JSON.parse(JSON.stringify(e.series.itemStyle.colorInfo))}}};var $=d(56279),c=d(49500);const y=d(29426);var P={name:"BarSimple",components:{HideButton:M.Z},mixins:[L.u,S,Z.u,O.H,$.P,A.P],props:["widgetInfo"],data(){return{source:[],dimensionsEx:null,dimensionsAliasEx:null,drillDown:{}}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=y.init(this.$refs.barSimple,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo),this.initClick(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{loadInfo(t){t.dataset[t.dataset.type]&&(this.source=t.dataset[t.dataset.type].source,this.dimensionsEx=t.dataset[t.dataset.type].dimensions,this.dimensionsAliasEx=t.dataset[t.dataset.type].dimensionsAlias),t.config.drillDown&&t.config.drillDown.enable==!0?(this.drillDown=JSON.parse(JSON.stringify(t.config.drillDown)),delete this.drillDown.graphic,this.drillDown.pid_arrary=[],this.doDrillDown(t,!0)):this.renderEcharts(t,this.source)},renderEcharts(t,e){let i=[],s=[],h=[],o=[];t.dataset[t.dataset.type]&&(i=t.dataset[t.dataset.type].dimensions,s=t.dataset[t.dataset.type].dimensionsAlias,h=t.dataset[t.dataset.type].encode);let D=this.getTooltip(t.config.tooltip),J=JSON.parse(JSON.stringify(t.config.toolbox)),K=JSON.parse(JSON.stringify(t.config.dataZoom)),m=JSON.parse(JSON.stringify(t.config.legend)),x=JSON.parse(JSON.stringify(t.config.title)),V=JSON.parse(JSON.stringify(t.config.grid)),a=JSON.parse(JSON.stringify(t.config.xAxis)),n=JSON.parse(JSON.stringify(t.config.yAxis)),r=JSON.parse(JSON.stringify(t.config.series)),X=this.$$global_editor.predefineColors;r.name||(r.name=this.getLegendData(s,h),t.config.series.name=r.name);let G=[];if(t.config.drillDown&&t.config.drillDown.enable==!0){let l=this.getGraphic(t.config.drillDown.graphic);l&&l.elements&&l.elements.length>0&&(l.elements[0].ignore=this.drillDown.pid_arrary.length<1),G.push(l)}let F={},k=[],Q=[];for(let l=i.length-1;l>-1;--l)F[i[l]]=l;for(let l=0;l<e.length;++l){let I=e[l],u={};for(let v in F)u[v]=I[F[v]]||"";k.push({name:I[F[h.x]]||"",value:I[F[h.y]]||"",source:e,row:u}),Q.push(I[F[h.x]]||"")}r.data=k,a.data=Q;for(let l=0;l<r.itemStyle.colorInfo.length;++l)o.push(this.getItemStyleColor(r.itemStyle.colorInfo[l]));let R;a.axisLabel.vertical?a.axisLabel.rotate!==0?R=a.axisLabel.margin+a.axisLabel.fontSize:R=a.axisLabel.margin:a.axisLabel.rotate!==0?R=a.axisLabel.margin+parseInt(a.axisLabel.fontSize/2):R=a.axisLabel.margin,this.isNegative(r,e),n.max==0&&(n.max=this.fun_max),n.min==0&&(n.min=this.fun_min),(!a.nameTextStyle.paddingTop||a.nameTextStyle.paddingTop=="")&&(a.nameTextStyle.paddingTop=0),(!a.nameTextStyle.paddingLeft||a.nameTextStyle.paddingLeft=="")&&(a.nameTextStyle.paddingLeft=0),a.nameTextStyle.paddingTop==0?a.nameTextStyle.verticalAlign="middle":a.nameTextStyle.verticalAlign="top",a.nameTextStyle.padding=[a.nameTextStyle.paddingTop,0,0,a.nameTextStyle.paddingLeft],(!n.nameTextStyle.paddingTop||n.nameTextStyle.paddingTop=="")&&(n.nameTextStyle.paddingTop=0),(!n.nameTextStyle.paddingLeft||n.nameTextStyle.paddingLeft=="")&&(n.nameTextStyle.paddingLeft=0),n.nameTextStyle.paddingTop==0?n.nameTextStyle.verticalAlign="middle":n.nameTextStyle.verticalAlign="top",n.nameTextStyle.padding=[n.nameTextStyle.paddingTop,0,0,n.nameTextStyle.paddingLeft];let z={color:this.$$global_editor.predefineColors,tooltip:D,toolbox:J,dataZoom:K,graphic:G,visualMap:t.config.visualMap.show?this.getVisualMap(t.config.visualMap):"",title:{show:x.show,text:x.text,link:x.link,textAlign:x.textAlign,left:x.left+"%",right:x.right+"%",top:x.top+"%",bottom:x.bottom+"%",textStyle:{fontSize:x.textStyle.fontSize,fontFamily:x.textStyle.fontFamily,color:x.textStyle.color}},legend:{show:m.show,type:m.type,itemWidth:m.itemWidth,itemHeight:m.itemHeight,icon:m.icon,orient:m.orient,align:m.align,itemGap:m.itemGap,left:m.left+"%",right:m.right+"%",top:m.top+"%",bottom:m.bottom+"%",textStyle:{color:m.textStyle.color,fontSize:m.textStyle.fontSize}},textStyle:{fontFamily:m.textStyle.fontFamily,color:m.textStyle.color},grid:{left:V.left+"%",right:V.right+"%",top:V.top+"%",bottom:V.bottom+"%"},xAxis:[{type:"category",show:a.show,name:a.name,data:a.data,axisLine:{show:a.axisLine.show,lineStyle:{color:a.axisLine.lineStyle.color}},axisTick:{show:a.axisTick.show},nameTextStyle:{...a.nameTextStyle},axisLabel:{interval:a.axisLabel.interval,show:a.axisLabel.show,rotate:a.axisLabel.rotate,margin:R,align:"center",verticalAlign:a.axisLabel.verticalAlign||"top",fontSize:a.axisLabel.fontSize,fontFamily:a.axisLabel.fontFamily,color:a.axisLabel.color,formatter:function(l,I){return a.axisLabel.script==!0?new Function("value, index",a.axisLabel.scriptontent).apply(this,[l,I]):a.axisLabel.vertical?l.split("").join(`
`):l}},splitLine:a.splitLine}],yAxis:[{type:"value",scale:!0,show:n.show,name:n.name,min:n.min,max:n.max,splitNumber:n.splitNumber,nameTextStyle:{...n.nameTextStyle},axisLine:{show:n.axisLine.show,lineStyle:{color:n.axisLine.lineStyle.color}},axisTick:{show:n.axisTick.show},axisLabel:{show:n.axisLabel.show,formatter:"{value}"+n.suffix,rotate:n.axisLabel.rotate,margin:n.axisLabel.margin,fontSize:n.axisLabel.fontSize,fontFamily:n.axisLabel.fontFamily,color:n.axisLabel.color,verticalAlign:n.axisLabel.verticalAlign},splitLine:n.splitLine}],dataset:{source:e,sourceHeader:!1},series:[{name:r.name,type:"bar",dimensions:i,encode:h,data:r.data,barWidth:r.barWidth+"%",label:{show:r.label.show,position:r.label.position,rotate:r.label.rotate,color:r.label.color,fontSize:r.label.fontSize,fontWeight:r.label.fontWeight,formatter:function(l){return r.label.prefix+l.value+r.label.suffix}},itemStyle:{color:function(l){return o[l.dataIndex]?o[l.dataIndex]:o[0]?o[0]:X[l.dataIndex]},opacity:r.itemStyle.opacity,barBorderRadius:[r.itemStyle.barBorderRadius.lt,r.itemStyle.barBorderRadius.rt,r.itemStyle.barBorderRadius.rb,r.itemStyle.barBorderRadius.lb]},markLine:r.markLine}]};if(r.emphasis)try{let l=r.emphasis;if(l.script&&l.script.enabled){if(l.script.content){let I=new Function("index","item","data",l.script.content),u=z.series[0].data;if(u&&u.length>0)for(let v=0;v<u.length;++v)try{u[v].emphasis=I.call(this,v,u[v],u)}catch(Y){c.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",Y)}}}else r.emphasis.itemStyle&&r.emphasis.itemStyle.color&&(z.series[0].emphasis={itemStyle:{...r.emphasis.itemStyle}})}catch(l){c.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",l)}this.getAnimation(z,t),this.setOption(z,t),this.setAnimationLoop(t,()=>{this.setOption(z,t)})},setOption(t,e){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0}),j.Z.autoShow(this,this.echarts,e.config.autoShow)},reLoadInfo(t){t&&(this.$refs.barSimple.style.width=t.attr.w+"px",this.$refs.barSimple.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},getLegendData(t,e){let i=this.$$lib__.find(t,s=>s.name==e.y);return i?i.alias&&i.alias!=""?i.alias:i.name:""},getSeriesColor(t,e=[]){const i=this;let s=[];if(t.config.series.emphasis.itemStyle.colorType=="script"){const h=this.echarts.getOption()?this.echarts.getOption().xAxis[0].data:e;let o=new Function("index",t.config.series.emphasis.itemStyle.colorScript);s=[],h.forEach((D,J)=>{let K=o.apply(i,[J]);const m={name:D,index:J,item:D,color:K};s.push(m)})}else t.config.series.emphasis.itemStyle.colorType=="template"&&(s=this.getEmphasisStyle(t.config.series.emphasis.itemStyle.color));return s},getEmphasisStyle(t){let e=null;return t&&(e=t),e},getItemStyleColor(t){let e=null;return t.pureColor&&t.type==this.$$global_editor.colorType.pureColor.code?e=t.pureColor:t.type==this.$$global_editor.colorType.gradation.code&&(e=new y.graphic.LinearGradient(0,0,0,1,[{offset:0,color:t.gradation.top!=null&&t.gradation.top!=""?t.gradation.top:"#FFFFFF"},{offset:1,color:t.gradation.bottom!=null&&t.gradation.bottom!=""?t.gradation.bottom:"#FFFFFF"}])),e},doDrillDown(t,e){let i=[];if(this.drillDown.pidValue&&this.drillDown.id&&this.drillDown.pid){let s={};for(let h=this.dimensionsEx.length-1;h>-1;--h)s[this.dimensionsEx[h]]=h;for(let h=0;h<this.source.length;++h){let o=this.source[h];o[s[this.drillDown.pid]]==this.drillDown.pidValue&&i.push(JSON.parse(JSON.stringify(o)))}}else c.error("\u5FC5\u987B\u914D\u7F6E\u4E0B\u94BB\u7684\u3010\u4E0A\u7EA7\u6570\u503C\u3001\u6570\u636E\u5B57\u6BB5\u3001\u4E0A\u7EA7\u5B57\u6BB5\u3011");if(i.length>0)this.renderEcharts(this.widgetInfo,i);else{let s=this.drillDown.pid_arrary.length-1;this.drillDown.pid_arrary.length=s>0?s:0,c.info("\u4E0B\u94BB\u5DF2\u65E0\u6570\u636E"),e&&this.renderEcharts(t,i)}},initClick(t){this.echarts.on("click",e=>{if(e.componentType=="graphic"){if(this.drillDown&&this.drillDown.enable==!0){let i=this.drillDown.pid_arrary.length;i>0?(this.drillDown.pidValue=this.drillDown.pid_arrary[i-1],this.drillDown.pid_arrary.length=i-1,this.drillDown.pidValue?this.doDrillDown(t):c.error("\u4E0B\u94BB\u5B57\u6BB5\u672A\u83B7\u53D6\u5230\u6709\u6548\u503C")):c.error("\u5DF2\u7ECF\u662F\u6700\u9876\u7EA7\uFF0C\u4E0D\u53EF\u4EE5\u518D\u8FD4\u56DE")}}else e.componentType=="series"&&(this.actionOnClick(t,e),this.drillDown&&this.drillDown.enable==!0&&(this.drillDown.pid_arrary.length==0?this.drillDown.pid_arrary.push(t.config.drillDown.pidValue):this.$$lib__.contains(this.drillDown.pid_arrary,this.drillDown.pidValue)||this.drillDown.pid_arrary.push(this.drillDown.pidValue),this.drillDown.pidValue=e.data.row[this.drillDown.id],this.drillDown.pidValue?this.doDrillDown(t):c.error("\u4E0B\u94BB\u5B57\u6BB5\u672A\u83B7\u53D6\u5230\u6709\u6548\u503C")))})},initAction(t){this.actionReceive(t)},actionOnClick(t,e){let i=this;this.$$lib__.each(t.action.sendOut.actionList,s=>{if(s.enabled){let h=s.code+"_"+t.id;if(s.paramsExtend&&s.paramsExtend.length>0){let o={};this.getParamsExtend(o,s.paramsExtend,t)}if(s.code==p.Z.click.code){let o={};o.x=e.name,o.y=e.value;let D=[],J=i.widgetInfo.action.sendOut.actionList;if(i.widgetInfo.dataset[i.widgetInfo.dataset.type].source&&i.widgetInfo.dataset[i.widgetInfo.dataset.type].source.length>0&&(D=i.widgetInfo.dataset[i.widgetInfo.dataset.type].source[e.dataIndex]),i.getExtendParams(o,J[0].paramsExtend,D,i.widgetInfo.dataset[i.widgetInfo.dataset.type].dimensions),s.script&&s.script.enabled){if(c.log("Execute script for "+i.widgetInfo.name+" component to "+s.name+" component"),s.script.content==""){W.Message.warning({message:s.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",s.script.content),o=this.customScript(o)}N.Z.$emit(h,o),s.postMessage&&i.doPostMessage(o),i.actionNameList.push(h)}}})},isNegative(t,e){let i=[];for(let s=0;s<t.length;s++){let h=-1;for(let o=0;o<t[s].dimensions.length;o++)t[s].dimensions[o]==t[s].encode.y&&(h=o);for(let o=0;o<e.length;o++)parseInt(e[o][h])<0&&i.push(o)}i.length>0?this.negative=!0:this.negative=!1},fun_max(t){let e=0,i=0;return parseInt(t.max)&&(e=Math.abs(parseInt(t.max)).toFixed(0).toString().length-1),parseInt(t.min)&&(i=Math.abs(parseInt(t.min)).toFixed(0).toString().length-1),Math.abs(t.max)>Math.abs(t.min)?Math.ceil(Math.abs(t.max)/Math.pow(10,e))*Math.pow(10,e):Math.ceil(Math.abs(t.min)/Math.pow(10,i))*Math.pow(10,i)},fun_min(t){if(this.negative){let e=0,i=0;return parseInt(t.max)&&(e=Math.abs(parseInt(t.max)).toFixed(0).toString().length-1),parseInt(t.min)&&(i=Math.abs(parseInt(t.min)).toFixed(0).toString().length-1),Math.abs(t.max)>Math.abs(t.min)?-1*Math.ceil(Math.abs(t.max)/Math.pow(10,e))*Math.pow(10,e):-1*Math.ceil(Math.abs(t.min)/Math.pow(10,i))*Math.pow(10,i)}else return-Math.abs(0)}}},H=P,w=d(68141),E=(0,w.Z)(H,C,b,!1,null,"5acd6bd2",null),B=E.exports}}]);
