"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[63707],{446532:function(N,d,s){s.d(d,{D:function(){return L}});var p=function(){var n=this,m=n._self._c;return m("div",{class:n.layOutClass,attrs:{id:"map"}},[m("div",{staticClass:"map",attrs:{id:"mainMap"},on:{contextmenu:n.preventContentMenu}},[n.isLoad?m("LayerMenu",{ref:"myLayerMenu",attrs:{shinemap:n.shinemap}}):n._e()],1)])},y=[],C=s(653183),g=s.n(C),S=s(104840),u=s(458262),w=s(926945);s(583258);var I={props:{mapOption:{},controls:{zoom:{type:Boolean,default:!0},mousePosition:{type:Boolean,default:!0},scaleLine:{type:Boolean,default:!0}},interaction:{mouseWheelZoom:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},dragPan:{type:Boolean,default:!0}}},data(){return{shinemap:{},isLoad:!1,mapLabelIsShow:!1}},components:{LayerMenu:S.Z},watch:{shinemap(h){h instanceof u.Z&&(this.isLoad=!0)}},mounted(){let h=new w.Z(this.mapOption);h.loadConfig().then(()=>{this.shinemap=new u.Z({controls:this.controls,interaction:this.interaction,target:"mainMap",configManager:h}),g()("#mainMap").resize(()=>{this.shinemap.updateSize()})})},methods:{preventContentMenu(h){h.preventDefault()}},computed:{layOutClass(){let h=this.shinemap.linkMap?this.shinemap.linkMap.length:0,n;switch(Number(h)){case 0:n="oneMap";break;case 1:n="twoMap";break;case 2:n="threeMap";break;case 3:n="fourMap";break;default:n="oneMap"}return n}}},_=I,x=s(768141),z=(0,x.Z)(_,p,y,!1,null,"41fcf4d4",null),L=z.exports},506685:function(N,d,s){s.r(d),s.d(d,{default:function(){return T}});var p=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.widgetInfo.attr.hide!=!0,expression:"widgetInfo.attr.hide != true"}],ref:"gisBase",staticClass:"my-gisBase",style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px"}},[t("hide-button",{attrs:{attr:e.widgetInfo.attr}}),t("ShineMap",{key:"2",ref:"myShineMap",staticClass:"my-shineMap",attrs:{controls:e.widgetInfo.config.controls,interaction:e.widgetInfo.config.interaction}})],1)},y=[],C=s(844513),g=s(927966),S=s(446532),u=s(130798),w=s(313927),I=s(213910),x={3301:[[119.8938,30.1355],[119.2596,29.7149]],3302:[[121.3934,29.9371],[121.6956,29.3994]],3303:[[120.7672,28.2237],[120.1547,27.6224]],3304:[[121.0968,30.7123],[120.5035,30.5476]],3305:[[119.5367,30.6409],[120.2041,30.7947]],3306:[[120.7507,30.0201],[120.8496,29.5697]],3307:[[119.7015,29.111],[120.3772,29.1577]],3308:[[118.515,29.0149],[119.1376,28.9835]],3309:[[122.2339,29.9487],[122.4751,30.4756]],3310:[[120.7892,28.7897],[121.366,28.8995]],3311:[[119.1687,28.0811],[119.8499,28.3005]],330102:[[120.1694,30.2467],[120.1618,30.2105]],330103:[[120.1856,30.3347],[120.1673,30.2812]],330104:[[120.343,30.3109],[120.2339,30.3072]],330105:[[120.1243,30.3187],[120.1695,30.3602]],330106:[[120.0823,30.1556],[120.0976,30.2691]],330108:[[120.1499,30.1734],[120.2001,30.1945]],330109:[[120.5461,30.2938],[120.233,30.0411]],330110:[[119.8581,30.3922],[120.1678,30.4328]],330111:[[119.6239,30.0466],[119.9329,30.0033]],330112:[[119.1563,30.1637],[119.5679,30.2982]],330122:[[119.409,29.9082],[119.7166,29.7701]],330127:[[119.0163,29.7379],[118.7553,29.4825]],330182:[[119.5175,29.5704],[119.1742,29.3699]],330802:[[118.7869,29.0822],[118.7773,28.9311]],330803:[[118.9503,29.1316],[118.8968,28.7292]],330822:[[118.4106,28.8844],[118.6263,29.063]],330824:[[118.2362,29.1138],[118.4615,29.2827]],330825:[[119.1714,29.1248],[119.2044,28.9037]],330881:[[118.596,28.7086],[118.5809,28.4285]],330702:[[119.4653,28.9078],[119.5863,29.0863]],330703:[[119.8141,29.2223],[119.7922,29.0767]],330723:[[119.6315,28.6867],[119.7922,28.8885]],330726:[[119.8622,29.5972],[119.9405,29.4447]],330727:[[120.4816,28.9572],[120.6464,29.1577]],330781:[[119.3898,29.2442],[119.6796,29.3404]],330782:[[120.1163,29.3816],[120.005,29.203]],330783:[[120.2646,29.1934],[120.5159,29.295]],330784:[[120.0037,28.9215],[120.2138,28.9764]],330602:[[120.612,30.084],[120.7179,29.959]],330603:[[120.6148,29.8272],[120.3923,30.0358]],330604:[[120.9073,29.8808],[120.829,30.1527]],330624:[[120.8249,29.385],[121.0076,29.4564]],330681:[[120.2069,29.797],[120.3456,29.5869]],330683:[[120.634,29.5759],[120.9059,29.6487]],330203:[[121.2437,29.797],[121.4511,29.8629]],330205:[[121.4346,29.9892],[121.5486,29.9288]],330206:[[121.7903,29.8972],[121.9908,29.8286]],330211:[[121.55,30.0208],[121.6983,29.9741]],330212:[[121.5692,29.7681],[121.7834,29.7366]],330213:[[121.2589,29.6062],[121.5582,29.5937]],330225:[[121.8535,29.4166],[121.9153,29.1447]],330226:[[121.3156,29.3026],[121.631,29.3053]],330281:[[121.068,30.1115],[121.2698,29.9892]],330282:[[121.2067,30.2749],[121.4456,30.165]],330902:[[121.8768,30.0249],[122.1954,30.0428]],330903:[[122.3932,29.922],[122.238,29.7668]],330921:[[122.319,30.2612],[122.1295,30.2831]],330922:[[122.4536,30.7267],[122.3396,30.5839]],330302:[[120.4836,28.0917],[120.6773,28.0162]],330303:[[120.7967,27.9262],[120.829,27.8273]],330304:[[120.6354,27.9386],[120.4198,28.021]],330305:[[121.0117,27.9049],[121.1476,27.8466]],330324:[[120.5173,28.378],[120.6985,28.1768]],330326:[[120.2632,27.6316],[120.5942,27.6413]],330327:[[120.3628,27.4717],[120.5344,27.4559]],330328:[[119.9144,27.8328],[120.1053,27.7491]],330329:[[119.7867,27.6035],[119.9913,27.4799]],330381:[[120.4005,27.8782],[120.5866,27.8047]],330382:[[121.0831,28.388],[120.9691,28.1284]],330402:[[120.8688,30.7559],[120.8352,30.6591]],330411:[[120.7281,30.8273],[120.6196,30.7401]],330421:[[120.8414,30.9454],[120.9348,30.8376]],330424:[[120.8057,30.5664],[120.9554,30.5671]],330481:[[120.4472,30.4256],[120.6711,30.4647]],330482:[[121.0412,30.6893],[121.1874,30.7257]],330483:[[120.3662,30.5712],[120.5571,30.668]],330502:[[120.1561,30.8747],[119.9892,30.7573]],330503:[[120.2131,30.7195],[120.3724,30.8129]],330521:[[119.9178,30.5588],[120.1623,30.5739]],330522:[[119.7057,31.0065],[119.9288,30.9866]],330523:[[119.4097,30.5444],[119.6651,30.6941]],331002:[[121.4236,28.698],[121.5033,28.6238]],331003:[[120.9684,28.5902],[121.1758,28.619]],331004:[[121.3824,28.5566],[121.5665,28.5366]],331022:[[121.3818,29.0557],[121.6035,28.9692]],331023:[[120.851,29.1127],[121.1071,29.1718]],331024:[[120.4726,28.6863],[120.7562,28.7893]],331081:[[121.3358,28.4144],[121.5569,28.3973]],331082:[[121.151,28.9273],[121.2685,28.7756]],331083:[[121.2259,28.1404],[121.3227,28.2517]],331102:[[119.8732,28.5493],[119.7798,28.3186]],331121:[[119.9803,28.2774],[120.2605,28.1607]],331122:[[120.2412,28.7444],[120.1932,28.5754]],331123:[[118.8982,28.4299],[119.1811,28.6345]],331124:[[119.5203,28.5315],[119.3115,28.3502]],331125:[[119.5793,28.2033],[119.4708,28.0234]],331126:[[119.0121,27.6375],[119.2676,27.5894]],331127:[[119.4969,27.8023],[119.7606,28.0014]],331181:[[119.1069,28.1772],[118.9957,27.9149]],4401:[[113.420637,23.525178]],4453:[[111.684439,22.829801]],4404:[[113.303986,22.094979]],4408:[[110.064977,21.174898]],4409:[[110.919229,22.019751]],4417:[[111.785107,21.989222]],4412:[[112.302529,23.501546]],4407:[[112.594942,22.410431]],4420:[[113.342391,22.501113]],4406:[[112.992717,23.028762]],4418:[[113.151227,24.015022]],4402:[[113.591544,24.701322]],4416:[[114.897802,23.896266]],4414:[[115.817582,23.999112]],4451:[[116.892301,23.891701]],4452:[[116.055733,23.383778]],4405:[[116.708463,23.40102]],4415:[[115.394238,22.884485]],4403:[[114.385947,22.687]],4419:[[113.706262,22.896237]],4413:[[114.612599,23.139404]]},z=s(334333),L=s(445061),h=s(126711),n={name:"GisBase",components:{ShineMap:S.D,HideButton:C.Z},mixins:[z.baseConfig,L.u,h.H],props:["widgetInfo"],data(){return{textInfo:"",fillColor:this.widgetInfo.config.fillColor,borderColor:this.widgetInfo.config.borderColor,bubbleColor_1:this.widgetInfo.config.bubbleColor_1,bubbleColor_2:this.widgetInfo.config.bubbleColor_2,bubbleShadowColor_1:this.widgetInfo.config.bubbleShadowColor_1,bubbleShadowColor_2:this.widgetInfo.config.bubbleShadowColor_2,fontSize:this.widgetInfo.config.fontSize,maxR:this.widgetInfo.config.maxR,minR:this.widgetInfo.config.minR,xzqExtentSize:this.widgetInfo.config.xzqExtentSize,bubbleFloat:this.widgetInfo.config.bubbleFloat,isShowXzqName:this.widgetInfo.config.isShowXzqName,isShowNameTag:this.widgetInfo.config.isShowNameTag,xzqdm_field:this.widgetInfo.config.xzqdm_field,xzqmc_field:this.widgetInfo.config.xzqmc_field,isBubbleImage:this.widgetInfo.config.isBubbleImage,bubbleImgURL_1:this.widgetInfo.config.bubbleImgURL_1,bubbleImgURL_2:this.widgetInfo.config.bubbleImgURL_2,imageFontColor_1:this.widgetInfo.config.imageFontColor_1,imageFontColor_2:this.widgetInfo.config.imageFontColor_2,bubbleNumLeft:this.widgetInfo.config.bubbleNumLeft,bubbleNumTop:this.widgetInfo.config.bubbleNumTop,encodeY:this.getEncodeY(this.widgetInfo.dataset),mapLayer:{toc:[]},layerRoot:{id:"P6F2D955F5A84BA882CC7B645974376C",label:"\u56FE\u5C42\u76EE\u5F55",showIndex:1}}},beforeDestroy(){u.Z.$off("mapInitialized")},mounted(){u.Z.$on("mapInitialized",()=>{this.loadInfo(this.widgetInfo),this.initAction(this.widgetInfo)})},methods:{loadInfo(i){let e=this.$refs.myShineMap;if(!e)return;let t;this.setGisConfigJSON(i),setTimeout(()=>{e.shinemap.addLayerById(i.config.baseLayer)},50),i.config.thematicMapType&&i.dataset.type==this.$$global_editor.dataSourcType.static.code&&(t=()=>{this.addThematicMap(i)}),t?t():i.dataset.type!=this.$$global_editor.dataSourcType.static.code&&this.reLoadInfo(i)},reLoadInfo(i){if(i){let l=this.$refs.gisBase;l&&(l.style.width=i.attr.w+"px",l.style.height=i.attr.hh+"px",l.style.display=i.attr.hide==!0?"none":"")}let e=this.$refs.myShineMap;if(!e)return;let t=e.shinemap;if(!t.map)return;this.setGisConfigJSON(i);let a=t.map.getLayers().getArray(),o=!1;for(let l=0,r=a.length;l<r;l++){if(a[l]instanceof w.default||a[l]instanceof I.default)if(a[l].get("id")==i.config.baseLayer){i.config.thematicMapType&&(this.addThematicMap(i),o=!0);break}else t.removeLayerById(a[l].get("id"));l==a.length-1&&setTimeout(()=>{t.addLayerById(i.config.baseLayer,()=>{i.config.thematicMapType&&this.addThematicMap(i)})},50)}o||this.judgeDataChange(i)&&this.addThematicMap(i)},addThematicMap(i){let e=this.$refs.myShineMap;if(!e)return;let t=i.dataset.type;if(!i.dataset[t].encode.x||!i.dataset[t].encode.y)return;let a="xzqh";if(i.config.layerTag){let f=this.$$lib__.find(i.mapLayer.toc,b=>b.id==i.config.layerTag);f&&(a=f.layerTag)}let o=new Object;o.mode=i.config.thematicMapType,o.layerTag=a,o.action="create",o.fontColorList=["rgb(186,247,223)","rgb(247,226,155)"],o.colorList=["#ff7f50","#87cefa","#da70d6","#32cd32","#6495ed"],o.colorList=[],o.fillColor=i.config.fillColor,o.borderColor=i.config.borderColor,o.isBubbleImage=i.config.isBubbleImage,i.config.isBubbleImage?(o.bubbleImgURL_1=i.config.bubbleImgURL_1,o.bubbleImgURL_2=i.config.bubbleImgURL_2,o.imageFontColor_1=i.config.imageFontColor_1,o.imageFontColor_2=i.config.imageFontColor_2,o.bubbleNumLeft=i.config.bubbleNumLeft,o.bubbleNumTop=i.config.bubbleNumTop):(o.bubbleColor_1=i.config.bubbleColor_1,o.bubbleColor_2=i.config.bubbleColor_2,o.bubbleShadowColor_1=i.config.bubbleShadowColor_1,o.bubbleShadowColor_2=i.config.bubbleShadowColor_2,o.boxShadowSize=i.config.boxShadowSize),o.fontSize=i.config.fontSize,o.bubbleMaxR=i.config.maxR,o.bubbleMinR=i.config.minR,o.xzqExtentSize=i.config.xzqExtentSize,o.bubbleFloat=i.config.bubbleFloat,o.isShowXzqName=i.config.isShowXzqName,o.isShowNameTag=i.config.isShowNameTag,o.xzqdm_field=i.config.xzqdm_field,o.xzqmc_field=i.config.xzqmc_field,o.wkid="EPSG:4490",o.totaldata={};let l,r=i.dataset[t].dimensions;for(let f=0,b=r.length;f<b;f++)if(r[f]==i.dataset[t].encode.x){l=f;break}let M=[];i.dataset[t].encode.y.forEach(f=>{for(let b=0,c=r.length;b<c;b++)if(r[b]==f){M.push(b);break}}),i.dataset[t].source.forEach(f=>{let b={xzqdm:"",data:[],positionPoint:""};b.xzqdm=f[l],M.forEach(c=>{b.data.push({value:f[c],name:i.dataset[t].dimensionsAlias[c].alias})}),b.positionPoint=x[b.xzqdm],o.totaldata[f[l]]=b}),e.shinemap.addShowMap(o,null,this.bubbleClick)},initAction(i){this.actionSendout(i),this.actionReceive(i)},onZoom(i,e,t){u.Z.$on("fit2region",a=>{e.xzq_code=a.xzqdm,e.flag=a.flag,g.Z.$emit(i,e),t&&this.doPostMessage(e)})},bubbleClick(i){let e=this,t=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(t,a=>{if(a.enabled&&a.code==e.$$global_editor.actionType.identify.code){let o=a.code+"_"+e.widgetInfo.id,l={data:i};if(a.paramsExtend&&a.paramsExtend.length>0&&this.getExtendParams(l,a.paramsExtend,[],[]),a.script&&a.script.enabled&&a.script.content){this.doConfigMap=new Function("data",a.script.content);let r=this.doConfigMap(l);r&&(l=r)}g.Z.$emit(o,l),a.postMessage&&this.doPostMessage(l),this.actionNameList.push(o)}})},setGisConfigJSON(i){if(i.mapLayer==null||i.mapLayer.toc==null)return;let e=null;if(i.mapLayer.toc.length==0?e=new Object:this.$$lib__.each(i.mapLayer.toc,o=>{let l=this.$$lib__.find(this.mapLayer.toc,r=>r.id==o.id);(l==null||!this.$$lib__.isEqual(l,o))&&(e=o)}),e==null)return;this.mapLayer.toc=JSON.parse(JSON.stringify(i.mapLayer.toc));let t=this.$refs.myShineMap;if(!t)return;let a=this.getGisConfigJSON(i);if(a&&a.toc){t.shinemap.map.getLayers().getArray().forEach(r=>{r.get("id")!=="drawLayer"&&r.get("id")!=="localLayer"&&t.shinemap.map.removeLayer(r)}),t.shinemap.removeBubble(),t.shinemap.configManager.config.toc=a.toc;let l=t.$refs.myLayerMenu.treeDataTransform(a.toc);t.$refs.myLayerMenu.treeData=l,t.$refs.myLayerMenu.$forceUpdate()}},getGisConfigJSON(i){let e=JSON.parse(JSON.stringify(i.mapLayer));if(e&&e.toc){let t=[];this.$$lib__.each(e.toc,a=>{a.parent=this.layerRoot.id,t.push(a)}),t.push(this.layerRoot),e.toc=t}return e},judgeDataChange(i){let e=i.config,t=!1;return e.fillColor&&this.fillColor!==e.fillColor?(this.fillColor=e.fillColor,t=!0):e.borderColor&&this.borderColor!==e.borderColor?(this.borderColor=e.borderColor,t=!0):e.bubbleColor_1&&this.bubbleColor_1!==e.bubbleColor_1?(this.bubbleColor_1=e.bubbleColor_1,t=!0):e.bubbleColor_2&&this.bubbleColor_2!==e.bubbleColor_2?(this.bubbleColor_2=e.bubbleColor_2,t=!0):e.bubbleShadowColor_1&&this.bubbleShadowColor_1!==e.bubbleShadowColor_1?(this.bubbleShadowColor_1=e.bubbleShadowColor_1,t=!0):e.bubbleShadowColor_2&&this.bubbleShadowColor_2!==e.bubbleShadowColor_2?(this.bubbleShadowColor_2=e.bubbleShadowColor_2,t=!0):e.boxShadowSize&&this.boxShadowSize!==e.boxShadowSize?(this.boxShadowSize=e.boxShadowSize,t=!0):e.fontSize&&this.fontSize!==e.fontSize?(this.fontSize=e.fontSize,t=!0):e.maxR&&this.maxR!==e.maxR?(this.maxR=e.maxR,t=!0):e.minR&&this.minR!==e.minR?(this.minR=e.minR,t=!0):e.xzqExtentSize&&this.xzqExtentSize!==e.xzqExtentSize?(this.xzqExtentSize=e.xzqExtentSize,t=!0):(e.bubbleFloat==!1||e.bubbleFloat==!0)&&this.bubbleFloat!==e.bubbleFloat?(this.bubbleFloat=e.bubbleFloat,t=!0):(e.isShowXzqName==!1||e.isShowXzqName==!0)&&this.isShowXzqName!==e.isShowXzqName?(this.isShowXzqName=e.isShowXzqName,t=!0):(e.isShowNameTag==!1||e.isShowNameTag==!0)&&this.isShowNameTag!==e.isShowNameTag?(this.isShowNameTag=e.isShowNameTag,t=!0):e.xzqdm_field&&this.xzqdm_field!==e.xzqdm_field?(this.xzqdm_field=e.xzqdm_field,t=!0):e.xzqmc_field&&this.xzqmc_field!==e.xzqmc_field?(this.xzqmc_field=e.xzqmc_field,t=!0):e.bubbleImgURL_1&&this.bubbleImgURL_1!==e.bubbleImgURL_1?(this.bubbleImgURL_1=e.bubbleImgURL_1,t=!0):e.bubbleImgURL_2&&this.bubbleImgURL_2!==e.bubbleImgURL_2?(this.bubbleImgURL_2=e.bubbleImgURL_2,t=!0):e.imageFontColor_1&&this.imageFontColor_1!==e.imageFontColor_1?(this.imageFontColor_1=e.imageFontColor_1,t=!0):e.imageFontColor_2&&this.imageFontColor_2!==e.imageFontColor_2?(this.imageFontColor_2=e.imageFontColor_2,t=!0):e.bubbleNumLeft&&this.bubbleNumLeft!==e.bubbleNumLeft?(this.bubbleNumLeft=e.bubbleNumLeft,t=!0):e.bubbleNumTop&&this.bubbleNumTop!==e.bubbleNumTop?(this.bubbleNumTop=e.bubbleNumTop,t=!0):(e.isBubbleImage==!1||e.isBubbleImage==!0)&&this.isBubbleImage!==e.isBubbleImage?(this.isBubbleImage=e.isBubbleImage,t=!0):this.encodeY!==i.dataset[i.dataset.type].encode.y&&(this.encodeY=i.dataset[i.dataset.type].encode.y,t=!0),t},getEncodeY(i){return i&&i[i.type]&&i[i.type].encode?i[i.type].encode.y:[]}}},m=n,v=s(768141),R=(0,v.Z)(m,p,y,!1,null,"015d2573",null),T=R.exports}}]);
