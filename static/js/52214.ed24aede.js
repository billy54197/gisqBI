"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[52214],{56279:function(C,m,a){a.d(m,{P:function(){return p}});var w=a(386892),f=a(149500);const p={mixins:[w.D],created(){},methods:{lifecycleBeforeChartsLoad(u){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&f.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let s=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[u]);if(s)return s}return u},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&f.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},105143:function(C,m,a){a.d(m,{b:function(){return u}});var w=a(148836),f=a(42160),p=a(149500);const u={created(){},computed:{...(0,w.Se)(["getWidgetAllArr"])},data(){return{containerViewSubWidgetList:[]}},methods:{...(0,w.nv)(["updateWidgetParentArrDataset","updateWidgetAllArrDataset"]),reLoadInfo(r){this.widgetInfo.id!=r.id&&this.$refs["comp_"+r.id]&&setTimeout(this.$refs["comp_"+r.id][0].reLoadInfo(r),500),this.loadInfo(r)},orgWidget(r){let s=[];return this.$$lib__.each(r,l=>{let n=this.$$lib__.find(this.getWidgetAllArr,c=>c.parentId==this.widgetInfo.id&&c.id==l.id);n&&(n.dataset&&n.dataset[n.dataset.type]&&(n.dataset.type==this.$$global_editor.dataSourcType.dynamic.code||n.dataset.type==this.$$global_editor.dataSourcType.local.code)&&n.dataset[n.dataset.type].autoUpdate==!0&&(f.default.set(this.dynamicWidgets,n.id,n),n.attr.hide!=!0&&n.dataset[n.dataset.type].autoUpdate==!0&&f.default.set(this.autoUpdateWidget,n.id,n)),s.push(n))}),f.default.set(this,"containerViewSubWidgetList",s),s},setTitleText(r,s){s?this.$$lib__.each(s,l=>{this.$$lib__.each(this.orgWidget(l.widgets),n=>{n.attr.widgetW||(n.attr.widgetW=n.attr.w),this.$refs["title_"+n.id]&&this.$refs["title_"+n.id][0]&&(this.$refs["title_"+n.id][0].innerHTML=this.initTextPosition(n)),n.title.position||(n.title.position="top")})}):this.$$lib__.each(this.orgWidget(r),l=>{this.$refs["title_"+l.id]&&this.$refs["title_"+l.id][0]&&(this.$refs["title_"+l.id][0].innerHTML=this.initTextPosition(l)),l.title.position||(l.title.position="top")})},initTextPosition(r){return r.title.text===void 0||!r.title.text?"":r.title.text&&(r.title.position==="left"||r.title.position==="right")?r.title.text.split("").join("<br />"):r.title.text},updataWidgetSource(r,s,l){try{switch(r.dataset.type){case this.$$global_editor.dataSourcType.dynamic.code:r.dataset.dynamic.source=s.data,s.total&&(r.dataset.dynamic.total=s.total);break;case this.$$global_editor.dataSourcType.local.code:r.dataset.local.dimensionsAlias=[],r.dataset.local.columnList=[],r.dataset.local.source=[],r.dataset.local.dimensions=[],r.dataset.local.dimensionsAlias=s.dimensionsAlias,r.dataset.local.columnList=s.columnList,r.dataset.local.source=s.source,r.dataset.local.dimensions=s.dimensions;break}}catch(c){p&&p.log&&p.log(c)}let n=this.$refs["comp_"+r.id];n&&n.length>0&&(this.updateWidgetAllArrDataset(r),this.updateWidgetParentArrDataset(r),n[0].reLoadInfo(r),this.sendoutDataloadSuccess(r),this.sendoutResponseData(r,s,l))},fit(r,s){if(!this.isView||!/^mobile/.test(this.getCanvasSetting.transformType))return r+"px";let l=this.getCanvasSetting.width/10,n=this.getCanvasSetting.height/window.innerHeight,c="";switch(this.getCanvasSetting.transformType){case"mobileAutoWidth":s?c=r+"px":c=r/l+"rem";break;case"mobileAutoBoth":c=r/l+"rem";break;default:s?c=r/n+"px":c=r/l+"rem"}return c}}}},980512:function(C,m,a){a.d(m,{Z:function(){return c}});var w=function(){var d=this,y=d._self._c;return y("div",{class:"container_child_"+d.widgetData.id,attrs:{id:"container_child_"+d.widgetData.id}},[y("keep-alive",[y(d.isView&&d.widgetData.isContainer?d.widgetData.typeName+"-view":d.widgetData.typeName,{ref:"com_"+d.widgetData.id,tag:"component",attrs:{"widget-info":d.widgetData,"widget-arr":d.getWidgetAllArr,"current-widget":d.currentWidget},on:{doGetPreviewData:d.doGetPreviewData,doReSetBoardId:d.doReSetBoardId,attrChange:d.attrChange}})],1)],1)},f=[],p=a(513229),u=a(148836),r={name:"DraggableComponent",extends:p.Z,computed:{...(0,u.Se)(["getWidgetAllArr","isView"])},methods:{reLoadInfo(g){if(g.id){let d=this.$refs["com_"+g.id];d&&d.reLoadInfo(g)}},doReSetBoardId(g){this.$emit("doReSetBoardId",g)},attrChange(g){this.$emit("attrChange",g)}}},s=r,l=a(768141),n=(0,l.Z)(s,w,f,!1,null,"41d16aa2",null),c=n.exports},152214:function(C,m,a){a.r(m),a.d(m,{default:function(){return k}});var w=function(){var t=this,o=t._self._c;return o("div",{ref:"drawer",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[o("el-drawer",{ref:"myDrawer",staticClass:"my-drawer",attrs:{"custom-class":`my-drawer-${t.widgetInfo.id}`,size:t.size,"close-on-press-escape":t.widgetInfo.config.drawer.closeOnPressEscape,modal:!1,direction:t.widgetInfo.config.drawer.direction,showClose:t.widgetInfo.config.drawer.showClose,wrapperClosable:t.widgetInfo.config.drawer.wrapperClosable,withHeader:t.widgetInfo.config.drawer.withHeader,visible:t.drawerVisible},on:{"update:visible":function(e){t.drawerVisible=e},opened:t.opened,open:t.open,close:t.close}},[o("div",{staticStyle:{overflow:"hidden",width:"100%"},style:t.getTitleStyle(t.widgetInfo.config.drawer),attrs:{slot:"title"},slot:"title"},[o("div",{style:{marginLeft:t.widgetInfo.config.drawer.title.label.left+"px",marginTop:t.widgetInfo.config.drawer.title.label.top+"px"}},[o("div",{style:t.getTitleSpanStyle(t.widgetInfo.config.drawer),domProps:{innerHTML:t._s(t.widgetInfo.config.drawer.title.text)}})])]),o("div",{staticClass:"my-div",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh-t.widgetInfo.config.drawer.title.h-3+"px",backgroundColor:t.widgetInfo.config.drawer.background.backgroundColor,backgroundImage:this.getImageUrl(t.widgetInfo.config.drawer.background.backgroundImage),backgroundSize:t.widgetInfo.config.drawer.background.backgroundSize}},[t.widgetInfo.config.container.scroll.show?o("happy-scroll",{attrs:{color:t.widgetInfo.config.container.scroll.color,resize:""}},[o("div",{staticClass:"my-drawer-container",style:{height:t.childMax.height+"px",width:t.childMax.width+"px",overflow:"visible"}},[t._l(t.orgWidget(t.widgetInfo.config.container.widgets),function(e){return[o("div",{style:t.getWidgetStyle(e)},[o("div",{key:"widget_"+e.id,ref:"widget_"+e.id,refInFor:!0,class:t.getWidgetClass(e),style:t.getBindStyle(e),attrs:{id:"widget_"+e.id}},[o("external-frame-svg",{ref:"comp_frame_"+e.id,refInFor:!0,attrs:{"widget-info":e}}),e.title.position==="top"||e.title.position==="left"?o("div",{staticStyle:{overflow:"hidden",float:"left"},style:t.getWidgetTitleStyle(e),on:{click:function(h){return t.openLink(e)}}},[o("div",{style:{marginLeft:e.title.label.left+"px",marginTop:e.title.label.top+"px"}},[o("span",{ref:"title_"+e.id,refInFor:!0,style:t.getTitleSpanStyle(e)})])]):t._e(),o("draggable-component-container",{ref:"comp_"+e.id,refInFor:!0,staticStyle:{display:"inline-block",float:"left"},style:t.getInfoStyle(e),attrs:{widgetData:e},on:{doGetPreviewData:t.getPreviewData,attrChange:t.attrChange}}),e.title.position==="bottom"||e.title.position==="right"?o("div",{staticStyle:{overflow:"hidden",float:"left"},style:t.getWidgetTitleStyle(e),on:{click:function(h){return t.openLink(e)}}},[o("div",{style:{marginLeft:e.title.label.left+"px",marginTop:e.title.label.top+"px"}},[o("span",{ref:"title_"+e.id,refInFor:!0,style:t.getTitleSpanStyle(e)})])]):t._e()],1)])]})],2)]):t._l(t.orgWidget(t.widgetInfo.config.container.widgets),function(e){return[o("div",{style:t.getWidgetStyle(e)},[o("div",{key:"widget_"+e.id,ref:"widget_"+e.id,refInFor:!0,class:t.getWidgetClass(e),style:t.getBindStyle(e),attrs:{id:"widget_"+e.id}},[o("external-frame-svg",{ref:"comp_frame_"+e.id,refInFor:!0,attrs:{"widget-info":e}}),e.title.position==="top"||e.title.position==="left"?o("div",{staticStyle:{overflow:"hidden",float:"left"},style:t.getWidgetTitleStyle(e),on:{click:function(h){return t.openLink(e)}}},[o("div",{style:{marginLeft:e.title.label.left+"px",marginTop:e.title.label.top+"px"}},[o("span",{ref:"title_"+e.id,refInFor:!0,style:t.getTitleSpanStyle(e)})])]):t._e(),o("draggable-component-container",{ref:"comp_"+e.id,refInFor:!0,staticStyle:{display:"inline-block",float:"left"},style:t.getInfoStyle(e),attrs:{widgetData:e},on:{doGetPreviewData:t.getPreviewData,doReSetBoardId:t.doReSetBoardId,attrChange:t.attrChange}}),e.title.position==="bottom"||e.title.position==="right"?o("div",{staticStyle:{overflow:"hidden",float:"left"},style:t.getWidgetTitleStyle(e),on:{click:function(h){return t.openLink(e)}}},[o("div",{style:{marginLeft:e.title.label.left+"px",marginTop:e.title.label.top+"px"}},[o("span",{ref:"title_"+e.id,refInFor:!0,style:t.getTitleSpanStyle(e)})])]):t._e()],1)])]})],2)])],1)},f=[],p=a(980512),u=a(193575),r=a(105143),s=a(927966),l=a(977863),n=a(955477),c=a(126711),g=a(56279),d=a(42160),y=a(555616),$=a(275770),_=a(213743),S=a(149500),D={name:"container-drawer-view",props:["widgetInfo","currentWidget"],components:{ExternalFrameSvg:_.Z,DraggableComponentContainer:p.Z,HappyScroll:l.HappyScroll},mixins:[n.baseConfig,u.E,r.b,c.H,g.P],computed:{size:function(){return this.widgetInfo.attr.w.toString()},childMax(){let i=this.orgWidget(this.widgetInfo.config.container.widgets),t=this.widgetInfo.attr.hh-this.widgetInfo.config.drawer.title.h-3,o=this.widgetInfo.attr.w;return this.widgetInfo.config.container.scroll.show&&i&&i.length>0&&i.forEach(e=>{e.attr.hh+e.attr.y>t&&(t=e.attr.hh+e.attr.y),e.attr.w+e.attr.x>o&&(o=e.attr.w+e.attr.x)}),{height:t,width:o}}},data(){return{drawerVisible:!1,timerArr:[],dataSetArr:{},autoUpdateWidget:{},dynamicWidgets:{},prefix:{widget:"widget_"},actionList:{},isOpen:!0,dbClick:!0}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(){if(this.widgetInfo.attr.hide=!0,this.getDynamicWidgetsSource(this.dynamicWidgets),this.lifecycleAfterLoad(),this.widgetInfo.config.drawer&&this.widgetInfo.config.drawer.border){const i=this.widgetInfo.config.drawer.border;let t={borderWidth:`${i.topWidth||0}px ${i.rightWidth||0}px
                    ${i.bottomWidth||0}px ${i.leftWidth||0}px`,borderColor:i.color,borderStyle:i.style},o=`.my-drawer-${this.widgetInfo.id} { ${this.mUtils.style2CSSStr(t)} }`;this.mUtils.appendCss(`container-drawer-${this.widgetInfo.id}`,o)}},reLoadInfo(i){this.loadInfo(i)},initAction(i){this.actionReceive(i)},getCarouselItemStyle(i){return{opacity:i.opacity,backgroundColor:i.backgroundColor,backgroundImage:this.getImageUrl(i.backgroundImage),backgroundSize:i.backgroundSize}},opened(){let i=this.$refs.myDrawer;if(!i)return;let t=i.$el.querySelector(".el-drawer__close-btn");if(t&&(i&&this.widgetInfo.config.drawer.buttonClose.custom?(t.style.top=this.widgetInfo.config.drawer.buttonClose.top+"px",t.style.right=this.widgetInfo.config.drawer.buttonClose.right+"px",t.style.fontSize=this.widgetInfo.config.drawer.buttonClose.fontSize+"px",t.style.zIndex=999,t.childNodes&&t.childNodes.length>0&&(t.childNodes[0].style.color=this.widgetInfo.config.drawer.buttonClose.color,this.widgetInfo.config.drawer.buttonClose.fontWeight&&(t.childNodes[0].style.fontWeight="bolder"))):(t.style.top="10px",t.style.right="15px",t.style.fontSize="16px",t.childNodes&&t.childNodes.length>0&&(t.childNodes[0].style.color="#909399",t.childNodes[0].style.fontWeight="normal"))),this.isOpen){for(let o in this.actionList)s.Z.$emit(o,this.actionList[o]);this.isOpen=!1}},open(){let i=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(i,t=>{if(t.enabled&&t.code==$.default.open.code){let o=t.code+"_"+this.widgetInfo.id,e={visible:!0};if(t.paramsExtend&&t.paramsExtend.length>0&&this.getExtendParams(e,t.paramsExtend),t.script&&t.script.enabled){if(S.log("Execute script for "+this.widgetInfo.name+" component to "+t.name+" component"),t.script.content==""){y.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",t.script.content),e=this.customScript(e)}s.Z.$emit(o,e),t.postMessage&&this.doPostMessage(e),this.actionNameList.push(o)}})},close(){this.widgetInfo.attr.hide=!0;let i=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(i,t=>{if(t.enabled&&t.code==$.default.close.code){let o=t.code+"_"+this.widgetInfo.id,e={visible:!1};if(t.paramsExtend&&t.paramsExtend.length>0&&this.getExtendParams(e,t.paramsExtend),t.script&&t.script.enabled){if(S.log("Execute script for "+this.widgetInfo.name+" component to "+t.name+" component"),t.script.content==""){y.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",t.script.content),e=this.customScript(e)}s.Z.$emit(o,e),t.postMessage&&this.doPostMessage(e),this.actionNameList.push(o)}})},actionReceive(i){if(i.action==null||i.action.receive==null)return;let t=i.action.receive.openDrawer;t&&t.enabled&&this.doDrawerVisible(t,i.name,!0);let o=i.action.receive.closeDrawer;o&&o.enabled&&this.doDrawerVisible(o,i.name,!1);let e=i.action.receive.receiveTitle;e&&e.enabled&&e.receiveTitleList&&e.receiveTitleList.length>0&&this.doReceiveTitle(e,i.name)},doDrawerVisible(i,t,o){let e=o==!0?"openDrawerList":"closeDrawerList";this.$$lib__.each(i[e],h=>{let v=h[0][1]+"_"+h[0][0];h[0][1].indexOf("_")>-1&&(v=h[0][1]),s.Z.$on(v,b=>{if(!this.dbClick)return;this.dbClick=!1,d.default.set(this.actionList,v,b);let I=h[0][2],L=I.indexOf("|");if(L>-1&&(I=h[0][2].substring(L+1)),i.script&&i.script.enabled){if(S.log("Execute script for "+t+" component to "+i.name+" component"),i.script.content==""){y.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}o==!0?this.doDrawerTrue=new Function("drawerVisible","data","param_key","value",i.script.content):this.doDrawerFalse=new Function("drawerVisible","data","param_key","value",i.script.content)}let x;o==!0?x=this.doDrawerTrue(this.drawerVisible,b,I,i.value):x=this.doDrawerFalse(this.drawerVisible,b,I,i.value),x instanceof Boolean&&(i.value==null||i.value==""||i.value==null?this.showDrawer(x):i.value==b[I]&&this.showDrawer(x)),setTimeout(()=>{this.dbClick=!0},500)})})},doDrawerTrue(i,t,o,e){e==null||e==""||e==null?this.showDrawer(!0):e==t[o]&&this.showDrawer(!0)},doDrawerFalse(i,t,o,e){e==null||e==""||e==null?this.showDrawer(!1):e==t[o]&&this.showDrawer(!1)},doReceiveTitle(i,t){this.$$lib__.each(i.receiveTitleList,o=>{let e=o[0][1]+"_"+o[0][0];o[0][1].indexOf("_")>-1&&(e=o[0][1]),s.Z.$on(e,h=>{let v=o[0][2],b=v.indexOf("|");if(b>-1&&(v=o[0][2].substring(b+1)),i.script&&i.script.enabled){if(S.log("Execute script for "+t+" component to "+i.name+" component"),i.script.content==""){y.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.dialogTitle=new Function("data","param_key",i.script.content)}this.dialogTitle(h,v)})})},showDrawer(i){this.widgetInfo.attr.hide=!i,this.drawerVisible=i,this.drawerVisible&&this.$nextTick(()=>{this.setTitleText(this.widgetInfo.config.container.widgets)})},dialogTitle(i,t){this.widgetInfo.config.drawer.title.text=i[t]},doReSetBoardId(i){this.$emit("doReSetBoardId",i)}},created:function(){this.clear()},destroyed:function(){this.clear()}},T=D,W=a(768141),A=(0,W.Z)(T,w,f,!1,null,"007815b3",null),k=A.exports}}]);
