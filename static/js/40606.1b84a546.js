"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[40606],{727377:function(k,h,n){n.d(h,{y:function(){return y}});var d=n(231954),l=n(555616),s=n.n(l),f=n(935051);let y={getClientInfo(){return(0,f.getRequest)("/public/getClientInfo")},getCodeValuePropertysByKeys(m){return(0,f.postRequest)("/public/thirdparty/platform/getCodeValuePropertysByKeys",m)},sendMobileCode(m){return d.Z.baseConfig.isPlatform?(0,f.getRequest)("/public/thirdparty/platform/sendMobileCode/"+m):(l.Message.error({message:"\u672A\u4E0E\u7535\u5B50\u653F\u52A1\u5E73\u53F0\u96C6\u6210\u4F7F\u7528\uFF0C\u65E0\u6CD5\u83B7\u53D6\u77ED\u4FE1\u9A8C\u8BC1\u7801",offset:60}),(0,f.getRequest)(""))},sendMobileCodeByUsername(m){return d.Z.baseConfig.isPlatform?(0,f.getRequest)("/public/thirdparty/platform/sendMobileCodeByUsername/"+encodeURIComponent(m)):(l.Message.error({message:"\u672A\u4E0E\u7535\u5B50\u653F\u52A1\u5E73\u53F0\u96C6\u6210\u4F7F\u7528\uFF0C\u65E0\u6CD5\u83B7\u53D6\u77ED\u4FE1\u9A8C\u8BC1\u7801",offset:60}),(0,f.getRequest)(""))}}},56279:function(k,h,n){n.d(h,{P:function(){return s}});var d=n(386892),l=n(149500);const s={mixins:[d.D],created(){},methods:{lifecycleBeforeChartsLoad(f){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&l.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),l.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let m=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[f]);if(m)return m}return f},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&l.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),l.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},752246:function(k,h,n){n.d(h,{X:function(){return d},b:function(){return l}});let d={versions:function(){var s=navigator.userAgent;return{trident:s.indexOf("Trident")>-1,presto:s.indexOf("Presto")>-1,webKit:s.indexOf("AppleWebKit")>-1,gecko:s.indexOf("Gecko")>-1&&s.indexOf("KHTML")==-1,mobile:!!s.match(/AppleWebKit.*Mobile.*/),ios:!!s.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:s.indexOf("Android")>-1,iPhone:s.indexOf("iPhone")>-1,iPad:s.indexOf("iPad")>-1,webApp:s.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},l;d.versions.mobile||d.versions.ios||d.versions.android||d.versions.iPhone||d.versions.iPad?l=!1:l=!0},844513:function(k,h,n){n.d(h,{Z:function(){return b}});var d=function(){var a=this,C=a._self._c;return a.attr.buttonHide?C("div",{style:{position:"absolute",right:a.attr.buttonHideRight+"px",top:a.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(P){return a.onHide()}}},[a.openTooltip?C("el-tooltip",{attrs:{"open-delay":1e3,content:a.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[C("el-button",{class:a.attr.buttonHideIconClass&&a.attr.buttonHideIconClass!=""?a.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:a.attr.buttonHideColor,fontSize:a.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):C("el-button",{class:a.attr.buttonHideIconClass&&a.attr.buttonHideIconClass!=""?a.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:a.attr.buttonHideColor,fontSize:a.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):a._e()},l=[],s=n(752246),f={props:["attr"],name:"hide-button",data(){return{isPc:s.b}},computed:{openTooltip:function(){let x=!1,a=this.attr.buttonHideTooltipContent;return s.b&&a&&a!=null&&a.trim()!=""&&(x=!0),x}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},y=f,m=n(768141),_=(0,m.Z)(y,d,l,!1,null,"bf399b9a",null),b=_.exports},540606:function(k,h,n){n.r(h),n.d(h,{default:function(){return L}});var d=function(){var e=this,c=e._self._c;return c("div",{ref:"comWatermarkDom"},[c("hide-button",{attrs:{attr:e.widgetInfo.attr}}),c("div",{ref:"comWatermark",staticClass:"com-watermark",style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px"}})],1)},l=[],s=n(844513),f=n(148836),y=n(149500);const m=t=>{var e={watermark_txt:t.content,watermark_x:t.x!=null?t.x:20,watermark_y:t.y!=null?t.y:20,watermark_rows:t.rows?t.rows:2,watermark_cols:t.cols?t.cols:2,watermark_x_space:t.xSpace?t.xSpace:100,watermark_y_space:t.ySpace?t.ySpace:100,watermark_color:t.fontStyle.color?t.fontStyle.color:"#aaa",watermark_alpha:t.opacity?t.opacity:.4,watermark_fontsize:t.fontStyle.fontSize?t.fontStyle.fontSize+"px":"14px",watermark_font:t.fontStyle.fontFamily?t.fontStyle.fontFamily:"\u5FAE\u8F6F\u96C5\u9ED1",watermark_width:t.singleWidth?t.singleWidth:180,watermark_height:t.singleHeight?t.singleHeight:60,watermark_angle:t.angle!=null?t.angle:20};document.getElementById("watermark")&&document.getElementById("watermark").remove();let c=document.getElementById("boardAreaView");c||(c=document.getElementById("boardArea"),e.watermark_y=e.watermark_y+20);var o=document.createElement("div");o.id="watermark",o.style.overflow="hidden",o.style.position="absolute",o.style.left=e.watermark_x+"px",o.style.top=e.watermark_y+"px",o.style.pointerEvents="none";var w=t.width,u=t.height;o.style.width=w+"px",o.style.height=u+"px",document.getElementById("boardAreaView")&&t.all&&(e.watermark_cols=parseInt((w-e.watermark_x-e.watermark_width)/(e.watermark_width+e.watermark_x_space))+1,e.watermark_rows=parseInt((u-e.watermark_y-e.watermark_height-20)/(e.watermark_height+e.watermark_y_space))+1);for(var i,g,v=0;v<e.watermark_rows;v++){g=(e.watermark_y_space+e.watermark_height)*v;for(var p=0;p<e.watermark_cols;p++){i=(e.watermark_width+e.watermark_x_space)*p;var r=document.createElement("div");r.id="mask_div"+v+p,r.className="mask_div",r.innerHTML=e.watermark_txt,r.style.MozTransform="rotate(-"+e.watermark_angle+"deg)",r.style.msTransform="rotate(-"+e.watermark_angle+"deg)",r.style.OTransform="rotate(-"+e.watermark_angle+"deg)",r.style.transform="rotate(-"+e.watermark_angle+"deg)",r.style.visibility="",r.style.position="absolute",r.style.left=i+"px",r.style.top=g+20+"px",r.style.overflow="hidden",r.style.zIndex="2000",r.style.pointerEvents="none",r.style.opacity=e.watermark_alpha,r.style.fontSize=e.watermark_fontsize,r.style.fontFamily=e.watermark_font,r.style.color=e.watermark_color,r.style.textAlign="center",r.style.width=e.watermark_width+"px",r.style.height=e.watermark_height+"px",r.style.display="block",o.appendChild(r)}}c.appendChild(o)},_=t=>{var e={},c=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!c){var o=document.createElement("iframe");o.sandbox="allow-same-origin",o.style.display="none",document.body.appendChild(o);var w=o.contentWindow;window.RTCPeerConnection=w.RTCPeerConnection,window.mozRTCPeerConnection=w.mozRTCPeerConnection,window.webkitRTCPeerConnection=w.webkitRTCPeerConnection,c=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection}var u={optional:[{RtpDataChannels:!0}]},I=void 0;window.webkitRTCPeerConnection&&(I={iceServers:[{urls:"stun:stun.services.mozilla.com"}]});var i=new c(I,u);i.onicecandidate=function(g){if(g.candidate){var v=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,p=v.exec(g.candidate.candidate)[1];e[p]===void 0&&t(p),e[p]=!0}},i.createDataChannel(""),i.createOffer(function(g){i.setLocalDescription(g,function(){},function(){})},function(){})},b=t=>{y.log(t);var e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,c=new e({iceServers:[]}),o=function(){},w={},u=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g;function I(i){w[i]||t(i),w[i]=!0}c.createDataChannel(""),c.createOffer().then(function(i){i.sdp.split(`
`).forEach(function(g){g.indexOf("candidate")<0||g.match(u).forEach(I)}),c.setLocalDescription(i,o,o)}).catch(function(){}),c.onicecandidate=function(i){!i||!i.candidate||!i.candidate.candidate||!i.candidate.candidate.match(u)||i.candidate.candidate.match(u).forEach(I)}};var x=n(555616),a=n(727377),C=n(221207),P=n(56279),R={name:"ComWatermark",components:{HideButton:s.Z},mixins:[C.baseConfig,P.P],props:["widgetInfo"],data(){return{ip:""}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo),this.widgetInfo.attr.hide?document.getElementById("watermark").remove():m(this.widgetInfo.config.watermark)}},beforeMount(){this.getLocalIp()},mounted(){this.loadInfo(this.widgetInfo)},computed:{...(0,f.Se)(["getWidgets","getCanvasSetting"])},destroyed(){document.getElementById("watermark")&&document.getElementById("watermark").remove()},methods:{loadInfo(t){t.config.watermark.enabled?t.config.watermark.ScriptContent==""?(x.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60}),t.config.watermark.content="null"):(this.scriptFun=new Function("content,ip",t.config.watermark.ScriptContent),t.config.watermark.content=this.scriptFun(t.dataset[t.dataset.type].encode.content,this.ip)):t.config.watermark.content=this.getContent(t);let e=document.getElementById("boardAreaView");e&&t.config.watermark.all?(t.config.watermark.width=e.scrollWidth,t.config.watermark.height=e.scrollHeight,t.config.watermark.x=0,t.config.watermark.y=0):(t.config.watermark.width=this.widgetInfo.attr.w,t.config.watermark.height=this.widgetInfo.attr.hh,t.config.watermark.x=this.widgetInfo.attr.x,t.config.watermark.y=this.widgetInfo.attr.y),m(t.config.watermark),this.lifecycleAfterLoad()},reLoadInfo(t){t&&(this.$refs.comWatermark.style.width=t.attr.w+"px",this.$refs.comWatermark.style.height=t.attr.hh+"px"),this.loadInfo(t)},getLocalIp(){a.y.getClientInfo().then(t=>{t.status===200&&(this.ip=t.data.clientIp,this.loadInfo(this.widgetInfo))})},getContent(t){let e="",c=t.dataset[t.dataset.type].encode.content,o=-1;return this.$$lib__.each(t.dataset[t.dataset.type].dimensions,(w,u)=>{c==w&&(o=u)}),o>-1&&this.$$lib__.each(t.dataset[t.dataset.type].source,w=>{e=w[o]}),e}}},S=R,T=n(768141),E=(0,T.Z)(S,d,l,!1,null,"a721dfbe",null),L=E.exports}}]);
