(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[65594],{211227:function(D,b,c){var g=c(149500),y,A,C;(function(l,E){A=[],y=E,C=typeof y=="function"?y.apply(b,A):y,C!==void 0&&(D.exports=C)})(this,function(){"use strict";function l(u,h){return typeof h>"u"?h={autoBom:!1}:typeof h!="object"&&(g.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)?new Blob(["\uFEFF",u],{type:u.type}):u}function E(u,h,v){var t=new XMLHttpRequest;t.open("GET",u),t.responseType="blob",t.onload=function(){x(t.response,h,v)},t.onerror=function(){g.error("could not download file")},t.send()}function F(u){var h=new XMLHttpRequest;h.open("HEAD",u,!1);try{h.send()}catch{}return 200<=h.status&&299>=h.status}function f(u){try{u.dispatchEvent(new MouseEvent("click"))}catch{var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(h)}}var R=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof c.g=="object"&&c.g.global===c.g?c.g:void 0,U=R.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),x=R.saveAs||(typeof window!="object"||window!==R?function(){}:"download"in HTMLAnchorElement.prototype&&!U?function(u,h,v){var t=R.URL||R.webkitURL,r=document.createElement("a");h=h||u.name||"download",r.download=h,r.rel="noopener",typeof u=="string"?(r.href=u,r.origin===location.origin?f(r):F(r.href)?E(u,h,v):f(r,r.target="_blank")):(r.href=t.createObjectURL(u),setTimeout(function(){t.revokeObjectURL(r.href)},4e4),setTimeout(function(){f(r)},0))}:"msSaveOrOpenBlob"in navigator?function(u,h,v){if(h=h||u.name||"download",typeof u!="string")navigator.msSaveOrOpenBlob(l(u,v),h);else if(F(u))E(u,h,v);else{var t=document.createElement("a");t.href=u,t.target="_blank",setTimeout(function(){f(t)})}}:function(u,h,v,t){if(t=t||open("","_blank"),t&&(t.document.title=t.document.body.innerText="downloading..."),typeof u=="string")return E(u,h,v);var r=u.type==="application/octet-stream",e=/constructor/i.test(R.HTMLElement)||R.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||r&&e||U)&&typeof FileReader<"u"){var n=new FileReader;n.onloadend=function(){var o=n.result;o=a?o:o.replace(/^data:[^;]*;/,"data:attachment/file;"),t?t.location.href=o:location=o,t=null},n.readAsDataURL(u)}else{var s=R.URL||R.webkitURL,i=s.createObjectURL(u);t?t.location=i:location.href=i,t=null,setTimeout(function(){s.revokeObjectURL(i)},4e4)}});R.saveAs=x.saveAs=x,D.exports=x})},165594:function(D,b,c){"use strict";var g=c(149500),y=c(419534);Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var A=y(c(578756)),C=y(c(66273)),l=y(c(342579)),E=y(c(122777)),F=y(c(42762)),f=c(159602),R=y(c(869787)),U=c(211227),x=function(){function h(v,t){(0,E.default)(this,h),this.shinegaUrl=v,this.shinegaDatabaseId=t}return(0,F.default)(h,[{key:"importFile",value:function(t){var r=this,e=t.files,a=t.wkid,n=t.fromwkid,s=t.token,i=new FormData;e.forEach(function(d){(0,l.default)(this,r),i.append("files",d.raw)}.bind(this)),i.append("wkid",a),n&&i.append("fromwkid",n),i.append("shapeonly",!1);var o={headers:{"Content-Type":"multipart/form-data"},token:s};return new A.default(function(d,m){var p=this;(0,l.default)(this,r),(0,f.postFromAdmin)(this.shinegaUrl,i,o).then(function(w){(0,l.default)(this,p);var k=(0,f.parseGaResult)(w);d(k)}.bind(this)).catch(function(w){(0,l.default)(this,p),this._handleError(w,m)}.bind(this))}.bind(this))}},{key:"exportFile",value:function(t){var r=this,e=t.wkts,a=t.extension,n=t.filename,s=t.exportFileExt,i=t.wkid,o=t.token,d=new FormData;return d.append("wkts",(0,C.default)(e)),d.append("extension",a),d.append("filename",n),d.append("wkid",i),new A.default(function(m,p){var w=this;(0,l.default)(this,r),(0,f.postFromAdmin)(this.shinegaUrl,d,{token:o}).then(function(k){if((0,l.default)(this,w),k=k.headers?k.data:k,k.success){var O=this._dataURLtoBlob(k.result);(0,U.saveAs)(O,n+s),m("\u5BFC\u51FA\u6210\u529F")}else typeof k=="string"?this._exportFile({wkts:e,extension:a,filename:n,exportFileExt:s,wkid:i,token:o},m,p):p(new Error("\u5BFC\u51FA\u9519\u8BEF:"+k.description))}.bind(this)).catch(function(k){(0,l.default)(this,w),g.error(k),p(new Error("\u5BFC\u51FA\u9519\u8BEF"))}.bind(this))}.bind(this))}},{key:"getArea",value:function(t,r){var e=this,a={headers:{"Content-Type":"application/json"},token:r,params:{spheroid:!1}};return new A.default(function(n){var s=this;(0,l.default)(this,e),(0,f.postFromAdmin)(this.shinegaUrl+"/geometry/util/area",t,a).then(function(i){(0,l.default)(this,s);var o=(0,f.parseGaResult)(i);n(o)}.bind(this)).catch(function(){(0,l.default)(this,s),n()}.bind(this))}.bind(this))}},{key:"getPrimaryKey",value:function(t){var r=this,e=t.layerTable,a=t.token;return new A.default(function(n,s){var i=this;(0,l.default)(this,r),(0,f.postFromAdmin)(this.shinegaUrl+"/primaryKey",R.default.stringify({tableName:e}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},token:a,shinegaDatabaseId:this.shinegaDatabaseId}).then(function(o){(0,l.default)(this,i);var d=(0,f.parseGaResult)(o);n(d)}.bind(this)).catch(function(o){(0,l.default)(this,i),this._handleError(o,s)}.bind(this))}.bind(this))}},{key:"save",value:function(t){var r=this,e=t.features,a=t.options,n=t.ruleOptions,s=t.token;return new A.default(function(i,o){var d=this;(0,l.default)(this,r);var m=new FormData;m.append("features",(0,C.default)(e)),a?m.append("options",(0,C.default)(a)):m.append("options","{}"),n&&m.append("ruleOptions",n),(0,f.postFromAdmin)(this.shinegaUrl+"/edit/save",m,{headers:{"Content-Type":"application/x-www-form-urlencoded"},token:s,shinegaDatabaseId:this.shinegaDatabaseId}).then(function(p){(0,l.default)(this,d);var w=(0,f.parseGaResult)(p);i(w)}.bind(this)).catch(function(p){(0,l.default)(this,d),this._handleError(p,o)}.bind(this))}.bind(this))}},{key:"delete",value:function(t){var r=this,e=t.featureClass,a=t.filterWhere,n=t.deleteOptions,s=t.ruleOptions,i=t.token;return new A.default(function(o,d){var m=this;(0,l.default)(this,r);var p=new FormData;p.append("featureClass",e),p.append("filterWhere",a),n?p.append("options",(0,C.default)(n)):p.append("options","{}"),s&&p.append("ruleOptions",s),(0,f.postFromAdmin)(this.shinegaUrl+"/edit/delete",p,{headers:{"Content-Type":"application/x-www-form-urlencoded"},token:i,shinegaDatabaseId:this.shinegaDatabaseId}).then(function(w){(0,l.default)(this,m);var k=(0,f.parseGaResult)(w);o(k)}.bind(this)).catch(function(w){(0,l.default)(this,m),w.message.indexOf("405")>-1?this._deleteUseGet({featureClass:e,filterWhere:a,deleteOptions:n,token:i,resolve:o,reject:d}):this._handleError(w,d)}.bind(this))}.bind(this))}},{key:"split",value:function(t){var r=this,e=t.features,a=t.splitLine,n=t.token;return new A.default(function(s,i){var o=this;(0,l.default)(this,r);var d=this.shinegaUrl+"/geometry/util/split";(0,f.postFromAdmin)(d,e,{headers:{"Content-Type":"application/json;charset=UTF-8"},params:{line:a},token:n}).then(function(m){(0,l.default)(this,o);var p=(0,f.parseGaResult)(m);s(p)}.bind(this)).catch(function(m){(0,l.default)(this,o),this._handleError(m,i)}.bind(this))}.bind(this))}},{key:"_exportFile",value:function(t,r,e){var a=this,n=t.wkts,s=t.extension,i=t.filename,o=t.exportFileExt,d=t.wkid,m=t.token,p=new FormData;p.append("wkts",(0,C.default)(n)),p.append("extension",s),p.append("filename",i),p.append("wkid",d),(0,f.postFromAdmin)(this.shinegaUrl,p,{responseType:"arraybuffer",token:m}).then(function(w){if((0,l.default)(this,a),w=w.headers?w.data:w,w){var k=new Blob([w]);(0,U.saveAs)(k,i+o),r("\u5BFC\u51FA\u6210\u529F")}else e(new Error("\u5BFC\u51FA\u9519\u8BEF"))}.bind(this)).catch(function(w){(0,l.default)(this,a),g.error(w),e(new Error("\u5BFC\u51FA\u9519\u8BEF"))}.bind(this))}},{key:"_deleteUseGet",value:function(t){var r=this,e=t.featureClass,a=t.filterWhere,n=t.deleteOptions,s=t.token,i=t.resolve,o=t.reject;(0,f.getFromAdmin)(this.shinegaUrl+"/edit/delete",{params:{featureClass:e,filterWhere:a,deleteOptions:n},token:s,shinegaDatabaseId:this.shinegaDatabaseId}).then(function(d){(0,l.default)(this,r);var m=(0,f.parseGaResult)(d);i(m)}.bind(this)).catch(function(d){(0,l.default)(this,r),this._handleError(d,o)}.bind(this))}},{key:"_dataURLtoBlob",value:function(t){for(var r=atob(t),e=r.length,a=new Uint8Array(e);e--;)a[e]=r.charCodeAt(e);return new Blob([a])}},{key:"_handleError",value:function(t,r){g.error(t);var e="";t.response?e=t.response.data.message:e=t.message,r(new Error("\u5BFC\u5165\u9519\u8BEF:"+e))}}]),h}(),u=x;b.default=u},159602:function(D,b,c){"use strict";var g=c(419534);Object.defineProperty(b,"__esModule",{value:!0}),b.get=R,b.getFromAdmin=x,b.imgUrlConvert=r,b.parseError=v,b.parseGaResult=t,b.parseResult=h,b.post=U,b.postFromAdmin=u;var y=g(c(342579)),A=g(c(578756)),C=g(c(66273)),l=g(c(143939)),E=g(c(705146)),F=g(c(10299)),f="Bearer";function R(e,a){var n=this;return new A.default(function(s,i){var o=this;(0,y.default)(this,n),F.default.get(e,{params:a}).then(function(d){(0,y.default)(this,o),s(d.data)}.bind(this)).catch(function(d){(0,y.default)(this,o),i(d.data)}.bind(this))}.bind(this))}function U(e,a){var n=this;return new A.default(function(s,i){var o=this;(0,y.default)(this,n),F.default.post(e,(0,C.default)(a)).then(function(d){(0,y.default)(this,o),s(d.data)}.bind(this)).catch(function(d){(0,y.default)(this,o),i(d.data)}.bind(this))}.bind(this))}function x(e,a){return a.headers||(a.headers={"Content-Type":"application/json"}),a.token&&(a.headers["X-Gisq-Token"]=f+" "+a.token),a.shinegaDatabaseId&&(a.headers.dataid=a.shinegaDatabaseId),a.applicationId&&(a.headers.ApplicationId=a.applicationId),F.default.get(e,a)}function u(e,a,n){return n.headers||(n.headers={"Content-Type":"application/json"}),n.token&&(n.headers["X-Gisq-Token"]=f+" "+n.token),n.shinegaDatabaseId&&(n.headers.dataid=n.shinegaDatabaseId),n.applicationId&&(n.headers.ApplicationId=n.applicationId),F.default.post(e,a,n)}function h(e){if(e.data.code==="0000"||e.data.code===200){var a=e.data;return{success:!0,data:a.result?a.result:a.data}}else{var n=e.data.description?e.data.description:e.data.message;return{success:!1,message:n}}}function v(e){var a=e.response,n=a.data.description?a.data.description:a.data.message,s;return a.status===401?s=n||"\u7528\u6237\u6821\u9A8C\u5931\u8D25":s=n||"\u672A\u77E5\u9519\u8BEF, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",s}function t(e){var a=this;e=e.headers?e.data:e;var n=!0;if(e.code?n=e.code==="0000":e.message&&(n=e.message==="success"),n){var s=e.result?e.result:e.data;if(s.error)return{success:!1,message:s.error};if(s.IsSucess===!1){var i="";return s.EditErrors.forEach(function(d){(0,y.default)(this,a),i+=d.ErrorMsg+"<br/>"}.bind(this)),{success:!1,message:i}}else return{success:!0,data:s}}else{var o=e.description?e.description:e.message;return{success:!1,message:o}}}function r(e,a,n){var s,i=e,o="[adminserverstatic]";if(((s=i)===null||s===void 0?void 0:s.indexOf(o))>-1)if(i=i.replace(o,""),n){var d,m,p,w="app_"+(0,l.default)(d=n.toLowerCase()).call(d,"-","");i=(0,E.default)(m=(0,E.default)(p="".concat(a,"/files/")).call(p,w,"/")).call(m,i)}else{var k;i=(0,E.default)(k="".concat(a,"/files/shinegisclient/")).call(k,i)}return i}},122777:function(D){function b(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function")}D.exports=b,D.exports.__esModule=!0,D.exports.default=D.exports},42762:function(D,b,c){var g=c(857448),y=c(168871);function A(l,E){for(var F=0;F<E.length;F++){var f=E[F];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),g(l,y(f.key),f)}}function C(l,E,F){return E&&A(l.prototype,E),F&&A(l,F),g(l,"prototype",{writable:!1}),l}D.exports=C,D.exports.__esModule=!0,D.exports.default=D.exports}}]);
