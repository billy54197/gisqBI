"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[5436],{56279:function(b,g,n){n.d(g,{P:function(){return p}});var v=n(86892),c=n(49500);const p={mixins:[v.D],created(){},methods:{lifecycleBeforeChartsLoad(f){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&c.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),c.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let u=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[f]);if(u)return u}return f},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&c.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),c.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},5436:function(b,g,n){n.r(g),n.d(g,{default:function(){return x}});var v=function(){var e=this,t=e._self._c;return t("div",{ref:"plaIntRef"},[t("span",[e._v("\u4E2D\u53F0\u4EA4\u4E92")])])},c=[],p=n(27966),f=n(26711),I=n(45061),u=n(56279),L=n(48836),C=n(35051),w=n(31954),y=n(21300),W=n(55946),d=n(49500),S={props:["widgetInfo"],name:"platform-interactive",mixins:[f.H,I.u,u.P],computed:{...(0,L.Se)(["getCanvasSettingInfo","getCanvasSetting","getWidgets"])},data(){return{widgetsList:[]}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo),this.widgetInfo.config&&this.widgetInfo.config.checkUserOnline&&this.doUserOnline()},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(i){window.location.href.indexOf("editor.html")>-1?this.widgetInfo.attr.hide=!1:this.widgetInfo.attr.hide=!0,this.lifecycleAfterLoad()},reLoadInfo(i){this.loadInfo(i)},initAction(i){this.actionReceive(i)},actionReceive(i){this.widgetsList=this.getWidgetsList();let e=i.action.receive.logout;e&&e.enabled&&this.doLogout(e.logoutList,i)},doLogout(i,e){this.$$lib__.each(i,t=>{let a=t[0][0],s=t[0][1],l=t[0][2];if(l){let o=l.indexOf("|");o>-1&&(l=t[0][2].substring(o+1))}p.Z.$on(s,o=>{o||(o={}),o.widget_key=a,o.widget_name=this.getNameByKey(a),o.action_key=s,o.action_name=this.getNameByKey(s),e.action.receive.logout.script&&e.action.receive.logout.script.enabled?(d.log("Execute the script to execute model to the "+e.name+" component"),new Function("selfInfo",e.action.receive.logout.script.content).apply(this,[e])):(0,C.authenticationFailed)(!0)})})},doUserOnline(){if(window.loginWebsocket||window.location.pathname.indexOf("editor.html")>-1)return;let i=y.getStoreUserInfo(),e="65418c9fe068",t=typeof i=="string"?JSON.parse(i):null;if(t==null)return d.log("\u7528\u6237\u5728\u7EBF\u4FE1\u606Fsocket\u8FDE\u63A5\u5931\u8D25\uFF0C\u672A\u80FD\u627E\u5230\u7528\u6237\u4FE1\u606F");var a={username:t.user_name,logintype:y.isMobile()?"APP":"PC",key:"mac",devicetype:"",userId:t.user_id,requestUrl:window.bi.config.publishUrl,staffName:decodeURI(t.user_nickname),subGuid:W.Z.state.index.application.applicationId};let s=this.mUtils.AES.encrypt(JSON.stringify(a),"gisq"+e),l=w.Z.baseConfig.domain.indexOf("://")===-1?window.location.origin+(w.Z.baseConfig.domain.startsWith("/")?"":"/")+w.Z.baseConfig.domain:w.Z.baseConfig.domain,o=new URL(l);o.protocol=o.protocol=="https:"?"wss:":"ws:",window.loginWebsocket=window.loginWebsocket||function(m,$){let B=m+(m.endsWith("/")?"":"/")+"websocket/"+$,r=new WebSocket(B);return r.onmessage=function(h){d.log("websocket",h)},r.onopen=function(){window.loginWebsocketHeartBeat&&window.clearInterval(window.loginWebsocketHeartBeat),window.loginWebsocketHeartBeat=window.setInterval(function(){r.send("ping")},45e3)},r.onerror=function(h){d.log("\u9519\u8BEF",h)},r.onclose=function(h){d.log("\u65AD\u5F00\u8FDE\u63A5",h),window.loginWebsocketHeartBeat&&window.clearInterval(window.loginWebsocketHeartBeat)},r}(""+o,s)},getWidgetsList(){let i=[];for(let e in this.getWidgets){let t=this.getWidgets[e];if(t.action&&t.action.sendOut&&t.action.sendOut.actionList){let a=[];this.$$lib__.each(t.action.sendOut.actionList,s=>{let l={value:s.code+"_"+e,label:s.name};if(this.is_bind_param){l.children=[];for(let o in s.params)l.children.push({value:s.code+"_"+e+"|"+o,label:o})}a.push(l)}),a.length>0&&i.push({value:t.id,label:t.name,children:a})}}if(this.getCanvasSetting.action&&this.getCanvasSetting.action.sendOut){let e=[];this.$$lib__.each(this.getCanvasSetting.action.sendOut.actionList,t=>{let a={value:t.code+"_canvas",label:t.name};if(this.is_bind_param){a.children=[];for(let s in t.params)a.children.push({value:t.code+"_canvas|"+s,label:s})}e.push(a)}),e.length>0&&i.push({value:this.$$global.sysGuid.datavisual.canvasId,label:this.$$global.sysGuid.datavisual.canvasName,children:e})}return i},getNameByKey(i){d.log(this.widgetsList);let e="";return this.widgetsList.forEach(function(t){t.value==i&&(e=t.label),e==""&&t.children.forEach(function(a){a.value==i&&(e=a.label)})}),e}}},O=S,k=n(68141),U=(0,k.Z)(O,v,c,!1,null,"29de915a",null),x=U.exports}}]);
