"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[14407],{56279:function(y,c,r){r.d(c,{P:function(){return l}});var d=r(386892),f=r(149500);const l={mixins:[d.D],created(){},methods:{lifecycleBeforeChartsLoad(h){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&f.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let m=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[h]);if(m)return m}return h},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&f.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},752246:function(y,c,r){r.d(c,{X:function(){return d},b:function(){return f}});let d={versions:function(){var l=navigator.userAgent;return{trident:l.indexOf("Trident")>-1,presto:l.indexOf("Presto")>-1,webKit:l.indexOf("AppleWebKit")>-1,gecko:l.indexOf("Gecko")>-1&&l.indexOf("KHTML")==-1,mobile:!!l.match(/AppleWebKit.*Mobile.*/),ios:!!l.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:l.indexOf("Android")>-1,iPhone:l.indexOf("iPhone")>-1,iPad:l.indexOf("iPad")>-1,webApp:l.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},f;d.versions.mobile||d.versions.ios||d.versions.android||d.versions.iPhone||d.versions.iPad?f=!1:f=!0},844513:function(y,c,r){r.d(c,{Z:function(){return I}});var d=function(){var o=this,p=o._self._c;return o.attr.buttonHide?p("div",{style:{position:"absolute",right:o.attr.buttonHideRight+"px",top:o.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(x){return o.onHide()}}},[o.openTooltip?p("el-tooltip",{attrs:{"open-delay":1e3,content:o.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[p("el-button",{class:o.attr.buttonHideIconClass&&o.attr.buttonHideIconClass!=""?o.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:o.attr.buttonHideColor,fontSize:o.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):p("el-button",{class:o.attr.buttonHideIconClass&&o.attr.buttonHideIconClass!=""?o.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:o.attr.buttonHideColor,fontSize:o.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):o._e()},f=[],l=r(752246),h={props:["attr"],name:"hide-button",data(){return{isPc:l.b}},computed:{openTooltip:function(){let g=!1,o=this.attr.buttonHideTooltipContent;return l.b&&o&&o!=null&&o.trim()!=""&&(g=!0),g}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},w=h,m=r(768141),P=(0,m.Z)(w,d,f,!1,null,"bf399b9a",null),I=P.exports},814407:function(y,c,r){r.r(c),r.d(c,{default:function(){return M}});var d=function(){var t=this,e=t._self._c;return e("div",{ref:"titleFlip",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[e("hide-button",{attrs:{attr:t.widgetInfo.attr}}),e("iframe",{ref:"myIframe",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px",verticalAlign:"top"},attrs:{id:"my_iframe_"+t.widgetInfo.id,src:t.url,frameborder:!t.widgetInfo.config.frameborder,scrolling:t.widgetInfo.config.scrolling}})],1)},f=[],l=r(844513),h=r(616739),w=r(126711),m=r(445061),P=r(56279),I=r(927966),g=r(555616),o=r(148836),p=r(42160),x=r(275770),b=r(149500),L={name:"AllIframe",components:{HideButton:l.Z},mixins:[h.baseConfig,w.H,m.u,P.P],props:["widgetInfo"],computed:{...(0,o.Se)(["getCanvasSetting","getURLParams"]),url:function(){return this.loaded?this.urlInfo.url:this.widgetInfo.attr.hide&&this.widgetInfo.config.loadOnShow?"":(this.loaded=!0,this.urlInfo.url)}},data(){return{loaded:!1,globalEditor:this.$$global_editor,urlInfo:{url:null,host:"",params:{}}}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)},"widgetInfo.config.url":function(){this.getUrlInfo()}},mounted(){this.loadInfo(this.widgetInfo),this.initAction(this.widgetInfo)},methods:{...(0,o.nv)(["addChildInitFinish"]),loadInfo(i){this.getUrlInfo(),b.debug(i),this.lifecycleAfterLoad()},reLoadInfo(i){this.loadInfo(i)},initAction(i){this.actionSendout(i),this.actionReceive(i),this.actionReceiveSelf(i)},actionSendout(i){let t=this;this.$$lib__.each(i.action.sendOut.actionList,e=>{if(e.enabled&&e.code==x.default.listenerMessage.code){let a=e.code+"_"+i.id,n={};if(e.paramsExtend&&e.paramsExtend.length>0){let s=[];t.widgetInfo.dataset[t.widgetInfo.dataset.type].source&&t.widgetInfo.dataset[t.widgetInfo.dataset.type].source.length>0&&(s=t.widgetInfo.dataset[t.widgetInfo.dataset.type].source[0]),this.getExtendParams(n,e.paramsExtend,s,t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions)}window.addEventListener("message",s=>{if(n=t.getParam(n,s.data),e.script&&e.script.enabled){if(b.log("Execute script for "+e.name+" action"),e.script.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param,data",e.script.content),n=this.customScript(n,s.data)}s.origin==window.origin?s.source&&s.source.frameElement&&s.source.frameElement.id=="my_iframe_"+i.id&&(I.Z.$emit(a,n),e.postMessage&&this.doPostMessage(n)):(I.Z.$emit(a,n),e.postMessage&&this.doPostMessage(n))}),this.actionNameList.push(a)}})},actionReceiveSelf(i){if(i.action==null||i.action.receive==null)return;let t=i.action.receive.postMessage;if(t&&t.enabled&&t.postList&&t.postList.length>0){let a=i.action.receive.postMessage.targetOrigin;this.postMessage(i.action.receive.postMessage.postList,a,t.script,i.name)}let e=i.action.receive.replaceUrlParams;if(e&&e.enabled&&e.replaceList&&e.replaceList.length>0){let a=e.replaceList;this.doUrlParams(a,i)}this.addChildInitFinish()},postMessage(i,t,e,a){let n=this;this.$$lib__.each(i,s=>{if(s[0].length>=2){let u=s[0][1]+"_"+s[0][0];s[0][1].indexOf("_")>-1&&(u=s[0][1]),I.Z.$on(u,v=>{if(e&&e.enabled){if(b.log("Execute script for "+a+" component to postMessage component"),e.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}n.sendPostMessage=new Function("data,origin",e.content)}n.sendPostMessage(v,t)})}})},sendPostMessage(i,t){this.$refs.myIframe.contentWindow.postMessage(i,t)},doUrlParams(i,t){let e={};if(this.$$lib__.each(i,a=>{let n=a.replaceParam;for(let s=0;s<n.length;s++)if(n[s].length==3){let u=n[s][1]+"_"+n[s][0],v=n[s][2],C=v.indexOf("|");n[s][1].indexOf("_")>-1&&(u=n[s][1]),C>-1&&(v=n[s][2].substring(C+1)),n[s][0]!=x.default.global.code?(e[u]||p.default.set(e,u,{}),e[u][a.param]||p.default.set(e[u],a.param,v)):this.replaceGlobalParams(a.param,v)}}),!this.$$lib__.isEmpty(e))for(let a in e)I.Z.$on(a,n=>{if(t.action.receive.replaceUrlParams.script&&t.action.receive.replaceUrlParams.script.enabled){if(b.log("Execute script for "+t.name+" component to replace UrlParams parameters"),t.action.receive.replaceUrlParams.script.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.doReplaceUrlParams=new Function("info","data","param_key",t.action.receive.replaceUrlParams.script.content),b.log("Replace UrlParams parameter of "+t.name+" component Script execution complete")}this.doReplaceUrlParams(t,n,e[a])})},doReplaceUrlParams(i,t,e){if(!this.$$lib__.isEmpty(this.urlInfo.params)&&this.urlInfo.host!=""){for(let a in e)for(let n in this.urlInfo.params)if(n==a){let s=e[a];this.urlInfo.params[n]=t[s]}this.urlInfo.url=this.urlInfo.host;for(let a in this.urlInfo.params)this.urlInfo.url=this.urlInfo.url+"&"+a+"="+this.urlInfo.params[a]}},replaceGlobalParams(i,t){let e=this.getGlobalParamsValue(t);if(!this.$$lib__.isEmpty(this.urlInfo.params)&&this.urlInfo.host!=""){this.urlInfo.params[i]=e,this.urlInfo.url=this.urlInfo.host;for(let a in this.urlInfo.params)this.urlInfo.url=this.urlInfo.url+"&"+a+"="+this.urlInfo.params[a]}},getGlobalParamsValue(i){if(this.getCanvasSetting==null||this.getCanvasSetting.data==null||this.getCanvasSetting.data.globalParams==null||this.getCanvasSetting.data.globalParams.paramsValue==null||this.getCanvasSetting.data.globalParams.paramsValue.length<1)return"";let t=this.$$lib__.find(this.getCanvasSetting.data.globalParams.paramsValue,a=>a.paramName==i);if(!t)return this.getCanvasSetting.data.globalParams.params[i];let e=this.getURLParams[t.urlParams];return e||(e=this.getCanvasSetting.data.globalParams.params[i]),e},getUrlInfo(){this.urlInfo.url=this.replaceParamValue(this.widgetInfo.config.url);let i=decodeURI(this.urlInfo.url),t=i.indexOf("?");if(t!=-1){this.urlInfo.host=i.substr(0,t+1);let n=i.substr(t+1).split("&");for(var e=0;e<n.length;e++)this.urlInfo.params[n[e].split("=")[0]]=decodeURI(n[e].split("=")[1])}},getParam(i,t){for(let e in i)for(let a in t)a==e&&(i[e]=t[a]);return i},replaceParamValue(i){return this.$$lib__.each(this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode,t=>{let e=new RegExp("[${]([^$]"+t.name+")[}]","g");i=i.replace(e,this.getParamValue(t))}),i},getParamValue(i){return i.type==this.globalEditor.iframeUrlParamsType.static.code?i.staticValue:i.type==this.globalEditor.iframeUrlParamsType.globalParams.code?this.getGlobalParamsValue(i.globalParamName):i.type==this.globalEditor.iframeUrlParamsType.dataSet.code&&this.widgetInfo.dataset[this.widgetInfo.dataset.type].source&&this.widgetInfo.dataset[this.widgetInfo.dataset.type].source.length>0?this.getFieldVal(this.widgetInfo.dataset[this.widgetInfo.dataset.type].source[0],this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions,i.dataSetField):""}}},S=L,$=r(768141),U=(0,$.Z)(S,d,f,!1,null,"5daa4c3a",null),M=U.exports}}]);
