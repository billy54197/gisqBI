"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[85311],{585311:function(x,d,o){o.r(d),o.d(d,{default:function(){return v}});var f=function(){var t=this,i=t._self._c;return i("div",[i("el-dialog",{staticClass:"dialog-publish",attrs:{title:"\u770B\u677F\u68C0\u6D4B","append-to-body":!0,"close-on-click-modal":!1,visible:t.dialogVisible,width:"520px"},on:{"update:visible":function(s){t.dialogVisible=s},open:t.closeDialogNotity}},[i("div",{attrs:{id:"style2"}},[i("el-badge",{staticClass:"item",attrs:{value:"\u91CD\u8981\u63D0\u9192"}},[i("span",{staticStyle:{color:"#e6a23c"}},[t._v("1.\u90E8\u5206\u914D\u7F6E\u9879\u4EC5\u7ED9\u51FA\u914D\u7F6E\u5EFA\u8BAE\uFF0C\u9700\u8981\u4EBA\u5DE5\u786E\u8BA4\u8FDB\u884C\u4FEE\u6539\u3002")]),i("br"),i("span",{staticStyle:{color:"#e6a23c"}},[t._v("2.\u4F18\u5316\u4FDD\u5B58\u540E\uFF0C\u5C06\u65E0\u6CD5\u627E\u56DE\u5DF2\u5220\u9664\u7684\u914D\u7F6E\u3002")])]),i("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"10px"},attrs:{data:t.configureOptions,height:"300px","row-key":"id",border:"",size:"mini","tree-props":{children:"children",hasChildren:"hasChildren"}},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"35"}}),i("el-table-column",{attrs:{label:"\u9009\u9879",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.name&&s.row.name.length>22?i("el-tooltip",[i("div",{staticClass:"tooltip-name",attrs:{slot:"content"},slot:"content"},[t._v(" "+t._s(s.row.name)+" "),i("br"),t._v(" "+t._s(s.row.content)+" ")]),i("span",[t._v(t._s(s.row.name.substr(0,20)+"..."))])]):i("el-tooltip",{attrs:{disabled:!s.row.content}},[i("div",{staticStyle:{"max-width":"400px"},attrs:{slot:"content"},domProps:{innerHTML:t._s(s.row.content)},slot:"content"}),i("span",[t._v(t._s(s.row.name))])])]}}])}),i("el-table-column",{attrs:{label:"\u72B6\u6001",width:"90",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.status==="\u68C0\u67E5\u4E2D"?i("span",[t._v("\u68C0\u67E5\u4E2D "),i("i",{staticClass:"el-icon el-icon-loading"})]):s.row.status==="\u53BB\u5904\u7406"?i("el-button",{style:{padding:"0px",color:t.COLORS.\u5F85\u5904\u7406},attrs:{type:"text"},on:{click:function(l){return t.doRepair(s.row)}}},[t._v(t._s(s.row.status))]):i("span",{style:{color:t.COLORS[s.row.status]}},[t._v(" "+t._s(s.row.status)+" ")])]}}])})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(s){t.dialogVisible=!1}}},[t._v("\u53D6 \u6D88")]),i("el-button",{attrs:{size:"mini",type:"primary",disabled:!t.allChecked},on:{click:t.doCheck}},[t._v(" "+t._s(t.checkedTime>0?"\u91CD\u65B0\u68C0\u6D4B":"\u5F00\u59CB\u68C0\u6D4B")+" ")])],1)])],1)},g=[],c=o(148836),m=o(555616),p=o(113067),h=o(149500),C={name:"board-config-checker",data(){return{COLORS:{\u5F85\u5904\u7406:"#e6a23c",\u672A\u9009\u4E2D:"#909399",\u901A\u8FC7:"#67c23a",\u5DF2\u5904\u7406:"#67c23a"},dialogVisible:!1,checkAll:!1,isIndeterminate:!0,checkedTime:0,checking:!1,checkedConfigure:[],configureOptions:[{id:"ConfigRelateUrl",name:"[\u914D\u7F6E\u5EFA\u8BAE] \u5D4C\u5165\u5730\u5740\u4F7F\u7528\u76F8\u5BF9\u8DEF\u5F84",content:"bi\u3001\u8868\u5355\u7B49\u5FEB\u901F\u6784\u5EFA\u5E73\u53F0\u5185\u90E8\u5730\u5740\uFF0C\u8BF7\u4F7F\u7528 /gisqBI/view.html \u6216\u8005 ./view.html \u7B49\u76F8\u5BF9\u8DEF\u5F84",default:!0,checked:!0},{id:"CheckCompatibility",name:"[\u68C0\u67E5] \u7EC4\u4EF6\u548C\u811A\u672C\u517C\u5BB9\u6027\u68C0\u67E5",content:"\u68C0\u67E5\u7EC4\u4EF6\u914D\u7F6E\u548C\u811A\u672C\u914D\u7F6E\u4E2D\u662F\u5426\u6709\u9700\u8981\u505A\u517C\u5BB9\u6027\u4FEE\u6539\u7684\u5730\u65B9\uFF0C\u5E76\u7ED9\u51FA\u4FEE\u6539\u5EFA\u8BAE\u3002",default:!0,checked:!0},{id:"RemoveConfigData",name:"[\u4F18\u5316] \u6E05\u9664\u975E\u4F7F\u7528\u4E2D\u7684\u6570\u636E\u7ED1\u5B9A\u914D\u7F6E\u9879",content:"\u5982\u679C\u7EC4\u4EF6\u6B63\u5728\u4F7F\u7528\u52A8\u6001\u6570\u636E\uFF0C\u5219\u5C06\u9759\u6001\u6570\u636E\u7684\u914D\u7F6E\u6E05\u9664\uFF0C\u53EF\u4EE5\u51CF\u5C11\u914D\u7F6E\u5185\u5BB9\uFF0C\u63D0\u9AD8\u6027\u80FD\u3002\u4F46<strong>\u4F18\u5316\u540E\uFF0C\u4FDD\u5B58\u5728\u9759\u6001\u6570\u636E\u4E2D\u7684\u6570\u636E\u5C06\u4F1A\u88AB\u6E05\u7A7A\uFF0C\u65E0\u6CD5\u6062\u590D\uFF0C\u91CD\u65B0\u4F7F\u7528\u65F6\u9700\u8981\u91CD\u65B0\u914D\u7F6E\u3002</strong>",default:!1,checked:!0},{id:"CheckDatasetField",name:"[\u68C0\u67E5] \u6570\u636E\u96C6\u5B57\u6BB5\u6821\u9A8C",content:"\u5982\u679C\u7EC4\u4EF6\u7ED1\u5B9A\u7684\u662F\u52A8\u6001\u6570\u636E\u96C6\uFF0C\u5219\u53BB\u8BF7\u6C42\u6570\u636E\u96C6\u6570\u636E\uFF0C\u5BF9\u6BD4\u672C\u5730\u6570\u636E\u96C6\u7684\u5B57\u6BB5\u548C\u8FD4\u56DE\u7684\u6570\u636E\u96C6\u5B57\u6BB5\u662F\u5426\u6709\u5DEE\u5F02\uFF0C\u5982\u679C\u6709\u5DEE\u5F02\u5219\u8FDB\u884C\u63D0\u9192\u3002",default:!0,checked:!0}]}},computed:{...(0,c.Se)(["getCurrentBoardConfig"]),allChecked(){return this.checkedConfigure.reduce((e,t)=>e&&t&&t.checked,!0)}},watch:{allChecked:e=>{e&&m.Message.success({message:"\u770B\u677F\u68C0\u6D4B\u5B8C\u6210",offset:60})}},methods:{...(0,c.nv)(["updateBoardConfig","setCurrentWidget"]),closeDialogNotity(){window.showBoardConfigCheckerDialogNotify&&(window.showBoardConfigCheckerDialogNotify.close(),window.showBoardConfigCheckerDialogNotify=null)},doRepair(e){e.widgetId?this.setCurrentWidget(e.widgetId):this.setCurrentWidget(null),this.dialogVisible=!1,window.showBoardConfigCheckerDialog=()=>{this.dialogVisible=!0},this.closeDialogNotity(),window.showBoardConfigCheckerDialogNotify=this.$notify({dangerouslyUseHTMLString:!0,message:'<button onclick="window.showBoardConfigCheckerDialog();">\u8FD4\u56DE\u770B\u677F\u68C0\u6D4B</button>',duration:0,customClass:"bi-borad-config-checker-notify"}),e.status="\u5DF2\u5904\u7406",this.checkedConfigure.forEach(t=>{t.children&&t.children.length>0&&t.status==="\u5F85\u5904\u7406"&&t.children.findIndex(i=>i.status==="\u53BB\u5904\u7406")===-1&&(t.status="\u5DF2\u5904\u7406")})},handleSelectionChange(e){this.$set(this,"checkedConfigure",e)},toggleSelection(e){e?e.forEach(t=>{this.$refs.multipleTable.toggleRowSelection(t)}):this.$refs.multipleTable.clearSelection()},doCheck(){if(this.allChecked){if(this.configureOptions.forEach(e=>{this.$set(e,"children",[]),this.$set(e,"status","\u672A\u9009\u4E2D"),this.$set(e,"checked",!0)}),this.checkedConfigure&&this.checkedConfigure.length>0)this.checkedConfigure.forEach(e=>{e.status="\u68C0\u67E5\u4E2D",e.checked=!1});else{this.$message.info("\u8BF7\u9009\u62E9\u68C0\u67E5\u9879\u76EE");return}this.checkedTime=new Date().getTime(),this.$nextTick(()=>{let e=JSON.parse(JSON.stringify(this.getCurrentBoardConfig));this.checkedConfigure.forEach(t=>{typeof this[`do${t.id}`]=="function"&&this[`do${t.id}`](t,e)}),this.updateBoardConfig(e)})}},doConfigRelateUrl(e,{canvasSetting:t,widgets:i}){let s=JSON.stringify(t);(s.indexOf("p://")>-1||s.indexOf("s://")>-1)&&e.children.push({id:"ConfigRelateUrl_canvas",name:"\u770B\u677F\u914D\u7F6E\u4E2D\u5B58\u5728\u7EDD\u5BF9\u8DEF\u5F84\u914D\u7F6E",status:"\u53BB\u5904\u7406"});for(const l in i){let a=i[l],n=JSON.stringify(a);(n.indexOf("p://")>-1||n.indexOf("s://")>-1)&&e.children.push({id:`ConfigRelateUrl_${l}`,name:`\u7EC4\u4EF6[${a.name}]\u4E2D\u5B58\u5728\u7EDD\u5BF9\u8DEF\u5F84\u914D\u7F6E`,status:"\u53BB\u5904\u7406",type:e.id,widgetId:a.id})}e.children.length>0?e.status="\u5F85\u5904\u7406":e.status="\u901A\u8FC7",e.checked=!0},doCheckCompatibility(e,{canvasSetting:t,widgets:i}){let s=JSON.stringify(t);(s.indexOf("localStorage.get")>-1||s.indexOf("localStorage.set")>-1||s.indexOf("localStorage.remove")>-1)&&e.children.push({id:"CheckCompatibility_canvas",name:"\u770B\u677F\u914D\u7F6E\u4E2D\u5B58\u5728\u5BF9localStorage\u7684\u76F4\u63A5\u8C03\u7528",content:"\u5982\u679C\u4F7F\u7528localStorage\u662F\u7528\u6765\u83B7\u53D6\u7CFB\u7EDF\u6570\u636E\uFF0C\u8BF7\u66F4\u6362\u4E3A\u5185\u90E8api\uFF0C\u5982\u83B7\u53D6token\uFF0C\u4FEE\u6539\u4E3Athis.mUtils.getStorageToken()",status:"\u53BB\u5904\u7406",type:e.id});for(const l in i){let a=i[l],n=JSON.stringify(a);(n.indexOf("localStorage.get")>-1||n.indexOf("localStorage.set")>-1||n.indexOf("localStorage.remove")>-1)&&e.children.push({id:"CheckCompatibility_canvas",name:`\u7EC4\u4EF6[${a.name}]\u4E2D\u5B58\u5728\u5BF9localStorage\u7684\u76F4\u63A5\u8C03\u7528`,content:"\u5982\u679C\u4F7F\u7528localStorage\u662F\u7528\u6765\u83B7\u53D6\u7CFB\u7EDF\u6570\u636E\uFF0C\u8BF7\u66F4\u6362\u4E3A\u5185\u90E8api\uFF0C\u5982\u83B7\u53D6token\uFF0C\u4FEE\u6539\u4E3Athis.mUtils.getStorageToken()",status:"\u53BB\u5904\u7406",type:e.id,widgetId:a.id})}e.children.length>0?e.status="\u5F85\u5904\u7406":e.status="\u901A\u8FC7",e.checked=!0},doCheckDataset(e,t){h.log(e,t),setTimeout(()=>{e.status="\u901A\u8FC7",e.checked=!0},5e3)},async doCheckDatasetField(e,{canvasSetting:t,widgets:i}){for(let s in i){let l=!1,a=i[s];if(a&&a.dataset&&a.dataset.type=="dynamic"&&a.dataset.dynamic){let n=JSON.parse(JSON.stringify(a.dataset.dynamic)),S={dataSetId:n.dataSetId,dimensions:n.dimensions,columnList:n.columnList,dimensionsAlias:n.dimensionsAlias,query:n.query},r=await p.o.getAggregateDataEx({dataSet:JSON.stringify(S)});if(n.dimensions&&r.status==200&&r.data&&r.data.columnList){l=!0;for(let b in n.dimensions){let u=!1;for(let O in r.data.columnList)n.dimensions[b]==r.data.columnList[O].name&&(u=!0);if(!u){l=!1;break}}}l||e.children.push({id:"CheckDatasetField_canvas",name:`\u7EC4\u4EF6[${a.name}]\u7ED1\u5B9A\u7684\u52A8\u6001\u6570\u636E\u96C6\u7684\u672C\u5730\u5B57\u6BB5\u548C\u8BF7\u6C42\u6570\u636E\u96C6\u6570\u636E\u8FD4\u56DE\u7684\u5B57\u6BB5\u6709\u5DEE\u5F02`,content:"\u5982\u679C\u7EC4\u4EF6\u7ED1\u5B9A\u7684\u52A8\u6001\u6570\u636E\u96C6\u7684\u672C\u5730\u5B57\u6BB5\u548C\u8BF7\u6C42\u6570\u636E\u96C6\u6570\u636E\u8FD4\u56DE\u7684\u5B57\u6BB5\u6709\u5DEE\u5F02\uFF0C\u8BF7\u5230\u5F53\u524D\u7EC4\u4EF6\u7684\u6570\u636E\u9879\u914D\u7F6E\u4E2D\u91CD\u65B0\u5237\u65B0\u6570\u636E\u96C6\u548C\u914D\u7F6E\u5B57\u6BB5\u7ED1\u5B9A\u3002",status:"\u53BB\u5904\u7406",type:e.id,widgetId:a.id})}}e.children.length>0?e.status="\u5F85\u5904\u7406":e.status="\u901A\u8FC7",e.checked=!0},doRemoveConfigData(e,t){h.log(e,t);const i=t.widgets;let s={};for(let l in i){let a=JSON.parse(JSON.stringify(i[l]));a.dataset=this.getNewDataset(a.dataset),Vue.set(s,l,a)}t.widgets=s,e.status="\u5DF2\u5904\u7406",e.checked=!0},getNewDataset(e){for(let t in e)if(e.type&&t!=e.type){let i=e[t];i&&i.source&&i.source.length>1&&(i.source=[i.source[0]]),e[t]=i}return e},openDialog(){this.dialogVisible=!0,this.checkedTime===0&&this.checkedConfigure.length===0&&(Array.prototype.push.apply(this.checkedConfigure,this.configureOptions.filter(e=>e.default)),this.$nextTick(()=>{this.toggleSelection(this.checkedConfigure)}))}}},k=C,y=o(768141),w=(0,y.Z)(k,f,g,!1,null,"4e13c6f0",null),v=w.exports}}]);
