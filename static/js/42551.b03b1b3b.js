"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[42551],{865046:function(K,p,e){var v=e(465557),r=e(419534);Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var T=r(e(828866)),k=r(e(705146)),M=r(e(578756)),N=r(e(452909)),C=r(e(342579)),F=r(e(122777)),u=r(e(42762)),a=r(e(330044)),f=r(e(299085)),o=r(e(234009)),s=r(e(615550)),n=r(e(349162)),h=r(e(223378)),c=e(972233),S=r(e(597998)),z=e(125794),Q=r(e(372407)),$=e(197149);function X(j){var R=D();return function(){var y=(0,o.default)(j),t;if(R){var l=(0,o.default)(this).constructor;t=v(y,arguments,l)}else t=y.apply(this,arguments);return(0,f.default)(this,t)}}function D(){if(typeof Reflect>"u"||!v||v.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(v(Boolean,[],function(){})),!0}catch{return!1}}var Z=function(j){(0,a.default)(g,j);var R=X(g);function g(y,t,l){var i;return(0,F.default)(this,g),i=R.call(this),i.path="identify",i.params={layers:"all",tolerance:0,returnGeometry:!0},i.tolerance=3,i.url=y+"/"+i.path,i.layerOption=l,i.geojsonFormat=new n.default,i.esrijsonFormat=new s.default,t&&((t.returnGeometry===!0||t.returnGeometry===!1)&&(i.params.returnGeometry=t.returnGeometry),t.layers&&(i.params.layers=t.layers),t.layerDefs&&(i.params.layerDefs=t.layerDefs),(t.returnZ===!0||t.returnZ===!1)&&(i.params.returnZ=t.returnZ),(t.returnM===!0||t.returnM===!1)&&(i.params.returnM=t.returnM),t.authkey&&(i.params.authkey=t.authkey)),i}return(0,u.default)(g,[{key:"at",value:function(t,l){var i=(0,T.default)(l),m=l.viewer,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},U=d.cartesian,J=d.tileWidth,E=d.tileHeight,P=d.rectangle,b=d.earthResolution,I,G;if(i){I=t,G=(0,$.getEsriSpatialReference)(i.getView().getProjection().getCode()),this.params.sr=G,this.params.width=i.getSize()[0],this.params.height=i.getSize()[1],this.params.imageDisplay=[this.params.width,this.params.height,96];var O=i.getView().calculateExtent(i.getSize());this.params.mapExtent={xmin:O[0],ymin:O[1],xmax:O[2],ymax:O[3],spatialReference:G},this.resolution=(0,c.getPointResolution)(i.getView().getProjection(),i.getView().getResolution(),i.getView().getCenter(),S.default.METERS),this.maskGeoJson=i.maskGeoJson}else if(m){var L,w,A;this.cartesian=U,this.position=t,G="4326";var W=new h.default(t);I=this.geojsonFormat.writeGeometry(W),this.params.sr=G,this.params.width=J,this.params.height=E,this.params.imageDisplay=[this.params.width,this.params.height,96],this.params.mapExtent=(0,k.default)(L=(0,k.default)(w=(0,k.default)(A="".concat(P.west,",")).call(A,P.south,",")).call(w,P.east,",")).call(L,P.north),this.resolution=b,this.maskGeoJson=m.maskGeoJson}return this._setGeometryParams(I,G),this}},{key:"between",value:function(t,l){return this.params.time=[t.valueOf(),l.valueOf()],this}},{key:"run",value:function(t,l){var i=this,m=this.layerOption,d=m.serverOrigin,U=m.label,J=m.id,E=m.isPop,P=m.layerTag,b={type:d,results:[],layerLabel:U,layerId:J,isPop:E,layerTag:P};return this.params.geometry?new M.default(function(I,G){var O=this;(0,C.default)(this,i),this.request(function(L,w){var A,W=this;(0,C.default)(this,O);var B=[];(w==null||(A=w.results)===null||A===void 0?void 0:A.length)>0&&(w.results.forEach(function(V){var H,x=this;(0,C.default)(this,W);var q=this.esrijsonFormat.readFeature(V),_=V.attributes,Y={layerInfo:{id:this.layerOption.id,serverOrigin:this.layerOption.serverOrigin,type:this.layerOption.type},identifyField:(H=this.layerOption.identifyField)===null||H===void 0?void 0:(0,N.default)(H).call(H,function(ee){return(0,C.default)(this,x),ee.layerId===V.layerId}.bind(this)),geometry:this.geojsonFormat.writeGeometry(q.getGeometry()),attributes:_};this.cartesian&&(Y.cartesian=this.cartesian,Y.position=this.position),B.push(Y)}.bind(this)),b.results=B),t&&t.call(l,L,b),L?G(L):I(b)}.bind(this),l)}.bind(this)):M.default.resolve(b)}},{key:"_setGeometryParams",value:function(t,l){var i=this._getIdentifyGeometry(this.geojsonFormat.readGeometry(t),"EPSG:".concat(l)),m=this._getIdentifyGeometryIntersectMask(i,"EPSG:".concat(l));if(m){var d=this.esrijsonFormat.writeGeometryObject(m);l&&(d.spatialReference={wkid:l}),this.params.geometry=d,this.params.geometryType=this.geojsonTypeToArcGIS(i.getType())}}},{key:"_getIdentifyGeometry",value:function(t,l){if(t.getType()==="Point"||t.getType()==="LineString"){var i=t.transform(l,"EPSG:4326"),m=(0,z.buffer)(this.geojsonFormat.writeGeometryObject(i),this.tolerance*this.resolution/1e3);return this.geojsonFormat.readFeature(m).getGeometry().transform("EPSG:4326",l)}else return t}},{key:"_getIdentifyGeometryIntersectMask",value:function(t,l){if(this.maskGeoJson){var i=this.geojsonFormat.writeGeometryObject(this.geojsonFormat.readGeometry(this.maskGeoJson)),m=this.geojsonFormat.writeGeometryObject(t.transform(l,"EPSG:4326")),d=(0,z.intersect)(i,m);return d?this.geojsonFormat.readFeature(d).getGeometry().transform("EPSG:4326",l):null}return t}}]),g}(Q.default);p.default=Z},372407:function(K,p,e){var v=e(419534);Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var r=v(e(66273)),T=v(e(342579)),k=v(e(122777)),M=v(e(42762)),N=function(){function C(){(0,k.default)(this,C)}return(0,M.default)(C,[{key:"geojsonTypeToArcGIS",value:function(u){var a;switch(u){case"Point":a="esriGeometryPoint";break;case"MultiPoint":a="esriGeometryMultipoint";break;case"LineString":a="esriGeometryPolyline";break;case"MultiLineString":a="esriGeometryPolyline";break;case"Polygon":a="esriGeometryPolygon";break;case"MultiPolygon":a="esriGeometryPolygon";break}return a}},{key:"isArcgisOnline",value:function(u){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(u)}},{key:"serialize",value:function(u){var a="";u.f=u.f||"json";for(var f in u)if(Object.prototype.hasOwnProperty.call(u,f)){var o=u[f],s=Object.prototype.toString.call(o),n;a.length&&(a+="&"),s==="[object Array]"?n=Object.prototype.toString.call(o[0])==="[object Object]"?(0,r.default)(o):o.join(","):s==="[object Object]"?n=(0,r.default)(o):s==="[object Date]"?n=o.valueOf():n=o,a+=encodeURIComponent(f)+"="+encodeURIComponent(n)}return a}},{key:"format",value:function(u){return this.params.returnUnformattedValues=!u,this}},{key:"createRequest",value:function(u,a){var f=new window.XMLHttpRequest;return f.onerror=function(){f.onreadystatechange=Util.falseFn,u.call(a,{error:{code:500,message:"XMLHttpRequest error"}},null)},f.onreadystatechange=function(){var o=this,s,n;if(f.readyState===4){try{s=JSON.parse(f.responseText)}catch{s=null,n={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!n&&s.error&&(n=s.error,s=null),f.onerror=function(){(0,T.default)(this,o),this.onerror()}.bind(this),u.call(a,n,s)}},f.ontimeout=function(){this.onerror()},f}},{key:"jsonp",value:function(u,a,f,o){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var s="c"+callbacks;a.callback="window._EsriLeafletCallbacks."+s,window._EsriLeafletCallbacks[s]=function(h){if(window._EsriLeafletCallbacks[s]!==!0){var c,S=Object.prototype.toString.call(h);S==="[object Object]"||S==="[object Array]"||(c={error:{code:500,message:"Expected array or object as JSONP response"}},h=null),!c&&h.error&&(c=h,h=null),f.call(o,c,h),window._EsriLeafletCallbacks[s]=!0}};var n=DomUtil.create("script",null,document.body);return n.type="text/javascript",n.src=u+"?"+serialize(a),n.id=s,n.onerror=function(h){if(h&&window._EsriLeafletCallbacks[s]!==!0){var c={error:{code:500,message:"An unknown error occurred"}};f.call(o,c),window._EsriLeafletCallbacks[s]=!0}},DomUtil.addClass(n,"esri-leaflet-jsonp"),callbacks++,{id:s,url:n.src,abort:function(){window._EsriLeafletCallbacks._callback[s]({code:0,message:"Request aborted."})}}}},{key:"request",value:function(u,a){var f=this.serialize(this.params),o=this.createRequest(u,a),s=(this.url+"?"+f).length;if(s<=2e3)o.open("GET",this.url+"?"+f);else if(s>2e3){var n=this.url;this.params.authkey&&(n=this.url+"?authkey=".concat(this.params.authkey)),o.open("POST",n),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}if(typeof a<"u"&&a!==null&&typeof a.options<"u"&&(o.timeout=a.options.timeout),s<=2e3)o.send(null);else if(s>2e3)o.send(f);else return s<=2e3?this.jsonp(this.url,this.params,u,a):void 0;return o}}]),C}();p.default=N},561674:function(K,p,e){var v=e(419534);Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var r=v(e(828866)),T=v(e(342579)),k=v(e(122777)),M=v(e(42762)),N=v(e(349162)),C=e(972233),F=v(e(597998)),u=new N.default,a=function(){function o(s,n,h){var c,S,z=(0,r.default)(h),Q=h.viewer,$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},X=$.cartesian,D=$.earthResolution;(0,k.default)(this,o),this.layerOption=s,this.map=z,this.viewer=Q,this.cartesian=X,this.position=n,this.projectionCode=(0,r.default)(this)?(0,r.default)(this).getView().getProjection().getCode():void 0,this.coordinate=this._getCoordinate(),this._earthResolution=D,this.resolution=this._getResolution(),this.outputFormat="application/json",this.maxFeatures=100,this.tolerance=3,this.layers=this._getLayers(),this.maskGeoJson=((c=(0,r.default)(this))===null||c===void 0?void 0:c.maskGeoJson)||((S=this.viewer)===null||S===void 0?void 0:S.maskGeoJson),this.params={INFO_FORMAT:this.outputFormat,FEATURE_COUNT:this.maxFeatures}}return(0,M.default)(o,[{key:"_getCoordinate",value:function(){if((0,r.default)(this)){if(this.position instanceof Array&&this.position.length===2)return this.position;var n=u.readGeometry(this.position);if(n.getType()==="Point")return n.getCoordinates()}else if(this.viewer&&this.position)return this.projectionCode="EPSG:4326",this.position}},{key:"_getResolution",value:function(){var n;return(0,r.default)(this)?n=(0,C.getPointResolution)((0,r.default)(this).getView().getProjection(),(0,r.default)(this).getView().getResolution(),(0,r.default)(this).getView().getCenter(),F.default.METERS):this.viewer&&(n=this._earthResolution),n}},{key:"_getLayers",value:function(){var n=this;if(this.layerOption.geoLayerIsGroup){var h;return(0,r.default)(h=this.layerOption.identifyField).call(h,function(c){return(0,T.default)(this,n),c.anotherName}.bind(this))}else return this.layerOption.visibleLayers}}]),o}(),f=a;p.default=f},813866:function(K,p,e){var v=e(149500),r=e(419534);Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var T=r(e(578756)),k=r(e(581806)),M=r(e(520314)),N=r(e(452909)),C=r(e(22466)),F=r(e(828866)),u=r(e(66273)),a=r(e(342579)),f=r(e(122777)),o=r(e(42762)),s=r(e(349162)),n=r(e(51462)),h=e(419026),c=e(972233),S=e(125794),z=r(e(223378)),Q=r(e(683605)),$=function(){function D(){(0,f.default)(this,D),this.geojsonFormat=new s.default,this.identifyParameters={}}return(0,o.default)(D,[{key:"execute",value:function(j){var R=this;return this.identifyParameters=j,new T.default(function(g){var y=this;(0,a.default)(this,R);var t=this.identifyParameters.layerOption.url;if(!(0,k.default)(t).call(t,"authkey")&&this.identifyParameters.layerOption.authkey){var l=(0,k.default)(t).call(t,"?")?"&":"?";t+=l+"authkey="+this.identifyParameters.layerOption.authkey}this._geoserverQuery(t).then(function(i){var m=this;(0,a.default)(this,y);var d=this.identifyParameters.layerOption,U=d.serverOrigin,J=d.label,E=d.id,P=d.isPop,b=d.layerTag,I={type:U,results:[],layerLabel:J,layerId:E,isPop:P,layerTag:b},G=[];i.forEach(function(O){var L,w,A=this;(0,a.default)(this,m);var W=(0,M.default)(L=O.id_).call(L,0,O.id_.lastIndexOf(".")),B=O.getProperties();delete B.geometry;var V={layerInfo:{id:this.identifyParameters.layerOption.id,serverOrigin:this.identifyParameters.layerOption.serverOrigin,type:this.identifyParameters.layerOption.type},identifyField:(w=this.identifyParameters.layerOption.identifyField)===null||w===void 0?void 0:(0,N.default)(w).call(w,function(H){return(0,a.default)(this,A),H.name===W}.bind(this)),geometry:this.geojsonFormat.writeGeometry(O.getGeometry()),attributes:B};this.identifyParameters.viewer&&(V.cartesian=this.identifyParameters.cartesian,V.position=this.identifyParameters.position),G.push(V)}.bind(this)),I.results=G,g(I)}.bind(this))}.bind(this))}},{key:"_geoserverQuery",value:function(j){var R=this,g=this._getIdentifyGeometry(),y=this._getIdentifyGeometryIntersectMask(g);if(!y)return T.default.resolve([]);var t=this.identifyParameters.layerOption.geoStr?this.identifyParameters.layerOption.geoStr:"the_geom",l=this.identifyParameters.layerOption._filter?this.identifyParameters.layerOption._filter:(0,C.default)(this.identifyParameters.layerOption),i;l&&(i=new Q.default().read(l));var m=(0,h.intersects)(t,y),d=i?(0,h.and)(i,m):m,U=new n.default().writeGetFeature({srsName:this.identifyParameters.projectionCode,featureNS:"",featurePrefix:"",featureTypes:this.identifyParameters.layers,outputFormat:"application/json",geometryName:this.identifyParameters.layerOption.geoStr||"the_geom",filter:d});return new T.default(function(J){var E=this;(0,a.default)(this,R),fetch(j,{method:"POST",body:new XMLSerializer().serializeToString(U)}).then(function(P){return(0,a.default)(this,E),P.json()}.bind(this)).then(function(P){var b,I=this;(0,a.default)(this,E);var G=[];G=(0,F.default)(b=P.features).call(b,function(O){return(0,a.default)(this,I),this.geojsonFormat.readFeature((0,u.default)(O))}.bind(this)),J(G)}.bind(this)).catch(function(P){(0,a.default)(this,E),J([]),v.error(P)}.bind(this))}.bind(this))}},{key:"_getIdentifyGeometry",value:function(){if(this.identifyParameters.coordinate){var j=this.geojsonFormat.writeGeometryObject(new z.default((0,c.transform)(this.identifyParameters.coordinate,this.identifyParameters.projectionCode,"EPSG:4326"))),R=(0,S.buffer)(j,this.identifyParameters.tolerance*this.identifyParameters.resolution/1e3);return this.geojsonFormat.readFeature(R).getGeometry().transform("EPSG:4326",this.identifyParameters.projectionCode)}else{var g=this.geojsonFormat.readGeometry(this.identifyParameters.position);if(g.getType()==="LineString"){var y=g.transform(this.identifyParameters.projectionCode,"EPSG:4326"),t=(0,S.buffer)(this.geojsonFormat.writeGeometryObject(y),this.identifyParameters.tolerance*this.identifyParameters.resolution/1e3);return this.geojsonFormat.readFeature(t).getGeometry().transform("EPSG:4326",this.identifyParameters.projectionCode)}else return g}}},{key:"_getIdentifyGeometryIntersectMask",value:function(j){if(this.identifyParameters.maskGeoJson){var R=this.geojsonFormat.writeGeometryObject(this.geojsonFormat.readGeometry(this.identifyParameters.maskGeoJson)),g=this.geojsonFormat.writeGeometryObject(j.transform(this.identifyParameters.projectionCode,"EPSG:4326")),y=(0,S.intersect)(R,g);return y?this.geojsonFormat.readFeature(y).getGeometry().transform("EPSG:4326",this.identifyParameters.projectionCode):null}return j}}]),D}(),X=$;p.default=X}}]);
