"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[36968,44777],{736968:function(C,u,i){i.r(u),i.d(u,{default:function(){return Q}});var f=function(){var e=this,t=e._self._c;return t("div",[t("button-tooltip",{attrs:{button_config:e.button_info}},[t("el-popover",{attrs:{placement:"bottom-end",width:"200",trigger:e.button_info.trigger},on:{show:e.showPopover}},[e.accessType!=e.global_query.accessType.public.code?t("div",[t("el-tree",{attrs:{data:e.customerQuery,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function({node:r,data:n}){return t("span",{staticClass:"custom-tree-node"},[t("span",{staticStyle:{width:"100%"},on:{click:function(S){return e.buttonClick(n,e.button_info)}}},[e._v(e._s(r.label))]),t("span",[t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u7F16\u8F91",effect:"light",placement:"top"}},[t("i",{staticClass:"el-icon-edit",staticStyle:{color:"#409EFF","margin-right":"8px"},on:{click:function(S){return e.edit(n)}}})]),t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u5220\u9664",effect:"light",placement:"top"}},[t("i",{staticClass:"el-icon-delete",staticStyle:{color:"#F56C6C","margin-right":"8px"},on:{click:function(S){return e.del(n)}}})]),t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4",effect:"light",placement:"top"}},[t("span",{class:n.default==!0?"class-default":"class-not-default",on:{click:function(S){return e.def(n)}}},[e._v("\u9ED8\u8BA4")])])],1)])}}],null,!1,1483675561)})],1):e._e(),e.accessType!=e.global_query.accessType.public.code?t("el-button",{class:`gisq-query-button el-button--${e.button_info.colorType}`,style:e.buttonStyle(e.button_info),attrs:{slot:"reference",size:e.button_info.size,disabled:e.button_info.disabled,type:e.button_info.style=="text"?"text":"",plain:e.button_info.style=="plain",round:e.button_info.style=="round",circle:e.button_info.style=="circle"},slot:"reference"},[!e.button_info.icon_align||e.button_info.icon_align==e.global_query.position.left.code?t("i",{class:e.button_info.icon,style:e.iconStyle(e.button_info)}):e._e(),e._v(" "+e._s(e.button_info.label)+" "),e.button_info.icon_align==e.global_query.position.right.code?t("i",{class:e.button_info.icon,style:e.iconStyle(e.button_info)}):e._e(),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]):e._e()],1)],1),t("save-query",{ref:"saveQuery",attrs:{"widget-id":e.widgetId}})],1)},y=[],c=i(148836),h=i(378931),l=i(555616),g=i(479876),a=i(644777),d=i(452013),v=i(350707),o=i(149500),m={name:"customer-query",components:{ButtonTooltip:d.Z,SaveQuery:a.default},mixins:[g.G],props:{button_save_query:{},button_info:{}},data(){return{global_query:this.$$global_query}},computed:{...(0,c.Se)(["customerQueryFun"]),customerQuery(){let s=this.customerQueryFun(this.widgetId);return s&&s.length>0?JSON.parse(JSON.stringify(this.$$lib__.sortBy(s,"number").reverse())):[]}},methods:{...(0,c.nv)(["setCustomerQuery"]),buttonClick(s,e){if(e.is_click){if(!e.script_click||e.script_click==""){o.warn("\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+e.name+" \u811A\u672C\u4E3A\u7A7A");return}o.info("\u6267\u884C\u70B9\u51FB\u4E8B\u4EF6 \u6309\u94AE"+e.name+" \u811A\u672C"),new Function("query,button_config",e.script_click).apply(this,[s,e])}else this.scriptClick(s,e)},edit(s){this.$refs.saveQuery.editQuery(s.guid)},del(s){this.$confirm("\u786E\u5B9A\u8981\u5220\u9664\u7B5B\u9009\u5668\uFF1A"+s.label+"?","\u5220\u9664\u786E\u8BA4",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning",customClass:"deleteBoardC"}).then(()=>{let e=[],t=1;this.$$lib__.each(this.customerQuery,r=>{r.guid!=s.guid&&(r.number=t,e.push(r),t++)}),this.saveQuery(e)}).catch(()=>{l.Message.info({message:"\u5DF2\u53D6\u6D88\u5220\u9664",offset:60})})},def(s){let e=JSON.parse(JSON.stringify(this.customerQuery));this.$$lib__.each(e,t=>{t.guid==s.guid?t.default=!t.default:t.default=!1}),this.saveQuery(e)},saveQuery(s){if(this.accessType){if(this.queryId==null&&this.queryPublishId==null){o.error("\u67E5\u8BE2\u5217\u8868ID\u548C\u7248\u672CID  \u81F3\u5C11\u6709\u4E00\u4E2A"),l.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60});return}switch(this.accessType){case this.global.editType.original.code:v._.saveCustomerQuery(JSON.stringify(s),this.queryId,this.queryPublishId).then(e=>{this.afterSave(s,e)});break;case this.global.editType.public.code:l.Message.error({message:"\u516C\u5F00\u7248\u672C\uFF0C\u65E0\u6CD5\u83B7\u53D6\u7528\u6237\u4FE1\u606F\uFF0C\u5373\u65E0\u6CD5\u4F7F\u7528\u6B64\u529F\u80FD",offset:60});break;default:l.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60})}}else this.queryId?h.y.saveCustomerQuery(JSON.stringify(s),this.queryId).then(e=>{this.afterSave(s,e)}):l.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u8BBE\u67E5\u8BE2\u5217\u8868\u4E3B\u952E\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60})},afterSave(s,e){e&&e.status==200?(this.setCustomerQuery({customerQuery:s,widgetId:this.widgetId}),l.Message.success({message:"\u4FDD\u5B58\u6210\u529F",offset:60})):l.Message.error({message:e.msg,offset:60}),this.dialogVisible=!1},scriptClick(s,e){o.debug(e);let t={};s&&(t=s.keyValue,t&&t!=""&&(t=JSON.parse(t))),this.setRequestBodyKeyValue({keyValue:t,widgetId:this.widgetId}),this.previewConditionValue(),this.setQueryCustomer(),this.doQuery()},showPopover(){this.button_save_query==null&&l.Message.warning({message:"\u201C\u6211\u7684\u7B5B\u9009\u5668\u201D\u6309\u94AE\uFF0C\u5FC5\u987B\u914D\u5408\u201C\u4FDD\u5B58\u7B5B\u9009\u5668\u201D\u6309\u94AE\u4F7F\u7528\uFF0C\u5373\u4FDD\u5B58\u540E\u7684\u7B5B\u9009\u5668\u624D\u4F1A\u5728\u6B64\u663E\u793A",offset:60})}}},b=m,p=i(768141),_=(0,p.Z)(b,f,y,!1,null,"3c756bef",null),Q=_.exports},644777:function(C,u,i){i.r(u),i.d(u,{default:function(){return Q}});var f=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{staticClass:"my-dialog-class",attrs:{title:"\u4FDD\u5B58\u7B5B\u9009\u6761\u4EF6","close-on-click-modal":!1,"modal-append-to-body":!1,"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(r){e.dialogVisible=r}}},[t("el-form",{ref:"ref_form_data",attrs:{model:e.form_data,rules:e.rules,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"\u7B5B\u9009\u5668\u540D\u79F0",prop:"label"}},[t("el-input",{model:{value:e.form_data.label,callback:function(r){e.$set(e.form_data,"label",r)},expression:"form_data.label"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form_data.guid==null,expression:"form_data.guid == null"}],attrs:{label:"\u66FF\u6362\u5DF2\u6709\u7B5B\u9009\u5668"}},[t("el-select",{staticClass:"white-bgc",staticStyle:{width:"100%"},attrs:{placeholder:"\u8BF7\u9009\u62E9\u5C06\u8981\u66FF\u6362\u7684\u7B5B\u9009\u5668"},on:{change:e.changeCover},model:{value:e.form_data.cover_guid,callback:function(r){e.$set(e.form_data,"cover_guid",r)},expression:"form_data.cover_guid"}},e._l(e.customerQuery,function(r){return t("el-option",{key:r.guid,attrs:{label:r.label,value:r.guid}})}),1)],1),e.over_length==!0?t("div",{staticStyle:{"text-align":"center"}},[t("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C"}}),t("label",{staticStyle:{color:"#F56C6C","font-weight":"bolder"}},[e._v(" \u63D0\u793A\uFF1A")]),t("label",{staticStyle:{color:"#F56C6C"}},[e._v(" \u4E00\u4E2A\u9875\u9762\u6700\u591A\u4FDD\u5B5810\u4E2A\u7B5B\u9009\u5668\uFF0C\u8D85\u51FA10\u4E2A\u540E\uFF0C\u53EA\u80FD\u66FF\u6362\u5DF2\u6709\u7684\u7B5B\u9009\u5668\u3002")])]):e._e()],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:function(r){e.dialogVisible=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.saveQuery}},[e._v("\u786E \u5B9A")])],1)],1)],1)},y=[],c=i(645617),h=i.n(c),l=i(479876),g=i(378931),a=i(555616),d=i(148836),v=i(350707),o=i(149500),m={name:"save-query",mixins:[l.G],props:{saveKeyValue:{type:Boolean,default:!0}},data(){return{dialogVisible:null,form_data:{guid:null,label:null,cover_guid:null},current_keyValue:null,rules:{label:[{required:!0,message:"\u8BF7\u8F93\u5165\u7B5B\u9009\u5668\u540D\u79F0",trigger:"blur"}]},over_length:!1}},computed:{...(0,d.Se)(["customerQueryFun"]),customerQuery(){let s=this.customerQueryFun(this.widgetId);return s&&s.length>0?JSON.parse(JSON.stringify(s)):[]}},methods:{...(0,d.nv)(["setCustomerQuery"]),saveQuery(){this.$refs.ref_form_data.validate(s=>{if(s)this.doQuery(),this.current_keyValue=JSON.parse(JSON.stringify(this.requestBody.keyValue)),this.$$lib__.each(this.customerQuery,e=>{e.default=!1}),this.form_data.guid==null?this.doAddQuery():this.doEditQuery(),this.over_length==!1&&this.doSaveQuery();else return!1})},doAddQuery(){this.form_data.cover_guid==null?(this.over_length=this.customerQuery.length>=10,this.over_length==!1&&this.customerQuery.push({guid:h().v4().replace(/-/g,""),label:this.form_data.label,keyValue:JSON.stringify(this.current_keyValue),default:!0,number:this.customerQuery.length+1})):this.doEditQuery()},doEditQuery(){this.over_length=!1,this.$$lib__.each(this.customerQuery,s=>{s.guid==this.form_data.cover_guid&&(s.label=this.form_data.label,this.saveKeyValue==!0&&(s.keyValue=JSON.stringify(this.current_keyValue)),s.default=!0)})},doSaveQuery(){if(this.accessType){if(this.queryId==null&&this.queryPublishId==null){o.error("\u67E5\u8BE2\u5217\u8868ID\u548C\u7248\u672CID  \u81F3\u5C11\u6709\u4E00\u4E2A"),a.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60});return}switch(this.accessType){case this.global.editType.original.code:v._.saveCustomerQuery(JSON.stringify(this.customerQuery),this.queryId,this.queryPublishId).then(s=>{this.afterSave(s)});break;case this.global.editType.public.code:a.Message.error({message:"\u516C\u5F00\u7248\u672C\uFF0C\u65E0\u6CD5\u83B7\u53D6\u7528\u6237\u4FE1\u606F\uFF0C\u5373\u65E0\u6CD5\u4F7F\u7528\u6B64\u529F\u80FD",offset:60});break;default:a.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60})}}else this.queryId?g.y.saveCustomerQuery(JSON.stringify(this.customerQuery),this.queryId).then(s=>{this.afterSave(s)}):a.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u8BBE\u67E5\u8BE2\u5217\u8868\u4E3B\u952E\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60})},afterSave(s){s&&s.status==200?(this.setCustomerQuery({customerQuery:this.customerQuery,widgetId:this.widgetId}),a.Message.success({message:"\u4FDD\u5B58\u6210\u529F",offset:60})):a.Message.error({message:s.msg,offset:60}),this.dialogVisible=!1},addQuery(){this.accessType!=this.$$global_query.accessType.public.code?(this.over_length=!1,this.form_data={guid:null,label:null,cover_guid:null},this.dialogVisible=!0):a.Message.warning({message:"\u516C\u5F00\u53D1\u5E03\u7248\u672C\uFF0C\u4E0D\u53EF\u4F7F\u7528\u6B64\u529F\u80FD",offset:60})},editQuery(s){this.over_length=!1;let e=this.$$lib__.find(this.customerQuery,t=>t.guid==s);e&&(this.form_data={guid:s,label:e.label,cover_guid:s}),this.dialogVisible=!0},changeCover(){if(!this.form_data.label||this.form_data.label==""){let s=this.$$lib__.find(this.customerQuery,e=>e.guid==this.form_data.cover_guid);this.form_data.label=s.label}}}},b=m,p=i(768141),_=(0,p.Z)(b,f,y,!1,null,"70284933",null),Q=_.exports}}]);
