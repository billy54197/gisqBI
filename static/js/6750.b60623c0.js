"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[6750],{56279:function(E,y,r){r.d(y,{P:function(){return S}});var C=r(86892),f=r(49500);const S={mixins:[C.D],created(){},methods:{lifecycleBeforeChartsLoad(p){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&f.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let w=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[p]);if(w)return w}return p},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&f.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},86750:function(E,y,r){r.r(y),r.d(y,{default:function(){return J}});var C=function(){var i=this,e=i._self._c;return e("div",{style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[e("hide-button",{attrs:{attr:i.widgetInfo.attr}}),e("div",{ref:"countryMapScatter",staticClass:"charts chart-bar map-mount-node",style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"},attrs:{id:"mapChart"}})],1)},f=[],S=r(27966),p=r(21300),b=r(3540),w=r(67157),I=r(50666),M=r(38002);const P={mixins:[w.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(I.Z.charts.title)),legend:JSON.parse(JSON.stringify(I.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(I.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(I.Z.charts.toolbox)),itemStyle:{normal:{areaColor:"rgba(0, 0, 0,0)",opacity:1,color:"#389BB7",borderColor:"rgba(147, 235, 248)",shadowColor:"rgba(128, 217, 248,.6)",label:{areaColor:"rgba(255,50,50,1)",color:"rgba(0,0,0,1)"}},emphasis:{label:{color:"rgba(0,0,0,1)"},itemStyle:{color:"#f66"}}},VisualMap:Object.assign(JSON.parse(JSON.stringify(M.Z.visualMap)),{inRange:{color:["#4C84FF"]}}),map3D:{label:{textStyle:{color:"#333",borderColor:"#fff",backgroundColor:"rgba(0,0,0,0)"}},itemStyle:{color:"rgb(5,101,123)",opacity:1,borderWidth:1,borderColor:"rgb(62,215,213)"},emphasis:{label:{textStyle:{color:"#333",borderColor:"#fff",backgroundColor:"rgba(0,0,0,0)"}},itemStyle:{color:"#f66",opacity:1}}},groundPlane:{color:"#aaa"},light:{main:{color:"#fff"},ambient:{color:"#fff",intensity:.2}},graphic:{style:{color:"#294D99"}}}}},methods:{filterPredefineColoursSchemeConfig(t,i){this.getNewConfigWithArrary(t,i,this.filter_config),this.getNewConfig_charts_visualMap_inRange_color(t.VisualMap,i.visualMap)}}};var L=r(45061),N=r(26711),A=r(99349),D=r(8925),z=r(44513),v=r(43156),x=r(55616),O=r(56279),c=r(49500);const R=r(29426);var F={props:["widgetInfo","currentWidget"],name:"country-map-scatter",mixins:[L.u,N.H,O.P,A.P,b.u,P],data(){return{historyRegion:[],dimensionsEx:null,dimensionsAliasEx:null,identical:!0,regionParent:{name:null,code:null},currentRegion:{id:null,name:null,cp:null,features:null,childrenCentralPoint:null}}},components:{HideButton:z.Z},mounted(){this.mapChart||(this.mapChart=R.init(this.$refs.countryMapScatter,null,{devicePixelRatio:2})),this.loadInfo(),this.initAction(this.widgetInfo)},destroyed(){this.mapChart.dispose()},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(t){t==null&&(t=this.widgetInfo),this.getCurrentRegionInfo(t.config.regionCode,i=>{let e=t.dataset[t.dataset.type].source,a=t.dataset[t.dataset.type].dimensions,n=t.dataset[t.dataset.type].dimensionsAlias,l=t.dataset[t.dataset.type].encode;this.dimensionsEx=a,this.dimensionsAliasEx=n;let g=this.getTooltip(t.config.tooltip);if(!t.config.tooltip.formatter.show&&!t.config.tooltip.formatter.script){let o="";t.config.map.tooltip&&(o=t.config.map.tooltip.unit),Object.assign(g,{formatter:function(s){let h="";return s.data&&s.data.value&&(h=s.data.alias+" : "+s.data.value+o+"<br>"),s.name+"<br>"+h}})}t.config.VisualMap.visualMapMin=="dataMin"&&(t.config.VisualMap.min=this.getVisualmapData(t,l.data)[0]),t.config.VisualMap.visualMapMax=="dataMax"&&(t.config.VisualMap.max=this.getVisualmapData(t,l.data)[1]);let d={tooltip:g,visualMap:t.config.VisualMap.show?this.getVisualMap(t.config.VisualMap):""},u=[],G=e.length,m={};for(let o=a.length-1;o>-1;--o)m[a[o]]=o;if(l.data&&l.region)for(let o=0;o<G;++o){let s=e[o],h=parseFloat(s[m[l.data]]);typeof h<"u"&&u.push({name:s[m[l.region]],alias:this.dimensionsAliasEx[m[l.data]].alias||this.dimensionsAliasEx[m[l.data]].name,value:h})}let V=t.config.graphic.style.fontSize+"px solid"+t.config.graphic.style.fontFamily;if(d.graphic=[{type:"group",bounding:"raw",left:t.config.graphic.style.iconLeft+"%",top:t.config.graphic.style.iconTop+"%",ignore:this.ignoreGraphic(),children:[{type:"text",z:100,style:{fill:t.config.graphic.style.color,text:t.config.graphic.style.text?t.config.graphic.style.text:"\u4E0A\u4E00\u7EA7",font:V,x:t.config.graphic.style.iconWidth+t.config.graphic.style.txtLeft,y:t.config.graphic.style.txtTop}},{type:"image",z:-10,bounding:"raw",origin:[25,25],ignore:this.ignoreGraphic(),style:{image:this.getImageUrl(t.config.graphic.style.iconImg),width:t.config.graphic.style.iconWidth,height:t.config.graphic.style.iconHeight}}]}],t.config.mapType==="map3D"){let o=JSON.parse(JSON.stringify(t.config.map3D));o.label.formatter=this.getFormatterString(t.config.map3D.label.formatter),o.left=o.left+"%",o.top=o.top+"%",o.right=o.right+"%",o.bottom=o.bottom+"%",o.type="map3D",o.name=l.data,o.map=t.config.regionCode.toString(),o.data=this.convertData(u),d.series=[];for(let s=0;s<o.data.length;s++)(o.data[s].name==o.data[s].code||o.data[s].code==o.map)&&(o.data.splice(s,1),s=s-1);d.series[0]=o}else{let o={name:l.data,type:"map",map:t.config.regionCode.toString(),data:this.convertData(u),label:{show:t.config.itemStyle.normal.label.show,textStyle:{fontSize:t.config.itemStyle.normal.label.fontSize,fontFamily:t.config.itemStyle.normal.label.fontFamily,color:t.config.itemStyle.normal.label.color},formatter:function(s){let h="";if(s.data&&t.config.itemStyle.normal.label.showValue){let B=t.config.itemStyle.normal.label.unit||"";h=`
`+s.data.value+B}return s.name+h},emphasis:{color:t.config.itemStyle.emphasis.label.color}},itemStyle:{areaColor:t.config.itemStyle.normal.areaColor,opacity:t.config.itemStyle.normal.opacity,color:t.config.itemStyle.normal.areaColor,borderColor:t.config.itemStyle.normal.borderColor,borderType:t.config.itemStyle.normal.borderType,borderWidth:.5},emphasis:{label:{show:t.config.showTooltip},itemStyle:{areaColor:t.config.itemStyle.normal.label.areaColor,color:t.config.itemStyle.normal.label.areaColor}}};t.config.autoMargin||(o.left=t.config.left+"%",o.right=t.config.right+"%",o.top=t.config.top+"%",o.bottom=t.config.bottom+"%"),d.series=[o]}R.registerMap(t.config.regionCode.toString(),i),this.mapChart&&this.mapChart.clear(),this.mapChart.setOption(this.lifecycleBeforeChartsLoad(d)),this.mapChart.resize()})},reLoadInfo(t){t&&(this.$refs.countryMapScatter.style.width=t.attr.w+"px",this.$refs.countryMapScatter.style.height=t.attr.hh+"px",this.$refs.countryMapScatter.style.display=t.attr.hide===!0?"none":""),this.loadInfo(t),this.mapChart.resize()},getCurrentRegionInfo(t,i){this.currentRegion.id=null,this.currentRegion.name=null,this.currentRegion.cp=null,this.currentRegion.features=null,this.currentRegion.childrenCentralPoint=null,v.h.getEchartsGeojsonByCodeWithChildrenCentralPoint(t).then(e=>{if(e&&e.status==200){if(!e.data){c.warn("\u672A\u67E5\u8BE2\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+t+" ]\u7684\u76F8\u5173\u6570\u636E");return}this.widgetInfo.config.regionName=e.data.xzqName,this.regionParent.code=e.data.parentCode,this.regionParent.name=e.data.parentName,this.currentRegion.id=t,this.currentRegion.name=e.data.xzqName,this.currentRegion.childrenCentralPoint=e.data.childrenCentralPoint;let a=e.data.geojsonEcharts;if(!a||a==""){c.warn("\u884C\u653F\u533A[ "+e.data.xzqName+" ]\u6CA1\u6709\u8BBE\u7F6E\u884C\u653F\u533A\u8FB9\u754C\u6570\u636E"),i();return}let n=JSON.parse(a);n&&n.cp&&(this.currentRegion.cp=n.cp),n&&n.features&&(this.currentRegion.features=n.features),i(n)}else c.log(e.msg)})},getFeatureInfo(t){let i=this.currentRegion.childrenCentralPoint[t];if(i&&i.cp)return JSON.parse(JSON.stringify(i));if(!this.currentRegion.features)return c.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5F53\u524D\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7F3A\u5C11features\u5C5E\u6027"),null;let e=this.$$lib__.find(this.currentRegion.features,a=>a.properties&&t==a.properties.id);return e?{id:e.properties.id,name:e.properties.name,cp:e.properties.cp}:(c.warn("\u6570\u636E\u96C6\u6570\u636E\u6E32\u67D3\u65F6\uFF0C\u5728\u884C\u653F\u533A[ "+this.currentRegion.name+" ]\u7684geojson\u6570\u636E\u7684features\u5C5E\u6027\u4E2D\uFF0C\u672A\u627E\u5230\u884C\u653F\u533A\u4EE3\u7801[ "+t+' ]\u7684\u76F8\u5173\u5C5E\u6027\uFF0C\u5373properties:{"id":"","name":"","cp":[]}\u4E0D\u5B58\u5728'),null)},convertData(t){let i=[];for(let e=0;e<t.length;e++){let a=this.getFeatureInfo(t[e].name);a?i.push({name:a.name,code:t[e].name,alias:t[e].alias,value:t[e].value}):i.push({name:t[e].name,code:t[e].name,alias:t[e].alias,value:t[e].value})}return i},initAction(t){this.actionSendout(t),this.actionReceive(t),this.registerAction(t,"openRegion","widgetList",this.doOpenRegion),this.clickEvent()},doOpenRegion(t,i,e,a){if(i&&e&&i[e]){let n=i[e];if(a.script&&a.script.enabled){if(c.log("Execute script for "+a.name+" component to "+a.script.title+" component"),a.script.content==""){x.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_openRegion=new Function("region,info,data,param_key",a.script.content),this.customScript_actionSend_openRegion(n,t,i,e)}else this.widgetInfo.config.regionCode!=n&&(this.widgetInfo.config.regionCode=n,this.loadInfo(this.widgetInfo))}},getParams(t,i){if(i.paramsExtend&&i.paramsExtend.length>0){let e=[],a=this.widgetInfo.dataset[this.widgetInfo.dataset.type].source,n=this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode,l=this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions;if(this.widgetInfo.dataset.regionType=="region"){let g=-1;this.$$lib__.each(l,(d,u)=>{d==n.region&&(g=u)});for(let d=0;d<a.length;d++)if(t.code==a[d][g]){e=a[d];break}}this.getExtendParams(t,i.paramsExtend,e,this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions)}return t},clickEvent(){let t=this;this.mapChart.on("click",function(i){let e=i.componentType=="graphic"?t.regionParent.name:i.name;t.getRegionByNameAndParentCode(e,a=>{let n={code:i.componentType=="graphic"?t.regionParent.code:a!=null?a.xzqCode:null,name:e};if(i.componentType=="graphic"&&(t.widgetInfo.config.regionCode=n.code,t.loadInfo(),t.sendActionFun(n,i)),!a||!a.xzqCode||a.xzqCode==""){t.sendActionFun(n,i);return}t.doDrill(a),t.sendActionFun(n,i)})})},sendActionFun(t,i){let e=this,a=e.widgetInfo.action.sendOut.actionList;e.$$lib__.each(a,n=>{if(n.enabled&&n.code==e.$$global_editor.actionType.click.code){let l=e.$$global_editor.actionType.click.code+"_"+e.widgetInfo.id;if(n.paramsExtend&&n.paramsExtend.length>0){let g=[];e.widgetInfo.dataset[e.widgetInfo.dataset.type].source&&e.widgetInfo.dataset[e.widgetInfo.dataset.type].source.length>0&&(g=e.widgetInfo.dataset[e.widgetInfo.dataset.type].source[i.dataIndex]),e.getExtendParams(t,n.paramsExtend,g,e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions)}if(n.script&&n.script.enabled){if(c.log("Execute script for "+n.name+" component to "+n.script.title+" component"),n.script.content==""){x.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam2=new Function("param, params",n.script.content),t=this.customScript_actionSend_clickParam2(t,i)}S.Z.$emit(l,t),n.postMessage&&e.doPostMessage(t),e.actionNameList.push(l)}else if(n.enabled&&n.code==e.$$global_editor.actionType.openLink.code){if(n.paramsExtend&&n.paramsExtend.length>0){let l=[];e.widgetInfo.dataset[e.widgetInfo.dataset.type].source&&e.widgetInfo.dataset[e.widgetInfo.dataset.type].source.length>0&&(l=e.widgetInfo.dataset[e.widgetInfo.dataset.type].source[i.dataIndex]),e.getExtendParams(t,n.paramsExtend,l,e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions)}if(n.script&&n.script.enabled){if(c.log("Execute script for "+n.name+" component to "+n.script.title+" component"),n.script.content==""){x.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_openLink=new Function("param",n.script.content),t=this.customScript_actionSend_openLink(t)}e.openLinkAction(n,t)}})},getRegionByNameAndParentCode(t,i){t&&v.h.getEchartsGeojsonByNameAndParentCode(t,this.widgetInfo.config.regionCode).then(e=>{if(e&&e.status==200){if(!e.data){c.warn("\u672A\u67E5\u5230\u884C\u653F\u533A[ "+t+" ]\u7684\u76F8\u5173\u6570\u636E"),i(null);return}if(!e.data.xzqCode||e.data.xzqCode==""){c.warn("\u672A\u67E5\u5230\u884C\u653F\u533A[ "+t+" ]\u7684\u76F8\u5173\u6570\u636E"),i(e.data);return}let a=e.data.geojsonEcharts;if(!a||a==""){c.warn("\u884C\u653F\u533A[ "+e.data.xzqName+" ]\u6CA1\u6709\u8BBE\u7F6E\u884C\u653F\u533A\u8FB9\u754C\u6570\u636E"),i(e.data);return}i(e.data)}else c.log(e.msg)})},doDrill(t){let i=!1,e=this.widgetInfo.config.allowDrillArea;(t.xzqCode=="china"||e==null||e==""||e=="province"&&t.xzqCode.length<=2||e=="city"&&t.xzqCode.length<=4||e=="area"&&t.xzqCode.length<=6||e=="town"&&t.xzqCode.length<=9)&&(i=!0),this.widgetInfo.config.allowDrill&&i&&t&&t.geojsonEcharts&&t.geojsonEcharts!=""&&(this.regionParent.code=t.parentCode,this.regionParent.name=t.parentName,this.widgetInfo.config.regionCode=t.xzqCode,this.loadInfo())},ignoreGraphic(){let t=this.widgetInfo.config.graphic.style.showArea;return this.currentRegion.id=="china"?!0:t=="province"&&this.currentRegion.id.length>2?this.getIgnoreGraphic():t=="city"&&this.currentRegion.id.length>4?this.getIgnoreGraphic():t=="area"&&this.currentRegion.id.length>6?this.getIgnoreGraphic():t=="town"&&this.currentRegion.id.length>9?this.getIgnoreGraphic():t==null||t==""?this.getIgnoreGraphic():!0},getIgnoreGraphic(){return this.regionParent.code&&this.regionParent.code!=""?this.identical=!1:this.identical=!0,!this.widgetInfo.config.allowDrill||this.identical},getImageUrl(t){if(t&&t!=="")return p.appendImageBaseURL(t)}}},$=F,j=r(68141),T=(0,j.Z)($,C,f,!1,null,"21ccc086",null),J=T.exports}}]);
