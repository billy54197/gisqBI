(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[602],{87212:function(Q,N,o){var d=o(49500);Q.exports=function(s){var c={};function i(g){if(c[g])return c[g].exports;var n=c[g]={i:g,l:!1,exports:{}};return s[g].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=s,i.c=c,i.d=function(g,n,p){i.o(g,n)||Object.defineProperty(g,n,{enumerable:!0,get:p})},i.r=function(g){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},i.t=function(g,n){if(n&1&&(g=i(g)),n&8||n&4&&typeof g=="object"&&g&&g.__esModule)return g;var p=Object.create(null);if(i.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:g}),n&2&&typeof g!="string")for(var y in g)i.d(p,y,function(P){return g[P]}.bind(null,y));return p},i.n=function(g){var n=g&&g.__esModule?function(){return g.default}:function(){return g};return i.d(n,"a",n),n},i.o=function(g,n){return Object.prototype.hasOwnProperty.call(g,n)},i.p="/dist/",i(i.s=760)}({0:function(s,c){s.exports=o(42579)},1:function(s,c){s.exports=o(28866)},10:function(s,c){s.exports=o(42762)},2:function(s,c,i){"use strict";i.d(c,"a",function(){return g});function g(n,p,y,P,u,D,w,q){var E=typeof n=="function"?n.options:n;p&&(E.render=p,E.staticRenderFns=y,E._compiled=!0),P&&(E.functional=!0),D&&(E._scopeId="data-v-"+D);var A;if(w?(A=function(v){v=v||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!v&&typeof __VUE_SSR_CONTEXT__<"u"&&(v=__VUE_SSR_CONTEXT__),u&&u.call(this,v),v&&v._registeredComponents&&v._registeredComponents.add(w)},E._ssrRegister=A):u&&(A=q?function(){u.call(this,(E.functional?this.parent:this).$root.$options.shadowRoot)}:u),A)if(E.functional){E._injectStyles=A;var k=E.render;E.render=function(T,z){return A.call(z),k(T,z)}}else{var V=E.beforeCreate;E.beforeCreate=V?[].concat(V,A):[A]}return{exports:n,options:E}}},27:function(s,c){s.exports=o(78756)},28:function(s,c){s.exports=o(32726)},30:function(s,c){s.exports=o(32569)},4:function(s,c){s.exports=o(55616)},43:function(s,c){s.exports=o(47806)},46:function(s,c){s.exports=o(69257)},48:function(s,c){s.exports=o(81360)},5:function(s,c){s.exports=o(5146)},58:function(s,c){s.exports=o(65594)},6:function(s,c){s.exports=o(83574)},67:function(s,c){s.exports=o(31694)},68:function(s,c){s.exports=o(81534)},7:function(s,c){s.exports=o(17249)},70:function(s,c){s.exports=o(92086)},74:function(s,c){s.exports=o(84247)},760:function(s,c,i){"use strict";i.r(c);var g=i(0),n=i.n(g),p=function(){var r=this,t=r.$createElement,e=r._self._c||t;return e("div",{directives:[{name:"show",rawName:"v-show",value:r.shouldShow,expression:"shouldShow"}],staticClass:"sh-file-export"},[e("general-container",{ref:"container",attrs:{"is-show":r.visible,"style-config":r.styleConfig,title:r.title?r.title:"\u6587\u4EF6\u5BFC\u51FA","img-src":r.imgSrc?r.imgSrc:"file-export",position:r.position,theme:r.theme,"theme-style":r.cardThemeStyle,"drag-enable":r.dragEnable,"append-to-body":r.appendToBody,"only-container":r.onlyContainer},on:{"update:isShow":function(h){r.visible=h},"update:is-show":function(h){r.visible=h},"change:isShow":r.onChangeIsShow}},[e("div",{staticClass:"file-export-content"},[e("el-form",{ref:"form",attrs:{"label-width":"70px","label-position":"left"}},[e("el-form-item",{attrs:{label:"\u6587\u4EF6\u7C7B\u578B"}},[e("el-select",{attrs:{size:"small"},model:{value:r.fileType,callback:function(h){r.fileType=h},expression:"fileType"}},r._l(r.fileTypes,function(h){return e("el-option",{key:h.value,attrs:{label:h.label,value:h.value}})}),1)],1),e("el-form-item",{attrs:{label:"\u6587\u4EF6\u540D\u79F0"}},[e("el-input",{attrs:{size:"small"},model:{value:r.fileName,callback:function(h){r.fileName=h},expression:"fileName"}})],1),e("el-form-item",[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:r.fileExportEvt}},[r._v(`\u5BFC\u51FA
          `)])],1)],1)],1)])],1)},y=[];p._withStripped=!0;var P=i(48),u=i.n(P),D=i(9),w=i.n(D),q=i(10),E=i.n(q),A=i(46),k=i.n(A),V=i(1),v=i.n(V),T=i(27),z=i.n(T),j=i(67),B=i.n(j),$=i(58),b=i.n($),X=function(){function r(t){w()(this,r),this.url=t.url,this.token=t.token,this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.mapProjectionCode=t.mapProjectionCode}return E()(r,[{key:"generate",value:function(){var e=this,h=[],x=new B.a,m=this.mapProjectionCode.substring(this.mapProjectionCode.lastIndexOf(":")+1,this.mapProjectionCode.length);return this.exportFeatures.forEach(function(f){n()(this,e),h.push(x.writeFeature(f))}.bind(this)),new b.a(this.url).exportFile({wkts:h,extension:"shp",filename:this.exportFileName,wkid:m,exportFileExt:".zip",token:this.token})}}]),r}(),et=X,it=function(){function r(t){w()(this,r),this.url=t.url,this.token=t.token,this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.mapProjectionCode=t.mapProjectionCode}return E()(r,[{key:"generate",value:function(){var e=this,h=[],x=new B.a,m=this.mapProjectionCode.substring(this.mapProjectionCode.lastIndexOf(":")+1,this.mapProjectionCode.length);return this.exportFeatures.forEach(function(f){n()(this,e),h.push(x.writeFeature(f))}.bind(this)),new b.a(this.url).exportFile({wkts:h,extension:this.exportFileType,filename:this.exportFileName,wkid:m,exportFileExt:this.exportFileExt,token:this.token})}}]),r}(),Y=it,_=i(5),W=i.n(_),F=i(70),L=i(87),K=i(68),H=function(){function r(t){w()(this,r),t=k()({},t),this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.isWithDH=t.isWithDH,this.mapProjectionCode=t.mapProjectionCode,this.isDegree=t.isDegree,this.isToTransformProj=t.isToTransformProj,this.transformProjection=t.transformProjection,this.resultString=""}return E()(r,[{key:"generate",value:function(){var e,h,x="EPSG:4490";Object(K.registerProj)(x);var m="2000\u56FD\u5BB6\u5927\u5730\u5750\u6807\u7CFB",f=this.exportFeatures,C=this.mapProjectionCode.split(":")[1]*1,l;if(C<=4554&&C>=4513)l=C-4488;else for(var a=0,S=f.length;a<S;a++){var G=f[a].clone(),J=this.geoProjection(G),M=Object(F.getCenter)(J.getGeometry().getExtent());if(M[0]>=-180&&M[0]<=180){if(!l)l=parseInt((M[0]-1.5)/3+1);else if(l!==parseInt((M[0]-1.5)/3+1))throw new Error("\u9009\u4E2D\u7684\u8981\u7D20\u8DE8\u5E26")}else throw d.warn("\u5E26\u53F7\u89E3\u6790\u5931\u8D25",G,J),new Error("\u5E26\u53F7\u89E3\u6790\u5931\u8D25")}var Z=new Date,O=Z.getFullYear(),U=Z.getMonth()+1,nt=Z.getDate(),Ot=W()(e=W()(h="".concat(O,"-")).call(h,U,"-")).call(e,nt);this.resultString+=`[\u5C5E\u6027\u63CF\u8FF0]\r
`,this.resultString+=`\u683C\u5F0F\u7248\u672C\u53F7=1.01\u7248\u672C\r
`,this.resultString+=`\u6570\u636E\u4EA7\u751F\u5355\u4F4D=\r
`,this.resultString+="\u6570\u636E\u4EA7\u751F\u65E5\u671F=".concat(Ot,`\r
`),this.resultString+="\u5750\u6807\u7CFB="+m+`\r
`,this.resultString+=`\u51E0\u5EA6\u5206\u5E26=3\r
`,this.resultString+=`\u6295\u5F71\u7C7B\u578B=\u9AD8\u65AF\u514B\u5415\u683C\r
`,this.resultString+=`\u8BA1\u91CF\u5355\u4F4D=\u7C73\r
`,this.resultString+="\u5E26\u53F7=".concat(l,`\r
`),this.resultString+=`\u7CBE\u5EA6=0.01\r
`,this.resultString+=`\u8F6C\u6362\u53C2\u6570=0,0,0,0,0,0,0\r
`,this.resultString+=`[\u5730\u5757\u5750\u6807]\r
`;for(var tt=0,Nt=f.length;tt<Nt;tt++)if(f[tt].getGeometry().getType()==="Polygon"||f[tt].getGeometry().getType()==="MultiPolygon"){var lt=f[tt].clone(),R={};if(C<=4554&&C>=4513)R=lt,R.set("wkid",C),R.set("delNo",l);else{R=this.geoProjection(lt),R.set("delNo",l);var zt=l+4488;R.set("wkid",zt);var Bt=R.getGeometry(),Ht=R.get("wkid"),ht=this.isToTransformProj?this.transformProjection:"EPSG:"+Ht;Object(K.registerProj)(ht);var Zt=Bt.transform("EPSG:4490",ht);R.setGeometry(Zt)}var ft=R.getGeometry().getArea();R.get("DK_MJ")&&R.set("DK_MJ",ft),this.connectGeometryString(R,tt,ft)}else throw new Error("\u9009\u4E2D\u7684\u8981\u7D20\u4E2D\u542B\u6709\u975E\u9762\u8981\u7D20");this.export()}},{key:"geoProjection",value:function(e){var h="EPSG:4490",x=e.getGeometry().transform(this.mapProjectionCode,h);return e.setGeometry(x),e}},{key:"connectGeometryString",value:function(e,h,x){var m=this,f=0,C=[];e.getGeometry().getType()==="MultiPolygon"?(C=e.getGeometry().getPolygons(),e.getGeometry().getPolygons().forEach(function(a){var S=this;n()(this,m),a.getCoordinates().forEach(function(G){n()(this,S),f+=G.length}.bind(this))}.bind(this))):e.getGeometry().getType()==="Polygon"&&(C.push(e.getGeometry()),e.getGeometry().getCoordinates().forEach(function(a){n()(this,m),f+=a.length}.bind(this)));var l="";e.get("DK_MC")&&(l=e.get("DK_MC")),(l===void 0||l===""||l.toUpperCase()==="NULL")&&(l="\u7ED8\u5236\u5730\u5757"),this.resultString+=""+f+","+x+","+this.exportFileName+"-"+h+","+l+`,\u9762,,,,@\r
`,C.forEach(function(a){var S=this;n()(this,m);var G=0;a.getLinearRings().forEach(function(J){var M=this;n()(this,S),G++,J.getCoordinates().forEach(function(Z,O){n()(this,M),O===J.getCoordinates().length-1&&(O=0),this.resultString+="J"+(O+1)+","+G+","+Z[1].toFixed(3)+","+Z[0].toFixed(3)+`\r
`}.bind(this))}.bind(this))}.bind(this))}},{key:"export",value:function(){var e=new Blob(["\uFEFF"+this.resultString],{type:"text/plain;charset=utf-8"});Object(L.saveAs)(e,this.exportFileName+this.exportFileExt)}}]),r}(),ot=H,I=function(){function r(t){w()(this,r),t=k()({},t),this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.isWithDH=t.isWithDH,this.mapProjectionCode=t.mapProjectionCode,this.isDegree=t.isDegree,this.isToTransformProj=t.isToTransformProj,this.transformProjection=t.transformProjection,this.resultString=""}return E()(r,[{key:"generate",value:function(){var e="EPSG:4490";Object(K.registerProj)(e);for(var h=this.mapProjectionCode.split(":")[1]*1,x=this.exportFeatures,m=0,f=x.length;m<f;m++)if(x[m].getGeometry().getType()==="Polygon"||x[m].getGeometry().getType()==="MultiPolygon"){var C=x[m].clone(),l={};if(h<=4554&&h>=4513)l=C,l.set("wkid",h);else{l=this.geoProjection(C);var a=Object(F.getCenter)(l.getGeometry().getExtent());if(a[0]>=-180&&a[0]<=180){var S=parseInt((a[0]-1.5)/3+1,10);l.set("delNo",S);var G=S+4488;l.set("wkid",G)}}var J=l.getGeometry(),M=this.isToTransformProj?this.transformProjection:"EPSG:"+l.get("wkid");Object(K.registerProj)(M);var Z=J.transform("EPSG:"+h,M);l.setGeometry(Z);var O=l.getGeometry().getArea();l.get("DK_MJ")&&l.set("DK_MJ",O),this.connectGeometryString(l,m,O)}else throw new Error("\u9009\u4E2D\u7684\u8981\u7D20\u4E2D\u542B\u6709\u975E\u9762\u8981\u7D20");this.export()}},{key:"geoProjection",value:function(e){var h="EPSG:4490",x=e.getGeometry().transform(this.mapProjectionCode,h);return e.setGeometry(x),e}},{key:"connectGeometryString",value:function(e,h,x){var m=this,f=0,C=[];e.getGeometry().getType()==="MultiPolygon"?(C=e.getGeometry().getPolygons(),e.getGeometry().getPolygons().forEach(function(a){var S=this;n()(this,m),a.getCoordinates().forEach(function(G){n()(this,S),f+=G.length}.bind(this))}.bind(this))):e.getGeometry().getType()==="Polygon"&&(C.push(e.getGeometry()),e.getGeometry().getCoordinates().forEach(function(a){n()(this,m),f+=a.length}.bind(this)));var l="";e.get("DK_MC")&&(l=e.get("DK_MC")),this.resultString+=`\u5BFC\u51FA\u9762\u6570\u636E0
`,C.forEach(function(a,S){var G=this;n()(this,m);var J=0;a.getLinearRings().forEach(function(M){var Z=this;n()(this,G),J++,M.getCoordinates().forEach(function(O,U){n()(this,Z),U===M.getCoordinates().length-1&&(U=0),this.resultString+=O[0].toFixed(3)+","+O[1].toFixed(3)+`\r
`}.bind(this))}.bind(this))}.bind(this))}},{key:"export",value:function(){var e=new Blob(["\uFEFF"+this.resultString],{type:"text/plain;charset=utf-8"});Object(L.saveAs)(e,this.exportFileName+this.exportFileExt)}}]),r}(),rt=I,gt=function(){function r(t){w()(this,r),t=k()({},t),this.exportFileName=t.exportFileName,this.exportFileType=t.exportFileType,this.exportFileExt=t.exportFileExt,this.exportFeatures=t.exportFeatures,this.isWithDH=t.isWithDH,this.mapProjectionCode=t.mapProjectionCode,this.isDegree=t.isDegree,this.isToTransformProj=t.isToTransformProj,this.transformProjection=t.transformProjection,this.resultString=""}return E()(r,[{key:"generate",value:function(){var e="EPSG:4490";Object(K.registerProj)(e);var h="2000\u56FD\u5BB6\u5927\u5730\u5750\u6807\u7CFB";this.resultString=`\u5BFC\u51FA\u9762\u6570\u636E0\r
`;for(var x=this.mapProjectionCode.split(":")[1]*1,m=this.exportFeatures,f=0,C=m.length;f<C;f++)if(m[f].getGeometry().getType()==="Polygon"||m[f].getGeometry().getType()==="MultiPolygon"){var l=m[f].clone(),a={};if(x<=4554&&x>=4513)a=l,a.set("wkid",x);else{a=this.geoProjection(l);var S=Object(F.getCenter)(a.getGeometry().getExtent());if(S[0]>=-180&&S[0]<=180){var G=parseInt((S[0]-1.5)/3+1,10);a.set("delNo",G);var J=G+4488;a.set("wkid",J)}}var M=a.getGeometry(),Z=this.isToTransformProj?this.transformProjection:"EPSG:"+a.get("wkid");Object(K.registerProj)(Z);var O=M.transform("EPSG:"+x,Z);a.setGeometry(O);var U=a.getGeometry().getArea();a.get("DK_MJ")&&a.set("DK_MJ",U),this.connectGeometryString(a,f,U)}else throw new Error("\u9009\u4E2D\u7684\u8981\u7D20\u4E2D\u542B\u6709\u975E\u9762\u8981\u7D20");this.export()}},{key:"geoProjection",value:function(e){var h="EPSG:4490",x=e.getGeometry().transform(this.mapProjectionCode,h);return e.setGeometry(x),e}},{key:"connectGeometryString",value:function(e,h,x){var m=this,f=0,C=[];e.getGeometry().getType()==="MultiPolygon"?(C=e.getGeometry().getPolygons(),e.getGeometry().getPolygons().forEach(function(a){var S=this;n()(this,m),a.getCoordinates().forEach(function(G){n()(this,S),f+=G.length}.bind(this))}.bind(this))):e.getGeometry().getType()==="Polygon"&&(C.push(e.getGeometry()),e.getGeometry().getCoordinates().forEach(function(a){n()(this,m),f+=a.length}.bind(this)));var l="";e.get("DK_MC")&&(l=e.get("DK_MC")),C.forEach(function(a,S){var G=this;n()(this,m);var J=0;a.getLinearRings().forEach(function(M){var Z=this;n()(this,G),J++;var O=0;M.getCoordinates().forEach(function(U,nt){n()(this,Z),O=O+1,nt===M.getCoordinates().length-1&&(nt=0),this.resultString+=O+","+(h+1)+","+J+",J"+(nt+1)+","+U[0].toFixed(3)+","+U[1].toFixed(3)+`\r
`}.bind(this))}.bind(this))}.bind(this))}},{key:"export",value:function(){var e=new Blob(["\uFEFF"+this.resultString],{type:"text/plain;charset=utf-8"});Object(L.saveAs)(e,this.exportFileName+this.exportFileExt)}}]),r}(),ct=gt,dt=function(){function r(t){w()(this,r),t=k()({},t),this.map=v()(t),this.exportFileName=t.exportFileName?t.exportFileName:"exportFile",this.exportFileTypeAndExt=t.exportFileTypeAndExt?t.exportFileTypeAndExt:"SHP|.shp",this.mapProjectionCode=v()(this).getView().getProjection().getCode(),this.exportFeatures=v()(this).getSelectFeatures(),this.options={url:t.url,token:t.token,exportFileName:this.exportFileName,exportFileType:this.exportFileTypeAndExt.split("|")[0].toUpperCase(),exportFileExt:this.exportFileTypeAndExt.split("|")[1],isWithDH:!0,exportFeatures:this.exportFeatures,mapProjectionCode:this.mapProjectionCode,isToTransformProj:t.isToTransformProj,transformProjection:v()(this).transformProjection,isDegree:!1}}return E()(r,[{key:"exportFile",value:function(){if(this.exportFeatures&&this.exportFeatures.length>0)return this.options.exportFileType.indexOf("NDH")>=0&&(this.options.exportFileType=this.options.exportFileType.replace("NDH",""),this.options.isWithDH=!1),this.fileTypeFilter();throw new Error("\u5F53\u524D\u672A\u9009\u62E9\u5BFC\u51FA\u5730\u5757")}},{key:"fileTypeFilter",value:function(){var e=this;switch(this.options.exportFileType){case"SHP":{var h=new et(this.options);return h.generate()}case"DXF":case"DWG":{var x=new Y(this.options);return x.generate()}case"ZDY":{var m=new rt(this.options);return new z.a(function(l,a){n()(this,e);try{m.generate(),l("\u5BFC\u51FA\u6210\u529F")}catch(S){d.error(S),a(S)}}.bind(this))}case"ZJSGTZYT":{var f=new ct(this.options);return new z.a(function(l,a){n()(this,e);try{f.generate(),l("\u5BFC\u51FA\u6210\u529F")}catch(S){d.error(S),a(S)}}.bind(this))}case"GTJZD":{var C=new ot(this.options);return new z.a(function(l,a){n()(this,e);try{C.generate(),l("\u5BFC\u51FA\u6210\u529F")}catch(S){d.error(S),a(S)}}.bind(this))}default:return new z.a(function(l,a){n()(this,e),a("\u6240\u9009\u5BFC\u51FA\u6587\u4EF6\u683C\u5F0F\u4E0D\u652F\u6301")}.bind(this))}}}]),r}(),ut=dt,pt=i(6),mt=i.n(pt),vt=i(43),xt=i.n(vt),yt=i(7),Ct=i.n(yt),St=i(74),Et=i.n(St),Tt=i(30),Pt=i.n(Tt),st=i(4),It=void 0,jt={name:"ShFileExport",components:{GeneralContainer:Pt.a},directives:{cardDrag:Et.a},mixins:[mt.a,xt.a,Ct.a],props:{url:{type:String},isToTransformProj:{type:Boolean,default:!1},imgIconConfig:{type:Object},fileTypes:{type:Array,default:function(){return n()(this,It),[{label:"\u56FD\u571F\u8D44\u6E90\u90E8\u6807\u51C6\u683C\u5F0F(*.txt)",value:"GTJZD|.txt"},{label:"Shp\u6587\u4EF6",value:"SHP|.shp"},{label:"AutoCAD DXF\u6587\u4EF6(*.dxf)",value:"DXF|.dxf"},{label:"AutoCAD DWG\u6587\u4EF6(*.dwg)",value:"DWG|.dwg"},{label:"\u6D59\u6C5F\u7701\u56FD\u571F\u8D44\u6E90\u5385\u6587\u4EF6(*.txt)",value:"ZJSGTZYT|.txt"},{label:"\u81EA\u5B9A\u4E49\u6587\u4EF6(*.txt)",value:"ZDY|.txt"}]}.bind(void 0)}},data:function(){return{isComponentShow:!0,fileName:"",projection:"",exportTestIsShow:!0,projectionSelectIsShow:!1,fileType:"GTJZD|.txt",text:this.imgIconConfig&&this.imgIconConfig.text?this.imgIconConfig.text:"\u5BFC\u51FA",fontSizeValue:this.imgIconConfig&&this.imgIconConfig.fontSize?this.imgIconConfig.fontSize:"14px",fontColor:this.imgIconConfig&&this.imgIconConfig.fontColor?this.imgIconConfig.fontColor:"#fff",imgIcon:this.imgIconConfig&&this.imgIconConfig.img?this.imgIconConfig.img:"",width:this.imgIconConfig&&this.imgIconConfig.width?this.imgIconConfig.width:16,height:this.imgIconConfig&&this.imgIconConfig.height?this.imgIconConfig.height:16}},computed:{shouldShow:function(){return this.viewMode==="2D"?!0:this.viewMode==="3D"?!1:this.currentView==="map"}},mounted:function(){var t=this;this.$map&&setTimeout(function(){n()(this,t),this.begin()}.bind(this),0)},methods:{begin:function(){this.fileType=this.fileTypes.length>0?this.fileTypes[0].value:""},onChangeIsShow:function(t){this.$emit("change:isShow",t)},fileExportEvt:function(){var t,e=this;if(u()(t=this.fileName).call(t)==="")return Object(st.Message)({message:"\u6587\u4EF6\u540D\u4E0D\u80FD\u4E3A\u7A7A",type:"warning"}),!1;var h=this.$loading({lock:!0,target:this.$map.getTargetElement(),text:"\u5BFC\u51FA\u4E2D...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),x=new ut({map:this.$map,url:this.url?this.url:this.shinegaUrl+"/geofile/export",token:this.token,exportFileName:this.fileName,exportFileTypeAndExt:this.fileType,isToTransformProj:this.isToTransformProj});setTimeout(function(){var m=this;n()(this,e);try{x.exportFile().then(function(f){n()(this,m),h.close(),Object(st.Message)({message:f,type:"success"})}.bind(this)).catch(function(f){n()(this,m),h.close(),st.Message.error(f.message?f.message:f)}.bind(this))}catch(f){h.close(),d.error(f.message),st.Message.error(f.message)}}.bind(this),100)}}},bt=jt,wt=i(2),Ft=Object(wt.a)(bt,p,y,!1,null,null,null),Gt=Ft.exports,Dt=i(28),$t=i.n(Dt),Mt=void 0,at=$t()(Gt,{configName:"FileExport",transform:function(t){n()(this,Mt);var e=t.show,h=t.label,x=t.position,m=t.config,f=m===void 0?{}:m,C=[];for(var l in f.fileInfo){var a=f.fileInfo[l].value;f[a]===!0&&C.push(f.fileInfo[l])}return{isShow:e,title:h,position:x,fileTypes:C}}.bind(void 0)});at.install=function(r){r.component(at.name,at)};var At=c.default=at},87:function(s,c){s.exports=o(11227)},9:function(s,c){s.exports=o(22777)}})},47806:function(Q,N,o){"use strict";var d=o(19534);Object.defineProperty(N,"__esModule",{value:!0}),N.default=void 0;var s=d(o(52909)),c=d(o(42579)),i=void 0,g={inject:{generalCardThemeStyle:{default:null}},props:{styleConfig:{type:Object,default:function(){(0,c.default)(this,i)}.bind(void 0)},position:{type:Object,default:function(){return(0,c.default)(this,i),{type:"absolute",top:"100px",right:"135px"}}.bind(void 0)},themeStyle:{type:Object},imgSrc:{type:String},title:{type:String},isShow:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!1},dragEnable:{type:Boolean,default:!0},onlyContainer:{type:Boolean,default:!1}},data:function(){return{visible:this.isShow,theme:"light"}},watch:{currentView:{handler:function(y){y==="earth"?this.theme="dark":this.theme="light"},immediate:!0},isShow:function(y){this.visible=y}},computed:{cardThemeStyle:function(){return this.themeStyle||this.generalCardThemeStyle}},mounted:function(){var y,P=this;this.$_mixin_generalCard=(0,s.default)(y=this.$children).call(y,function(u){return(0,c.default)(this,P),u.$options.name==="ShGeneralCard"}.bind(this))},methods:{changeShow:function(y){var P;if((P=this.$_mixin_generalCard)===null||P===void 0||P.changeShow(y),y===!1||y!==!0&&this.visible){var u;(u=this.deactivate)===null||u===void 0||u.call(this)}},changeStatus:function(y){var P;(P=this.$_mixin_generalCard)===null||P===void 0||P.changeStatus(y)},getPosition:function(){var y;return(y=this.$_mixin_generalCard)===null||y===void 0?void 0:y.getPosition()}}},n=g;N.default=n},32726:function(Q,N,o){"use strict";var d=o(49500),s=o(85208),c=o(59791),i=o(22466),g=o(83393),n=o(5077),p=o(19534);Object.defineProperty(N,"__esModule",{value:!0}),N.default=z;var y=p(o(11323)),P=p(o(43389)),u=p(o(34749)),D=p(o(42579)),w=p(o(85208)),q=p(o(28866)),E=p(o(22466)),A=p(o(81806)),k=p(o(5146));function V(j,B){var $=s(j);if(c){var b=c(j);B&&(b=i(b).call(b,function(X){return g(j,X).enumerable})),$.push.apply($,b)}return $}function v(j){for(var B=1;B<arguments.length;B++){var $=arguments[B]!=null?arguments[B]:{};B%2?V(Object($),!0).forEach(function(b){(0,P.default)(j,b,$[b])}):n?Object.defineProperties(j,n($)):V(Object($)).forEach(function(b){Object.defineProperty(j,b,g($,b))})}return j}function T(j,B){for(var $=!1,b=j,X=function(){var it=this;b=b.$parent;var Y=b.$refs;Y&&(0,w.default)(Y).forEach(function(_){(0,D.default)(this,it),Y[_]===j&&(Y[_]=B,$=!0)}.bind(this))};b.$parent&&!$;)X()}function z(j){var B,$,b=this,X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},et=X.configName,it=X.componentName,Y=X.transform,_=(0,q.default)(B=(0,E.default)($=j.mixins||[]).call($,function(W){return(0,D.default)(this,b),!!W.props}.bind(this))).call(B,function(W){return(0,D.default)(this,b),{props:W.props}}.bind(this));return{name:it||j.name,props:j.props,mixins:_,inject:{reactiveConfigInstance:{default:function(){var F=this;return function(){return(0,D.default)(this,F),null}.bind(this)}}},data:function(){return this.$configInfo={},{ready:!1}},computed:{configInstance:function(){return this.reactiveConfigInstance()}},mounted:function(){this.initConfig()},methods:{initConfig:function(){var F=this;return(0,u.default)(y.default.mark(function L(){var K,H;return y.default.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!F.configInstance){I.next=17;break}return K=F.$options.name.replace("Sh",""),H={},I.prev=3,I.next=6,F.configInstance.getWidgetInfoByTag(et||K);case 6:H=I.sent,I.next=13;break;case 9:return I.prev=9,I.t0=I.catch(3),d.error(I.t0),I.abrupt("return");case 13:if(H.stat){I.next=15;break}return I.abrupt("return");case 15:typeof Y=="function"&&H.data?H=Y(H.data,F.configInstance.widgetInfo.mapConfig,{url:F.configInstance.url.replace("/role/getResources",""),schemeId:F.configInstance.schemeId}):H=H.data,F.$configInfo=v({},H);case 17:F.ready=!0;case 18:case"end":return I.stop()}},L,null,[[3,9]])}))()},forwordRef:function(){var F;T(this._self,this._self.$children[0]),(F=this._self.$children[0])===null||F===void 0||F.$emit("mounted",this._self.$children[0])}},render:function(F){var L,K=this,H;if((0,A.default)(L=(0,w.default)(this.$listeners)).call(L,"hook:mounted")){var ot;H=v(v({},this.$listeners),{},{"hook:mounted":(0,k.default)(ot=[this.forwordRef]).call(ot,this.$listeners["hook:mounted"])})}else H=v(v({},this.$listeners),{},{"hook:mounted":this.forwordRef});var I=this.$options.propsData;return(0,w.default)(I).forEach(function(rt){(0,D.default)(this,K),I[rt]===void 0&&delete I[rt]}.bind(this)),this.ready?F(j,{on:H,scopedSlots:this.$scopedSlots,props:v(v({},this.$configInfo),I),attrs:this.$attrs},this.$slots.default):null}}}},42709:function(Q,N,o){"use strict";var d=o(48836);const s={data(){return this.map=null,this.timer="",{isEditor:window.location.href.indexOf("editor.html")>0}},inject:{reactiveViewMode:{default:function(){return()=>"23D"}}},computed:{viewMode(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()}},mounted(){!this.widgetInfo.parentId&&this.isEditor&&this.widgetInfo.action.gisMapId&&this.$nextTick(function(){this.updateWidgetParentId({widgetId:this.widgetInfo.id,parentId:this.widgetInfo.action.gisMapId,keepPosition:!0})})},methods:{...(0,d.nv)(["updateWidgetParentId"]),getBindMap(){typeof this.widgetInfo.action.gisMapId<"u"}}};N.Z=s},76010:function(Q,N){"use strict";const o={data(){return{isSpecial:!1,isEditor:window.location.href.indexOf("editor.html")>0}},computed:{isBindToPage(){return this.widgetInfo.config.styleConfig.dragEnable||this.isSpecial},position(){return this.isEditor||!this.isBindToPage?{type:"absolute",top:"0px",left:"0px",bottom:"unset",right:"unset",zIndex:this.widgetInfo.attr.z}:{type:"absolute",top:this.widgetInfo.attr.y+"px",left:this.widgetInfo.attr.x+"px",zIndex:this.widgetInfo.attr.z}},styleConfig(){return{isShowBtn:this.widgetInfo.config.styleConfig.isShowBtn,isStartFix:this.isEditor,titleBar:{miniBtn:!0,maxBtn:!1,closeBtn:!1,fixBtn:!this.isEditor,title:!0},autoVisible:!1,btnSize:{size:this.widgetInfo.config.styleConfig.btnSize.size+"px",padding:this.widgetInfo.config.styleConfig.btnSize.padding+"px",radius:this.widgetInfo.config.styleConfig.btnSize.radius+"px"},size:{radius:this.widgetInfo.config.styleConfig.size.radius+"px",width:this.widgetInfo.attr.w>150?this.widgetInfo.attr.w+"px":"275px",height:this.widgetInfo.attr.hh>100?this.widgetInfo.attr.hh+"px":"80vh"},toolBtnSize:{size:this.widgetInfo.config.styleConfig.toolBtnSize.size+"px",margin:(this.widgetInfo.config.styleConfig.btnSize.size-this.widgetInfo.config.styleConfig.toolBtnSize.size)/2+"px"}}},themeConfig(){let d=this.widgetInfo.config.themeStyle.light;return{light:{title:{backgroundImage:"url('"+d.title.backgroundImage+"')",backgroundColor:d.title.backgroundColor?d.title.backgroundColor:d.floatButton.fillcolor,backgroundSize:d.title.backgroundSize,fontSize:d.title.fontSize+"px",color:d.title.fontColor},primaryFont:{fontSize:d.primaryFont.fontSize+"px",fontColor:d.primaryFont.fontColor},toolButton:{color:d.toolButton.color},panel:{backgroundImage:"url('"+d.panel.backgroundImage+"')",backgroundColor:d.panel.fillcolor,backgroundSize:d.panel.backgroundSize,border:d.panel.border},floatButton:{backgroundColor:d.floatButton.fillcolor,shadowColor:d.floatButton.shadowColor,border:d.floatButton.border}}}}},methods:{bindToPage(d){d&&this.isBindToPage&&(d.parentElement.remove(d),document.getElementById("page_"+this.widgetInfo.pageId).append(d),d.style.pointerEvents="auto",document.getElementById("container_child_"+this.widgetInfo.id).remove())}}};N.Z=o},44513:function(Q,N,o){"use strict";o.d(N,{Z:function(){return y}});var d=function(){var u=this,D=u._self._c;return u.attr.buttonHide?D("div",{style:{position:"absolute",right:u.attr.buttonHideRight+"px",top:u.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(w){return u.onHide()}}},[u.openTooltip?D("el-tooltip",{attrs:{"open-delay":1e3,content:u.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[D("el-button",{class:u.attr.buttonHideIconClass&&u.attr.buttonHideIconClass!=""?u.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:u.attr.buttonHideColor,fontSize:u.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):D("el-button",{class:u.attr.buttonHideIconClass&&u.attr.buttonHideIconClass!=""?u.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:u.attr.buttonHideColor,fontSize:u.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):u._e()},s=[],c=o(52246),i={props:["attr"],name:"hide-button",data(){return{isPc:c.b}},computed:{openTooltip:function(){let P=!1,u=this.attr.buttonHideTooltipContent;return c.b&&u&&u!=null&&u.trim()!=""&&(P=!0),P}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},g=i,n=o(68141),p=(0,n.Z)(g,d,s,!1,null,"bf399b9a",null),y=p.exports},30602:function(Q,N,o){"use strict";o.r(N),o.d(N,{default:function(){return V}});var d=function(){var T=this,z=T._self._c;return z("div",{directives:[{name:"show",rawName:"v-show",value:T.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"content",staticClass:"my-gisBase",style:{width:T.widgetInfo.attr.w+"px",height:T.widgetInfo.attr.hh+"px"}},[z("hide-button",{attrs:{attr:T.widgetInfo.attr}}),z("FileExport",{ref:"fileexport",attrs:{"btn-attr":T.btnAttr,"img-icon-config":T.imgIconConfig,position:T.position,"file-types":T.widgetInfo.config.fileTypes,"style-config":T.styleConfig,"theme-style":T.themeConfig,"drag-enable":T.widgetInfo.config.styleConfig.dragEnable,"img-src":T.widgetInfo.config.imgSrc}})],1)},s=[],c=o(87212),i=o.n(c),g=o(44513),n=o(35718),p=o(45061),y=o(26711),P=o(86892),u=o(76010),D=o(42709),w=o(49500),q={name:"GisFileExport",components:{FileExport:i(),HideButton:g.Z},mixins:[n.u,P.D,p.u,y.H,u.Z,D.Z],props:["widgetInfo"],data(){return{timer:"",map:null,tocConfig:null,btnAttr:this.widgetInfo.attr,imgIconConfig:this.widgetInfo.config.imgIconConfig}},mounted(){this.isEditor||this.$nextTick(()=>{let v=this.$refs.fileexport.$el;this.bindToPage(v)}),this.initAction(this.widgetInfo)},methods:{loadInfo(){},reLoadInfo(v){this.loadInfo(v),this.btnAttr=v.attr,this.imgIconConfig=v.config.imgIconConfig},initAction(v){this.actionReceive(v)},getBindMap(){if(typeof this.widgetInfo.action.gisMapId<"u"){let v=this.getWidgetObject(this.widgetInfo.action.gisMapId);if(v){clearInterval(this.timer);let T=v.$refs.gismap;T&&(w.log("\u83B7\u53D6map\u5BF9\u8C61\u6210\u529F\uFF0C\u56FE\u5C42\u76EE\u5F55\u7ED1\u5B9A\u5730\u56FE\uFF0C\u521D\u59CB\u5316\u56FE\u5C42\u64CD\u4F5C,\u5173\u95ED\u5B9A\u65F6\u5668"),this.map=T.map,this.$refs.fileexport.setMap(this.map))}}},doConfigMap(v,T,z){let j=T[z];w.info("======tctocovt========="),w.info(v),w.info(j),this.map=j,w.info("==============="),this.$refs.toc.initLayerManager(this.map)}}},E=q,A=o(68141),k=(0,A.Z)(E,d,s,!1,null,"73913800",null),V=k.exports}}]);
