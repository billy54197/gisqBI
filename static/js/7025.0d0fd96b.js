"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[7025],{98521:function(G,A,o){var C=o(75770),I=o(27966),O=o(55616),N=o.n(O),F=o(49500);A.Z={autoShow(L,b,v){let r=L;if(r.innerAutoShowInterval&&r.innerAutoShowInterval>-1&&(clearInterval(r.innerAutoShowInterval),r.innerAutoShowInterval=-1,b.dispatchAction({type:"downplay",dataIndex:r.innerAutoShowIndex}),r.innerAutoShowIndex=0),!(L&&b&&v&&v.enabled&&v.interval>0))return;let D=v.showTip;typeof r.innerAutoShowIndex>"u"&&(r.innerAutoShowIndex=0),r.innerAutoShowInterval=setInterval(function(){let d=b.getOption(),c=0,x=0;d.series[c].data?x=d.series[c].data.length:d.dataset&&d.dataset.length>0&&(x=d.dataset[0].source.length),x!=0&&(b.dispatchAction({type:"downplay",dataIndex:r.innerAutoShowIndex}),r.innerAutoShowIndex=(r.innerAutoShowIndex+1)%x,b.dispatchAction({type:"highlight",dataIndex:r.innerAutoShowIndex}),D&&b.dispatchAction({type:"showTip",seriesIndex:c,dataIndex:r.innerAutoShowIndex}),R(r,r.innerAutoShowIndex,c,d))},v.interval*1e3);function R(d,c,x,J){let h=d.widgetInfo;d.$$lib__.each(h.action.sendOut.actionList,m=>{if(m.enabled&&m.code==C.Z.autoHighLight.code){let M=h.dataset[h.dataset.type].dimensions,z=m.code+"_"+h.id,S={},E=[];if(h.dataset[h.dataset.type].source&&h.dataset[h.dataset.type].source.length>0&&(E=h.dataset[h.dataset.type].source[c]),S.x=d.getFieldVal(E,M,J.series[x].encode.x),S.y=d.getFieldVal(E,M,J.series[x].encode.y),d.getExtendParams(S,m.paramsExtend,E,M),m.script&&m.script.enabled){if(F.log("Execute script for "+h.name+" component to "+m.name+" component"),m.script.content==""){O.Message.warning({message:m.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}try{S=new Function("param,autoShowIndex,seriesIndex, opts",m.script.content).apply(d,[S,c,x,J])}catch(Z){F.error(Z)}}I.Z.$emit(z,S),m.postMessage&&d.doPostMessage(S)}})}}}},56279:function(G,A,o){o.d(A,{P:function(){return O}});var C=o(86892),I=o(49500);const O={mixins:[C.D],created(){},methods:{lifecycleBeforeChartsLoad(N){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&I.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),I.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let L=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[N]);if(L)return L}return N},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&I.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),I.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},77025:function(G,A,o){o.r(A),o.d(A,{default:function(){return Z}});var C=function(){var i=this,s=i._self._c;return s("div",{style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[s("hide-button",{attrs:{attr:i.widgetInfo.attr}}),s("div",{ref:"barStack",style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}})],1)},I=[],O=o(44513),N=o(27966),F=o(45061),L=o(26711),b=o(66758),v=o(99349),r=o(98521),D=o(75770),R=o(55616),d=o(67157),c=o(50666);const x={mixins:[d.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(c.Z.charts.title)),legend:JSON.parse(JSON.stringify(c.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(c.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(c.Z.charts.toolbox)),visualMap:{inRange:{color:["#000000"]}},dataZoom:JSON.parse(JSON.stringify(c.Z.charts.dataZoom)),xAxis:JSON.parse(JSON.stringify(c.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(c.Z.charts.yAxis)),series:[{itemStyle:{colorInfo:{type:"gradation",pureColor:"",gradation:{top:"rgba(146, 203, 255, 1)",bottom:"rgba(20, 122, 217, 1)"}},opacity:1}}]}}},methods:{filterPredefineColoursSchemeConfig(t,i){this.getNewConfigWithArrary(t,i,this.filter_config)}}};var J=o(56279),h=o(49500);const m=o(29426);var M={name:"BarStack",components:{HideButton:O.Z},mixins:[b.u,F.u,L.H,J.P,v.P,x],props:["widgetInfo"],data(){return{dimensionsEx:null,dimensionsAliasEx:null}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},destroyed(){this.echarts.dispose()},mounted(){this.echarts=m.init(this.$refs.barStack,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},methods:{loadInfo(t){let i=[],s=[],y=[],g=[];t.dataset[t.dataset.type]&&(i=t.dataset[t.dataset.type].source,s=t.dataset[t.dataset.type].dimensions,y=t.dataset[t.dataset.type].dimensionsAlias,g=t.dataset[t.dataset.type].encode),this.dimensionsEx=s,this.dimensionsAliasEx=y;let a=JSON.parse(JSON.stringify(t.config.series)),K=this.getTooltip(t.config.tooltip),U=JSON.parse(JSON.stringify(t.config.toolbox)),j=this.getTooltip(t.config.dataZoom),f=JSON.parse(JSON.stringify(t.config.legend)),u=JSON.parse(JSON.stringify(t.config.title)),$=JSON.parse(JSON.stringify(t.config.grid)),n=JSON.parse(JSON.stringify(t.config.xAxis)),l=JSON.parse(JSON.stringify(t.config.yAxis));for(let e=0;e<a.length;e++){a[e].dimensions=s,a[e].type="bar",a[e].barGap&&(a[e].barGap=a[e].barGap+"%"),a[e].barWidth&&(a[e].barWidth=a[e].barWidth+"%"),a[e].itemStyle.barBorderRadiusInfo&&(a[e].itemStyle.barBorderRadius=this.getItemStyleBarBorderRadius(a[e].itemStyle.barBorderRadiusInfo)),a[e].name||(a[e].name=this.getLegendData(y,a[e].encode.y),t.config.series[e].name=a[e].name),a[e].itemStyle.colorInfo.type&&(a[e].itemStyle.color=this.getItemStyleColor(a[e].itemStyle.colorInfo));let P={},T=[],H=[];for(let p=a[e].dimensions.length-1;p>-1;--p)P[s[p]]=p;for(let p=0;p<i.length;++p){let B=i[p];T.push(B[P[g.y[e]]]||""),H.push(B[P[g.x]]||"")}if(a[e].data=T,a[e].emphasis)try{if(a[e].emphasis.script&&a[e].emphasis.script.enabled){if(a[e].emphasis.script.content)try{let p=this,B=new Function("index","item","data",a[e].emphasis.script.content);a[e].data.forEach((W,k)=>{let V=B.call(p,k,W,T);a[e].data[k]={value:W,emphasis:V}})}catch(p){h.error("\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u811A\u672C\u62A5\u9519\uFF1A",p)}}else a[e].emphasis.itemStyle&&a[e].emphasis.itemStyle.color&&(a[e].emphasis={itemStyle:{...a[e].emphasis.itemStyle}})}catch(p){h.error("\u5904\u7406\u9AD8\u4EAE\u6837\u5F0F\u62A5\u9519\uFF1A",p)}n.data=H}let w={color:this.$$global_editor.predefineColors,tooltip:K,toolbox:U,dataZoom:j,visualMap:t.config.visualMap.show?this.getVisualMap(t.config.visualMap):"",title:{show:u.show,text:u.text,link:u.link,textAlign:u.textAlign,left:u.left+"%",right:u.right+"%",top:u.top+"%",bottom:u.bottom+"%",textStyle:{fontSize:u.textStyle.fontSize,fontFamily:u.textStyle.fontFamily,color:u.textStyle.color}},legend:{show:f.show,type:f.type,itemWidth:f.itemWidth,itemHeight:f.itemHeight,icon:f.icon,orient:f.orient,align:f.align,itemGap:f.itemGap,left:f.left+"%",right:f.right+"%",top:f.top+"%",bottom:f.bottom+"%",textStyle:{fontSize:f.textStyle.fontSize,fontFamily:f.textStyle.fontFamily,color:f.textStyle.color}},grid:{left:$.left+"%",right:$.right+"%",top:$.top+"%",bottom:$.bottom+"%",containLabel:!0},xAxis:[{type:"category",show:n.show,name:n.name,data:n.data,nameLocation:n.nameLocation,nameGap:n.nameGap,axisLine:{show:n.axisLine.show,lineStyle:{color:n.axisLine.lineStyle.color}},axisTick:{show:n.axisTick.show},axisLabel:{interval:n.axisLabel.interval,show:n.axisLabel.show,rotate:n.axisLabel.rotate,margin:n.axisLabel.margin,fontSize:n.axisLabel.fontSize,fontFamily:n.axisLabel.fontFamily,color:n.axisLabel.color,formatter:function(e,P){return n.axisLabel.script==!0?new Function("value, index",n.axisLabel.scriptontent).apply(this,[e,P]):n.axisLabel.vertical?e.split("").join(`
`):e}},splitLine:n.splitLine}],yAxis:[{scale:!0,type:"value",show:l.show,name:l.name,nameLocation:l.nameLocation,nameGap:l.nameGap,min:l.min,max:l.max,splitNumber:l.splitNumber,axisLine:{show:l.axisLine.show,lineStyle:{color:l.axisLine.lineStyle.color}},axisTick:{show:l.axisTick.show},axisLabel:{show:l.axisLabel.show,rotate:l.axisLabel.rotate,margin:l.axisLabel.margin,fontSize:l.axisLabel.fontSize,fontFamily:l.axisLabel.fontFamily,color:l.axisLabel.color},splitLine:l.splitLine}],dataset:{source:i,sourceHeader:!1},series:a};(!w.yAxis[0].min||w.yAxis[0].min=="")&&(w.yAxis[0].min=0),(!w.yAxis[0].max||w.yAxis[0].max=="")&&delete w.yAxis[0].max,this.getAnimation(w,t),this.setOption(w,t),this.setAnimationLoop(t,()=>{this.setOption(w,t)})},setOption(t,i){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0}),r.Z.autoShow(this,this.echarts,i.config.autoShow)},reLoadInfo(t){this.mergeConfig(t),t&&(this.$refs.barStack.style.width=t.attr.w+"px",this.$refs.barStack.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},getLegendData(t,i){let s=this.$$lib__.find(t,y=>y.name==i);return s?s.alias&&s.alias!=""?s.alias:s.name:""},getItemStyleColor(t){let i=null;return t.pureColor&&t.type==this.$$global_editor.colorType.pureColor.code?i=t.pureColor:t.type==this.$$global_editor.colorType.gradation.code&&(i=new m.graphic.LinearGradient(0,0,0,1,[{offset:0,color:t.gradation.top!=null&&t.gradation.top!=""?t.gradation.top:"#FFFFFF"},{offset:1,color:t.gradation.bottom!=null&&t.gradation.bottom!=""?t.gradation.bottom:"#FFFFFF"}])),i},getItemStyleBarBorderRadius(t){let i=[];return i.push(t.lt),i.push(t.rt),i.push(t.rb),i.push(t.lb),i},initAction(t){this.actionSendout(t),this.actionReceive(t)},actionSendout(t){let i=this;this.$$lib__.each(t.action.sendOut.actionList,s=>{if(s.enabled){let y=s.code+"_"+t.id;if(s.paramsExtend&&s.paramsExtend.length>0){let g={};this.getParamsExtend(g,s.paramsExtend,t)}s.code==D.Z.click.code&&i.onClick(y,s)}})},onClick(t,i){let s=this;s.echarts.on("click",y=>{let g={};g.x=y.name,g.y=y.value;let a=[];if(s.widgetInfo.dataset[s.widgetInfo.dataset.type].source&&s.widgetInfo.dataset[s.widgetInfo.dataset.type].source.length>0&&(a=s.widgetInfo.dataset[s.widgetInfo.dataset.type].source[y.dataIndex]),s.getExtendParams(g,i.paramsExtend,a,s.widgetInfo.dataset[s.widgetInfo.dataset.type].dimensions),i.script&&i.script.enabled){if(h.log("Execute script for "+s.widgetInfo.name+" component to "+i.name+" component"),i.script.content==""){R.Message.warning({message:i.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam=new Function("param,params",i.script.content),g=this.customScript_actionSend_clickParam(g,y)}N.Z.$emit(t,g),i.postMessage&&s.doPostMessage(g)})}}},z=M,S=o(68141),E=(0,S.Z)(z,C,I,!1,null,"026a1afc",null),Z=E.exports}}]);
