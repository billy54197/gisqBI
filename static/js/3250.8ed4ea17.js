"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[3250],{56279:function(R,w,r){r.d(w,{P:function(){return b}});var C=r(86892),p=r(49500);const b={mixins:[C.D],created(){},methods:{lifecycleBeforeChartsLoad(I){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&p.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let v=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[I]);if(v)return v}return I},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&p.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},44513:function(R,w,r){r.d(w,{Z:function(){return S}});var C=function(){var s=this,m=s._self._c;return s.attr.buttonHide?m("div",{style:{position:"absolute",right:s.attr.buttonHideRight+"px",top:s.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(y){return s.onHide()}}},[s.openTooltip?m("el-tooltip",{attrs:{"open-delay":1e3,content:s.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[m("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):m("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):s._e()},p=[],b=r(52246),I={props:["attr"],name:"hide-button",data(){return{isPc:b.b}},computed:{openTooltip:function(){let k=!1,s=this.attr.buttonHideTooltipContent;return b.b&&s&&s!=null&&s.trim()!=""&&(k=!0),k}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},z=I,v=r(68141),L=(0,v.Z)(z,C,p,!1,null,"bf399b9a",null),S=L.exports},93250:function(R,w,r){r.r(w),r.d(w,{default:function(){return D}});var C=function(){var t=this,i=t._self._c;return i("div",{ref:"rankingCarousel",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px",overflow:"hidden",cursor:t.getCursor(t.widgetInfo.action,t.$$global_editor.actionType.click.code)},on:{click:t.onClick}},[i("hide-button",{attrs:{attr:t.widgetInfo.attr}}),i("div",{style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px",overflow:"hidden",paddingTop:t.widgetInfo.config.board.paddingTop+"px",paddingRight:t.widgetInfo.config.board.paddingRight+"px",paddingBottom:t.widgetInfo.config.board.paddingBottom+"px",paddingLeft:t.widgetInfo.config.board.paddingLeft+"px"}},[i("div",{ref:t.ref,staticClass:"scroll-ranking",style:{width:t.widgetInfo.attr.w-t.widgetInfo.config.board.paddingLeft-t.widgetInfo.config.board.paddingRight+"px",height:t.widgetInfo.attr.hh-t.widgetInfo.config.board.paddingTop-t.widgetInfo.config.board.paddingBottom+"px"}},t._l(t.rows,function(o,d){return i("div",{key:o.toString()+o.scroll,staticClass:"row-item",style:`height: ${t.heights[d]}px;`,on:{click:function(n){return t.onClick(o)}}},[i("div",{staticClass:"ranking-info"},[i("div",{staticClass:"rank",style:{color:t.widgetInfo.config.board.rank.color,fontSize:t.widgetInfo.config.board.rank.fontSize+"px",fontFamily:t.widgetInfo.config.board.rank.fontFamily},domProps:{innerHTML:t._s(o.ranking)}}),i("div",{staticClass:"info-name",style:{color:t.widgetInfo.config.board.name.color,fontSize:t.widgetInfo.config.board.name.fontSize+"px",fontFamily:t.widgetInfo.config.board.name.fontFamily},domProps:{innerHTML:t._s(o.name)}}),i("div",{staticClass:"ranking-value",style:{color:t.widgetInfo.config.board.value.color,fontSize:t.widgetInfo.config.board.value.fontSize+"px",fontFamily:t.widgetInfo.config.board.value.fontFamily},domProps:{innerHTML:t._s(o.value)}}),i("div",{style:{color:t.widgetInfo.config.board.unit.color,fontSize:t.widgetInfo.config.board.unit.fontSize+"px",fontFamily:t.widgetInfo.config.board.unit.fontFamily}},[t._v(" "+t._s(t.mergedConfig.unit)+" ")])]),i("div",[i("div",{staticClass:"progress-border",style:{width:o.percent+"%",height:t.widgetInfo.config.board.progress.height+"px",backgroundColor:t.widgetInfo.config.board.progress.backgroundColor,borderRadius:t.widgetInfo.config.board.progress.borderRadius+"px"}},[t.widgetInfo.config.board.shine.enabled?i("div",{staticClass:"progress-shine",style:{top:t.widgetInfo.config.board.shine.top+"px",width:t.widgetInfo.config.board.shine.width+"px",height:t.widgetInfo.config.board.shine.height+"px",background:"radial-gradient("+t.widgetInfo.config.board.shine.backgroundColor+", transparent "+t.widgetInfo.config.board.shine.backgroundGradient+"%)",animationDuration:t.widgetInfo.config.board.shine.animationDuration+"s",animationIterationCount:"1"}}):t._e()])]),t.widgetInfo.config.board.full.enabled?i("div",{staticClass:"full-border",style:{width:"100%",height:t.widgetInfo.config.board.full.height+"px",marginTop:t.widgetInfo.config.board.full.marginTop+"px",backgroundColor:t.widgetInfo.config.board.full.backgroundColor,borderRadius:t.widgetInfo.config.board.full.borderRadius+"px"}}):t._e()])}),0)])],1)},p=[],b=r(27966),I=r(21300),z=r(45061),v=r(26711),L=r(56279),S=r(44513),k=r(47921),s=r(55616),m=r(75770),y=r(49500),T={name:"ComRankingCarousel",components:{HideButton:S.Z},mixins:[k.u,z.u,v.H,L.P],props:["widgetInfo"],data(){return{ref:"scroll-ranking",mergedConfig:null,rowsData:[],rows:[],heights:[],animationIndex:0,animationHandler:"",updater:0,dom:"",width:0,height:0,debounceInitWHFun:"",domObserver:""}},computed:{},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo),this.loadInfo(this.widgetInfo)}},mounted(){this.loadInfo(this.widgetInfo),this.initAction(this.widgetInfo),this.resizeObserver=new ResizeObserver((e,t)=>{this.loadInfo(this.widgetInfo)}),this.resizeObserver&&this.resizeObserver.observe(this.$refs.rankingCarousel)},destroyed(){this.stopAnimation(),this.unbindDomResizeCallback(),this.resizeObserver&&this.resizeObserver.unobserve(this.$refs.rankingCarousel)},methods:{loadInfo(e){this.rows=[],this.rowsData=[],this.mergedConfig={data:this.getRankingData(e),rowNum:e.config.carousel.rowNum,waitTime:e.config.carousel.waitTime,carousel:e.config.carousel.carousel,unit:e.config.board.unit.text,sort:e.config.carousel.sort},this.calcData(),this.autoResizeMixinInit(),this.lifecycleAfterLoad()},reLoadInfo(e){this.loadInfo(e)},getRankingData(e){let t=[];if(e.dataset[e.dataset.type]){let i=JSON.parse(JSON.stringify(e.dataset[e.dataset.type].source)),o=JSON.parse(JSON.stringify(e.dataset[e.dataset.type].encode)),d=JSON.parse(JSON.stringify(e.dataset[e.dataset.type].columnList)),n=null,l=null;d.forEach(c=>{o.name==c.name&&(n=c.index),o.value==c.name&&(l=c.index)}),i.forEach(c=>{let u={};u.name=c[n],u.value=c[l],t.push(u)})}return t},afterAutoResizeMixinInit(){this.calcData()},onResize(){this.mergedConfig&&this.calcHeights(!0)},calcData(){this.stopAnimation(),this.calcRowsData(),this.calcHeights(),this.widgetInfo.config.carousel.enabled&&this.animation(!0)},calcRowsData(){let{data:e,rowNum:t}=JSON.parse(JSON.stringify(this.mergedConfig)),i=0,o=[];for(let a in e)if(/^(-?\d+)(\.\d+)?$/.test(e[a].value)){if(!/^-?\d+$/.test(e[a].value)){let f=e[a].value+"";f.split(".")[1].length>i&&(i=f.split(".")[1].length)}o.push(e[a])}if(e=o,i>0)for(let a in e)e[a].value=e[a].value*Math.pow(10,i);this.mergedConfig.sort&&e.sort((a,f)=>f.value-a.value);const d=e.map(({value:a})=>a),n=Math.min(...d)||0,l=Math.abs(n),c=Math.max(...d)||0,u=Math.abs(c),h=c+l;if(e=e.map((a,f)=>({...a,ranking:f+1,percent:(parseInt(a.value)+l)/h*100})),i>0)for(let a in e)e[a].value=e[a].value/Math.pow(10,i);const x=e.length;x>t&&x<2*t&&(e=[...e,...e]),e=e.map((a,f)=>({...a,scroll:f}));let g=JSON.parse(JSON.stringify(this.widgetInfo.config.board));if(g.rank.type=="text"&&e.forEach(a=>{a.ranking=g.rank.html.replace(/\${ranking}/g,a.ranking)}),g.rank.type=="formatter"&&g.rank.formatter&&g.rank.formatter.scriptContent)if(y.log("Execute script for "+this.widgetInfo.name),g.rank.formatter.scriptContent=="")s.Message.warning({message:"\u6392\u540D\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});else{let a=new Function("item,index",g.rank.formatter.scriptContent);e.forEach((f,H)=>{f.ranking=a(f,H)})}e&&(this.rowsData=e,this.rows=e)},calcHeights(e=!1){const{height:t,mergedConfig:i}=this,{rowNum:o,data:d}=i,n=t/o;this.avgHeight=n,e||(this.heights=new Array(d.length).fill(n))},async animation(e=!1){let{avgHeight:t,animationIndex:i,mergedConfig:o,rowsData:d,animation:n,updater:l}=this;const{waitTime:c,carousel:u,rowNum:h}=o,x=d.length;if(h>=x||e&&(await new Promise(H=>setTimeout(H,c)),l!==this.updater))return;const g=u==="single"?1:h;let a=d.slice(i);if(a.push(...d.slice(0,i)),u=="single"?this.rows=a.slice(0,h+1):this.rows=a,this.heights=new Array(x).fill(t),await new Promise(H=>setTimeout(H,300)),l!==this.updater)return;this.heights.splice(0,g,...new Array(g).fill(0)),i+=g;const f=i-x;f>=0&&(i=f),this.animationIndex=i,this.animationHandler=setTimeout(n,c-300)},stopAnimation(){const{animationHandler:e,updater:t}=this;this.updater=(t+1)%999999,e&&clearTimeout(e)},async autoResizeMixinInit(){await this.initWH(!1),this.getDebounceInitWHFun(),this.bindDomResizeCallback(),typeof this.afterAutoResizeMixinInit=="function"&&this.afterAutoResizeMixinInit()},initWH(e=!0){const{$nextTick:t,$refs:i,ref:o,onResize:d}=this;return new Promise(n=>{t(()=>{const l=this.dom=i[o];this.width=l?l.clientWidth:0,this.height=l?l.clientHeight:0,l?(!this.width||!this.height)&&y.warn("Component width or height is 0px, rendering abnormality may occur!"):y.warn("Failed to get dom node, component rendering may be abnormal!"),typeof d=="function"&&e&&d(),n()})})},getDebounceInitWHFun(){this.debounceInitWHFun=this.debounce(100,this.initWH)},bindDomResizeCallback(){this.domObserver=this.observerDomResize(this.dom,this.debounceInitWHFun),window.addEventListener("resize",this.debounceInitWHFun)},debounce(e,t){let i;return function(){clearTimeout(i);const[o,d]=[this,arguments];i=setTimeout(()=>{t.apply(o,d)},e)}},observerDomResize(e,t){const i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,o=new i(t);return o.observe(e,{attributes:!0,attributeFilter:["style"],attributeOldValue:!0}),o},unbindDomResizeCallback(){},initAction(e){this.actionReceive(e)},onClick(e){if(!e.ranking)return;let t=this.widgetInfo,i=[],o=this,d=t.action.sendOut.actionList;o.$$lib__.each(d,n=>{let l=n.code+"_"+t.id,c={};n.paramsExtend&&n.paramsExtend.length>0&&o.getParamsExtend(c,n.paramsExtend,t);let u=n.postMessage;if(n.enabled&&n.code==m.Z.click.code){if(t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(i=t.dataset[t.dataset.type].source[e.scroll]),o.getExtendParams(c,n.paramsExtend,i,t.dataset[t.dataset.type].dimensions),n.script&&n.script.enabled){if(y.log("Execute script for "+o.widgetInfo.name+" component to "+n.name+" component"),n.script.content==""){s.Message.warning({message:n.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}c=new Function("params,info",n.script.content)(e,this.widgetInfo)}b.Z.$emit(l,e),u&&o.doPostMessage(e)}else if(n.enabled&&n.code==m.Z.click.openLink.code){if(n.paramsExtend&&n.paramsExtend.length>0){let h=[];t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(h=t.dataset[t.dataset.type].source[e.index]),n.type===o.$$global_editor.linkType.dynamic.code&&(n[o.$$global_editor.linkType.dynamic.code].url=o.getActionUrl(n,t.dataset[t.dataset.type].source[e.index],t.dataset[t.dataset.type].dimensions)),o.getExtendParams(c,n.paramsExtend,h,t.dataset[t.dataset.type].dimensions)}if(n.script&&n.script.enabled){if(y.log("Execute script for "+o.widgetInfo.name+" component to "+n.name+" component"),n.script.content==""){s.Message.warning({message:n.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}c=new Function("params,info",n.script.content)(e,this.widgetInfo)}o.openLinkAction(n,e)}})}}},M=T,F=r(68141),O=(0,F.Z)(M,C,p,!1,null,"2ce9d960",null),D=O.exports}}]);
