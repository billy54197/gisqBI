"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[2237],{402237:function(ct,c,e){var S=e(149500),p=e(465557),A=e(985208),q=e(659791),j=e(22466),E=e(183393),K=e(105077),et=e(520314),_=e(426352),N=e(230551),P=e(43586),L=e(419534);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var w=L(e(828866)),I=L(e(578756)),b=L(e(543389)),R=L(e(342579)),F=L(e(122777)),d=L(e(42762)),h=L(e(330044)),V=L(e(299085)),W=L(e(234009)),at=L(e(407165)),$=e(519704),J=e(59269),D=L(e(340980)),k=e(101117),C=e(110563),U=L(e(437661));function G(M,Q){var B=typeof N<"u"&&P(M)||M["@@iterator"];if(!B){if(Array.isArray(M)||(B=ot(M))||Q&&M&&typeof M.length=="number"){B&&(M=B);var l=0,a=function(){};return{s:a,n:function(){return l>=M.length?{done:!0}:{done:!1,value:M[l++]}},e:function(s){throw s},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n=!0,i=!1,r;return{s:function(){B=B.call(M)},n:function(){var s=B.next();return n=s.done,s},e:function(s){i=!0,r=s},f:function(){try{!n&&B.return!=null&&B.return()}finally{if(i)throw r}}}}function ot(M,Q){var B;if(M){if(typeof M=="string")return ut(M,Q);var l=et(B=Object.prototype.toString.call(M)).call(B,8,-1);if(l==="Object"&&M.constructor&&(l=M.constructor.name),l==="Map"||l==="Set")return _(M);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return ut(M,Q)}}function ut(M,Q){(Q==null||Q>M.length)&&(Q=M.length);for(var B=0,l=new Array(Q);B<Q;B++)l[B]=M[B];return l}function gt(M,Q){var B=A(M);if(q){var l=q(M);Q&&(l=j(l).call(l,function(a){return E(M,a).enumerable})),B.push.apply(B,l)}return B}function vt(M){for(var Q=1;Q<arguments.length;Q++){var B=arguments[Q]!=null?arguments[Q]:{};Q%2?gt(Object(B),!0).forEach(function(l){(0,b.default)(M,l,B[l])}):K?Object.defineProperties(M,K(B)):gt(Object(B)).forEach(function(l){Object.defineProperty(M,l,E(B,l))})}return M}function Tt(M){var Q=pt();return function(){var l=(0,W.default)(M),a;if(Q){var n=(0,W.default)(this).constructor;a=p(l,arguments,n)}else a=l.apply(this,arguments);return(0,V.default)(this,a)}}function pt(){if(typeof Reflect>"u"||!p||p.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(p(Boolean,[],function(){})),!0}catch{return!1}}var Et=function(M){(0,h.default)(B,M);var Q=Tt(B);function B(l,a,n){var i;return(0,F.default)(this,B),i=Q.call(this),i.active=!1,i.targetLayerId="",i.map=l,i.earth=a,i._initDrawTool(n),i}return(0,d.default)(B,[{key:"_initDrawTool",value:function(){var a=this,n=[];(0,w.default)(this)&&n.push(new I.default(function(i){var r=this;(0,R.default)(this,a),Promise.resolve().then(e.bind(e,519704)).then(function(t){(0,R.default)(this,r);var s=t.default;this.initMapTool(s),i()}.bind(this))}.bind(this))),this.earth&&n.push(new I.default(function(i){var r=this;(0,R.default)(this,a),Promise.all([e.e(93503),e.e(51611)]).then(e.bind(e,351611)).then(function(t){(0,R.default)(this,r);var s=t.default;this.initEarthTool(s,J.BASE_DRAWLAYER_ID),i()}.bind(this))}.bind(this))),I.default.all(n).then(function(){(0,R.default)(this,a),this.dispatchEvent({type:"inited",target:this.earthDrawTool})}.bind(this))}},{key:"initMapTool",value:function(a){var n=this;this.mapDrawTool=new a((0,w.default)(this)),this.targetLayerId=this.mapDrawTool.sourceId,this.mapDrawTool.init(),this.mapDrawTool.on("drawend",function(i){if((0,R.default)(this,n),this.earthDrawTool)try{var r=this.earthDrawTool.loadFeature(i.feature);i.feature.setFeature3d(r?.[0])}catch(t){S.warn(t)}this.dispatchEvent(i)}.bind(this)),this.mapDrawTool.on("modifyend",function(i){if((0,R.default)(this,n),(i.feature.type==="circle"||i.feature.type==="ellipse")&&this.mapDrawTool.editFeature(i.feature.feature2d),this.earthDrawTool){var r=this.earthDrawTool._drawTool.getEntityById(i.feature.id);this.earthDrawTool._drawTool.setCoordinates(i.feature.getCoordinates(),r);var t=i.feature.getAttr3d();t.style.perPositionHeight=!0,this.earthDrawTool._drawTool.updateAttribute(t,r)}this.dispatchEvent(new $.DrawToolEvent("edit-move-point",i.feature))}.bind(this)),this.mapDrawTool.on("drawstart",function(i){(0,R.default)(this,n),this.dispatchEvent(i)}.bind(this)),this.mapDrawTool.on("change:active",function(i){(0,R.default)(this,n),this.dispatchEvent(i)}.bind(this)),this.mapDrawTool.on("edit-stop",function(i){(0,R.default)(this,n),this.currEditFeature=null,this.dispatchEvent(i)}.bind(this)),this.mapDrawTool.on("edit-start",function(i){(0,R.default)(this,n);var r=i.feature;if(this.earthDrawTool){var t=this.earthDrawTool._drawTool.getEntityById(r.id);r.setFeature3d(t)}this.currEditFeature=r,this.dispatchEvent(new $.DrawToolEvent("edit-start",r))}.bind(this))}},{key:"initEarthTool",value:function(a,n){var i=this;this.targetLayerId=n,this.earthDrawTool=new a(this.earth.viewer,{id:n,hasEdit:!0});var r=this.earthDrawTool._drawTool;r.hasEdit(!1),r.on("change:active",function(t){(0,R.default)(this,i),this.dispatchEvent(new $.DrawToolActiveEvent($.DrawToolEventType.CHANGEACTIVE,t.drawtype,t.active))}.bind(this)),r.on("draw-created",function(t){(0,R.default)(this,i);var s=new D.default({event3d:t});if(this.mapDrawTool){var m=this.mapDrawTool.loadFeature(s);s.setFeature2d(m)}this.dispatchEvent(new $.DrawToolEvent($.DrawToolEventType.DRAWEND,s)),r.startEditing(t.entity)}.bind(this)),r.on("delete-feature",function(t){var s;(0,R.default)(this,i);var m=t==null||(s=t._attribute)===null||s===void 0?void 0:s.attr;this.mapDrawTool&&m&&this.mapDrawTool.removeFeature(m.id,m.layerId),this.dispatchEvent(new $.DrawToolEvent("delete-feature",m))}.bind(this)),r.on("draw-add-point",function(){(0,R.default)(this,i),this.dispatchEvent(new $.DrawToolEvent("drawstart"))}.bind(this)),r.on("edit-move-point",function(t){(0,R.default)(this,i);var s=new D.default({event3d:t});if(this.mapDrawTool){var m=this.mapDrawTool.loadFeature(s);s.setFeature2d(m),this.mapDrawTool.editFeature(m)}this.dispatchEvent(new $.DrawToolEvent("edit-move-point",s))}.bind(this)),r.on("edit-remove-point",function(t){(0,R.default)(this,i);var s=new D.default({event3d:t});if(this.mapDrawTool){var m=this.mapDrawTool.loadFeature(s);s.setFeature2d(m),this.mapDrawTool.editFeature(m)}this.dispatchEvent(new $.DrawToolEvent("edit-remove-point",s))}.bind(this)),r.on("edit-start",function(t){(0,R.default)(this,i);var s=new D.default({event3d:t});if(this.mapDrawTool){var m,X=t.entity.attribute.attr.id,O=t.entity.attribute.attr.layerId,lt=(m=this.mapDrawTool.getFeature(X,O))===null||m===void 0?void 0:m.feature2d;lt&&s.setFeature2d(lt)}this.currEditFeature=s,this.dispatchEvent(new $.DrawToolEvent("edit-start",s))}.bind(this)),r.on("edit-stop",function(){(0,R.default)(this,i),this.currEditFeature=null,this.dispatchEvent(new $.DrawToolEvent("edit-stop"))}.bind(this))}},{key:"activate",value:function(a,n,i){if(this.hasEdit(!1),this.activeType=a,n){var r,t=(r=U.default[a])===null||r===void 0?void 0:r.style;n=(0,C.mergeObjs)(t,n)}this.getCurrentView()==="map"?this.mapDrawTool&&this.mapDrawTool.activate(a,n,i):this.earthDrawTool&&this.earthDrawTool.activate(a,n)}},{key:"hasEdit",value:function(a,n){var i;this.mapDrawTool&&(a?(this.mapDrawTool.activate("modify"),n&&this.mapDrawTool.editFeature(n.feature2d)):this.mapDrawTool.deactivate("modify")),!((i=this.earthDrawTool)===null||i===void 0)&&i._drawTool&&this.earthDrawTool._drawTool.hasEdit(a),this.activeType=a?"edit":null,this.isEdit=a}},{key:"stopEditing",value:function(){this.mapDrawTool&&this.mapDrawTool.stopEditing(),this.earthDrawTool&&this.earthDrawTool._drawTool.stopEditing()}},{key:"deactivate",value:function(a){this.activeType=null,this.mapDrawTool&&this.mapDrawTool.deactivate(a),this.earthDrawTool&&this.earthDrawTool.deactivate(a)}},{key:"removeAll",value:function(a){this.mapDrawTool&&this.mapDrawTool.removeAll(a),this.earthDrawTool&&this.earthDrawTool.removeAll(a)}},{key:"setEditLayer",value:function(a){this.targetLayerId=a,this.mapDrawTool&&this.mapDrawTool.setEditLayer(a),this.earthDrawTool&&this.earthDrawTool._drawTool.setEditLayer(a)}},{key:"createDrawLayer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={drawLayerType:J.BASE_DRAWLAYER_TYPE,id:(0,k.v4)(),isShow:!0,label:J.BASE_DRAWLAYER_ID,isPop:!1,mapIndex:99999};a=vt(vt({},n),a);var i={};return(0,w.default)(this)&&(i.map=(0,w.default)(this).createDrawLayer(a)),this.earth&&(i.earth=this.earth.createDrawLayer(a)),i.option=a,i}},{key:"loadGeoJson",value:function(a,n){try{typeof a=="string"&&(a=JSON.parse(a))}catch(O){S.error(O.name+": "+O.message+` 
\u8BF7\u786E\u8BA4json\u6587\u4EF6\u683C\u5F0F\u6B63\u786E!!!`);return}if(a.type==="FeatureCollection"&&a.features.length>0){var i=[],r=G(a.features),t;try{for(r.s();!(t=r.n()).done;){var s=t.value,m=this._loadGeoJson(s,n);i.push(m)}}catch(O){r.e(O)}finally{r.f()}return n.isFly&&this.flyTo(i),i}else{var X=this._loadGeoJson(a,n);return n.isFly&&this.flyTo(X),[X]}}},{key:"_loadGeoJson",value:function(a,n){return this.loadFeature(vt({geojson:a},n))}},{key:"loadFeature",value:function(a){var n,i;if(!a.geojson){S.warn("geojson\u4E0D\u5B58\u5728\u65E0\u6CD5\u7ED8\u5236");return}if(a.id||(a.id=(0,k.v4)()),a.type||(a.type=(0,C.getSymbolType)((0,C.getGeometryTypeFromGeoJSON)(a.geojson))),((n=a.geojson)===null||n===void 0||(i=n.geometry)===null||i===void 0?void 0:i.type)==="MultiPolygon"&&(a.id=a.id+"_multi0"),a.layerId||(a.layerId=this.targetLayerId),this.mapDrawTool&&(a.feature2d=this.mapDrawTool.loadFeature(a)),this.earthDrawTool){var r;a.feature3d=(r=this.earthDrawTool.loadFeature(a))===null||r===void 0?void 0:r[0]}return a}},{key:"removeFeatures",value:function(a){var n=G(a),i;try{for(n.s();!(i=n.n()).done;){var r=i.value;this.removeFeature(r)}}catch(t){n.e(t)}finally{n.f()}}},{key:"removeFeature",value:function(a){if(this.mapDrawTool&&this.mapDrawTool.removeFeature(a.id,a.layerId),this.earth){var n=this.earth.viewer.shine.getLayer(a.layerId,"id");n&&n.deleteFeatureById(a.id)}}},{key:"setFeatureStyle",value:function(a,n){this.mapDrawTool&&this.mapDrawTool.setFeatureStyle(a,n),this.earthDrawTool&&this.earthDrawTool.setFeatureStyle(a,n)}},{key:"updateAttribute",value:function(a,n){n==null&&(n=this.currEditFeature),a.drawtype&&(a.drawtype==="plotting"?a.plottingType&&(n.type=a.plottingType):n.type=a.drawtype),n.style=a.style,n.setAttr(a.attr),this.mapDrawTool&&this.mapDrawTool.updateAttribute(a,n),this.earthDrawTool&&(n.feature3d||(n.feature3d=this.earthDrawTool._getEntity()),this.earthDrawTool._drawTool.updateAttribute(a,n.feature3d))}},{key:"setAttr",value:function(a,n){if(n==null&&(n=this.currEditFeature),n.setAttr(a),this.mapDrawTool&&this.mapDrawTool.setAttr(n.getAttr(),n),this.earthDrawTool){var i=n.feature3d;i||(i=this.earthDrawTool._drawTool.getFeatureById(n.id,n.layerId)),i&&(i.attribute.attr=vt(vt({},i.attribute.attr),n.getAttr()))}}},{key:"setCoordinates",value:function(a,n){if(this.mapDrawTool&&this.mapDrawTool.setCoordinates(a,n),this.earthDrawTool){var i=n.getAttr3d();i.style.perPositionHeight=!0,this.earthDrawTool._drawTool.updateAttribute(i),this.earthDrawTool._drawTool.setCoordinates(a,n.feature3d),this.earthDrawTool.updateDraggers()}}},{key:"getCurrEditFeature",value:function(){return this.currEditFeature}},{key:"setLayerVisible",value:function(a,n){this.earth&&this.earth.viewer.shine.getLayer(a,"id").setLayerVisible(n),(0,w.default)(this)&&(0,w.default)(this).getLayerById(a).setVisible(n)}},{key:"setFeatureVisible",value:function(a){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=a.layerId,r=a.id;if(this.earth){var t=this.earth.viewer.shine.getLayer(i,"id"),s=t.getFeatureById(r);t.setFeatureVisible(s,n)}(0,w.default)(this)&&(0,w.default)(this).getLayerById(i).getSource().setFeatureVisible(r,n)}},{key:"importData",value:function(a){var n=G(a),i;try{for(n.s();!(i=n.n()).done;){var r=i.value;r.tp==="layer"&&(this.createDrawLayer(r),r.isShow||this.setLayerVisible(r.id,r.isShow))}}catch(O){n.e(O)}finally{n.f()}var t=G(a),s;try{for(t.s();!(s=t.n()).done;){var m=s.value;try{if(m.tp==="feature"){var X=new D.default(m);this.mapDrawTool&&this.mapDrawTool.loadFeature(X),this.earthDrawTool&&this.earthDrawTool.loadFeature(X),m.isShow||this.setFeatureVisible(m,!1)}}catch(O){S.warn(O)}}}catch(O){t.e(O)}finally{t.f()}}},{key:"flyTo",value:function(a){var n=this.getCurrentView();n==="map"?this.mapDrawTool&&this.mapDrawTool.flyToFeatures(a):this.earthDrawTool&&this.earthDrawTool.flyToFeatures(a)}},{key:"setCurrentView",value:function(a){this.activeType&&this.activeType!=="edit"&&(a==="map"?(this.earthDrawTool&&this.earthDrawTool.deactivate(),this.mapDrawTool&&this.mapDrawTool.activate(this.activeType)):(this.mapDrawTool&&this.mapDrawTool.deactivate(),this.earthDrawTool&&this.earthDrawTool.activate(this.activeType)))}},{key:"getCurrentView",value:function(){if((0,w.default)(this))if(this.earth){var a=(0,w.default)(this).getContainer().style.display!=="none";return a?"map":"earth"}else return"map";else return"earth"}}]),B}(at.default),yt=Et;c.default=yt},340980:function(ct,c,e){var S=e(985208),p=e(659791),A=e(22466),q=e(183393),j=e(105077),E=e(419534);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var K=E(e(66273)),et=E(e(543389)),_=E(e(122777)),N=E(e(42762)),P=e(437926),L=E(e(437661)),w=e(110563);function I(F,d){var h=S(F);if(p){var V=p(F);d&&(V=A(V).call(V,function(W){return q(F,W).enumerable})),h.push.apply(h,V)}return h}function b(F){for(var d=1;d<arguments.length;d++){var h=arguments[d]!=null?arguments[d]:{};d%2?I(Object(h),!0).forEach(function(V){(0,et.default)(F,V,h[V])}):j?Object.defineProperties(F,j(h)):I(Object(h)).forEach(function(V){Object.defineProperty(F,V,q(h,V))})}return F}var R=function(){function F(d){if((0,_.default)(this,F),d){var h;d.feature2d?this.generateByFeature2d(d.feature2d,d.layerId):d.event3d?this.generateByEvent3d(d.event3d):(this.id=d.id,this.layerId=d.layerId,this.type=d.type,this.geojson=typeof d.geojson=="string"?JSON.parse(d.geojson):d.geojson,this.style=d.style,this.geoEntityId=d.geoEntityId),(h=this.geojson)!==null&&h!==void 0&&h.properties&&delete this.geojson.properties.layerId}}return(0,N.default)(F,[{key:"generateByFeature2d",value:function(h,V){this.feature2d=h,this.layerId=V;var W=h.getGeometry();this.id=h.getId(),h.getProperties().id||h.setProperties({id:this.id}),W.isPlot?(this.geojson=JSON.parse(W.getGeoJson()),this.type=W.getPlotType(),this.setAttr(h.getProperties())):(this.geojson=(0,P.getGeoJsonFromGeometry)(h.getGeometry()),this.setAttr(h.getProperties()),this.type=(0,w.getSymbolType)(W.getType())),h.drawType&&(this.type=h.drawType),this.style=h.originStyle}},{key:"generateByEvent3d",value:function(h){this.id=h.entity.attribute.attr.id,this.feature3d=h.entity,this.type=h.drawtype,this.layerId=h.entity.attribute.attr.layerId,this.geojson=JSON.parse((0,K.default)(h.geojson)),this.geojson&&(this.style=this.geojson.properties.style,this.geojson.properties=this.geojson.properties.attr,this.type==="plotting"&&(this.type=this.feature3d.attribute.plottingType))}},{key:"setFeature2d",value:function(h){this.feature2d=h}},{key:"setFeature3d",value:function(h){this.feature3d=h}},{key:"getAttr3d",value:function(){if(this.feature3d)return this.feature3d.attribute;var h=typeof this.geojson=="string"?JSON.parse(this.geojson):this.geojson;return{edittype:L.default[this.type].edittype,drawtype:L.default[this.type].drawtype,plottingType:L.default[this.type].plottingType,attr:h.properties,style:this.style}}},{key:"getCoordinates",value:function(){if(this.geojson){var h=typeof this.geojson=="string"?JSON.parse(this.geojson):this.geojson,V=h.type==="Feature"?h.geometry:h;return V.type==="Point"?[V.coordinates]:V.type==="Polygon"?V.coordinates[0]:V.coordinates}}},{key:"setAttr",value:function(h){if(typeof this.geojson=="string"&&(this.geojson=JSON.parse(this.geojson)),this.geojson&&h){var V={};for(var W in h)h[W]instanceof Object||(V[W]=h[W]);this.geojson.properties=b(b({},this.geojson.properties),V),this.type==="plotting"&&(this.type=this.geojson.properties.plottingType,delete this.geojson.properties.plottingType,delete this.geojson.properties.isPlotting)}}},{key:"getAttr",value:function(){return typeof this.geojson=="string"&&(this.geojson=JSON.parse(this.geojson)),this.geojson.properties}}]),F}();c.default=R},437926:function(ct,c,e){Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getFeaturesFromGeoJson",{enumerable:!0,get:function(){return S.getFeaturesFromGeoJson}}),Object.defineProperty(c,"getGeoJsonFromFeature",{enumerable:!0,get:function(){return S.getGeoJsonFromFeature}}),Object.defineProperty(c,"getGeoJsonFromFeatures",{enumerable:!0,get:function(){return S.getGeoJsonFromFeatures}}),Object.defineProperty(c,"getGeoJsonFromGeometry",{enumerable:!0,get:function(){return S.getGeoJsonFromGeometry}}),Object.defineProperty(c,"transformCoordinate",{enumerable:!0,get:function(){return S.transformCoordinate}}),Object.defineProperty(c,"transformExtent",{enumerable:!0,get:function(){return S.transformExtent}});var S=e(439705)},519704:function(ct,c,e){var S=e(149500),p=e(29870),A=e(465557),q=e(520314),j=e(426352),E=e(230551),K=e(43586),et=e(985208),_=e(659791),N=e(22466),P=e(183393),L=e(105077),w=e(787879),I=e(419534);Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.DrawToolEventType=c.DrawToolEvent=c.DrawToolActiveEvent=void 0;var b=I(e(638006)),R=I(e(298924)),F=I(e(828866)),d=I(e(543389)),h=I(e(342579)),V=I(e(42762)),W=I(e(122777)),at=I(e(330044)),$=I(e(299085)),J=I(e(234009)),D=I(e(828659)),k=I(e(758397)),C=I(e(217712)),U=I(e(918601)),G=r(e(91398)),ot=e(351502),ut=I(e(407165)),gt=I(e(12207)),vt=e(101117),Tt=I(e(349162)),pt=e(692086),Et=e(197149),yt=e(59269),M=I(e(340980)),Q=I(e(437661)),B=e(437926),l=e(355217),a=I(e(647598)),n=I(e(289517));function i(g){if(typeof w!="function")return null;var H=new w,x=new w;return(i=function(o){return o?x:H})(g)}function r(g,H){if(!H&&g&&g.__esModule)return g;if(g===null||p(g)!=="object"&&typeof g!="function")return{default:g};var x=i(H);if(x&&x.has(g))return x.get(g);var y={},o=Object.defineProperty&&P;for(var u in g)if(u!=="default"&&Object.prototype.hasOwnProperty.call(g,u)){var f=o?P(g,u):null;f&&(f.get||f.set)?Object.defineProperty(y,u,f):y[u]=g[u]}return y.default=g,x&&x.set(g,y),y}function t(g,H){var x=et(g);if(_){var y=_(g);H&&(y=N(y).call(y,function(o){return P(g,o).enumerable})),x.push.apply(x,y)}return x}function s(g){for(var H=1;H<arguments.length;H++){var x=arguments[H]!=null?arguments[H]:{};H%2?t(Object(x),!0).forEach(function(y){(0,d.default)(g,y,x[y])}):L?Object.defineProperties(g,L(x)):t(Object(x)).forEach(function(y){Object.defineProperty(g,y,P(x,y))})}return g}function m(g,H){var x=typeof E<"u"&&K(g)||g["@@iterator"];if(!x){if(Array.isArray(g)||(x=X(g))||H&&g&&typeof g.length=="number"){x&&(g=x);var y=0,o=function(){};return{s:o,n:function(){return y>=g.length?{done:!0}:{done:!1,value:g[y++]}},e:function(Z){throw Z},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,f=!1,v;return{s:function(){x=x.call(g)},n:function(){var Z=x.next();return u=Z.done,Z},e:function(Z){f=!0,v=Z},f:function(){try{!u&&x.return!=null&&x.return()}finally{if(f)throw v}}}}function X(g,H){var x;if(g){if(typeof g=="string")return O(g,H);var y=q(x=Object.prototype.toString.call(g)).call(x,8,-1);if(y==="Object"&&g.constructor&&(y=g.constructor.name),y==="Map"||y==="Set")return j(g);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return O(g,H)}}function O(g,H){(H==null||H>g.length)&&(H=g.length);for(var x=0,y=new Array(H);x<H;x++)y[x]=g[x];return y}function lt(g){var H=T();return function(){var y=(0,J.default)(g),o;if(H){var u=(0,J.default)(this).constructor;o=A(y,arguments,u)}else o=y.apply(this,arguments);return(0,$.default)(this,o)}}function T(){if(typeof Reflect>"u"||!A||A.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(A(Boolean,[],function(){})),!0}catch{return!1}}var z={CHANGEACTIVE:"change:active",DRAWEND:"drawend"};c.DrawToolEventType=z;var tt=function(g){(0,at.default)(x,g);var H=lt(x);function x(y,o,u){var f;return(0,W.default)(this,x),f=H.call(this,y),f.tool=o,f.active=u,f}return(0,V.default)(x)}(gt.default);c.DrawToolActiveEvent=tt;var rt=function(g){(0,at.default)(x,g);var H=lt(x);function x(y,o,u){var f;return(0,W.default)(this,x),f=H.call(this,y),f.feature=o,f.geojson=u,f}return(0,V.default)(x)}(gt.default);c.DrawToolEvent=rt;var nt=function(g){(0,at.default)(x,g);var H=lt(x);function x(y,o){var u;return(0,W.default)(this,x),u=H.call(this),u.name="DrawTool",u.active=!1,u.map=y,u.controlMap=new b.default,u.editorControl=new C.default(y),u.options=o||(0,R.default)(G),u.sourceId=yt.BASE_DRAWLAYER_ID,u}return(0,V.default)(x,[{key:"init",value:function(){if(!(0,F.default)(this).getLayerById(this.sourceId)){S.error("\u672A\u53D1\u73B0\u7ED8\u5236\u56FE\u5C42");return}this.drawSource=(0,F.default)(this).getLayerById(this.sourceId).getSource(),this.editorControl.clearControl(),this.controlMap.clear();var o=m(this.options),u;try{for(o.s();!(u=o.n()).done;){var f=u.value;this.createControlByName(f)}}catch(v){o.e(v)}finally{o.f()}}},{key:"destory",value:function(){this.editorControl.destory()}},{key:"removeFeature",value:function(o,u){try{(0,F.default)(this).getLayerById(u).getSource().removeFeatureById(o)}catch(f){S.warn(f)}}},{key:"generateControlByName",value:function(o){switch(o){case G.DRAWPOINT:return new D.default({drawname:o,source:this.drawSource});case G.DRAWLINE:return new D.default({drawname:o,type:"LineString",source:this.drawSource});case G.DRAWPOLYGON:return new D.default({drawname:o,type:"Polygon",source:this.drawSource});case G.MODIFY:return new U.default({source:this.drawSource,sourceId:this.sourceId});case G.CLEAR:return new k.default({source:this.drawSource})}}},{key:"createControlByName",value:function(o){var u=this,f=this.generateControlByName(o);if(f)return f.on("change:active",function(v){(0,h.default)(this,u),this.dispatchEvent(new tt(z.CHANGEACTIVE,o,v.detail.control.active))}.bind(this)),f.isDraw&&(f.on("drawstart",function(v){(0,h.default)(this,u),this.dispatchEvent(v)}.bind(this)),f.on("drawend",function(v){(0,h.default)(this,u),f.drawname&&(v.feature.drawType=f.drawname);var Y=new M.default({feature2d:v.feature,layerId:this.sourceId});this.dispatchEvent(new rt(z.DRAWEND,Y))}.bind(this))),f.isModify&&(f.on("modifyend",function(v){(0,h.default)(this,u);var Y=new M.default({feature2d:v.features.getArray()[0],layerId:this.sourceId});this.dispatchEvent(new rt("modifyend",Y))}.bind(this)),f.on("edit-start",function(v){(0,h.default)(this,u);var Y=new M.default({feature2d:v.features,layerId:this.sourceId});this.currEditFeature=Y,this.dispatchEvent(new rt("edit-start",Y))}.bind(this)),f.on("edit-stop",function(v){(0,h.default)(this,u),this.currEditFeature=null,this.dispatchEvent(v)}.bind(this))),this.controlMap.set(o,f),this.editorControl.addControl(f),f}},{key:"getControlByName",value:function(o){return this.controlMap.get(o)}},{key:"activate",value:function(o,u,f){var v=this.getControlByName(o);if(v){var Y,Z;v.activate(u||((Y=Q.default[o])===null||Y===void 0?void 0:Y.style),f||((Z=Q.default[o])===null||Z===void 0?void 0:Z.attr))}}},{key:"deactivate",value:function(o){if(o){var u=this.getControlByName(o);u.deactivate()}else{var f=this.editorControl.getActiveControls(),v=m(f.getArray()),Y;try{for(v.s();!(Y=v.n()).done;){var Z=Y.value;Z.deactivate()}}catch(it){v.e(it)}finally{v.f()}}}},{key:"removeSelect",value:function(){var o=this.editorControl.getEditFeature();o&&this.drawSource.removeFeature(o)}},{key:"removeAll",value:function(o){if(o){var u=(0,F.default)(this).getLayerById(o);u&&u.getSource().clear()}else this.drawSource.clear()}},{key:"setEditLayer",value:function(o){this.sourceId=o,this.drawSource=(0,F.default)(this).getLayerById(o).getSource(),this.editorControl.setEditSource(this.drawSource,o)}},{key:"loadGeoJson",value:function(o){var u=this,f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=f.isClear,Y=v===void 0?!1:v,Z=f.isFly,it=Z===void 0?!1:Z,st=f.layerId,ht=st===void 0?yt.BASE_DRAWLAYER_ID:st,dt=f.style,Ft=new Tt.default,mt=Ft.readFeatures(o),Dt=(0,F.default)(this).getLayerById(ht);if(!Dt){S.error("\u5730\u56FE\u4E2D\u4E0D\u5B58\u5728id\u4E3A".concat(ht,"\u7684\u56FE\u5C42\uFF0C\u8BF7\u5148\u521B\u5EFA"));return}if(Y&&Dt.getSource().clear(),dt){var wt=(0,Et.getStyleFormGeneralStyle)(dt);mt.forEach(function(St){(0,h.default)(this,u),St.targetLayerId=ht,St.setStyle(wt)}.bind(this))}if(Dt.getSource().addFeatures(mt),it){for(var xt=mt[0].getGeometry().getExtent(),Ct=1;Ct<mt.length;Ct++)(0,pt.extend)(xt,mt[Ct].getGeometry().getExtent());(0,F.default)(this).getView().fit(xt,{size:(0,F.default)(this).getSize(),padding:[100,100,100,100],duration:700})}return mt}},{key:"removeFeatures",value:function(o){var u=this;o.forEach(function(f){(0,h.default)(this,u),this.removeFeature(f)}.bind(this))}},{key:"setFeatureStyle",value:function(o,u){return u=s(s({},o.style),u),this.updateAttribute({style:u},o),o}},{key:"editFeature",value:function(o){var u=this.getControlByName("modify");u&&(u.getActive()||u.activate(),u.setSelectFeature(o))}},{key:"stopEditing",value:function(){var o=this.getControlByName("modify");o&&o.stopEditing()}},{key:"loadFeature",value:function(o){var u=n.default[o.type],f=[ot.POINT,ot.POLYLINE,ot.POLYGON],v,Y=Q.default[o.type],Z=s(s({},Y.style),o.style);if(f.indexOf(u)>-1){var it=(0,B.getFeaturesFromGeoJson)(o.geojson);it&&it.length>0&&(v=it[0]),v.originStyle=Z}else{var st=(0,l.createPlotByJson)(o);v=new a.default,v.setGeometry(st),st.setStyle(Z),v.originStyle=st.style}if(v){var ht;v.drawType=o.type;var dt=o==null||(ht=o.getAttr)===null||ht===void 0?void 0:ht.call(o);if(dt&&v.setProperties(dt),v.setId(o.id?o.id:(0,vt.v4)()),o.layerId){var Ft=(0,F.default)(this).createDrawLayer({id:o.layerId});this.addFeature(Ft.getSource(),v)}else this.addFeature(this.drawSource,v);v.setStyle((0,l.getStyle)(o.type,Z,(0,F.default)(this)))}return v}},{key:"addFeature",value:function(o,u){u.getId()&&o.getFeatureById(u.getId())&&o.removeFeature(o.getFeatureById(u.getId())),o.addFeature(u)}},{key:"getFeature",value:function(o,u){if(o&&u){var f=(0,F.default)(this).getLayerById(u);if(f){var v=f.getSource().getFeatureById(o);if(v)return new M.default({feature2d:v,layerId:this.sourceId})}}}},{key:"setCoordinates",value:function(o,u){if(u==null&&(u=this.currEditFeature),!(u==null||o==null)){var f=n.default[u.type];f===ot.POINT?u.feature2d.getGeometry().setCoordinates(o[0]):f===ot.POLYLINE?u.feature2d.getGeometry().setCoordinates(o):f===ot.POLYGON?u.feature2d.getGeometry().setCoordinates([o]):f==="circle"||f==="ellipse"?u.feature2d.getGeometry().setCenter(o[0]):u.feature2d.getGeometry().setPoints(o)}}},{key:"_getOlFeature",value:function(o){if(o==null&&(o=this.currEditFeature),o!=null){var u=o.feature2d;if(!u){var f;u=(f=this.getFeature(o.id,o.layerId))===null||f===void 0?void 0:f.feature2d}return u}}},{key:"updateAttribute",value:function(o,u){var f=this._getOlFeature(u);if(!(f==null||o==null)){var v=f.getGeometry();v.setRadius&&v.setRadius(o.style),f.originStyle=o.style,f.drawType=u.type,f.setStyle((0,l.getStyle)(u.type,o.style,(0,F.default)(this))),f.setProperties(o.attr)}}},{key:"setAttr",value:function(o,u){var f=this._getOlFeature(u);f==null||o==null||f?.setProperties(o)}},{key:"flyToFeatures",value:function(o){var u;if(Array.isArray(o)){var f=m(o),v;try{for(f.s();!(v=f.n()).done;){var Y=v.value,Z=this._getOlFeature(Y);Z&&(u?(0,pt.extend)(u,Z.getGeometry().getExtent()):u=Z.getGeometry().getExtent())}}catch(st){f.e(st)}finally{f.f()}}else{var it=this._getOlFeature(o);it&&(u=it.getGeometry().getExtent())}u&&(0,F.default)(this).getView().fit(u,{padding:[200,200,200,200]})}},{key:"getCurrEditFeature",value:function(){return this.currEditFeature}}]),x}(ut.default),ft=nt;c.default=ft},758397:function(ct,c,e){var S=e(465557),p=e(419534);Object.defineProperty(c,"__esModule",{value:!![]}),c.default=void 0;var A=p(e(828866)),q=p(e(122777)),j=p(e(42762)),E=p(e(330044)),K=p(e(299085)),et=p(e(234009)),_=p(e(383698));function N(I){var b=P();return function(){var F=(0,et.default)(I),d;if(b){var h=(0,et.default)(this).constructor;d=S(F,arguments,h)}else d=F.apply(this,arguments);return(0,K.default)(this,d)}}function P(){if(typeof Reflect>"u"||!S)return![];if(S.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(S(Boolean,[],function(){})),!![]}catch{return![]}}var L=function(I){(0,E.default)(R,I);var b=N(R);function R(F){var d;return(0,q.default)(this,R),d=b.call(this,F),d.source=F.source,d}return(0,j.default)(R,[{key:"onClick",value:function(){this.source.clear(),(0,A.default)(this).setSelectFeatures([])}}]),R}(_.default),w=L;c.default=w},383698:function(ct,c,e){var S=e(465557),p=e(985208),A=e(659791),q=e(22466),j=e(183393),E=e(105077),K=e(419534);Object.defineProperty(c,"__esModule",{value:!![]}),c.default=void 0;var et=K(e(828866)),_=K(e(342579)),N=K(e(543389)),P=K(e(122777)),L=K(e(42762)),w=K(e(330044)),I=K(e(299085)),b=K(e(234009)),R=K(e(951641)),F=K(e(692405));function d(J,D){var k=p(J);if(A){var C=A(J);D&&(C=q(C).call(C,function(U){return j(J,U).enumerable})),k.push.apply(k,C)}return k}function h(J){for(var D=1;D<arguments.length;D++){var k=arguments[D]!=null?arguments[D]:{};D%2?d(Object(k),!0).forEach(function(C){(0,N.default)(J,C,k[C])}):E?Object.defineProperties(J,E(k)):d(Object(k)).forEach(function(C){Object.defineProperty(J,C,j(k,C))})}return J}function V(J){var D=W();return function(){var C=(0,b.default)(J),U;if(D){var G=(0,b.default)(this).constructor;U=S(C,arguments,G)}else U=C.apply(this,arguments);return(0,I.default)(this,U)}}function W(){if(typeof Reflect>"u"||!S)return![];if(S.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(S(Boolean,[],function(){})),!![]}catch{return![]}}var at=function(J){(0,w.default)(k,J);var D=V(k);function k(C){var U=this,G;return(0,P.default)(this,k),G=D.call(this),G.dialogTarget=C.dialogTarget,G.properties=h({},C),G.source=C.source||new F.default({features:C.features}),G.sourceId=C.sourceId,G.layerFilter=C.layerFilter||function(ot){return(0,_.default)(this,U),!G.source||ot.get("id")===G.sourceId}.bind(this),G.editor=null,G.standalone=!![],G}return(0,L.default)(k,[{key:"onClick",value:function(){this.active?this.deactivate():this.activate()}},{key:"setMap",value:function(U){this.map=U}},{key:"setEditor",value:function(U){this.editor=U}},{key:"setSource",value:function(U,G){this.source=U,this.sourceId=G}},{key:"activate",value:function(U){!this.getActive()&&(this.active=!![],this.properties.activeImg&&(this.img.src=this.properties.activeImg),!U&&this.dispatchEvent({type:"change:active",target:this,detail:{control:this}})),this.openDialog()}},{key:"deactivate",value:function(U){this.active=![],this.properties.deactiveImg&&(this.img.src=this.properties.deactiveImg),!U&&this.dispatchEvent({type:"change:active",target:this,detail:{control:this}}),this.closeDialog()}},{key:"getActive",value:function(){return this.active}},{key:"openDialog",value:function(){this.closeDialog(),this.getDialogTemplate&&(this.dialogDiv=document.createElement("div"),this.dialogDiv.innerHTML=`
        <div class="ole-dialog">
          `.concat(this.getDialogTemplate(),`
        </div>
      `),(this.dialogTarget||(0,et.default)(this).getTargetElement()).appendChild(this.dialogDiv))}},{key:"closeDialog",value:function(){this.dialogDiv&&((this.dialogTarget||(0,et.default)(this).getTargetElement()).removeChild(this.dialogDiv),this.dialogDiv=null)}},{key:"setProperties",value:function(U,G){this.properties=h(h({},this.properties),U),!G&&this.dispatchEvent({type:"propertychange",target:this,detail:{properties:this.properties,control:this}})}},{key:"getProperties",value:function(){return h({},this.properties)}}]),k}(R.default),$=at;c.default=$},828659:function(ct,c,e){var S=e(465557),p=e(419534);Object.defineProperty(c,"__esModule",{value:!![]}),c.default=void 0;var A=p(e(828866)),q=p(e(342579)),j=p(e(122777)),E=p(e(42762)),K=p(e(553144)),et=p(e(330044)),_=p(e(299085)),N=p(e(234009)),P=p(e(765056)),L=p(e(383698)),w=e(355217),I=e(101117),b=p(e(17369));function R(V){var W=F();return function(){var $=(0,N.default)(V),J;if(W){var D=(0,N.default)(this).constructor;J=S($,arguments,D)}else J=$.apply(this,arguments);return(0,_.default)(this,J)}}function F(){if(typeof Reflect>"u"||!S)return![];if(S.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(S(Boolean,[],function(){})),!![]}catch{return![]}}var d=function(V){(0,et.default)(at,V);var W=R(at);function at($){var J=this,D;(0,j.default)(this,at),D=W.call(this,$),D.isDraw=!![],D.source=$.source,D.drawname=$.drawname;var k=$.type?$.type:"Point";switch(k){case"Point":case"MultiPoint":D.type="point";break;case"LineString":case"LinearRing":case"MultiLineString":D.type="polyline";break;case"Polygon":case"MultiPolygon":D.type="polygon";break}return D.drawInteraction=new P.default({type:k,features:$.features,style:$.style,stopClick:!![]}),D.drawInteraction.on("drawend",function(C){if((0,q.default)(this,J),D.source){D.originStyle&&(C.feature.originStyle=D.originStyle,C.feature.setStyle(D.featureStyle)),D.initAttr&&C.feature.setProperties(D.initAttr);var U=(0,I.v4)();C.feature.setId(U),C.feature.set("id",U),C.feature.set("layerId",D.sourceId),D.source.addFeature(C.feature)}if(C.feature.getGeometry().getType()===b.default.POINT){var G=C.feature.getGeometry().getCoordinates();G.push(500),C.feature.getGeometry().setCoordinates(G)}D.dispatchEvent(C)}.bind(this)),D.drawInteraction.on("drawstart",function(C){(0,q.default)(this,J),D.dispatchEvent(C)}.bind(this)),D}return(0,E.default)(at,[{key:"activate",value:function(J,D){this.originStyle=J,this.initAttr=D,J&&(this.featureStyle=(0,w.getStyle)(this.drawname?this.drawname:this.type,J),this.drawInteraction.getOverlay().setStyle(this.featureStyle)),(0,A.default)(this).addInteraction(this.drawInteraction),(0,K.default)((0,N.default)(at.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(J){(0,A.default)(this).removeInteraction(this.drawInteraction),(0,K.default)((0,N.default)(at.prototype),"deactivate",this).call(this,J)}}]),at}(L.default),h=d;c.default=h},918601:function(ct,c,e){var S=e(29870),p=e(465557),A=e(787879),q=e(183393),j=e(419534);Object.defineProperty(c,"__esModule",{value:!![]}),c.default=void 0;var E=j(e(828866)),K=j(e(705146)),et=j(e(520314)),_=j(e(669033)),N=j(e(636583)),P=j(e(122777)),L=j(e(42762)),w=j(e(387507)),I=j(e(553144)),b=j(e(330044)),R=j(e(299085)),F=j(e(234009)),d=j(e(342579)),h=e(407165),V=e(692086),W=e(91873),at=j(e(491131)),$=e(505775),J=e(612768),D=e(708326),k=e(648847),C=j(e(383698)),U=Tt(e(856674)),G=j(e(641739)),ot=e(59269),ut=e(986200),gt=void 0;function vt(l){if(typeof A!="function")return null;var a=new A,n=new A;return(vt=function(r){return r?n:a})(l)}function Tt(l,a){if(!a&&l&&l.__esModule)return l;if(l===null||S(l)!=="object"&&typeof l!="function")return{default:l};var n=vt(a);if(n&&n.has(l))return n.get(l);var i={},r=Object.defineProperty&&q;for(var t in l)if(t!=="default"&&Object.prototype.hasOwnProperty.call(l,t)){var s=r?q(l,t):null;s&&(s.get||s.set)?Object.defineProperty(i,t,s):i[t]=l[t]}return i.default=l,n&&n.set(l,i),i}function pt(l){var a=Et();return function(){var i=(0,F.default)(l),r;if(a){var t=(0,F.default)(this).constructor;r=p(i,arguments,t)}else r=i.apply(this,arguments);return(0,R.default)(this,r)}}function Et(){if(typeof Reflect>"u"||!p)return![];if(p.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(p(Boolean,[],function(){})),!![]}catch{return![]}}var yt=function(a,n){if((0,d.default)(this,gt),!a)return[];var i=a;return typeof a=="function"&&(n?i=a(n):i=a()),Array.isArray(i)?i:[i]}.bind(void 0),M=new W.Style({image:new W.Circle({radius:5,fill:new W.Fill({color:"rgba(25,25,125,0.8)"}),stroke:new W.Stroke({color:"rgba(255,255,255,0.6)",width:2})}),geometry:function(a){var n=this;(0,d.default)(this,gt);var i=[];return a.getGeometry().getType()==="Polygon"?a.getGeometry().getCoordinates()[0].forEach(function(r){(0,d.default)(this,n),i.push(r)}.bind(this)):a.getGeometry().getType()==="MultiPolygon"?a.getGeometry().getCoordinates()[0].forEach(function(r){var t=this;(0,d.default)(this,n),r.forEach(function(s){(0,d.default)(this,t),i.push(s)}.bind(this)),i.push(r)}.bind(this)):a.getGeometry().getType()==="LineString"?i=a.getGeometry().getCoordinates():i=[a.getGeometry().getCoordinates()],new at.default([a.getGeometry(),new $.MultiPoint(i)])}.bind(void 0)}),Q=function(l){(0,b.default)(n,l);var a=pt(n);function n(i){var r=this,t;(0,P.default)(this,n),t=a.call(this,i),t.isModify=!![];var s="oldStyles",m="selectMoveOnChangeKey",X="selectModifyOnChangeKey";t.coordinate=null,t.previousCursor=null,t.hitTolerance=i.hitTolerance===void 0?5:i.hitTolerance,t.selectMoveStyle=i.selectMoveStyle,t.selectModifyStyle=i.selectModifyStyle||M,t.modifyStyle=i.modifyStyle,t.deleteFeature=t.deleteFeature.bind((0,w.default)(t)),t.cursorHandler=t.cursorHandler.bind((0,w.default)(t)),t.cursorTimeout=null,G.default.$on("revokeFeatureEditing",function(){(0,d.default)(this,r);try{t.selectModify.getOverlay().getSource().clear(!![])}catch{t.selectModify.getOverlay().getSource().clear(!![])}t.editor.setEditFeature(null),(0,E.default)(t).refresh()}.bind(this)),t.deleteCondition=i.deleteCondition||function(T){return(0,d.default)(this,r),T.keyCode===46||T.keyCode===8}.bind(this),t.deleteNodeCondition=i.deleteNodeCondition||D.altKeyOnly,t.selectFilter=function(T,z){return(0,d.default)(this,r),t.layerFilter?t.layerFilter(z):!![]}.bind(this),t.getFeatureAtPixel=function(T){(0,d.default)(this,r);var z=((0,E.default)(t).getFeaturesAtPixel(T,{hitTolerance:t.hitTolerance,layerFilter:t.layerFilter})||[])[0];return z}.bind(this),t.isHoverVertexFeatureAtPixel=function(T){var z=this;(0,d.default)(this,r);var tt=![];return(0,E.default)(t).forEachFeatureAtPixel(T,function(rt,nt){return(0,d.default)(this,z),nt?![]:(tt=!![],!![])}.bind(this),{hitTolerance:t.hitTolerance}),tt}.bind(this),t.applySelectStyle=function(T,z){var tt;(0,d.default)(this,r);var rt=yt(T.getStyleFunction(),T),nt=yt(z,T),ft=(0,K.default)(tt=[]).call(tt,(0,N.default)(rt),(0,N.default)(nt));T.set(s,rt),T.setStyle(ft)}.bind(this),t.onSelectFeature=function(T,z,tt){var rt=this;if((0,d.default)(this,r),!!T.getStyleFunction()){t.applySelectStyle(T,z);var nt=T.get(tt);nt&&((0,h.unByKey)(nt),T.unset(nt)),T.set(tt,T.on("change",function(ft){(0,d.default)(this,rt),t.onSelectedFeatureChange(ft.target,z)}.bind(this)))}}.bind(this),t.onDeselectFeature=function(T,z,tt){if((0,d.default)(this,r),!!T.getStyleFunction()){var rt=T.get(tt);rt&&((0,h.unByKey)(rt),T.unset(rt)),T.unset(s);var nt=yt(T.getStyleFunction(),T),ft=yt(z,T),g=(0,et.default)(nt).call(nt,0,nt.indexOf(ft[0]));T.setStyle(g)}}.bind(this),t.onSelectedFeatureChange=function(T,z){var tt=this;(0,d.default)(this,r);var rt=yt(T.getStyleFunction(),T),nt=T.get(s);if(nt){var ft=nt.some(function(g,H){return(0,d.default)(this,tt),g!==rt[H]}.bind(this));ft&&t.applySelectStyle(T,z)}}.bind(this),t.selectMove=new k.Select({condition:i.moveCondition||D.singleClick,toggleCondition:i.moveToggleCondition||D.shiftKeyOnly,filter:function(z,tt){return(0,d.default)(this,r),t.isSelectedByModify(z)?![]:t.selectFilter(z,tt)}.bind(this),style:t.selectMoveStyle,hitTolerance:t.hitTolerance,wrapX:![]});var O;t.selectMove.getFeatures().on("add",function(T){var z=this;(0,d.default)(this,r),t.selectModify.getFeatures().clear(),document.addEventListener("keydown",t.deleteFeature),(0,E.default)(t).addInteraction(t.moveInteraction),(0,h.unByKey)(O),O=(0,E.default)(t).on("singleclick",function(tt){(0,d.default)(this,z),t.unselectInteraction(tt,t.selectMove)}.bind(this)),t.selectMoveStyle&&t.onSelectFeature(T.element,t.selectMoveStyle,m)}.bind(this)),t.selectMove.getFeatures().on("remove",function(T){(0,d.default)(this,r),document.removeEventListener("keydown",t.deleteFeature),(0,E.default)(t).removeInteraction(t.moveInteraction),(0,h.unByKey)(O),t.selectMoveStyle&&t.onDeselectFeature(T.element,t.selectMoveStyle,m)}.bind(this)),t.selectCondition=function(T){return(0,d.default)(this,r),(0,D.singleClick)(T)&&!t.deleteNodeCondition(T)}.bind(this),t.selectModify=new k.Select({condition:i.modifyCondition||t.selectCondition,toggleCondition:i.modifyToggleCondition||D.shiftKeyOnly,filter:t.selectFilter,style:t.selectModifyStyle,hitTolerance:t.hitTolerance,wrapX:![]});var lt;return t.selectModify.getFeatures().on("add",function(T){(0,d.default)(this,r),document.addEventListener("keydown",t.deleteFeature),t.dispatchEvent(new ut.ModifyEvent("edit-start",T.element)),(0,E.default)(t).addInteraction(t.modifyInteraction),(0,h.unByKey)(lt),t.selectModifyStyle&&(G.default.$emit("startFeatureEditing",{type:"edit",select:t.selectModify,modify:t.modifyInteraction}),t.onSelectFeature(T.element,t.selectModifyStyle,X))}.bind(this)),t.selectModify.getFeatures().on("remove",function(T){(0,d.default)(this,r),document.removeEventListener("keydown",t.deleteFeature),t.dispatchEvent(new ut.ModifyEvent("edit-stop")),(0,E.default)(t).removeInteraction(t.modifyInteraction),(0,h.unByKey)(lt),G.default.$emit("cancelEdit"),t.selectModifyStyle&&t.onDeselectFeature(T.element,t.selectModifyStyle,X),(0,E.default)(t).refresh()}.bind(this)),t.modifyInteraction=new J.Modify({features:t.selectModify.getFeatures(),style:t.modifyStyle,deleteCondition:function(z){return(0,d.default)(this,r),t.deleteNodeCondition(z)&&(0,D.click)(z)?!![]:![]}.bind(this)}),t.modifyInteraction.on("modifystart",function(T){(0,d.default)(this,r),t.editor.setEditFeature(T.features.item(0)),t.isModifying=!![]}.bind(this)),t.modifyInteraction.on("modifyend",function(T){(0,d.default)(this,r),t.editor.setEditFeature(null);var z=(0,E.default)(t).getView().getResolution();(0,E.default)(t).getView().setResolution(z+1e-17),(0,E.default)(t).getView().setResolution(z),t.isModifying=![],t.dispatchEvent(T)}.bind(this)),t.moveInteraction=new J.Pointer({handleDownEvent:t.startMoveFeature.bind((0,w.default)(t)),handleDragEvent:t.moveFeature.bind((0,w.default)(t)),handleUpEvent:t.stopMoveFeature.bind((0,w.default)(t))}),t}return(0,L.default)(n,[{key:"deleteFeature",value:function(r){var t=this;if(!(/textarea|input/i.test(r.target.nodeName)||!this.deleteCondition(r))){var s;this.selectModify.getFeatures().getArray().length>0&&(s=this.selectModify.getFeatures()),s&&(s.getArray().forEach(function(m,X){return(0,d.default)(this,t),this.source.removeFeature(s.getArray()[X])}.bind(this)),this.changeCursor(null),s.clear(),r.stopPropagation(),r.preventDefault())}}},{key:"isSelectedByMove",value:function(r){return this.selectMove.getFeatures().getArray().indexOf(r)!==-1}},{key:"isSelectedByModify",value:function(r){return this.selectModify.getFeatures().getArray().indexOf(r)!==-1}},{key:"startMoveFeature",value:function(r){if(this.featureToMove=this.getFeatureAtPixel(r.pixel),this.featureToMove&&this.isSelectedByMove(this.featureToMove)){if(this.featureToMove.getGeometry()instanceof $.Point){var t=this.featureToMove.getGeometry().getExtent();this.coordinate=(0,V.getCenter)(t)}else this.coordinate=r.coordinate;return this.editor.setEditFeature(this.featureToMove),this.isMoving=!![],this.moveInteraction.dispatchEvent(new U.default(U.MoveEventType.MOVESTART,this.featureToMove,r)),!![]}return![]}},{key:"setModifyStyle",value:function(){var r=this;this.selectModifyStyle=new W.Style({image:new W.Circle({radius:5,fill:new W.Fill({color:"#05A0FF"}),stroke:new W.Stroke({color:"#05A0FF",width:2})}),stroke:new W.Stroke({color:"#05A0FF",width:3}),fill:new W.Fill({color:"rgba(255,255,255,0.4)"}),geometry:function(s){var m=this;(0,d.default)(this,r);var X=[];return s.getGeometry().getType()==="Polygon"?s.getGeometry().getCoordinates()[0].forEach(function(O){(0,d.default)(this,m),X.push(O)}.bind(this)):s.getGeometry().getType()==="MultiPolygon"?s.getGeometry().getCoordinates()[0].forEach(function(O){var lt=this;(0,d.default)(this,m),O.forEach(function(T){(0,d.default)(this,lt),X.push(T)}.bind(this)),X.push(O)}.bind(this)):s.getGeometry().getType()==="LineString"?X=s.getGeometry().getCoordinates():X=[s.getGeometry().getCoordinates()],new at.default([s.getGeometry(),new $.MultiPoint(X)])}.bind(this)})}},{key:"moveFeature",value:function(r){var t=r.coordinate[0]-this.coordinate[0],s=r.coordinate[1]-this.coordinate[1];this.featureToMove.getGeometry().translate(t,s),this.coordinate=r.coordinate}},{key:"stopMoveFeature",value:function(r){return this.moveInteraction.dispatchEvent(new U.default(U.MoveEventType.MOVEEND,this.featureToMove,r)),this.coordinate=null,this.editor.setEditFeature(null),this.isMoving=![],this.featureToMove=null,![]}},{key:"cursorHandler",value:function(r){var t=this;this.cursorTimeout&&clearTimeout(this.cursorTimeout),this.cursorTimeout=setTimeout(function(){if((0,d.default)(this,t),r.dragging||this.isMoving||this.isModifying){this.changeCursor("grabbing");return}var s=this.getFeatureAtPixel(r.pixel);if(!s){this.changeCursor(this.previousCursor),this.previousCursor=null;return}this.isSelectedByMove(s)?this.changeCursor("grab"):this.isSelectedByModify(s)?this.isHoverVertexFeatureAtPixel(r.pixel)?this.changeCursor("grab"):this.changeCursor(this.previousCursor):this.changeCursor("pointer")}.bind(this),50)}},{key:"unselectInteraction",value:function(r,t){if(this.deleteNode){this.deleteNode=![];return}!(0,E.default)(this).hasFeatureAtPixel(r.pixel)&&t.getFeatures().clear()}},{key:"changeCursor",value:function(r){var t=(0,E.default)(this).getTargetElement();(t.style.cursor||r)&&t.style.cursor!==r&&(this.previousCursor===null&&(this.previousCursor=t.style.cursor),t.style.cursor=r)}},{key:"activate",value:function(){(0,I.default)((0,F.default)(n.prototype),"activate",this).call(this),clearTimeout(this.cursorTimeout),(0,E.default)(this).on("pointermove",this.cursorHandler),(0,E.default)(this).addInteraction(this.selectModify)}},{key:"deactivate",value:function(r){clearTimeout(this.cursorTimeout),(0,E.default)(this).un("pointermove",this.cursorHandler);try{this.selectModify.getOverlay().getSource().clear(!![])}catch{this.selectModify.getOverlay().getSource().clear(!![])}for(var t=(0,E.default)(this).getSelectFeatures(),s=0;s<t.length;s++){var m=t[s];m.get("isSelected")&&((0,_.default)(t).call(t,s,1),s--,(0,E.default)(this).getLayerById(ot.BASE_DRAWLAYER_ID).getSource().removeFeature(m))}this.selectModify.getFeatures().clear(),(0,E.default)(this).removeInteraction(this.selectModify),(0,E.default)(this).removeInteraction(this.modifyInteraction),(0,I.default)((0,F.default)(n.prototype),"deactivate",this).call(this,r)}},{key:"stopEditing",value:function(){(0,E.default)(this).removeInteraction(this.modifyInteraction)}},{key:"setEditLayer",value:function(r){this.sourceId=r}},{key:"setSelectFeature",value:function(r){this.selectModify.getFeatures().clear(),this.selectModify.getFeatures().push(r)}}]),n}(C.default),B=Q;c.default=B},217712:function(ct,c,e){var S=e(419534);Object.defineProperty(c,"__esModule",{value:!![]}),c.default=void 0;var p=S(e(828866)),A=S(e(342579)),q=S(e(122777)),j=S(e(42762)),E=S(e(10257)),K=function(){function _(N,P){(0,q.default)(this,_),this.map=N,this.controls=new E.default,this.activeControls=new E.default,this.services=new E.default,this.options=P||{},this.editFeature=null}return(0,j.default)(_,[{key:"addControl",value:function(P){var L=this;P.setMap((0,p.default)(this)),P.setEditor(this),P.addEventListener("change:active",function(w){(0,A.default)(this,L),this.activeStateChange(w.detail.control)}.bind(this)),this.controls.push(P)}},{key:"addService",value:function(P){P.setMap((0,p.default)(this)),P.setEditor(this),P.activate(),this.services.push(P)}},{key:"clearService",value:function(){this.services=new E.default}},{key:"addControls",value:function(P){for(var L=P instanceof E.default?P:new E.default(P),w=0;w<L.getLength();w+=1)this.addControl(L.item(w))}},{key:"clearControl",value:function(){this.controls=new E.default}},{key:"remove",value:function(){var P=this;this.controls.forEach(function(L){(0,A.default)(this,P),L.deactivate(!![])}.bind(this)),this.clearControl()}},{key:"destory",value:function(){this.remove(),this.toolbar&&this.toolbar.destroy()}},{key:"getControls",value:function(){return this.controls}},{key:"getActiveControls",value:function(){return this.activeControls}},{key:"setEditFeature",value:function(P){this.editFeature=P}},{key:"getEditFeature",value:function(){return this.editFeature}},{key:"activeStateChange",value:function(P){if(P.getActive()&&P.standalone)for(var L=0;L<this.controls.getLength();L+=1){var w=this.controls.item(L);w!==P&&w.getActive()&&w.standalone&&(w.deactivate(),this.activeControls.remove(w))}P.getActive()?this.activeControls.push(P):this.activeControls.remove(P)}},{key:"setEditSource",value:function(P,L){for(var w=0;w<this.controls.getLength();w+=1){var I=this.controls.item(w);I.isModify?I.setEditLayer(L):I.setSource&&I.setSource(P,L)}}}]),_}(),et=K;c.default=et},91398:function(ct,c){Object.defineProperty(c,"__esModule",{value:!![]}),c.UNION=c.ROTATE=c.MODIFY=c.INTERSECTION=c.DRAWPOLYGON=c.DRAWPOINT=c.DRAWLINE=c.DIFFERENCE=c.CLEAR=c.CAD=c.BUFFER=void 0;var e="cad";c.CAD=e;var S="point";c.DRAWPOINT=S;var p="polyline";c.DRAWLINE=p;var A="polygon";c.DRAWPOLYGON=A;var q="modify";c.MODIFY=q;var j="clear";c.CLEAR=j;var E="rotate";c.ROTATE=E;var K="buffer";c.BUFFER=K;var et="union";c.UNION=et;var _="intersection";c.INTERSECTION=_;var N="difference";c.DIFFERENCE=N},856674:function(ct,c,e){var S=e(465557),p=e(419534);Object.defineProperty(c,"__esModule",{value:!![]}),c.default=c.MoveEventType=void 0;var A=p(e(42762)),q=p(e(122777)),j=p(e(330044)),E=p(e(299085)),K=p(e(234009)),et=p(e(12207));function _(w){var I=N();return function(){var R=(0,K.default)(w),F;if(I){var d=(0,K.default)(this).constructor;F=S(R,arguments,d)}else F=R.apply(this,arguments);return(0,E.default)(this,F)}}function N(){if(typeof Reflect>"u"||!S)return![];if(S.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(S(Boolean,[],function(){})),!![]}catch{return![]}}var P={MOVESTART:"movestart",MOVEEND:"moveend"};c.MoveEventType=P;var L=function(w){(0,j.default)(b,w);var I=_(b);function b(R,F,d){var h;return(0,q.default)(this,b),h=I.call(this,R),h.feature=F,h.mapBrowserEvent=d,h}return(0,A.default)(b)}(et.default);c.default=L},648847:function(ct,c,e){var S=e(419534);Object.defineProperty(c,"__esModule",{value:!![]}),Object.defineProperty(c,"Select",{enumerable:!![],get:function(){return p.default}});var p=S(e(51032))},51032:function(ct,c,e){var S=e(581806),p=e(465557),A=e(419534);Object.defineProperty(c,"__esModule",{value:!![]}),c.default=void 0;var q=A(e(22466)),j=A(e(828866)),E=A(e(669033)),K=A(e(342579)),et=A(e(553144)),_=A(e(42762)),N=A(e(122777)),P=A(e(330044)),L=A(e(299085)),w=A(e(234009)),I=e(875907),b=e(542422),R=A(e(12207)),F=e(708326),d=e(561280),h=A(e(17369)),V=A(e(655878)),W=A(e(505085)),at=e(500623),$=A(e(692405)),J=e(339211),D=A(e(865046)),k=A(e(223378)),C=A(e(561674)),U=A(e(813866)),G=A(e(647598)),ot=A(e(349162)),ut=e(59269);function gt(l){var a=vt();return function(){var i=(0,w.default)(l),r;if(a){var t=(0,w.default)(this).constructor;r=p(i,arguments,t)}else r=i.apply(this,arguments);return(0,L.default)(this,r)}}function vt(){if(typeof Reflect>"u"||!p)return![];if(p.sham)return![];if(typeof Proxy=="function")return!![];try{return Boolean.prototype.valueOf.call(p(Boolean,[],function(){})),!![]}catch{return![]}}var Tt={SELECT:"select"},pt=function(l){(0,P.default)(n,l);var a=gt(n);function n(i,r,t,s){var m;return(0,N.default)(this,n),m=a.call(this,i),m.selected=r,m.deselected=t,m.mapBrowserEvent=s,m}return(0,_.default)(n)}(R.default),Et=function(l){(0,P.default)(n,l);var a=gt(n);function n(i){var r;(0,N.default)(this,n),r=a.call(this,{handleEvent:yt});var t=i||{};r.condition_=t.condition?t.condition:F.singleClick,r.addCondition_=t.addCondition?t.addCondition:F.never,r.removeCondition_=t.removeCondition?t.removeCondition:F.never,r.toggleCondition_=t.toggleCondition?t.toggleCondition:F.shiftKeyOnly,r.multi_=t.multi?t.multi:![],r.filter_=(0,q.default)(t)?(0,q.default)(t):d.TRUE,r.hitTolerance_=t.hitTolerance?t.hitTolerance:0;var s=new W.default({source:new $.default({useSpatialIndex:![],features:t.features,wrapX:t.wrapX}),id:"modifyLayer",style:t.style?t.style:Q(),updateWhileAnimating:!![],updateWhileInteracting:!![]});r.featureOverlay_=s;var m;if(t.layers)if(typeof t.layers=="function")m=t.layers;else{var X=t.layers;m=function(lt){return S(b)(X,lt)}}else m=d.TRUE;return r.layerFilter_=m,r.featureLayerAssociation_={},r}return(0,_.default)(n,[{key:"addFeatureLayerAssociation_",value:function(r,t){this.featureLayerAssociation_[(0,I.getUid)(r)]=t}},{key:"getFeatures",value:function(){return this.featureOverlay_.getSource().getFeaturesCollection()}},{key:"getHitTolerance",value:function(){return this.hitTolerance_}},{key:"getLayer",value:function(r){return this.featureLayerAssociation_[(0,I.getUid)(r)]}},{key:"getOverlay",value:function(){return this.featureOverlay_}},{key:"setHitTolerance",value:function(r){this.hitTolerance_=r}},{key:"setMap",value:function(r){(0,et.default)((0,w.default)(n.prototype),"setMap",this).call(this,r),r&&(this.layerManager=r.layerManager,this.featureOverlay_.setMap(r))}},{key:"removeFeatureLayerAssociation_",value:function(r){delete this.featureLayerAssociation_[(0,I.getUid)(r)]}}]),n}(V.default);function yt(l){var a=this;if(!this.condition_(l))return!![];var n=this.addCondition_(l),i=this.removeCondition_(l),r=this.toggleCondition_(l),t=!n&&!i&&!r,s=(0,j.default)(l),m=this.getFeatures(),X=[],O=[],lt=new ot.default,T=new k.default(s.getCoordinateFromPixel(l.pixel)),z=lt.writeGeometry(T);if(t){for(var tt=s.getSelectFeatures(),rt=0;rt<tt.length;rt++){var nt=tt[rt];nt.get("isSelected")&&((0,E.default)(tt).call(tt,rt,1),rt--,s.getLayerById(ut.BASE_DRAWLAYER_ID).getSource().removeFeature(nt))}if((0,at.clear)(this.featureLayerAssociation_),this.currentEditTargetLayer=this.layerManager.getEditLayer()?this.layerManager.getEditLayer().metadata:null,this.currentEditTargetLayer!=null){if(this.currentEditTargetLayer.type==="dynamic"){var ft={layers:"visible:"+this.currentEditTargetLayer.visibleLayers.join(",")};(0,q.default)(this.currentEditTargetLayer)&&(ft.layerDefs=(0,q.default)(this.currentEditTargetLayer)),this.currentEditTargetLayer.authkey&&(ft.authkey=this.currentEditTargetLayer.authkey);var g=new D.default(this.currentEditTargetLayer.url,ft,this.currentEditTargetLayer);g.at(z,{map:s}),g.run().then(function(v){(0,K.default)(this,a);var Y=v.results[0];if(Y!=null){var Z=new ot.default,it=new G.default({geometry:Z.readGeometry(v.results[0].geometry)});it.set("isSelected",!![]),M(v.results[0],it),s.getLayerById(ut.BASE_DRAWLAYER_ID).getSource().addFeature(it),O.push(it),this.addFeatureLayerAssociation_(it,s.getLayerById(ut.BASE_DRAWLAYER_ID));for(var st=m.getLength()-1;st>=0;--st){var ht=m.item(st),dt=O.indexOf(ht);dt>-1?(0,E.default)(O).call(O,dt,1):(m.remove(ht),X.push(ht))}O.length!==0&&m.extend(O)}}.bind(this),this)}else if(this.currentEditTargetLayer.type==="geoserver-wms"){var H=new C.default(this.currentEditTargetLayer,z,{map:s}),x=new U.default;x.execute(H).then(function(v){(0,K.default)(this,a);var Y=v.results[0];if(Y!=null){for(var Z=s.getSelectFeatures(),it=0;it<Z.length;it++){var st=Z[it];st.get("isSelected")&&((0,E.default)(Z).call(Z,it,1),it--,s.getLayerById(ut.BASE_DRAWLAYER_ID).getSource().removeFeature(st))}var ht=new ot.default,dt=new G.default({geometry:ht.readGeometry(v.results[0].geometry)});dt.set("isSelected",!![]),M(v.results[0],dt),s.getLayerById(ut.BASE_DRAWLAYER_ID).getSource().addFeature(dt),O.push(dt),this.addFeatureLayerAssociation_(dt,s.getLayerById(ut.BASE_DRAWLAYER_ID));for(var Ft=m.getLength()-1;Ft>=0;--Ft){var mt=m.item(Ft),Dt=O.indexOf(mt);Dt>-1?(0,E.default)(O).call(O,Dt,1):(m.remove(mt),X.push(mt))}O.length!==0&&m.extend(O)}}.bind(this))}}s.forEachFeatureAtPixel(l.pixel,function(v,Y){if(this.filter_(v,Y))return O.push(v),this.addFeatureLayerAssociation_(v,Y),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var y=m.getLength()-1;y>=0;--y){var o=m.item(y),u=O.indexOf(o);u>-1?(0,E.default)(O).call(O,u,1):(m.remove(o),X.push(o))}O.length!==0&&m.extend(O)}else{s.forEachFeatureAtPixel(l.pixel,function(v,Y){if(this.filter_(v,Y))return(n||r)&&!S(b)(m.getArray(),v)?(O.push(v),this.addFeatureLayerAssociation_(v,Y)):(i||r)&&S(b)(m.getArray(),v)&&(X.push(v),this.removeFeatureLayerAssociation_(v)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var f=X.length-1;f>=0;--f)m.remove(X[f]);m.extend(O)}return(O.length>0||X.length>0)&&this.dispatchEvent(new pt(Tt.SELECT,O,X,l)),(0,F.pointerMove)(l)}function M(l,a){for(var n in l.attributes)a.set(n?.toLowerCase(),l.attributes[n])}function Q(){var l=(0,J.createEditingStyle)();return(0,b.extend)(l[h.default.POLYGON],l[h.default.LINE_STRING]),(0,b.extend)(l[h.default.GEOMETRY_COLLECTION],l[h.default.LINE_STRING]),function(a){return a.getGeometry()?l[a.getGeometry().getType()]:null}}var B=Et;c.default=B}}]);
