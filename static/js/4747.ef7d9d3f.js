"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[4747],{56279:function(E,m,c){c.d(m,{P:function(){return g}});var I=c(86892),l=c(49500);const g={mixins:[I.D],created(){},methods:{lifecycleBeforeChartsLoad(h){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&l.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),l.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let u=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[h]);if(u)return u}return h},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&l.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),l.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},24747:function(E,m,c){c.r(m),c.d(m,{default:function(){return J}});var I=function(){var e=this,i=e._self._c;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],staticStyle:{width:"100px",height:"100px","text-align":"center","line-height":"100px"}},[e._v("\u83B7\u53D6\u5B9A\u4F4D")])},l=[],g=c(27966),h=c(45061),b=c(26711),u=c(56279),N=c(23400),P=c(72318),T=c(67157);const O={mixins:[T.c],data(){return{config_extend:{config:{}},filter_config:{}}},methods:{filterPredefineColoursSchemeConfig(t,e){this.getNewConfigWithArrary(t,e,this.filter_config)}}};var C=c(42160),$=c(48836),D=c(96471),p=c(55616),w=c(49500);const{sin:f,cos:M,sqrt:L,abs:v,PI:d}=Math,x=6378245,S=.006693421622965823;var W={name:"form-location",props:["widgetInfo","currentWidget"],mixins:[P.u,O,h.u,b.H,u.P,N.j],watch:{"currentWidget.id":{deep:!0,handler:function(t){if(!this.currentWidget.id){this.widgetInfo.attr.hide=!0;return}t===this.widgetInfo.id||this.currentWidget.parentId===this.widgetInfo.id?this.widgetInfo.attr.hide=!1:this.widgetInfo.attr.hide=!0}}},data(){return{dbClick:!0,prefix:{widget:"widget_"},actionList:{},watcher:null,getPlus:D.A,formData:{guid:"",create_date:"",points:[],coordsType:""},timer:null}},computed:{...(0,$.Se)(["isView"])},methods:{isInChinaBbox(t,e){return t>=72.004&&t<=137.8347&&e>=.8293&&e<=55.8271},transformLat(t,e){let i=-100+2*t+3*e+.2*e*e+.1*t*e+.2*L(v(t));return i+=(20*f(6*t*d)+20*f(2*t*d))*2/3,i+=(20*f(e*d)+40*f(e/3*d))*2/3,i+=(160*f(e/12*d)+320*f(e*d/30))*2/3,i},transformLon(t,e){let i=300+t+2*e+.1*t*t+.1*t*e+.1*L(v(t));return i+=(20*f(6*t*d)+20*f(2*t*d))*2/3,i+=(20*f(t*d)+40*f(t/3*d))*2/3,i+=(150*f(t/12*d)+300*f(t/30*d))*2/3,i},delta(t,e){let i=this.transformLon(t-105,e-35),s=this.transformLat(t-105,e-35);const n=e/180*d;let o=f(n);o=1-S*o*o;const r=L(o);return i=i*180/(x/r*M(n)*d),s=s*180/(x*(1-S)/(o*r)*d),[i,s]},WGS84ToGCJ02(t){const[e,i]=t;if(!this.isInChinaBbox(e,i))return[e,i];const s=this.delta(e,i);return[e+s[0],i+s[1]]},GCJ02ToWGS84(t){const[e,i]=t;if(!this.isInChinaBbox(e,i))return[e,i];let[s,n]=[e,i],o=this.WGS84ToGCJ02([s,n]),r=o[0]-e,a=o[1]-i;for(;v(r)>1e-6||v(a)>1e-6;)s-=r,n-=a,o=this.WGS84ToGCJ02([s,n]),r=o[0]-e,a=o[1]-i;return[s,n]},loadInfo(){this.lifecycleAfterLoad()},reLoadInfo(){},initAction(t){this.actionReceive(t),this.initReceive(t)},initReceive(t){if(t.action===void 0||t.action.receive===void 0)return;let e=this,i=navigator,s=e.getPlus();s&&(i=s),t.action.receive.getLocation&&this.$$lib__.each(t.action.receive.getLocation.getLocationList,n=>{let o=n[0][1]+"_"+n[0][0];n[0][1].indexOf("_")>-1&&(o=n[0][1]);let r=n[0][2];if(r){let a=r.indexOf("|");a>-1&&(r=n[0][2].substring(a+1))}g.Z.$on(o,a=>{if(t.action.receive.getLocation.script&&t.action.receive.getLocation.script.enabled){if(w.log("Execute script for "+this.widgetInfo.name+" component to "+n.name+" component"),t.action.receive.getLocation.script.content==""){p.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.custom_getLocation_script=new Function("data","param_key",t.action.receive.getLocation.script.content),this.custom_getLocation_script(a,r);return}e.dbClick&&(e.dbClick=!1,C.default.set(e.actionList,o,a),this.widgetInfo.config.type==="watch"&&this.watcher&&i.geolocation.clearWatch(this.watcher),this.getLocation(this.widgetInfo.config.type),setTimeout(()=>{e.dbClick=!0},500))})}),t.action.receive.stopLocation&&this.$$lib__.each(t.action.receive.stopLocation.stopLocationList,n=>{let o=n[0][1]+"_"+n[0][0];n[0][1].indexOf("_")>-1&&(o=n[0][1]);let r=n[0][2];if(r){let a=r.indexOf("|");a>-1&&(r=n[0][2].substring(a+1))}g.Z.$on(o,a=>{if(t.action.receive.stopLocation.script&&t.action.receive.stopLocation.script.enabled){if(w.log("Execute script for "+this.widgetInfo.name+" component to "+n.name+" component"),t.action.receive.stopLocation.script.content==""){p.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.custom_stopLocation_script=new Function("param","param_key",t.action.receive.getLocation.script.content),this.custom_stopLocation_script(a,r);return}e.dbClick&&(e.dbClick=!1,C.default.set(e.actionList,o,a),this.widgetInfo.config.type==="watch"&&(this.watcher&&i.geolocation.clearWatch(this.watcher),this.timer&&clearInterval(this.timer),this.getLocation("single",!0)),setTimeout(()=>{e.dbClick=!0},500))})})},uuid(){let t=[],e="0123456789abcdef";for(let s=0;s<36;s++)t[s]=e.substr(Math.floor(Math.random()*16),1);return t[14]="4",t[19]=e.substr(t[19]&3|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("").replace(/-/g,"")},dataResolved(t){const e=JSON.parse(JSON.stringify(t));if(e.points.length===0)return;e.date_end=e.points[e.points.length-1].timestamp,e.points=JSON.stringify(e.points),this.formData.points=[];let i=this,s=i.widgetInfo.action.sendOut.actionList;this.$$lib__.each(s,n=>{if(n.enabled&&n.code=="dataResolved"){let o="dataResolved_"+i.widgetInfo.id;if(n.paramsExtend&&n.paramsExtend.length>0&&this.getExtendParams(e,n.paramsExtend),n.script&&n.script.enabled){if(w.log("Execute script for "+this.widgetInfo.name+" component to "+n.name+" component"),n.script.content==""){p.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",n.script.content),this.customScript(e);return}g.Z.$emit(o,e),n.postMessage&&this.doPostMessage(e),i.actionNameList.push(o)}})},getLocation(t,e=!1){let i=this,s=navigator,n=i.getPlus();if(n&&(s=n),s.geolocation){if(t==="watch"){this.timer&&clearInterval(this.timer);const o=Date.now();i.formData={guid:this.uuid(),points:[],coordsType:this.widgetInfo.config.coordsType,create_date:o,date_start:o,date_end:o},i.dataResolved(i.formData),this.timer=setInterval(()=>{i.dataResolved(i.formData)},1e3*i.widgetInfo.config.submitGap)}this.watcher&&s.geolocation.clearWatch(this.watcher),this.watcher=s.geolocation[t==="watch"?"watchPosition":"getCurrentPosition"](function(o){const r=isNaN(o.timestamp)?Date.now():o.timestamp;let a=null;i.widgetInfo.config.coordsType==="wgs84"&&i.widgetInfo.config.provider==="amap"&&(a=i.GCJ02ToWGS84([o.coords.longitude,o.coords.latitude])),i.widgetInfo.config.coordsType==="gcj02"&&i.widgetInfo.config.provider==="system"&&(a=i.WGS84ToGCJ02([o.coords.longitude,o.coords.latitude]));const y={country:o.coords.country,province:o.coords.province,city:o.coords.city,district:o.coords.district,longitude:a?a[0]:o.coords.longitude,latitude:a?a[1]:o.coords.latitude,timestamp:r},_={...y,create_date:y.timestamp,guid:i.uuid()};e&&i.dataResolved(i.formData),t==="watch"&&i.formData.points.push(_),i.getLocationSuccess(y)},function(o){switch(o.code){case o.PERMISSION_DENIED:i.$message({message:"\u7528\u6237\u62D2\u7EDD\u5BF9\u83B7\u53D6\u5730\u7406\u4F4D\u7F6E\u7684\u8BF7\u6C42\u3002",type:"error"});break;case o.POSITION_UNAVAILABLE:i.$message({message:"\u4F4D\u7F6E\u4FE1\u606F\u662F\u4E0D\u53EF\u7528\u7684\u3002",type:"error"});break;case o.TIMEOUT:i.$message({message:"\u8BF7\u6C42\u7528\u6237\u5730\u7406\u4F4D\u7F6E\u8D85\u65F6\u3002",type:"error"});break;case o.UNKNOWN_ERROR:i.$message({message:"\u672A\u77E5\u9519\u8BEF\u3002",type:"error"});break}},{enableHighAccuracy:!0,timeout:this.widgetInfo.config.timeout,maximumAge:this.widgetInfo.config.maximumAge,provider:this.widgetInfo.config.provider})}else i.$message({message:"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u5B9A\u4F4D",type:"error"})},getLocationSuccess(t){let e=this,i=e.widgetInfo.action.sendOut.actionList;this.$$lib__.each(i,s=>{if(s.enabled&&s.code=="done"){let n="done_"+e.widgetInfo.id,o=t;if(s.paramsExtend&&s.paramsExtend.length>0&&this.getExtendParams(o,s.paramsExtend),s.script&&s.script.enabled){if(w.log("Execute script for "+this.widgetInfo.name+" component to "+s.name+" component"),s.script.content==""){p.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",s.script.content),o=this.customScript(o)}g.Z.$emit(n,o),s.postMessage&&this.doPostMessage(o),e.actionNameList.push(n)}})}},mounted(){this.initAction(this.widgetInfo),this.isView&&(this.widgetInfo.attr.hide=!0),this.formData.coordsType=this.widgetInfo.config.coordsType,this.loadInfo(this.widgetInfo)}},R=W,A=c(68141),G=(0,A.Z)(R,I,l,!1,null,"6bbd3159",null),J=G.exports}}]);
