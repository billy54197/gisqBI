"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[9353],{56279:function(w,r,n){n.d(r,{P:function(){return u}});var g=n(86892),c=n(49500);const u={mixins:[g.D],created(){},methods:{lifecycleBeforeChartsLoad(l){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&c.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),c.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let f=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[l]);if(f)return f}return l},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&c.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),c.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},59353:function(w,r,n){n.r(r),n.d(r,{default:function(){return $}});var g=function(){var e=this,i=e._self._c;return i("div",{ref:"logRef"},[i("span",[e._v("\u65E5\u5FD7\u7EC4\u4EF6")])])},c=[],u=n(27966),l=n(26711),p=n(45061),f=n(82815),I=n(48836),y=n(55946),v=n(21300),L=n(90689),C=n(56279),h=n(49500),S={props:["widgetInfo"],name:"log",mixins:[f.u,l.H,p.u,C.P],computed:{...(0,I.Se)(["getCanvasSettingInfo","getCanvasSetting","getWidgets"])},data(){return{widgetsList:[]}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(t){window.location.href.indexOf("editor.html")>-1?this.widgetInfo.attr.hide=!1:this.widgetInfo.attr.hide=!0,this.lifecycleAfterLoad()},reLoadInfo(t){this.loadInfo(t)},initAction(t){this.actionReceive(t)},actionReceive(t){this.widgetsList=this.getWidgetsList();let e=t.action.receive.log;if(e&&e.enabled){let i=e.logList;this.doLog(i,t)}},doLog(t,e){this.$$lib__.each(t,i=>{let a=i[0][0],o=i[0][1];u.Z.$on(o,s=>{s||(s={}),s.widgetKey=a,s.widgetName=this.getNameByKey(a),s.actionKey=o,s.actionName=this.getNameByKey(o);let d=this.getPostData();if(e.action.receive.log.script&&e.action.receive.log.script.enabled){h.log("Execute the script to execute model to the "+e.name+" component");let m=new Function("logInfo","bizInfo","postData",e.action.receive.log.script.content).apply(this,[e,s,d]);m&&this.doActionLog(m)}else this.doActionLog(d)})})},getPostData(){let t={};t.appId=y.Z.getters.getApplication.applicationId,t.applicationName="";let e=window.location.host;e.indexOf(":")>-1&&(e=e.split(":")[0]),t.clientIp=e,t.clientMac="",t.code=1,t.datetime=v.formatDate(new Date),t.description="",t.gisq_request_id="",t.methodName="",t.microName=this.widgetInfo.name,t.optId="",t.optKind="",t.querystring="",t.requestBody="",t.requestFrom="",t.requestId=window.location.host,t.requestTime=v.formatDate(new Date),t.requestUrl=window.location.href,t.serviceKind="",t.subguid="";let i=v.getStoreUserInfo();return i&&(i=JSON.parse(i),t.staffName=i.userName,t.userId=i.userId,t.userKind=i.user_kind==null?"":i.user_kind,t.userName=i.userCode),t.useragent=navigator.userAgent,t.ywh="",t},doActionLog(t){L.G.saveBizLog(t).then(e=>{h.info(e)}).catch(e=>{h.info(e)})},getWidgetsList(){let t=[];for(let e in this.getWidgets){let i=this.getWidgets[e];if(i.action&&i.action.sendOut&&i.action.sendOut.actionList){let a=[];this.$$lib__.each(i.action.sendOut.actionList,o=>{let s={value:o.code+"_"+e,label:o.name};if(this.is_bind_param){s.children=[];for(let d in o.params)s.children.push({value:o.code+"_"+e+"|"+d,label:d})}a.push(s)}),a.length>0&&t.push({value:i.id,label:i.name,children:a})}}if(this.getCanvasSetting.action&&this.getCanvasSetting.action.sendOut){let e=[];this.$$lib__.each(this.getCanvasSetting.action.sendOut.actionList,i=>{let a={value:i.code+"_canvas",label:i.name};if(this.is_bind_param){a.children=[];for(let o in i.params)a.children.push({value:i.code+"_canvas|"+o,label:o})}e.push(a)}),e.length>0&&t.push({value:this.$$global.sysGuid.datavisual.canvasId,label:this.$$global.sysGuid.datavisual.canvasName,children:e})}return t},getNameByKey(t){h.log(this.widgetsList);let e="";return this.widgetsList.forEach(function(i){i.value==t&&(e=i.label),e==""&&i.children.forEach(function(a){a.value==t&&(e=a.label)})}),e}}},b=S,N=n(68141),D=(0,N.Z)(b,g,c,!1,null,"57a58cfa",null),$=D.exports}}]);
