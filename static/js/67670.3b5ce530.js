(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[67670],{380247:function(e,c,t){var s=t(149500);e.exports=function(i){var r={};function n(a){if(r[a])return r[a].exports;var u=r[a]={i:a,l:!1,exports:{}};return i[a].call(u.exports,u,u.exports,n),u.l=!0,u.exports}return n.m=i,n.c=r,n.d=function(a,u,l){n.o(a,u)||Object.defineProperty(a,u,{enumerable:!0,get:l})},n.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},n.t=function(a,u){if(u&1&&(a=n(a)),u&8||u&4&&typeof a=="object"&&a&&a.__esModule)return a;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:a}),u&2&&typeof a!="string")for(var f in a)n.d(l,f,function(w){return a[w]}.bind(null,f));return l},n.n=function(a){var u=a&&a.__esModule?function(){return a.default}:function(){return a};return n.d(u,"a",u),u},n.o=function(a,u){return Object.prototype.hasOwnProperty.call(a,u)},n.p="/dist/",n(n.s=770)}({0:function(i,r){i.exports=t(342579)},1:function(i,r){i.exports=t(828866)},10:function(i,r){i.exports=t(42762)},15:function(i,r){i.exports=t(202692)},16:function(i,r){i.exports=t(91873)},17:function(i,r){i.exports=t(985208)},2:function(i,r,n){"use strict";n.d(r,"a",function(){return a});function a(u,l,f,w,x,G,T,N){var M=typeof u=="function"?u.options:u;l&&(M.render=l,M.staticRenderFns=f,M._compiled=!0),w&&(M.functional=!0),G&&(M._scopeId="data-v-"+G);var A;if(T?(A=function($){$=$||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!$&&typeof __VUE_SSR_CONTEXT__<"u"&&($=__VUE_SSR_CONTEXT__),x&&x.call(this,$),$&&$._registeredComponents&&$._registeredComponents.add(T)},M._ssrRegister=A):x&&(A=N?function(){x.call(this,(M.functional?this.parent:this).$root.$options.shadowRoot)}:x),A)if(M.functional){M._injectStyles=A;var J=M.render;M.render=function(V,h){return A.call(h),J(V,h)}}else{var F=M.beforeCreate;M.beforeCreate=F?[].concat(F,A):[A]}return{exports:u,options:M}}},21:function(i,r){i.exports=t(581806)},27:function(i,r){i.exports=t(578756)},29:function(i,r){i.exports=t(505775)},35:function(i,r){i.exports=t(349162)},4:function(i,r){i.exports=t(555616)},42:function(i,r){i.exports=t(647598)},498:function(i,r){i.exports=t(183254)},5:function(i,r){i.exports=t(705146)},50:function(i,r){i.exports=t(636583)},52:function(i,r){i.exports=t(407165)},6:function(i,r){i.exports=t(783574)},60:function(i,r){i.exports=t(308421)},61:function(i,r){i.exports=t(419457)},7:function(i,r){i.exports=t(17249)},73:function(i,r){i.exports=t(615550)},770:function(i,r,n){"use strict";n.r(r);var a=function(){var m=this,b=m.$createElement,o=m._self._c||b;return o("div",{directives:[{name:"show",rawName:"v-show",value:m.isShow,expression:"isShow"}],staticClass:"sh-cutting-layer"},[m.$slots.default?o("span",{on:{click:function(){return m.toggle()}}},[m._t("default")],2):o("general-button",{attrs:{"is-column":!!m.isColumn,"icon-class":m.iconClass?m.iconClass:"cutting-layer",active:m.active,"show-img":!!m.showImg,"show-label":!!m.showLabel,"theme-style":m.themeStyle,"drag-enable":m.dragEnable,title:m.title?m.title:"\u88C1\u526A"},on:{click:function(){return m.toggle()}}})],1)},u=[];a._withStripped=!0;var l=n(0),f=n.n(l),w=n(6),x=n.n(w),G=n(7),T=n.n(G),N=n(60),M=n.n(N),A={defaultActive:{type:Boolean,default:function(){return!1}},isShow:{type:Boolean,default:function(){return!0}},cuttingOptions:{type:Object,default:function(){return{geoJson:"",isMask:!1,maskType:"pruning",stopMoveListener:!1,geoLayer:{layer:{},whereInfo:""},targetLayers:[],maskConfig:{fillColor:"",strokeColor:"",strokeWidth:0},locateConfig:{isFit:!1,isLocate:!1,center:"",resolution:""}}}}},J={geoJson:"",isMask:!0,stopMoveListener:!1,maskType:"pruning",targetLayers:["f8d3717c-e84d-1f5c-b8af-b17c2f319b5f2D\u7535\u5B50\u5730\u56FE","35f38315-c80e-cf6a-683b-917c82b67a712D\u7535\u5B50\u5730\u56FE"],geoLayer:{layer:{visibleLayers:["fgy:kj000101a"],type:"dynamic",url:"http://192.168.11.148:6080/arcgis/rest/services/%E8%A1%8C%E6%94%BF%E5%8C%BA%E5%AF%BC%E8%88%AA/MapServer",serverOrigin:"arcgis"},whereInfo:"xzqdm='3301'"},maskConfig:{fillColor:"rgba(0, 0, 0, 0.6)",strokeColor:"rgba(255, 69, 0, 1)",strokeWidth:2},locateConf:{isLocate:!1,center:"",resolution:""}},F=n(50),$=n.n(F),V=n(9),h=n.n(V),v=n(10),L=n.n(v),S=n(1),C=n.n(S),W=n(5),B=n.n(W),ot=n(21),q=n.n(ot),at=n(17),_=n.n(at),ut=n(27),tt=n.n(ut),ft=n(35),lt=n.n(ft),ct=n(73),ht=n.n(ct),z=n(16),dt=n(15),R=n.n(dt),et=n(29),it=n(52),vt=n(42),nt=n.n(vt),pt=n(83),gt=n(96),yt=n(498),k=n(4),xt=function(){function m(b){h()(this,m),this.map=b,this.isAllowCut=!0,this.currentWkid=b.getView().getProjection().getCode(),this.targetLayers=[],this.geoJSON=new lt.a,this.esrijsonFormat=new ht.a,this.prerenderEvtObj={},this.postrenderEvtObj={},this.xzq_features=[],this.isFirstExt=!0}return L()(m,[{key:"initMoveListener",value:function(){var o=this;C()(this).getTargetElement().addEventListener("mousewheel",function(){f()(this,o),this.isAllowCut=!1}.bind(this),!1),C()(this).on("pointerdown",function(){f()(this,o),this.isAllowCut=!1}.bind(this)),C()(this).getView().on("change:resolution",function(){f()(this,o),this.isAllowCut=!1}.bind(this)),C()(this).on("movestart",function(){f()(this,o),this.isAllowCut=!1}.bind(this)),C()(this).on("moveend",function(){f()(this,o),this.isAllowCut||C()(this).render(),this.isAllowCut=!0}.bind(this))}},{key:"initCutting",value:function(o){o?(this.options=o,this.targetLayers=o.targetLayers,o.stopMoveListener||this.initMoveListener(),this.clearCutLayers(),this.isAllowCut=!0,this.startCut(o)):k.Message.warning("\u88C1\u526A\u53C2\u6570\u7F3A\u5931")}},{key:"startCut",value:function(o){var d=this,y=o.geoLayer.layer;if(o.geoJson){var p=[],g=o.geoJson;typeof g=="string"?p.push(JSON.parse(g)):p=C()(g).call(g,function(O){f()(this,d);var E=O.geojsonGis||O;return JSON.parse(E)}.bind(this)),this.unionGeometry(p)}else if(y&&o.geoLayer.whereInfo){var I=o.geoLayer.whereInfo;setTimeout(function(){var O=this;f()(this,d),o.geoLayer.whereInfo&&this.customGeometry(y,I,function(E){f()(this,O),this.unionGeometry(E)}.bind(this))}.bind(this),800)}else k.Message.error("\u672A\u83B7\u53D6\u5230\u88C1\u526A\u8303\u56F4\u6570\u636E\uFF01")}},{key:"customGeometry",value:function(o,d,y){var p=this;this.whereClause===d&&this.geomLayerUrl===o.url&&this.xzq_features.length>0?y(this.xzq_features):(this.whereClause=d,this.geomLayerUrl=o.url,o.type.indexOf("geoserver")>-1?this.requestGeo(o,d,function(g){f()(this,p),this.xzq_features=g,y(g)}.bind(this)):(o.type==="dynamic"||o.type==="feature"||o.type==="feature-zj")&&this.requestArc(o,d,function(g){f()(this,p),this.xzq_features=g,y(g)}.bind(this)))}},{key:"unionGeometry",value:function(o){var d=this;if(this.targetLayers.length>0)if(o&&o.length>0){var y=[];o.forEach(function(I){var O;f()(this,d);var E=I.geometry,j=[];if(E)E.type&&E.type==="MultiPolygon"?j=E.coordinates:j.push(E.coordinates);else{var P=I.getGeometry(),Z=P.getType();Z==="Polygon"?j=[I.getGeometry().getCoordinates()]:j=I.getGeometry().getCoordinates()}y=B()(O=[]).call(O,$()(y),$()(j))}.bind(this));var p=new et.MultiPolygon(y),g=new nt.a(p);this.setCutting(g)}else k.Message.error("\u6CA1\u6709\u88C1\u526A\u533A\u57DF\u6570\u636E")}},{key:"setCutting",value:function(o){var d=this,y=o.getGeometry();this.currentWkid!=="EPSG:4490"&&(y=y.transform("EPSG:4490",this.currentWkid)),this.dataGeometry=y;var p=new z.Fill({color:[0,0,0,0]});this.styleVC=new z.Style({fill:p}),this.dataGeometry&&(this.targetLayers.forEach(function(g){f()(this,d);var I=C()(this).getLayerById(g);I?this.cutPrender(I):s.error(g+"\u56FE\u5C42\u672A\u52A0\u8F7D")}.bind(this)),setTimeout(function(){f()(this,d),this.setExtentLocate()}.bind(this),500)),this.setMask(o)}},{key:"setExtentLocate",value:function(){var o=this.dataGeometry.getExtent(),d=this.options.locateConf||this.options.locateConfig;if(!(!d||q()(o).call(o,1/0))){var y=d.isLocate,p=d.center,g=d.resolution,I=d.isFit;I?C()(this).getView().fit(o):y&&p&&this.isFirstExt&&(C()(this).getView().setCenter(p),C()(this).getView().setResolution(g||9),this.isFirstExt=!1)}}},{key:"addCuttingLayer",value:function(o){var d=C()(this).getLayerById(o);d&&(this.cutPrender(d),C()(this).render())}},{key:"cutPrender",value:function(o){var d=this,y=o.on("prerender",function(g){f()(this,d),this.isAllowCut&&this.styleVC&&this.dataGeometry&&this.changeCtx(g)}.bind(this)),p=o.on("postrender",function(g){if(f()(this,d),this.isAllowCut){var I=g.context;I.restore()}}.bind(this));this.prerenderEvtObj[o.values_.id]=y,this.postrenderEvtObj[o.values_.id]=p}},{key:"changeCtx",value:function(o){var d=o.context,y=Object(yt.getVectorContext)(o);d.save(),y.setStyle(this.styleVC),y.drawGeometry(this.dataGeometry),d.lineWidth=2,d.strokeStyle="rgba(0,0,0,0.5)",d.stroke(),d.clip()}},{key:"clearCutLayers",value:function(){for(var o in this.prerenderEvtObj)this.removeCutLayerById(o,!1);this.prerenderEvtObj={},this.postrenderEvtObj={},this.removeMask(),C()(this).render()}},{key:"removeCutLayerById",value:function(o){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,y=_()(this.prerenderEvtObj);if(q()(y).call(y,o)){var p=this.prerenderEvtObj[o],g=this.postrenderEvtObj[o];Object(it.unByKey)(p),Object(it.unByKey)(g),delete this.prerenderEvtObj[o],delete this.postrenderEvtObj[o],d&&C()(this).render()}else k.Message.error(o+"\u56FE\u5C42\u4E3A\u52A0\u8F7D!")}},{key:"removeMask",value:function(){var o=C()(this).getLayerById("cuttingMask");o&&C()(this).removeLayer(o)}},{key:"setMask",value:function(o){this.removeMask();var d=this.options,y=d.maskType;if(d.isMask){var p=this.getMaskPolygon(y,o);this.setMaskLayer(p)}}},{key:"getMaskPolygon",value:function(o,d){var y=this,p=[[[-180,-90],[-180,90],[180,90],[180,-90],[-180,-90]]];o==="fill"&&(p=[]);var g=d.getGeometry().getType(),I=d.getGeometry().getCoordinates();return g.toLowerCase()==="polygon"?p=B()(p).call(p,I):I.forEach(function(O){f()(this,y),p=B()(p).call(p,O)}.bind(this)),p}},{key:"setMaskLayer",value:function(o){var d=[o],y=new gt.Vector,p=new et.MultiPolygon(d),g=new nt.a(p);y.addFeature(g);var I=new pt.Vector({id:"cuttingMask",zIndex:this.options.maskIndex||1099,source:y,style:this.setLineStyle()});C()(this).addLayer(I)}},{key:"setLineStyle",value:function(){var o="rgba(0, 191, 255, 1)",d="rgba(255, 255, 255, 0.5)",y=0,p=this.options.maskConfig,g=p.strokeColor,I=p.fillColor,O=p.strokeWidth,E=new z.Stroke({color:g||o,width:O||y}),j=new z.Fill({color:I||d}),P=new z.Style({fill:j});return O>0&&P.setStroke(E),P}},{key:"requestGeo",value:function(o,d,y){var p=this,g=o.url,I=g.lastIndexOf("/");g=g.substring(0,I)+"/wfs";var O=o.visibleLayers[0],E=C()(this).getView().getProjection().getCode();R.a.ajax({url:g,data:{service:"WFS",version:"1.1.0",request:"GetFeature",typeName:O,outputFormat:"application/json",maxFeatures:3200,srsName:E,CQL_FILTER:d},success:function(P){f()(this,p),P&&P.features.length>0?y(P.features):y(null)}.bind(this),error:function(P){f()(this,p),s.error(P),k.Message.error("\u83B7\u53D6\u88C1\u526A\u533A\u57DF\u6570\u636E\u51FA\u9519")}.bind(this)})}},{key:"requestArc",value:function(o,d,y){var p=this,g=this.currentWkid;g=g.split(":")[1];var I=o.url,O={f:"json"};R.a.ajax({url:I,data:O,success:function(j){var P=this;if(f()(this,p),j&&(j=JSON.parse(j),j.layers&&j.layers.length>0)){var Z=[];j.layers.forEach(function(X){var Y=this;f()(this,P);var H=X.id,D=I+"/"+H+"/query",rt={f:"json",outFields:"*",outSR:g,returnGeometry:!0,where:d},Mt=new tt.a(function(Q){var st=this;f()(this,Y),this._ajax(D,rt,Q),R.a.ajax({url:D,data:rt,success:function(K){if(f()(this,st),K){K=JSON.parse(K);var Ot=this.esrijsonFormat.readFeatures(K);Q(Ot)}}.bind(this),error:function(){f()(this,st),Q([])}.bind(this)})}.bind(this));Z.push(Mt)}.bind(this)),tt.a.all(Z).then(function(X){var Y=this;f()(this,P);var H=[];X.forEach(function(D){f()(this,Y),D.length>0&&(H=B()(H).call(H,D))}.bind(this)),y(H)}.bind(this))}}.bind(this),error:function(j){f()(this,p),s.error(j),k.Message.error("\u83B7\u53D6\u88C1\u526A\u533A\u57DF\u6570\u636E\u51FA\u9519")}.bind(this)})}},{key:"getCutLayersIds",value:function(){return _()(this.prerenderEvtObj)}},{key:"_ajax",value:function(o,d,y){var p=this;R.a.ajax({url:o,data:d,success:function(I){if(f()(this,p),I){I=JSON.parse(I);var O=this.esrijsonFormat.readFeatures(I);y(O)}}.bind(this),error:function(){f()(this,p),y([])}.bind(this)})}}]),m}(),mt=n(61),Ct=n.n(mt),bt={name:"ShCuttingLayer",components:{GeneralButton:M.a},mixins:[x.a,T.a,Ct.a],props:A,data:function(){return this.cutting,{active:!1}},mounted:function(){var b=this;this.$map&&setTimeout(function(){f()(this,b),this.begin()}.bind(this),0)},methods:{toggle:function(){this.active?this.deactivate():this.activate(),this.active=!this.active},begin:function(){this.defaultActive&&this.activate()},activate:function(){this.cutting||(this.cutting=new xt(this.$map)),this.cutting.initCutting(this.cuttingOptions)},deactivate:function(){this.cutting&&this.cutting.clearCutLayers()},addCuttingLayerById:function(b){this.cutting&&this.cuttingOptions&&this.cutting.addCuttingLayer(b)},removeCuttingLayerById:function(b){this.cutting&&this.cuttingOptions&&this.cutting.removeCutLayerById(b)},getCutLayersIds:function(){return this.cutting?this.cutting.getCutLayersIds():[]}},render:function(){return null}},It=bt,Lt=n(2),wt=Object(Lt.a)(It,a,u,!1,null,null,null),U=wt.exports;U.install=function(m){m.component(U.name,U)};var jt=r.default=U},83:function(i,r){i.exports=t(17527)},9:function(i,r){i.exports=t(122777)},96:function(i,r){i.exports=t(365094)}})},783574:function(e,c,t){"use strict";var s=t(419534);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var i=s(t(828866)),r=s(t(342579)),n={data:function(){return{isSetMap_common:!1}},inject:{reactiveConfigInstance:{default:function(){var l=this;return function(){return(0,r.default)(this,l),null}.bind(this)}},reactiveViewMode:{default:function(){var l=this;return function(){return(0,r.default)(this,l),"23D"}.bind(this)}},reactiveView:{default:function(){var l=this;return function(){return(0,r.default)(this,l),"map"}.bind(this)}},reactiveMap:{default:function(){var l=this;return function(){return(0,r.default)(this,l),null}.bind(this)}},reactiveEarth:{default:function(){var l=this;return function(){return(0,r.default)(this,l),null}.bind(this)}},reactiveInteraction:{default:function(){var l=this;return function(){return(0,r.default)(this,l),null}.bind(this)}},reactiveShinegaUrl:{default:function(){var l=this;return function(){return(0,r.default)(this,l),null}.bind(this)}},reactiveShinegaDatabaseId:{default:function(){var l=this;return function(){return(0,r.default)(this,l),null}.bind(this)}},shinegaInitData:{default:null},token:{default:null},emitterId:{default:null},fastApplicationId:{default:null},publishId:{default:null}},computed:{configInstance:function(){return this.reactiveConfigInstance()},$map:function(){return this.isSetMap_common?this.$_map:this.reactiveMap()},$earth:function(){return this.isSetMap_common?this.$_earth:this.reactiveEarth()},viewMode:function(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()},currentView:function(){return this.reactiveView()},currentInteraction:function(){return this.reactiveInteraction()},shinegaUrl:function(){return this.reactiveShinegaUrl()},shinegaDatabaseId:function(){return this.reactiveShinegaDatabaseId()}},methods:{setMap:function(l){var f=(0,i.default)(l),w=l.earth,x=l.viewMode;this.$_map=f,this.$_earth=w,this.$_viewMode=x,this.isSetMap_common=!0,this.begin&&this.begin()}}},a=n;c.default=a},419457:function(e,c,t){"use strict";var s=t(419534);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var i=s(t(452909)),r=s(t(342579)),n=void 0,a={props:{isShow:{type:Boolean,default:!0},position:{type:Object,default:function(){return(0,r.default)(this,n),{type:"absolute",top:"1px",left:"1px"}}.bind(void 0)},isColumn:{type:Boolean,default:!1},title:{type:String},iconClass:{type:String},dragEnable:{type:Boolean,default:!1},showImg:{type:Boolean,default:!0},showLabel:{type:Boolean,default:!0},themeStyle:{type:Object}},data:function(){return{theme:"light"}},watch:{currentView:{handler:function(f){f==="earth"?this.theme="dark":this.theme="light"},immediate:!0}},mounted:function(){var f,w=this;this.$_mixin_generalButton=(0,i.default)(f=this.$children).call(f,function(x){return(0,r.default)(this,w),x.$options.name==="ShGeneralButton"}.bind(this))},methods:{getPosition:function(){var f;return(f=this.$_mixin_generalButton)===null||f===void 0?void 0:f.getPosition()}}},u=a;c.default=u},56279:function(e,c,t){"use strict";t.d(c,{P:function(){return r}});var s=t(386892),i=t(149500);const r={mixins:[s.D],created(){},methods:{lifecycleBeforeChartsLoad(n){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&i.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),i.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let u=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[n]);if(u)return u}return n},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&i.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),i.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},242709:function(e,c,t){"use strict";var s=t(148836);const i={data(){return this.map=null,this.timer="",{isEditor:window.location.href.indexOf("editor.html")>0}},inject:{reactiveViewMode:{default:function(){return()=>"23D"}}},computed:{viewMode(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()}},mounted(){!this.widgetInfo.parentId&&this.isEditor&&this.widgetInfo.action.gisMapId&&this.$nextTick(function(){this.updateWidgetParentId({widgetId:this.widgetInfo.id,parentId:this.widgetInfo.action.gisMapId,keepPosition:!0})})},methods:{...(0,s.nv)(["updateWidgetParentId"]),getBindMap(){typeof this.widgetInfo.action.gisMapId<"u"}}};c.Z=i},752246:function(e,c,t){"use strict";t.d(c,{X:function(){return s},b:function(){return i}});let s={versions:function(){var r=navigator.userAgent;return{trident:r.indexOf("Trident")>-1,presto:r.indexOf("Presto")>-1,webKit:r.indexOf("AppleWebKit")>-1,gecko:r.indexOf("Gecko")>-1&&r.indexOf("KHTML")==-1,mobile:!!r.match(/AppleWebKit.*Mobile.*/),ios:!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:r.indexOf("Android")>-1,iPhone:r.indexOf("iPhone")>-1,iPad:r.indexOf("iPad")>-1,webApp:r.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},i;s.versions.mobile||s.versions.ios||s.versions.android||s.versions.iPhone||s.versions.iPad?i=!1:i=!0},844513:function(e,c,t){"use strict";t.d(c,{Z:function(){return f}});var s=function(){var x=this,G=x._self._c;return x.attr.buttonHide?G("div",{style:{position:"absolute",right:x.attr.buttonHideRight+"px",top:x.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(T){return x.onHide()}}},[x.openTooltip?G("el-tooltip",{attrs:{"open-delay":1e3,content:x.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[G("el-button",{class:x.attr.buttonHideIconClass&&x.attr.buttonHideIconClass!=""?x.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:x.attr.buttonHideColor,fontSize:x.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):G("el-button",{class:x.attr.buttonHideIconClass&&x.attr.buttonHideIconClass!=""?x.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:x.attr.buttonHideColor,fontSize:x.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):x._e()},i=[],r=t(752246),n={props:["attr"],name:"hide-button",data(){return{isPc:r.b}},computed:{openTooltip:function(){let w=!1,x=this.attr.buttonHideTooltipContent;return r.b&&x&&x!=null&&x.trim()!=""&&(w=!0),w}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},a=n,u=t(768141),l=(0,u.Z)(a,s,i,!1,null,"bf399b9a",null),f=l.exports},167670:function(e,c,t){"use strict";t.r(c),t.d(c,{default:function(){return V}});var s=function(){var v=this,L=v._self._c;return L("div",{directives:[{name:"show",rawName:"v-show",value:v.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"gis-cutting",style:{width:v.widgetInfo.attr.w+"px",height:v.widgetInfo.attr.hh+"px"},attrs:{map:v.map}},[L("hide-button",{attrs:{attr:v.widgetInfo.attr}}),L("cutting-layer",{ref:"cuttingLayer",attrs:{"is-show":!1,"cutting-options":v.widgetInfo.config}})],1)},i=[],r=t(380247),n=t.n(r),a=t(386892),u=t(844513),l=t(445061),f=t(950681),w=t(927966),x=t(242709),G=t(783574),T=t(143156),N=t(56279),M=t(149500),A={name:"GisCutting",components:{HideButton:u.Z,CuttingLayer:n()},mixins:[a.D,N.P,f.Z,l.u,G.default,x.Z],props:["widgetInfo"],data(){return{map:null,cutCls:void 0,stratedGetId:!1,firstInit:!0}},watch:{"widgetInfo.action.gisMapId":{handler(h){this.stratedGetId||(this.getBindMap(h),this.stratedGetId=!0)}}},destroyed(){this.cutCls&&this.cutCls.clearEvt()},created(){this.initAction(this.widgetInfo)},mounted(){this.widgetInfo.config.mapLayers=[],w.Z.$emit("register-save-event",{widget:this,handler:this.saveMapInfo}),w.Z.$on("refreshLayer",h=>{if(h&&(h=JSON.parse(h),this.widgetInfo.config.treeLayer=h,this.$refs.cuttingLayer.cutting)){let v=this.widgetInfo.config.filterConfig.filterIds,L=[];h.forEach(S=>{v.indexOf(S.id)>-1&&L.push(S.id)}),this.widgetInfo.config.filterConfig.filterIds=L,this.$refs.cuttingLayer.cutting.initCutting(this.lifecycleBeforeChartsLoad(this.widgetInfo.config))}}),w.Z.$on("refreshCutingList",()=>{this.$map&&this.getLayers(this.$map)}),this.$nextTick(()=>{this.$refs.cuttingLayer.activate()}),this.$map&&this.$map.layerManager.on("afterAddLayer",h=>{let v=h.layer.get("id");this.widgetInfo.config.targetLayers.indexOf(v)>-1&&(this.$refs.cuttingLayer.deactivate(),this.$refs.cuttingLayer.activate())}),this.onCuttingInited()},methods:{initAction(h){if(M.log("\u88C1\u526A\u6570\u636E\u521D\u59CB\u5316"),!h.config.geoJson||h.config.geoJson.length===0){const v=h.config.cutConfig.currentXZQ;v&&v.length>0&&this._getGeojson(v)}this.actionReceive(this.lifecycleBeforeChartsLoad(h))},_getGeojson(h){T.h.getGisGeojsonByCode({xzqCode:h}).then(v=>{v.status===200&&v.data&&v.data.length>0&&(this.widgetInfo.config.geoJson=v.data||[])})},actionReceive(h){if(h.action===void 0||h.action.receive===void 0)return;let v=h.action.receive.mapCutting;v&&v.enabled&&v.cutList&&v.cutList.length>0&&this.$$lib__.each(v.cutList,C=>{let W=C[0][1];w.Z.$on(W,B=>{v.script&&v.script.enabled&&(M.log("Execute the script to locate temp graphic to the "+h.name+" component"),this.actionMapCutting=new Function("info","data","action",v.script.content)),this.actionMapCutting(h,B,C)})});let L=h.action.receive.show;L&&L.enabled&&L.showList&&L.showList.length>0&&this.doActionShowOrHide(L.showList,L.value,L.script,h.name,"show",!1);let S=h.action.receive.hide;S&&S.enabled&&S.hideList&&S.hideList.length>0&&this.doActionShowOrHide(S.hideList,S.value,S.script,h.name,"hide",!0)},getMapId(){if(!this.stratedGetId){let h=setInterval(()=>{this.widgetInfo.action.gisMapId&&(clearInterval(h),this.getBindMap(this.widgetInfo.action.gisMapId))},500);this.stratedGetId=!0}},reLoadInfo(){this.$refs.cuttingLayer.activate()},getBindMap(h){let v=this.getWidgetObject(h);v&&this.initCutFun(v)},initCutFun(h){this.map=h.$refs.gismap},getLayers(h){let v=h.getLayers().getArray(),L=[];v.forEach(S=>{S.values_.id!=="drawLayer"&&S.values_.id!=="localLayer"&&S.values_.layerTag&&L.push(S)}),this.widgetInfo.config.mapLayers=L},saveMapInfo(){let h=this.$map,v=h.getView().getCenter(),L=h.getView().getResolution();this.widgetInfo.config.locateConf.center=v,this.widgetInfo.config.locateConf.resolution=L},actionMapCutting(h,v,L){},doShow(){this.$refs.cuttingLayer&&this.$refs.cuttingLayer.activate()},doHide(){this.$refs.cuttingLayer&&this.$refs.cuttingLayer.deactivate()},biPostMessage(h,v){let L=this,S=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(S,C=>{if(C.enabled&&h.indexOf(C.code)>-1){let W=C.code+"_"+L.widgetInfo.id;if(C.paramsExtend&&C.paramsExtend.length>0&&this.getExtendParams(v,C.paramsExtend,[],[]),C.script&&C.script.enabled&&C.script.content){this.doConfigMap=new Function("data",C.script.content);let B=this.doConfigMap(v);B&&(v=B)}w.Z.$emit(W,v),C.postMessage&&this.doPostMessage(v)}})},onCuttingInited(){let h=this.widgetInfo.config;this.biPostMessage([this.$$global_editor.actionType.mapConfiged.code],h)}}},J=A,F=t(768141),$=(0,F.Z)(J,s,i,!1,null,"1ec8c57a",null),V=$.exports},780876:function(e){function c(t,s){(s==null||s>t.length)&&(s=t.length);for(var i=0,r=new Array(s);i<s;i++)r[i]=t[i];return r}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports},396159:function(e,c,t){var s=t(847578),i=t(780876);function r(n){if(s(n))return i(n)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},122777:function(e){function c(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports},42762:function(e,c,t){var s=t(857448),i=t(168871);function r(a,u){for(var l=0;l<u.length;l++){var f=u[l];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),s(a,i(f.key),f)}}function n(a,u,l){return u&&r(a.prototype,u),l&&r(a,l),s(a,"prototype",{writable:!1}),a}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},554581:function(e,c,t){var s=t(494464),i=t(922780),r=t(735842);function n(a){if(typeof s<"u"&&i(a)!=null||a["@@iterator"]!=null)return r(a)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},412260:function(e){function c(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports},636583:function(e,c,t){var s=t(396159),i=t(554581),r=t(877297),n=t(412260);function a(u){return s(u)||i(u)||r(u)||n()}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},248943:function(e,c,t){var s=t(311484),i=t(29870).default;function r(n,a){if(i(n)!="object"||!n)return n;var u=n[s];if(u!==void 0){var l=u.call(n,a||"default");if(i(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},168871:function(e,c,t){var s=t(29870).default,i=t(248943);function r(n){var a=i(n,"string");return s(a)=="symbol"?a:String(a)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},877297:function(e,c,t){var s=t(797968),i=t(735842),r=t(780876);function n(a,u){var l;if(a){if(typeof a=="string")return r(a,u);var f=s(l=Object.prototype.toString.call(a)).call(l,8,-1);if(f==="Object"&&a.constructor&&(f=a.constructor.name),f==="Map"||f==="Set")return i(a);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return r(a,u)}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},575833:function(e,c,t){"use strict";var s=t(505567);e.exports=s},314963:function(e,c,t){"use strict";var s=t(976694);e.exports=s},267479:function(e,c,t){"use strict";var s=t(675576);e.exports=s},419727:function(e,c,t){"use strict";var s=t(411165);e.exports=s},797339:function(e,c,t){"use strict";var s=t(56345);e.exports=s},215748:function(e,c,t){"use strict";t(341809);var s=t(594388);e.exports=s.Array.isArray},300296:function(e,c,t){"use strict";t(449614);var s=t(594388),i=s.Object,r=e.exports=function(a,u,l){return i.defineProperty(a,u,l)};i.defineProperty.sham&&(r.sham=!0)},603953:function(e,c,t){"use strict";t(676258),t(853977);var s=t(499215);e.exports=s.f("toPrimitive")},735842:function(e,c,t){"use strict";e.exports=t(316276)},847578:function(e,c,t){"use strict";e.exports=t(20486)},797968:function(e,c,t){"use strict";e.exports=t(870348)},857448:function(e,c,t){"use strict";e.exports=t(476876)},311484:function(e,c,t){"use strict";e.exports=t(154090)},316276:function(e,c,t){"use strict";var s=t(575833);e.exports=s},20486:function(e,c,t){"use strict";var s=t(314963);e.exports=s},870348:function(e,c,t){"use strict";var s=t(267479);e.exports=s},476876:function(e,c,t){"use strict";var s=t(419727);e.exports=s},154090:function(e,c,t){"use strict";var s=t(797339);e.exports=s},341809:function(e,c,t){"use strict";var s=t(190434),i=t(267170);s({target:"Array",stat:!0},{isArray:i})},676258:function(){},449614:function(e,c,t){"use strict";var s=t(190434),i=t(714451),r=t(351032).f;s({target:"Object",stat:!0,forced:Object.defineProperty!==r,sham:!i},{defineProperty:r})},976694:function(e,c,t){"use strict";var s=t(215748);e.exports=s},411165:function(e,c,t){"use strict";var s=t(300296);e.exports=s},56345:function(e,c,t){"use strict";var s=t(603953);e.exports=s}}]);
