"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[49525],{549525:function(y,r,s){s.r(r),s.d(r,{default:function(){return m}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"my-wrapper"},[e("el-form",{ref:"form",attrs:{size:"mini","label-width":"70px","label-position":"right",model:t.currentWidget.dataset}},[e("el-form-item",{attrs:{label:"\u6570\u636E\u7C7B\u578B"}},[e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90\u7C7B\u578B"},on:{change:t.changeDatasetType},model:{value:t.currentWidget.dataset.type,callback:function(a){t.$set(t.currentWidget.dataset,"type",a)},expression:"currentWidget.dataset.type"}},t._l(t.dataSourcTypeList,function(a){return e("el-option",{key:a.value,attrs:{disabled:a.disabled,label:a.label,value:a.value}})}),1)],1),e("el-form-item",{attrs:{label:"\u6587\u4EF6\u540D\u79F0"}},[e("el-input",{staticStyle:{width:"170px"},attrs:{placeholder:"\u4E0B\u8F7D\u4FDD\u5B58\u7684\u6587\u4EF6\u540D\u79F0"},on:{change:t.getConfigData},model:{value:t.currentWidget.dataset[t.currentWidget.dataset.type].encode.fileName,callback:function(a){t.$set(t.currentWidget.dataset[t.currentWidget.dataset.type].encode,"fileName",a)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.fileName"}})],1),e("el-form-item",{attrs:{label:"Sheet\u540D\u79F0"}},[e("el-input",{staticStyle:{width:"170px"},attrs:{placeholder:"\u751F\u6210\u7684sheet\u540D\u79F0"},on:{change:t.getConfigData},model:{value:t.currentWidget.dataset[t.currentWidget.dataset.type].encode.sheetName,callback:function(a){t.$set(t.currentWidget.dataset[t.currentWidget.dataset.type].encode,"sheetName",a)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.sheetName"}})],1),e("el-collapse",[e("el-collapse-item",[e("template",{slot:"title"},[e("div",{staticClass:"my-title"},[t._v("\u5B57\u6BB5\u9009\u62E9")]),e("el-tooltip",[e("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s("<p>\u4E0D\u52FE\u9009\u5B57\u6BB5\u5219\u9ED8\u8BA4\u4E3A\u4E0B\u8F7D\u5168\u90E8\u5B57\u6BB5</p>")},slot:"content"}),e("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"5px"}})])],1),e("el-table",{ref:"columnTable",attrs:{data:t.tableData,"row-key":"name","reserve-selection":!0,size:"mini"},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection"}}),e("el-table-column",{attrs:{prop:"name",label:"\u5B57\u6BB5"}}),e("el-table-column",{attrs:{prop:"alias",label:"\u540D\u79F0"}}),e("el-table-column",{attrs:{label:"\u79FB\u52A8",width:"55"},scopedSlots:t._u([{key:"default",fn:function(a){return a.row.find==!0?[e("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:"\u5411\u4E0A\u79FB\u52A8",placement:"top"}},[e("el-link",{attrs:{underline:!1}},[e("i",{directives:[{name:"show",rawName:"v-show",value:a.$index!=0,expression:"scope.$index != 0"}],staticClass:"el-icon-top",staticStyle:{color:"#67c23a"},on:{click:function(i){return t.handleMove(a.$index,a.row.name,"top")}}})])],1),e("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:"\u5411\u4E0B\u79FB\u52A8",placement:"top"}},[e("el-link",{attrs:{underline:!1}},[e("i",{directives:[{name:"show",rawName:"v-show",value:a.$index!=t.selectionRows.length-1,expression:"scope.$index != selectionRows.length - 1"}],staticClass:"el-icon-bottom",staticStyle:{color:"#67c23a"},on:{click:function(i){return t.handleMove(a.$index,a.row.name,"bottom")}}})])],1)]:void 0}}],null,!0)})],1)],2)],1),e("setting-dataset",{ref:"settingDataset",attrs:{currentWidget:t.currentWidget},on:{getDataSetData:t.getConfigData,clearDynamicEncode:t.clearDynamicEncode}})],1)],1)},c=[],d=s(723400),u=s(589908),h={name:"download-excel-data",props:["currentWidget"],components:{SettingDataset:u.Z},mixins:[d.j],data(){return{dataSourcTypeList:[{label:"\u52A8\u6001",value:"dynamic"},{label:"\u672C\u5730(\u5F00\u53D1\u4E2D)",value:"local"}],tableData:[],selectionRows:[]}},watch:{"currentWidget.id":{deep:!0,handler:function(){this.isIniting=!0,this.getTableData(),this.$nextTick(()=>{this.isIniting=!1})}}},mounted(){this.isIniting=!0,this.getTableData(),this.$nextTick(()=>{this.isIniting=!1})},methods:{getTableData(){if(this.tableData=[],this.selectionRows=[],this.currentWidget.dataset.type!="static"){let n=this.currentWidget.dataset[this.currentWidget.dataset.type].encode.columns,t=JSON.parse(JSON.stringify(this.currentWidget.dataset[this.currentWidget.dataset.type].dimensionsAlias));if(n&&n!=""){let e=n.split(",");this.$$lib__.each(e,a=>{let i=this.$$lib__.find(t,l=>(l.name==a&&(l.find=!0),l.name==a));i&&(this.tableData.push(i),this.selectionRows.push(i))})}this.$$lib__.each(t,e=>{e.find!=!0&&this.tableData.push(e)})}this.$nextTick(()=>{this.setSelection()})},setSelection(){this.selectionRows.forEach(n=>{this.$refs.columnTable.toggleRowSelection(n)})},handleSelectionChange(n){if(this.isIniting)return;let t=[];n.forEach(e=>{t.push(e.name)}),this.currentWidget.dataset[this.currentWidget.dataset.type].encode.columns=t.join(","),this.getConfigData()},handleMove(n,t,e){let a=this.currentWidget.dataset[this.currentWidget.dataset.type].encode.columns.split(","),i=a[n];e=="top"?(a[n]=a[n-1],a[n-1]=i):e=="bottom"&&(a[n]=a[n+1],a[n+1]=i),this.currentWidget.dataset[this.currentWidget.dataset.type].encode.columns=a.join(","),this.getConfigData()},clearDynamicEncode(){this.currentWidget.dataset[this.currentWidget.dataset.type].encode.columns="",this.getConfigData()},changeDatasetType(){this.$refs.settingDataset.loadPreview(),this.getConfigData()}}},g=h,p=s(768141),f=(0,p.Z)(g,o,c,!1,null,"09f61ff1",null),m=f.exports}}]);
