"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[1023],{56279:function(z,u,l){l.d(u,{P:function(){return I}});var F=l(86892),y=l(49500);const I={mixins:[F.D],created(){},methods:{lifecycleBeforeChartsLoad(x){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&y.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),y.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let L=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[x]);if(L)return L}return x},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&y.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),y.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},21023:function(z,u,l){l.r(u),l.d(u,{default:function(){return j}});var F=function(){var a=this,s=a._self._c;return s("div",{style:{width:a.widgetInfo.attr.w+"px",height:a.widgetInfo.attr.hh+"px"}},[s("hide-button",{attrs:{attr:a.widgetInfo.attr}}),s("div",{ref:"pictorialBarLineMix",style:{width:a.widgetInfo.attr.w+"px",height:a.widgetInfo.attr.hh+"px"}})],1)},y=[],I=l(44513),x=l(27966),C=l(56279),L=l(45061),T=l(26711),E=l(75797),G=l(99349),$=l(55616),P=l(75770),R=l(67157),S=l(50666);const D={mixins:[R.c],data(){return{config_extend:{config:{series:[{type:"pictorialBar",yAxisIndex:0,markLine:{lineStyle:{show:!0,color:"rgba(180, 18, 18, 1)"}}},{type:"line",yAxisIndex:0,lineStyle:{color:"rgba(99, 196, 90, 1)"}},{type:"pictorialBar",yAxisIndex:0}]}},filter_config:{title:JSON.parse(JSON.stringify(S.Z.charts.title)),legend:JSON.parse(JSON.stringify(S.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(S.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(S.Z.charts.toolbox)),xAxis:JSON.parse(JSON.stringify(S.Z.charts.xAxis)),yAxisLeft:{axisLine:{lineStyle:{color:"#BFC5D1"}},axisLabel:{fontFamily:"",color:"#8B93A8"}},yAxisRight:{axisLine:{lineStyle:{color:"rgba(0,0,0,1)"}},axisLabel:{fontFamily:"",color:"rgba(0,0,0,1)"}}},series_filter:{series_pictorialBar:[{type:"pictorialBar",yAxisIndex:0,itemStyle:{colorInfo:{type:"pureColor",pureColor:"",gradation:{}},opacity:1},areaStyle:{colorInfo:{type:"pureColor",pureColor:"",gradation:{}},opacity:0},markLine:{lineStyle:{color:"rgba(180, 18, 18, 1)"}}}],series_line:[{type:"line",yAxisIndex:0,itemStyle:{colorInfo:{type:"pureColor",pureColor:"",gradation:{}},opacity:1},areaStyle:{colorInfo:{type:"pureColor",pureColor:"",gradation:{}},opacity:0},lineStyle:{color:"rgba(254, 196, 0, 1)"}}]}}},methods:{filterPredefineColoursSchemeConfig(t,a){if(this.getNewConfigWithArrary(t,a,this.filter_config),a.series instanceof Array&&t.series instanceof Array){let s=[],r=[],e=[],h=[];for(let m=0;m<a.series.length;m++)a.series[m].type=="pictorialBar"?s.push(a.series[m]):r.push(a.series[m]);for(let m=0;m<t.series.length;m++)t.series[m].type=="pictorialBar"?e.push(t.series[m]):h.push(t.series[m]);this.getNewConfigWithArrary(e,s,this.series_filter.series_pictorialBar),this.getNewConfigWithArrary(h,r,this.series_filter.series_line)}}}};var N=l(49500);const O=l(29426);var Z={name:"PictorialBarLineMix",components:{HideButton:I.Z},mixins:[C.P,L.u,T.H,G.P,E.u,D],props:["widgetInfo"],data(){return{dimensionsEx:null,dimensionsAliasEx:null,negative:null}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=O.init(this.$refs.pictorialBarLineMix,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{loadInfo(t){let a=[],s=[],r=[];s=t.dataset[t.dataset.type].dimensions,a=t.dataset[t.dataset.type].source,r=t.dataset[t.dataset.type].dimensionsAlias,this.dimensionsEx=s,this.dimensionsAliasEx=r;let e=JSON.parse(JSON.stringify(t.config.series)),h=this.getTooltip(t.config.tooltip),m=JSON.parse(JSON.stringify(t.config.toolbox)),d=JSON.parse(JSON.stringify(t.config.legend)),p=JSON.parse(JSON.stringify(t.config.title)),w=JSON.parse(JSON.stringify(t.config.grid)),c=JSON.parse(JSON.stringify(t.config.xAxis)),o=JSON.parse(JSON.stringify(t.config.yAxisLeft)),n=JSON.parse(JSON.stringify(t.config.yAxisRight)),U=e.length;for(let i=0;i<U;i++){e[i].dimensions=s,e[i].barGap&&(e[i].barGap=e[i].barGap+"%"),e[i].name||(e[i].name=this.getLegendData(r,e[i].encode[t.dataset.type].y)),e[i].type=="pictorialBar"?(e[i].barWidth&&(e[i].barWidth=e[i].barWidth+"%"),e[i].itemStyle.barBorderRadiusInfo&&(e[i].itemStyle.barBorderRadius=this.getItemStyleBarBorderRadius(e[i].itemStyle.barBorderRadiusInfo)),e[i].itemStyle.colorInfo.type&&(e[i].itemStyle.color=this.getItemStyleColor(e[i].itemStyle.colorInfo)),t.config.series[i].emphasis&&t.config.series[i].emphasis.itemStyle&&t.config.series[i].emphasis.itemStyle.color&&(e[i].emphasis.itemStyle.color=t.config.series[i].emphasis.itemStyle.color),this.getSymbol(e[i]),e[i].symbolSize&&(e[i].symbolSize=e[i].symbolSizePercent?[e[i].symbolSize[0]+"%",e[i].symbolSize[1]+"%"]:[e[i].symbolSize[0],e[i].symbolSize[1]])):e[i].type=="line"&&(e[i].lineWidth=e[i].lineWidth+"%",e[i].itemStyle.color=e[i].lineStyle.color,e[i].symbol=e[i].lineSymbol,e[i].symbolSize=e[i].lineSymbolSize,e[i].areaStyle.colorInfo.type&&(e[i].areaStyle.color=this.getItemStyleColor(e[i].areaStyle.colorInfo)),t.config.series[i].emphasis&&t.config.series[i].emphasis.itemStyle&&t.config.series[i].emphasis.itemStyle.color&&(e[i].emphasis.itemStyle.color=t.config.series[i].emphasis.itemStyle.color));let A={},b=[],v=[];for(let f=e[i].dimensions.length-1;f>-1;--f)A[s[f]]=f;for(let f=0;f<a.length;++f){let g=a[f];b.push(g[A[e[i].encode[t.dataset.type].y]]||""),v.push(g[A[e[i].encode[t.dataset.type].x]]||"")}if(e[i].data=b,c.data=v,b&&b.length>0&&t.config.series[i].emphasis&&t.config.series[i].emphasis.script&&t.config.series[i].emphasis.script.enabled){const f=t.config.series[i].emphasis;if(f.script.content)try{let g=this,K=new Function("index","item","data",f.script.content);e[i].data.forEach((B,J)=>{let Q=K.call(g,J,B,b);e[i].data[J]={value:B,emphasis:Q}})}catch(g){N.error("\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u811A\u672C\u62A5\u9519\uFF1A",g)}}}this.isNegative(e,a),!o.max&&o.max!=0&&(o.max=this.fun_max),!o.min&&o.min!=0&&(o.min=this.fun_min),!n.max&&n.max!=0&&(n.max=this.fun_max),!n.min&&n.min!=0&&(n.min=this.fun_min);let M={color:this.$$global_editor.predefineColors,tooltip:h,toolbox:m,title:{show:p.show,text:p.text,link:p.link,textAlign:p.textAlign,left:p.left+"%",right:p.right+"%",top:p.top+"%",bottom:p.bottom+"%",textStyle:{fontSize:p.textStyle.fontSize,fontFamily:p.textStyle.fontFamily,color:p.textStyle.color}},legend:{show:d.show,type:d.type,itemWidth:d.itemWidth,itemHeight:d.itemHeight,icon:d.icon,orient:d.orient,align:d.align,itemGap:d.itemGap,left:d.left+"%",top:d.top+"%",textStyle:{fontSize:d.textStyle.fontSize,fontFamily:d.textStyle.fontFamily,color:d.textStyle.color}},grid:{left:w.left+"%",right:w.right+"%",top:w.top+"%",bottom:w.bottom+"%"},xAxis:[{type:c.type,show:c.show,name:c.name,data:c.data,nameLocation:c.nameLocation,nameGap:c.nameGap,boundaryGap:c.boundaryGap,axisLine:{show:c.axisLine.show,lineStyle:{color:c.axisLine.lineStyle.color}},axisTick:{show:c.axisTick.show},axisLabel:{interval:c.axisLabel.interval,show:c.axisLabel.show,rotate:c.axisLabel.rotate,margin:c.axisLabel.margin,fontSize:c.axisLabel.fontSize,fontFamily:c.axisLabel.fontFamily,color:c.axisLabel.color},splitLine:c.splitLine}],yAxis:[{show:o.show,type:o.type,name:o.name,position:"left",min:o.min,max:o.max,nameLocation:o.nameLocation,nameGap:o.nameGap,nameTextStyle:o.nameTextStyle,axisLine:{show:o.axisLine.show,lineStyle:{color:o.axisLine.lineStyle.color}},axisTick:{show:o.axisTick.show,lineStyle:o.axisTick.lineStyle},axisLabel:{show:o.axisLabel.show,rotate:o.axisLabel.rotate,margin:o.axisLabel.margin,fontSize:o.axisLabel.fontSize,fontFamily:o.axisLabel.fontFamily,color:o.axisLabel.color},splitLine:o.splitLine,axisPointer:{status:"hide"}},{show:n.show,type:n.type,name:n.name,position:"right",min:n.min,max:n.max,nameLocation:n.nameLocation,nameGap:n.nameGap,nameTextStyle:n.nameTextStyle,axisLine:{show:n.axisLine.show,lineStyle:{color:n.axisLine.lineStyle.color}},axisTick:{show:n.axisTick.show,lineStyle:n.axisTick.lineStyle},axisLabel:{show:n.axisLabel.show,rotate:n.axisLabel.rotate,margin:n.axisLabel.margin,fontSize:n.axisLabel.fontSize,fontFamily:n.axisLabel.fontFamily,color:n.axisLabel.color},splitLine:n.splitLine,axisPointer:{status:"hide"}}],dataset:{source:a,sourceHeader:!1},series:e};this.getAnimation(M,t),this.setOption(M),this.setAnimationLoop(t,()=>{this.setOption(M,t)})},setOption(t){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0})},getSymbol(t){t.symbolType=="img"&&t.symbol!=""&&(t.symbol=this.getSymbolURL(t.symbol)),t.symbolType=="svg"&&t.symbol!=""&&(t.symbol.indexOf("image/")>-1?t.symbol=t.symbol.indexOf("image://")==-1?"image://"+t.symbol:t.symbol:t.symbol=t.symbol.indexOf("path://")==-1?"path://"+t.symbol:t.symbol)},reLoadInfo(t){t&&(this.$refs.pictorialBarLineMix.style.width=t.attr.w+"px",this.$refs.pictorialBarLineMix.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},getLegendData(t,a){let s=this.$$lib__.find(t,r=>r.name==a);return s?s.alias&&s.alias!=""?s.alias:s.name:""},getItemStyleColor(t){let a=null;return t.pureColor&&t.type==this.$$global_editor.colorType.pureColor.code?a=t.pureColor:t.type==this.$$global_editor.colorType.gradation.code&&(t.position=="levelDec"?a=new O.graphic.LinearGradient(0,0,1,0,[{offset:0,color:t.gradation.left!=null&&t.gradation.left!=""?t.gradation.left:"#FFFFFF"},{offset:1,color:t.gradation.right!=null&&t.gradation.right!=""?t.gradation.right:"#FFFFFF"}]):a=new O.graphic.LinearGradient(0,0,0,1,[{offset:0,color:t.gradation.top!=null&&t.gradation.top!=""?t.gradation.top:"#FFFFFF"},{offset:1,color:t.gradation.bottom!=null&&t.gradation.bottom!=""?t.gradation.bottom:"#FFFFFF"}])),a},getItemStyleBarBorderRadius(t){let a=[];return a.push(t.lt),a.push(t.rt),a.push(t.rb),a.push(t.lb),a},initAction(t){this.actionSendout(t),this.actionReceive(t)},actionSendout(t){let a=this;this.$$lib__.each(t.action.sendOut.actionList,s=>{if(s.enabled){let r=s.code+"_"+t.id;if(s.paramsExtend&&s.paramsExtend.length>0){let e={};this.getParamsExtend(e,s.paramsExtend,t)}s.code==P.Z.click.code&&a.onClick(r,s)}})},onClick(t,a){let s=this;s.echarts.on("click",r=>{let e={};e.x=r.name,e.y=r.value;let h=[],m=s.widgetInfo.action.sendOut.actionList;if(s.widgetInfo.dataset[s.widgetInfo.dataset.type].source&&s.widgetInfo.dataset[s.widgetInfo.dataset.type].source.length>0&&(h=s.widgetInfo.dataset[s.widgetInfo.dataset.type].source[r.dataIndex]),s.getExtendParams(e,m[0].paramsExtend,h,s.widgetInfo.dataset[s.widgetInfo.dataset.type].dimensions),a.script&&a.script.enabled){if(N.log("Execute script for "+s.widgetInfo.name+" component to "+a.name+" component"),a.script.content==""){$.Message.warning({message:a.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",a.script.content),e=this.customScript(e)}x.Z.$emit(t,e),a.postMessage&&s.doPostMessage(e),s.actionNameList.push(t)})},isNegative(t,a){let s=[];for(let r=0;r<t.length;r++){let e=-1;for(let h=0;h<t[r].dimensions.length;h++)t[r].dimensions[h]==t[r].encode.y&&(e=h);for(let h=0;h<a.length;h++)parseInt(a[h][e])<0&&s.push(h)}s.length>0?this.negative=!0:this.negative=!1},fun_max(t){let a=0,s=0;return parseInt(t.max)&&(a=Math.abs(parseInt(t.max)).toFixed(0).toString().length-1),parseInt(t.min)&&(s=Math.abs(parseInt(t.min)).toFixed(0).toString().length-1),Math.abs(t.max)>Math.abs(t.min)?Math.ceil(Math.abs(t.max)/Math.pow(10,a))*Math.pow(10,a):Math.ceil(Math.abs(t.min)/Math.pow(10,s))*Math.pow(10,s)},fun_min(t){if(this.negative){let a=0,s=0;return parseInt(t.max)&&(a=Math.abs(parseInt(t.max)).toFixed(0).toString().length-1),parseInt(t.min)&&(s=Math.abs(parseInt(t.min)).toFixed(0).toString().length-1),Math.abs(t.max)>Math.abs(t.min)?-1*Math.ceil(Math.abs(t.max)/Math.pow(10,a))*Math.pow(10,a):-1*Math.ceil(Math.abs(t.min)/Math.pow(10,s))*Math.pow(10,s)}else return-Math.abs(0)}}},W=Z,H=l(68141),k=(0,H.Z)(W,F,y,!1,null,"7b86cf4c",null),j=k.exports}}]);
