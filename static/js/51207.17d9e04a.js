"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[51207],{56279:function(v,f,i){i.d(f,{P:function(){return o}});var l=i(386892),c=i(149500);const o={mixins:[l.D],created(){},methods:{lifecycleBeforeChartsLoad(h){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&c.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),c.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let p=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[h]);if(p)return p}return h},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&c.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),c.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},752246:function(v,f,i){i.d(f,{X:function(){return l},b:function(){return c}});let l={versions:function(){var o=navigator.userAgent;return{trident:o.indexOf("Trident")>-1,presto:o.indexOf("Presto")>-1,webKit:o.indexOf("AppleWebKit")>-1,gecko:o.indexOf("Gecko")>-1&&o.indexOf("KHTML")==-1,mobile:!!o.match(/AppleWebKit.*Mobile.*/),ios:!!o.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:o.indexOf("Android")>-1,iPhone:o.indexOf("iPhone")>-1,iPad:o.indexOf("iPad")>-1,webApp:o.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},c;l.versions.mobile||l.versions.ios||l.versions.android||l.versions.iPhone||l.versions.iPad?c=!1:c=!0},844513:function(v,f,i){i.d(f,{Z:function(){return I}});var l=function(){var n=this,g=n._self._c;return n.attr.buttonHide?g("div",{style:{position:"absolute",right:n.attr.buttonHideRight+"px",top:n.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(S){return n.onHide()}}},[n.openTooltip?g("el-tooltip",{attrs:{"open-delay":1e3,content:n.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[g("el-button",{class:n.attr.buttonHideIconClass&&n.attr.buttonHideIconClass!=""?n.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:n.attr.buttonHideColor,fontSize:n.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):g("el-button",{class:n.attr.buttonHideIconClass&&n.attr.buttonHideIconClass!=""?n.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:n.attr.buttonHideColor,fontSize:n.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):n._e()},c=[],o=i(752246),h={props:["attr"],name:"hide-button",data(){return{isPc:o.b}},computed:{openTooltip:function(){let m=!1,n=this.attr.buttonHideTooltipContent;return o.b&&n&&n!=null&&n.trim()!=""&&(m=!0),m}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},w=h,p=i(768141),y=(0,p.Z)(w,l,c,!1,null,"bf399b9a",null),I=y.exports},851207:function(v,f,i){i.r(f),i.d(f,{default:function(){return E}});var l=function(){var e=this,a=e._self._c;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],ref:"buttonGroup",style:{width:e.widgetInfo.attr.w+"px",cursor:"pointer",height:e.widgetInfo.attr.hh+"px"},attrs:{"element-loading-text":"\u6B63\u5728\u4E0B\u8F7D\u4E2D","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.6)"},on:{click:function(s){return e.onDownloadExcel()}}},[a("hide-button",{attrs:{attr:e.widgetInfo.attr}}),a("div",{style:e.getStyle(e.widgetInfo.config)},[a("i",{class:e.widgetInfo.config.text.icon}),e._v(e._s(e.widgetInfo.config.text.label)+" ")])],1)},c=[],o=i(844513),h=i(193575),w=i(575416),p=i(555616),y=i(42160),I=i(927966),m=i(445061),n=i(56279),g=i(67157);const S={mixins:[g.c],data(){return{config_extend:{config:{text:{fontStyle:{color:"#99C999"},padding:{top:3,left:7}}}},filter_config:{text:{fontStyle:{color:"#99C999"}}}}},methods:{filterPredefineColoursSchemeConfig(t,e){this.getNewConfigWithArrary(t,e,this.filter_config)}}};var L=i(275770),x=i(149500),C={props:["widgetInfo"],name:"download-excel",components:{HideButton:o.Z},mixins:[w.baseConfig,h.E,m.u,n.P,S],data(){return{fullscreenLoading:!1}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{loadInfo(t){t.dataset&&t.dataset.type!="static"&&(t.dataset[t.dataset.type].source=[]),this.lifecycleAfterLoad()},reLoadInfo(t){this.loadInfo(t)},initAction(t){this.actionReceive(t),this.replaceParams(t)},onDownloadExcel(){if(this.widgetInfo.dataset[this.widgetInfo.dataset.type].dataSetId==null||this.widgetInfo.dataset[this.widgetInfo.dataset.type].dataSetId==""||this.widgetInfo.dataset[this.widgetInfo.dataset.type].dataSetId==null){p.Message.warning("\u5C1A\u672A\u914D\u7F6E\u6570\u636E\u96C6\u4FE1\u606F");return}if(this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode.columns){let t=this.widgetInfo.dataset[this.widgetInfo.dataset.type].encode.columns.split(",");if(t.length>0){let e=this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensionsAlias,a=[];t.forEach(s=>{let r=e.find(d=>d.name==s);r&&a.push(r)}),a.length>0&&(this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensionsAlias=a)}}this.sendOutAction(),this.downloadExcel(JSON.stringify(this.widgetInfo.dataset))},getStyle(t){return{paddingLeft:this.mUtils.getNewPxW(t.text.padding.left)+"px",paddingTop:this.mUtils.getNewPxH(t.text.padding.top)+"px",fontSize:this.mUtils.getNewFontSize(t.text.fontStyle.fontSize)+"px",color:t.text.fontStyle.color,fontWeight:t.text.fontStyle.fontWeight,fontFamily:t.text.fontStyle.fontFamily,fontStyle:t.text.fontStyle.fontStyle,textDecoration:t.text.fontStyle.textDecoration,textAlign:t.text.fontStyle.horizontalAlignment}},replaceParams(t){if(t.action==null||t.action.receive==null)return;let e=t.action.receive.replaceParams;if(e&&e.enabled){let a=e.replaceList;this.doParams(a,t)}},doParams(t,e){let a={};if(this.$$lib__.each(t,s=>{let r=s.replaceParam;for(let d=0;d<r.length;d++)if(r[d].length==3){let u="",b=r[d][2],P=b.indexOf("|");r[d][1].indexOf("_")>-1&&(u=r[d][1]),P>-1&&(b=r[d][2].substring(P+1)),a[u]||y.default.set(a,u,{}),a[u][s.param]||y.default.set(a[u],s.param,b)}}),!this.$$lib__.isEmpty(a))for(let s in a)I.Z.$on(s,r=>{(e.dataset[e.dataset.type].query==null||!e.dataset[e.dataset.type].query.params==null)&&(e.dataset[e.dataset.type].query={params:[],page:{enabled:!1,pageNum:1,pageSize:10},orders:[]});let d=!0;if(e.action.receive.replaceParams.script&&e.action.receive.replaceParams.script.enabled){if(x.log("Execute script for "+e.name+" component to replace dataset parameters"),e.action.receive.replaceParams.script.content==""){p.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60}),d=!1;return}this.doActionParams=new Function("info","data","param_key",e.action.receive.replaceParams.script.content)}d&&this.doActionParams(e,r,a[s])})},doActionParams(t,e,a){let s=t.dataset[t.dataset.type].query.params;for(let r in a)this.$$lib__.each(s,d=>{if(d.name==r){let u=a[r];d.defaultVal=e[u]}});x.info(s),this.widgetInfo.dataset[this.widgetInfo.dataset.type].query.params=JSON.parse(JSON.stringify(s)),x.info(this.widgetInfo.dataset[this.widgetInfo.dataset.type].query.params)},sendOutAction(){this.$$lib__.each(this.widgetInfo.action.sendOut.actionList,t=>{if(t.enabled&&t.code==L.default.click.code){let e={text:this.widgetInfo.config.text.label};if(t.paramsExtend&&t.paramsExtend.length>0){let s=[];this.widgetInfo.dataset[this.widgetInfo.dataset.type].source&&this.widgetInfo.dataset[this.widgetInfo.dataset.type].source.length>0&&(s=this.widgetInfo.dataset[this.widgetInfo.dataset.type].source[0]),this.getExtendParams(e,t.paramsExtend,s,this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions)}let a=t.code+"_"+this.widgetInfo.id;if(t.script&&t.script.enabled){if(x.log("Execute script for "+this.widgetInfo.name+" component to "+t.name+" component"),t.script.content==""){p.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}e=new Function("param",t.script.content).apply(this,[e])}I.Z.$emit(a,e),t.postMessage&&this.doPostMessage(e),this.actionNameList.push(a)}})}}},H=C,O=i(768141),A=(0,O.Z)(H,l,c,!1,null,"0ef29a46",null),E=A.exports}}]);
