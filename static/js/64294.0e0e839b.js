"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[64294],{764294:function(T,g,n){n.r(g),n.d(g,{default:function(){return b}});var p=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}]},[t("el-dialog",{staticClass:"dialog-publish",attrs:{"append-to-body":!0,center:!0,"close-on-click-modal":!1,visible:e.dialogVisible,title:"\u5B58\u4E3A\u793A\u4F8B",width:"440px"},on:{"update:visible":function(i){e.dialogVisible=i}}},[t("div",{staticStyle:{height:"130px"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.steps=="select",expression:"steps == 'select'"}],staticClass:"my-card-button"},[t("div",{staticStyle:{"margin-bottom":"10px",color:"rgb(245, 108, 108)","margin-left":"30px","text-align":"center"}},[e._v(" \u5EFA\u8BAE\u7EC4\u4EF6\u5BBD\u5EA6\u5C0F\u4E8E220\uFF0C\u9AD8\u5EA6\u5C0F\u4E8E120"),t("br"),e._v(" \u6CE8\u610F\uFF1A\u53F3\u4E0A\u89D2\u753B\u5E03\u653E\u7F29\u4E3A100%\uFF0C\u5426\u5219\u7F29\u7565\u56FE\u622A\u53D6\u4E0D\u5168"),t("br"),e._v(" \u4E14\u5BB9\u5668\u7EC4\u4EF6\u5185\u4E0D\u8981\u653E\u5B50\u7EC4\u4EF6\uFF0C\u5426\u5219\u4F1A\u622A\u53D6\u5230\u7F29\u7565\u56FE\u91CC ")]),t("el-tooltip",{attrs:{content:"\u65B0\u589E",effect:"dark",placement:"top"}},[t("el-button",{staticStyle:{"background-color":"#67c23a",color:"#fff",padding:"5px","margin-left":"80px"},attrs:{type:"text"},on:{click:e.add}},[t("i",{staticClass:"iconfont bi_add1",staticStyle:{"font-size":"50px"}})])],1),e.getSelectMultiple?t("el-tooltip",{attrs:{content:"\u591A\u9009\u4E0D\u53EF\u4EE5\u8986\u76D6",effect:"dark",placement:"top"}},[t("el-button",{staticStyle:{"background-color":"#909399",color:"#fff",padding:"5px","margin-left":"100px"},attrs:{type:"text"}},[t("i",{staticClass:"iconfont bi_edit",staticStyle:{"font-size":"50px"}})])],1):t("el-tooltip",{attrs:{content:"\u8986\u76D6",effect:"dark",placement:"top"}},[t("el-button",{staticStyle:{"background-color":"#5689f7",color:"#fff",padding:"5px","margin-left":"100px"},attrs:{type:"text"},on:{click:e.edit}},[t("i",{staticClass:"iconfont bi_edit",staticStyle:{"font-size":"50px"}})])],1)],1),t("el-form",{ref:"refExample",attrs:{model:e.object,rules:e.rules,"label-width":"90px",size:"mini"}},[e.steps=="add"?t("div",[e.getSelectMultiple?t("el-form-item",{attrs:{label:"\u540D\u79F0\u524D\u7F00"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"\u8BF7\u8F93\u5165\u793A\u4F8B\u540D\u79F0\u524D\u7F00",maxlength:"50"},model:{value:e.object.prefixName,callback:function(i){e.$set(e.object,"prefixName",i)},expression:"object.prefixName"}})],1):t("el-form-item",{attrs:{label:"\u793A\u4F8B\u540D\u79F0",prop:"exampleName"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"\u8BF7\u8F93\u5165\u793A\u4F8B\u540D\u79F0",maxlength:"50"},model:{value:e.object.exampleName,callback:function(i){e.$set(e.object,"exampleName",i)},expression:"object.exampleName"}})],1),t("el-form-item",{attrs:{label:"\u5173\u8054\u914D\u8272"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5173\u8054\u914D\u8272","popper-class":"white-bgc"},on:{change:e.changeValueTheme},model:{value:e.object.widgetThemeId,callback:function(i){e.$set(e.object,"widgetThemeId",i)},expression:"object.widgetThemeId"}},e._l(e.listWidgetTheme,function(i){return t("el-option",{key:i.widgetThemeId,attrs:{label:i.themeName,value:i.widgetThemeId}})}),1)],1)],1):e.steps=="cover"?t("div",[t("el-form-item",{attrs:{label:"\u793A\u4F8B\u540D\u79F0"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"\u8BF7\u9009\u62E9\u793A\u4F8B\u540D\u79F0","popper-class":"white-bgc",maxlength:"50"},on:{change:e.changeValueExample},model:{value:e.object.widgetExampleId,callback:function(i){e.$set(e.object,"widgetExampleId",i)},expression:"object.widgetExampleId"}},e._l(e.listWidgetExample,function(i){return t("el-option",{key:i.widgetExampleId,attrs:{label:i.exampleName,value:i.widgetExampleId}})}),1)],1),t("el-form-item",{attrs:{label:"\u5173\u8054\u914D\u8272"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5173\u8054\u914D\u8272","popper-class":"white-bgc"},on:{change:e.changeValueTheme,"remove-tag":e.removeTagTheme},model:{value:e.coverThemeIdList,callback:function(i){e.coverThemeIdList=i},expression:"coverThemeIdList"}},e._l(e.listWidgetThemeCover,function(i){return t("el-option",{key:i.widgetThemeId,attrs:{disabled:i.disabled,label:i.themeName,value:i.widgetThemeId}})}),1)],1)],1):e._e()])],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:function(i){e.dialogVisible=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.steps!="select",expression:"steps != 'select'"}],attrs:{size:"mini"},on:{click:e.back}},[e._v("\u4E0A\u4E00\u6B65")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.steps!="select",expression:"steps != 'select'"}],attrs:{size:"mini",type:"primary"},on:{click:e.saveExample}},[e._v(" \u786E \u5B9A ")])],1)])],1)},c=[],r=n(433948),o=n(555616),m=n(148836),h=n(782047),u={name:"example-editor-toolbar",mixins:[h.v],data(){return{fullscreenLoading:!1,dialogVisible:!1,steps:"select",object:{},rules:{exampleName:[{required:!0,max:50,message:"\u5FC5\u586B\uFF1A\u793A\u4F8B\u540D\u79F0\uFF08\u957F\u5EA6\u9650\u523650\u5B57\u7B26\uFF09",trigger:"blur"}]},listWidgetExample:[],listWidgetTheme:[],listWidgetThemeCover:[],coverThemeIdList:[],list:{widgetExample:[],widgetTheme:[]},saveMultiple:{len:0,index:0,list:[]}}},computed:{...(0,m.Se)(["getWidgetTemplateExample","getCanvasSetting","getSelectMultiple","getCurrentWidget","getMultipleWidget"])},watch:{"saveMultiple.index":{deep:!0,handler:function(){this.saveMultiple.len>0&&this.saveMultiple.len==this.saveMultiple.index&&this.saveExampleMultiple()}}},mounted(){this.getThemeAndExample()},methods:{...(0,m.nv)(["setWidgetTemplateExample","setWidgetTheme"]),openDialog(){this.steps="select",this.clear(),this.dialogVisible=!0,this.getExampleList()},add(){this.clear(),this.steps="add",!this.getSelectMultiple&&(!this.object.exampleName||this.object.exampleName=="")&&(this.object.exampleName=this.getCurrentWidget.name)},edit(){this.clear(),this.steps="cover"},saveExample(){this.$refs.refExample.validate(l=>{if(l)this.getSelectMultiple?(this.fullscreenLoading=!0,this.exampleMultiple()):(this.fullscreenLoading=!0,this.steps=="add"?this.saveExampleSingle(this.getCurrentWidget,this.object,()=>{this.getThemeAndExample(),this.fullscreenLoading=!1,this.dialogVisible=!1}):this.steps=="cover"&&this.coverExample(this.getCurrentWidget,this.object,()=>{this.getThemeAndExample(),this.fullscreenLoading=!1,this.dialogVisible=!1}));else return!1})},saveExampleMultiple(){r.A.saveList(this.saveMultiple.list).then(l=>{l&&l.status==200?(this.getThemeAndExample(),this.fullscreenLoading=!1,this.dialogVisible=!1,o.Message.success({message:"\u6B64\u6B21 "+this.saveMultiple.len+" \u4E2A\u7EC4\u4EF6\u5B58\u4E3A\u793A\u4F8B\u5DF2\u6210\u529F\u4FDD\u5B58\u5B8C\u6210",offset:60})):o.Message.error({message:"\u6B64\u6B21 "+this.saveMultiple.len+" \u4E2A\u7EC4\u4EF6\u5B58\u4E3A\u793A\u4F8B\u4FDD\u5B58\u5931\u8D25\uFF1A"+l.msg,offset:60})})},saveExampleSingle(l,e,t){let i=JSON.parse(JSON.stringify(l)),s=[{childWidget:[],selfWidget:i}];e.configJson=JSON.stringify(s),e.widgetType=i.widgetType,e.widgetGroup=i.widgetGroup,e.widgetName=i.typeName,this.exampleImg(i.id,i.attr.w,i.attr.h,a=>{e.exampleImg=a,r.A.save(e).then(d=>{d&&d.status==200?o.Message.success({message:"\u7EC4\u4EF6\u3010 "+l.name+" \u3011\u6210\u529F\u4FDD\u5B58\u4E3A\u793A\u4F8B\u3010"+e.exampleName+"\u3011",offset:60}):o.Message.error({message:"\u7EC4\u4EF6\u3010 "+l.name+" \u3011\u4FDD\u5B58\u5931\u8D25\uFF1A"+d.msg,offset:60}),t&&t()})})},coverExample(l,e,t){let i=JSON.parse(JSON.stringify(l)),s=[{childWidget:[],selfWidget:i}];e.configJson=JSON.stringify(s),e.widgetType=i.widgetType,e.widgetGroup=i.widgetGroup,e.widgetName=i.typeName,this.exampleImg(i.id,i.attr.w,i.attr.h,a=>{e.exampleImg=a,r.A.cover({widgetExample:e,widgetThemeIds:this.coverThemeIdList}).then(d=>{d&&d.status==200?o.Message.success({message:"\u7EC4\u4EF6\u3010 "+l.name+" \u3011\u8986\u76D6\u6210\u529F",offset:60}):o.Message.error({message:"\u7EC4\u4EF6\u3010 "+l.name+" \u3011\u8986\u76D6\u5931\u8D25\uFF1A"+d.msg,offset:60}),t&&t()})})},exampleMultiple(){this.saveMultiple.len=Object.keys(this.getMultipleWidget).length,this.saveMultiple.index=0,this.saveMultiple.list=[];for(let l in this.getMultipleWidget){let e=this.getMultipleWidget[l],t=JSON.parse(JSON.stringify(this.object));this.object.prefixName&&(t.exampleName=this.object.prefixName+e.name);let i=JSON.parse(JSON.stringify(e)),s=[{childWidget:[],selfWidget:i}];t.configJson=JSON.stringify(s),t.widgetType=i.widgetType,t.widgetGroup=i.widgetGroup,t.widgetName=i.typeName,this.exampleImg(i.id,i.attr.w,i.attr.h,a=>{t.exampleImg=a,this.saveMultiple.list.push(t),this.saveMultiple.index++})}},changeValueExample(l){this.listWidgetThemeCover=[],this.coverThemeIdList=[],this.$$lib__.each(this.listWidgetTheme,e=>{let t={widgetThemeId:e.widgetThemeId,themeName:e.themeName};this.$$lib__.find(e.exampleInfo,s=>s.widgetExampleId==l)&&(t.disabled=!0,this.coverThemeIdList.push(e.widgetThemeId)),this.listWidgetThemeCover.push(t)})},changeValueTheme(l){let e=[];this.$$lib__.each(l,t=>{let i=this.$$lib__.find(this.listWidgetTheme,s=>s.widgetThemeId==t);if(i){let s=this.$$lib__.find(i.exampleInfo,a=>a.widgetType==this.getCurrentWidget.widgetType&&a.widgetGroup==this.getCurrentWidget.widgetGroup&&a.widgetName==this.getCurrentWidget.typeName);if(s){let a=this.$$lib__.find(this.listWidgetExample,w=>w.widgetExampleId==s.widgetExampleId),d=a!=null?"\u3010"+a.exampleName+"\u3011":"";e.push("\u65B9\u6848\u3010 "+i.themeName+" \u3011\u4E2D\u7684\u3010 "+d+" \u3011\u793A\u4F8B\uFF0C")}}}),e.length>0&&o.Message.warning({dangerouslyUseHTMLString:!0,message:e.join("<br />")+"<br />\u4EE5\u4E0A\u65B9\u6848\u4E2D\u5DF2\u7ECF\u5B58\u5728\u3010"+this.getCurrentWidget.typeTitle+"\u3011\u7C7B\u578B\u7684\u7EC4\u4EF6\u793A\u4F8B\uFF0C\u4FDD\u5B58\u540E\u5C06\u8986\u76D6\u539F\u6765\u7684\u793A\u4F8B",offset:120})},removeTagTheme(l){let e=this.$$lib__.find(this.listWidgetThemeCover,t=>t.widgetThemeId==l&&t.disabled==!0);e&&(this.coverThemeIdList.push(l),o.Message.warning({message:"\u5DF2\u5173\u8054\u7684\u65B9\u6848\u3010"+e.themeName+"\u3011\u4E0D\u5141\u8BB8\u79FB\u9664\uFF0C\u5982\u82E5\u79FB\u9664\uFF0C\u8BF7\u5230\u65B9\u6848\u7BA1\u7406\u4E2D\u89E3\u9664\u5173\u8054",offset:60}))},getExampleList(){this.system_list_key=this.getCurrentWidget.widgetType+"_"+this.getCurrentWidget.widgetGroup+"_"+this.getCurrentWidget.typeName;let l=this.getWidgetTemplateExample[this.system_list_key];l?this.listWidgetExample=l:this.listWidgetExample=[]},clear(){this.object={widgetExampleId:null,widgetThemeId:null,exampleName:null,prefixName:null,widgetType:null,widgetGroup:null,widgetName:null,configJson:null,exampleImg:null},this.listWidgetThemeCover=[],this.coverThemeIdList=[]},back(){this.steps="select"}}},f=u,x=n(768141),v=(0,x.Z)(f,p,c,!1,null,"64bfc74a",null),b=v.exports}}]);
