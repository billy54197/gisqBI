"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[4777],{44777:function(p,i,l){l.r(i),l.d(i,{default:function(){return Q}});var o=function(){var e=this,s=e._self._c;return s("div",[s("el-dialog",{staticClass:"my-dialog-class",attrs:{title:"\u4FDD\u5B58\u7B5B\u9009\u6761\u4EF6","close-on-click-modal":!1,"modal-append-to-body":!1,"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(a){e.dialogVisible=a}}},[s("el-form",{ref:"ref_form_data",attrs:{model:e.form_data,rules:e.rules,size:"mini","label-width":"120px"}},[s("el-form-item",{attrs:{label:"\u7B5B\u9009\u5668\u540D\u79F0",prop:"label"}},[s("el-input",{model:{value:e.form_data.label,callback:function(a){e.$set(e.form_data,"label",a)},expression:"form_data.label"}})],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form_data.guid==null,expression:"form_data.guid == null"}],attrs:{label:"\u66FF\u6362\u5DF2\u6709\u7B5B\u9009\u5668"}},[s("el-select",{staticClass:"white-bgc",staticStyle:{width:"100%"},attrs:{placeholder:"\u8BF7\u9009\u62E9\u5C06\u8981\u66FF\u6362\u7684\u7B5B\u9009\u5668"},on:{change:e.changeCover},model:{value:e.form_data.cover_guid,callback:function(a){e.$set(e.form_data,"cover_guid",a)},expression:"form_data.cover_guid"}},e._l(e.customerQuery,function(a){return s("el-option",{key:a.guid,attrs:{label:a.label,value:a.guid}})}),1)],1),e.over_length==!0?s("div",{staticStyle:{"text-align":"center"}},[s("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C"}}),s("label",{staticStyle:{color:"#F56C6C","font-weight":"bolder"}},[e._v(" \u63D0\u793A\uFF1A")]),s("label",{staticStyle:{color:"#F56C6C"}},[e._v(" \u4E00\u4E2A\u9875\u9762\u6700\u591A\u4FDD\u5B5810\u4E2A\u7B5B\u9009\u5668\uFF0C\u8D85\u51FA10\u4E2A\u540E\uFF0C\u53EA\u80FD\u66FF\u6362\u5DF2\u6709\u7684\u7B5B\u9009\u5668\u3002")])]):e._e()],1),s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(a){e.dialogVisible=!1}}},[e._v("\u53D6 \u6D88")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.saveQuery}},[e._v("\u786E \u5B9A")])],1)],1)],1)},d=[],n=l(45617),f=l.n(n),h=l(79876),c=l(78931),r=l(55616),u=l(48836),y=l(50707),g=l(49500),m={name:"save-query",mixins:[h.G],props:{saveKeyValue:{type:Boolean,default:!0}},data(){return{dialogVisible:null,form_data:{guid:null,label:null,cover_guid:null},current_keyValue:null,rules:{label:[{required:!0,message:"\u8BF7\u8F93\u5165\u7B5B\u9009\u5668\u540D\u79F0",trigger:"blur"}]},over_length:!1}},computed:{...(0,u.Se)(["customerQueryFun"]),customerQuery(){let t=this.customerQueryFun(this.widgetId);return t&&t.length>0?JSON.parse(JSON.stringify(t)):[]}},methods:{...(0,u.nv)(["setCustomerQuery"]),saveQuery(){this.$refs.ref_form_data.validate(t=>{if(t)this.doQuery(),this.current_keyValue=JSON.parse(JSON.stringify(this.requestBody.keyValue)),this.$$lib__.each(this.customerQuery,e=>{e.default=!1}),this.form_data.guid==null?this.doAddQuery():this.doEditQuery(),this.over_length==!1&&this.doSaveQuery();else return!1})},doAddQuery(){this.form_data.cover_guid==null?(this.over_length=this.customerQuery.length>=10,this.over_length==!1&&this.customerQuery.push({guid:f().v4().replace(/-/g,""),label:this.form_data.label,keyValue:JSON.stringify(this.current_keyValue),default:!0,number:this.customerQuery.length+1})):this.doEditQuery()},doEditQuery(){this.over_length=!1,this.$$lib__.each(this.customerQuery,t=>{t.guid==this.form_data.cover_guid&&(t.label=this.form_data.label,this.saveKeyValue==!0&&(t.keyValue=JSON.stringify(this.current_keyValue)),t.default=!0)})},doSaveQuery(){if(this.accessType){if(this.queryId==null&&this.queryPublishId==null){g.error("\u67E5\u8BE2\u5217\u8868ID\u548C\u7248\u672CID  \u81F3\u5C11\u6709\u4E00\u4E2A"),r.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60});return}switch(this.accessType){case this.global.editType.original.code:y._.saveCustomerQuery(JSON.stringify(this.customerQuery),this.queryId,this.queryPublishId).then(t=>{this.afterSave(t)});break;case this.global.editType.public.code:r.Message.error({message:"\u516C\u5F00\u7248\u672C\uFF0C\u65E0\u6CD5\u83B7\u53D6\u7528\u6237\u4FE1\u606F\uFF0C\u5373\u65E0\u6CD5\u4F7F\u7528\u6B64\u529F\u80FD",offset:60});break;default:r.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60})}}else this.queryId?c.y.saveCustomerQuery(JSON.stringify(this.customerQuery),this.queryId).then(t=>{this.afterSave(t)}):r.Message.error({message:"\u53C2\u6570\u6709\u8BEF\uFF0C\u65E0\u8BBE\u67E5\u8BE2\u5217\u8868\u4E3B\u952E\uFF0C\u65E0\u6CD5\u4FDD\u5B58",offset:60})},afterSave(t){t&&t.status==200?(this.setCustomerQuery({customerQuery:this.customerQuery,widgetId:this.widgetId}),r.Message.success({message:"\u4FDD\u5B58\u6210\u529F",offset:60})):r.Message.error({message:t.msg,offset:60}),this.dialogVisible=!1},addQuery(){this.accessType!=this.$$global_query.accessType.public.code?(this.over_length=!1,this.form_data={guid:null,label:null,cover_guid:null},this.dialogVisible=!0):r.Message.warning({message:"\u516C\u5F00\u53D1\u5E03\u7248\u672C\uFF0C\u4E0D\u53EF\u4F7F\u7528\u6B64\u529F\u80FD",offset:60})},editQuery(t){this.over_length=!1;let e=this.$$lib__.find(this.customerQuery,s=>s.guid==t);e&&(this.form_data={guid:t,label:e.label,cover_guid:t}),this.dialogVisible=!0},changeCover(){if(!this.form_data.label||this.form_data.label==""){let t=this.$$lib__.find(this.customerQuery,e=>e.guid==this.form_data.cover_guid);this.form_data.label=t.label}}}},v=m,b=l(68141),_=(0,b.Z)(v,o,d,!1,null,"70284933",null),Q=_.exports}}]);
