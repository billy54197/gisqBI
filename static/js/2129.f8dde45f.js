"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[2129],{56279:function(O,u,s){s.d(u,{P:function(){return b}});var w=s(86892),p=s(49500);const b={mixins:[w.D],created(){},methods:{lifecycleBeforeChartsLoad(y){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&p.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let x=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[y]);if(x)return x}return y},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&p.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},72129:function(O,u,s){s.r(u),s.d(u,{default:function(){return H}});var w=function(){var i=this,o=i._self._c;return o("div",{style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}},[o("hide-button",{attrs:{attr:i.widgetInfo.attr}}),o("div",{ref:"pieNested",style:{width:i.widgetInfo.attr.w+"px",height:i.widgetInfo.attr.hh+"px"}})],1)},p=[],b=s(44513),y=s(27966),I=s(87798),x=s(56279),A=s(45061),C=s(26711),J=s(7797),F=s(99349),D=s(55616),z=s(75770),P=s(67157),m=s(50666);const E={mixins:[P.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(m.Z.charts.title)),legend:JSON.parse(JSON.stringify(m.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(m.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(m.Z.charts.toolbox)),xAxis:JSON.parse(JSON.stringify(m.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(m.Z.charts.yAxis)),color:["#29CC97"],series:{label:{color:"#fff",backgroundColor:"rgba(0,23,11,0.8)"},labelLine:{lineStyle:{color:"#000"}},data:{itemStyle:{normal:{color:"rgba(0,0,0,0)"},emphasis:{color:"rgba(0,0,0,0)"}}}},seriesData:[{itemStyle:{color:"rgba(232, 233, 240, 1)"}}]}}},methods:{filterPredefineColoursSchemeConfig(e,i){this.getNewConfigWithArrary(e,i,this.filter_config)}}};var N=s(49500);const Z=s(29426);var M={name:"PieNested",components:{HideButton:b.Z},mixins:[J.u,x.P,A.u,C.H,I.P,F.P,E],props:["widgetInfo"],data(){return{}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=Z.init(this.$refs.pieNested,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{initAction(e){this.actionSendout(e),this.actionReceive(e)},loadInfo(e){let i=[],o={};e.dataset[e.dataset.type]&&(i=this.getSeriesData(e.dataset[e.dataset.type].source,e.dataset[e.dataset.type].dimensions,e.config.seriesData),o=this.getData(i,e.config.seriesData,e.config.series));let t=JSON.parse(JSON.stringify(e)),l=this.getTooltip(t.config.tooltip),d=JSON.parse(JSON.stringify(t.config.toolbox)),n={title:{show:t.config.title.show,text:t.config.title.text,link:t.config.title.link,textAlign:t.config.title.textAlign,left:t.config.title.left+"%",right:t.config.title.right+"%",top:t.config.title.top+"%",bottom:t.config.title.bottom+"%",label:{fontSize:t.config.title.label.fontSize,fontFamily:t.config.title.label.fontFamily,color:t.config.title.label.color},textStyle:{fontSize:t.config.title.textStyle.fontSize,fontFamily:t.config.title.textStyle.fontFamily,color:t.config.title.textStyle.color}},legend:{show:t.config.legend.show,itemWidth:t.config.legend.itemWidth,itemHeight:t.config.legend.itemHeight,icon:t.config.legend.icon,orient:t.config.legend.orient,align:t.config.legend.align,itemGap:t.config.legend.itemGap,left:t.config.legend.left+"%",right:t.config.legend.right+"%",top:t.config.legend.top+"%",bottom:t.config.legend.bottom+"%",selectedMode:!1,textStyle:{fontSize:t.config.legend.textStyle.fontSize,fontFamily:t.config.legend.textStyle.fontFamily,color:t.config.legend.textStyle.color}},grid:{top:t.config.grid.top+"%",bottom:t.config.grid.bottom+"%",left:t.config.grid.left+"%",right:t.config.grid.right+"%",containLabel:t.config.grid.containLabel},yAxis:[{show:t.config.yAxis.show,type:"category",inverse:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:t.config.yAxis.axisLabel,data:o.yAxis}],xAxis:[{show:t.config.xAxis.show,type:"category",inverse:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:t.config.xAxis.axisLabel,data:o.yAxis}],tooltip:l,toolbox:d,series:o.series};if(n.series&&n.series.length>0&&e.config.seriesData[0].emphasis&&e.config.seriesData[0].emphasis.script&&e.config.seriesData[0].emphasis.script.enabled){const f=e.config.seriesData[0].emphasis;if(f.script.content){let a=new Function("index","item","data",f.script.content);for(let r=0;r<n.series.length;r++)try{let h=a.call(this,r,n.series[r],n.series);n.series[r].data[0].emphasis=h}catch(h){N.error("\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u811A\u672C\u62A5\u9519\uFF1A",h)}}}else for(let f=0;f<n.series.length;f++)n.series[f].data[0].emphasis=e.config.seriesData[0].emphasis;this.getAnimation(n,t),this.setOption(n),this.setAnimationLoop(t,()=>{this.setOption(n,t)})},setOption(e){this.echarts.getOption()&&this.echarts.clear(),setTimeout(()=>{this.echarts.setOption(this.lifecycleBeforeChartsLoad(e),{notMerge:!0})},0)},reLoadInfo(e){e&&(this.$refs.pieNested.style.width=e.attr.w+"px",this.$refs.pieNested.style.height=e.attr.hh+"px"),this.loadInfo(e),this.echarts.resize()},getData(e,i,o){let t=JSON.parse(JSON.stringify(o)),l=e.length,d=this.getNewColorList(l),n={series:[],yAxis:[]},f=l>1?(t.width-t.radius)/(l*2):t.width;for(let a=0;a<l;a++){let r=JSON.parse(JSON.stringify(i)),h=[],v=JSON.parse(JSON.stringify(i));for(let c=0;c<r.length;c++){let g="",L="",S="";e[a].length&&e[a][1].value?(e[a][1].value>100?g=100:g=e[a][1].value,L=100-g):e[a].length&&(g=(parseFloat(e[a][0].value)/parseFloat(e[a][0].name)*100).toFixed(this.widgetInfo.config.grid.decimalDigits),L=100-g),c==0?S=g:c==1?S=L:c==2&&(S=parseFloat(100/(360-t.restRadius)*t.restRadius)),v[c].label.formatter=this.getFormatterString(v[c].label.formatter);let W={name:e[a].length?e[a][c].name:"",value:S,itemStyle:{color:c==0?d[a]:r[c].itemStyle.color},label:v[c].label,labelLine:r[c].labelLine,tooltip:r[c]?r[c].tooltip:!1};c==0&&!isNaN(g)&&n.yAxis.push(g),h.push(W)}h[0].value&&n.series.push({name:"",type:"pie",hoverAnimation:!1,clockWise:t.clockWise,startAngle:t.startAngle,z:0,radius:[t.width-a*f*2+"%",t.width-a*f*2-f+"%"],center:[t.center[0]+"%",t.center[1]+"%"],label:{show:t.label.show,position:t.label.position,color:t.label.color,fontWeight:t.label.fontWeight,fontSize:t.label.fontSize,backgroundColor:t.label.backgroundColor,padding:[4,8,4,8]},labelLine:{show:t.labelLine.show,lineStyle:{color:t.labelLine.lineStyle.color,width:t.labelLine.lineStyle.width,type:t.labelLine.lineStyle.type}},itemStyle:t.itemStyle,data:h})}return n},getNewColorList(e){let i=JSON.parse(JSON.stringify(this.widgetInfo.config.color));if(e<=i.length)return i;for(let o=0;o<e;o++)i[o]==null&&(i[o]=i[0]);return i},getSeriesData(e,i,o){let t=[];for(let l=0;l<e.length;l++){let d=[{name:"",value:""},{name:"",value:""},{name:"",value:""}];for(let n in o){let f=-1,a=-1;for(let r=0;r<i.length;r++)i[r]==o[n].encode.x&&o[n].encode.x!=""&&(f=r),i[r]==o[n].encode.y&&o[n].encode.y!=""&&(a=r);(f>-1||a>-1)&&(d[n].name=e[l][f],d[n].value=e[l][a])}t.push(d)}return t},actionSendout(e){let i=this;this.$$lib__.each(e.action.sendOut.actionList,o=>{if(o.enabled){let t=o.code+"_"+e.id;if(o.paramsExtend&&o.paramsExtend.length>0){let l={};this.getParamsExtend(l,o.paramsExtend,e)}o.code==z.Z.click.code&&i.onClick(t,o)}})},onClick(e,i){let o=this;o.echarts.on("click",t=>{let l={};if(l.x=t.data.name,l.y=t.data.value,i.script&&i.script.enabled){if(N.log("Execute script for "+o.widgetInfo.name+" component to "+i.name+" component"),i.script.content==""){D.Message.warning({message:i.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",i.script.content),l=this.customScript(l)}y.Z.$emit(e,l),i.postMessage&&o.doPostMessage(l),o.actionNameList.push(e)})}}},R=M,$=s(68141),T=(0,$.Z)(R,w,p,!1,null,"c0823a80",null),H=T.exports}}]);
