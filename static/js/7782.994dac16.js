(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[7782],{31638:function(ot,L,s){"use strict";var a=s(29870),f=s(20314),r=s(26352),g=s(40639),l=s(43586),z=s(85208),A=s(59791),D=s(22466),j=s(83393),U=s(5077),V=s(87879),Q=s(19534);Object.defineProperty(L,"__esModule",{value:!![]}),L.FlattenTools=void 0;var F=Q(s(22466)),X=Q(s(28866)),J=Q(s(81806)),H=Q(s(43389)),u=Q(s(42579)),m=Q(s(22777)),S=Q(s(42762)),p=it(s(87647)),G=it(s(10614)),W=s(92672),N=s(70317),rt=s(55616),Y=s(36161);function ht(c){if(typeof V!="function")return null;var b=new V,o=new V;return(ht=function(T){return T?o:b})(c)}function it(c,b){if(!b&&c&&c.__esModule)return c;if(c===null||a(c)!=="object"&&typeof c!="function")return{default:c};var o=ht(b);if(o&&o.has(c))return o.get(c);var d={},T=Object.defineProperty&&j;for(var C in c)if(C!=="default"&&Object.prototype.hasOwnProperty.call(c,C)){var P=T?j(c,C):null;P&&(P.get||P.set)?Object.defineProperty(d,C,P):d[C]=c[C]}return d.default=c,o&&o.set(c,d),d}function ut(c,b){var o=z(c);if(A){var d=A(c);b&&(d=D(d).call(d,function(T){return j(c,T).enumerable})),o.push.apply(o,d)}return o}function tt(c){for(var b=1;b<arguments.length;b++){var o=arguments[b]!=null?arguments[b]:{};b%2?ut(Object(o),!0).forEach(function(d){(0,H.default)(c,d,o[d])}):U?Object.defineProperties(c,U(o)):ut(Object(o)).forEach(function(d){Object.defineProperty(c,d,j(o,d))})}return c}function Ct(c,b){var o=typeof g<"u"&&l(c)||c["@@iterator"];if(!o){if(Array.isArray(c)||(o=st(c))||b&&c&&typeof c.length=="number"){o&&(c=o);var d=0,T=function(){};return{s:T,n:function(){return d>=c.length?{done:!![]}:{done:![],value:c[d++]}},e:function(O){throw O},f:T}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C=!![],P=![],y;return{s:function(){o=o.call(c)},n:function(){var O=o.next();return C=O.done,O},e:function(O){P=!![],y=O},f:function(){try{!C&&o.return!=null&&o.return()}finally{if(P)throw y}}}}function st(c,b){var o;if(c){if(typeof c=="string")return gt(c,b);var d=f(o=Object.prototype.toString.call(c)).call(o,8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return r(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return gt(c,b)}}function gt(c,b){(b==null||b>c.length)&&(b=c.length);for(var o=0,d=new Array(b);o<b;o++)d[o]=c[o];return d}var lt=function(){function c(b,o){(0,m.default)(this,c),this.viewer=b||{},this.dataSource=o||new p.CustomDataSource}return(0,S.default)(c,[{key:"clipArr",value:function(o){var d=this,T=this.viewer.shine.layerManager.checkedLayers,C=(0,F.default)(T).call(T,function(K){return(0,u.default)(this,d),K.type==="3dtiles"||K.type==="I3S"}.bind(this)),P=(0,X.default)(C).call(C,function(K){return(0,u.default)(this,d),K.id}.bind(this)),y=Ct(C),M;try{for(y.s();!(M=y.n()).done;){var O,Z=M.value,k=this.viewer.shine.getLayer(Z.id,"id");((O=k.provider)===null||O===void 0?void 0:O.layers[0].data.layerType)==="Building"?rt.Message.error("Buiding\u7C7B\u578B\u6682\u65F6\u4E0D\u652F\u6301\u6B64\u7C7B\u670D\u52A1\u7684\u5F00\u6316\u538B\u5E73\uFF01"):(!k.model.flattenPolygons&&(k.model.flattenPolygons=new p.FlattenPolygonCollection),k.model.flattenPolygons.removeAll())}}catch(K){y.e(K)}finally{y.f()}var q=this.viewer.scene.globe;q.flattenPolygons=new p.FlattenPolygonCollection,q.flattenPolygons.removeAll(),o.length===0&&(q.flattenPolygons.enabled=![]);for(var at=function(){var vt=this,pt=JSON.parse(o[_].positions),St=o[_].flattenType?"clipping":"flatten",wt=d.getFlattenPolygon(St,pt),Tt=JSON.parse(o[_].layers);Tt.forEach(function(yt){if((0,u.default)(this,vt),(0,J.default)(P).call(P,yt.id)){var mt=d.viewer.shine.getLayer(yt.id,"id");if(mt.model){var Pt=mt.model;Pt.flattenPolygons.add(wt)}else rt.Message.error("Buiding\u7C7B\u578B\u6682\u65F6\u4E0D\u652F\u6301\u6B64\u7C7B\u670D\u52A1\u7684\u5F00\u6316\u538B\u5E73\uFF01")}}.bind(this));var It=d.getFlattenPolygon(o[_].terrainType,pt);q.flattenPolygons.add(It)},_=0;_<o.length;_++)at()}},{key:"getFlattenPolygon",value:function(o,d,T){var C;switch(o){case"clipping":C=new p.FlattenPolygon({positions:d,mode:p.FlattenMode.CLIPPING});break;case"flatten":var P=T||p.Cartographic.fromCartesian(d[0]).height;C=new p.FlattenPolygon({positions:d,height:P,mode:p.FlattenMode.FLATTEN});break;case"disable":var y=tt({},d[0]),M={x:y.x+10,y:y.y,z:y.z},O={x:y.x,y:y.y+10,z:y.z};C=new p.FlattenPolygon({positions:[y,M,O],height:0,mode:p.FlattenMode.FLATTEN});break}return C}},{key:"createHeightDragger",value:function(o,d){var T=this,C=o.editing._positions_draw;T.updatePolygonHeight(o,d),o.editing.newHeightDraggers=[];var P=(0,W.setPositionsHeight)((0,W.centerOfMass)(C),d),y,M=G.createDragger(this.dataSource,{position:P,type:G.PointType.MoveHeight,tooltip:N.message.dragger.moveHeight,onDrag:function(Z,k){y=y||k;var q=p.Cartographic.fromCartesian(k).height,at=q-p.Cartographic.fromCartesian(y).height;T.updatePolygonHeight(o,q+at),y=k},onDragEnd:function(){y=null}});o.editing.newHeightDraggers.push(M)}},{key:"updatePolygonHeight",value:function(o,d){var T,C=this,P=o.editing._positions_draw,y=d;if(y==0&&o&&(y=p.Cartographic.fromCartesian(o._positions_draw[0]).height),!(!P||P.length==0)){for(var M=(0,F.default)(T=o.editing.draggers).call(T,function(K){return(0,u.default)(this,C),K._pointType==1||K._pointType==2}.bind(this)),O=0;O<M.length;O++){var Z=M[O],k=(0,W.setPositionsHeight)(Z.position.getValue(),y);Z.position.setValue(k)}for(var q=[],at=0;at<P.length;at++){var _=(0,W.setPositionsHeight)(P[at],y);q.push(_)}o.editing._positions_draw=q,o._positions_draw=q,o.editing.setPositions(q),o.editing.updateDraggers()}}},{key:"toClip",value:function(o,d,T,C){var P;if(d[0].z?P=d:P=(0,Y.lonlats2cartesians)(d),o instanceof Array)for(var y=0;y<o.length;y++){var M=o[y];!M.flattenPolygons&&(M.flattenPolygons=new p.FlattenPolygonCollection);var O=this.getFlattenPolygon(T,P,C);M.flattenPolygons.add(O)}else{var Z=o;!Z.flattenPolygons&&(Z.flattenPolygons=new p.FlattenPolygonCollection);var k=this.getFlattenPolygon(T,P,C);Z.flattenPolygons.add(k)}}},{key:"terrainClip",value:function(o,d,T){var C;o[0].z?C=o:C=(0,Y.lonlats2cartesians)(o);var P=this.viewer.scene.globe,y=this.getFlattenPolygon(d,C,T);!P.flattenPolygons&&(P.flattenPolygons=new p.FlattenPolygonCollection),P.flattenPolygons.enabled=!![],P.flattenPolygons.add(y)}},{key:"deleteIndexTerrain",value:function(o){var d=this.viewer.scene.globe;!d.flattenPolygons&&(d.flattenPolygons=new p.FlattenPolygonCollection);var T=d.flattenPolygons.get(o);d.flattenPolygons.remove(T)}},{key:"deleteAllTerrain",value:function(){var o=this.viewer.scene.globe;!o.flattenPolygons&&(o.flattenPolygons=new p.FlattenPolygonCollection),o.flattenPolygons.removeAll(),o.flattenPolygons.enabled=![]}},{key:"centerAt",value:function(o){var d=p.BoundingSphere.fromPoints(o);this.viewer.camera.flyToBoundingSphere(d)}},{key:"deleteAll",value:function(o){if(o instanceof Array)for(var d=0;d<o.length;d++){var T=o[d].flattenPolygons;T&&T.removeAll()}else{var C=o.flattenPolygons;C&&C.removeAll()}}},{key:"deleteFlattenPolygon",value:function(o,d){if(o instanceof Array)for(var T=0;T<o.length;T++){var C=o[T].flattenPolygons,P=C.get(d);P.equals=function(O,Z){return O.flattenMode===Z.flattenMode&&O.geometry===Z.geometry},C.remove(P)}else{var y=o.flattenPolygons,M=y.get(d);M.equals=function(O,Z){return O.flattenMode===Z.flattenMode&&O.geometry===Z.geometry},y.remove(M)}}}]),c}();L.FlattenTools=lt},38068:function(ot,L,s){ot.exports=function(a){var f={};function r(g){if(f[g])return f[g].exports;var l=f[g]={i:g,l:!1,exports:{}};return a[g].call(l.exports,l,l.exports,r),l.l=!0,l.exports}return r.m=a,r.c=f,r.d=function(g,l,z){r.o(g,l)||Object.defineProperty(g,l,{enumerable:!0,get:z})},r.r=function(g){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},r.t=function(g,l){if(l&1&&(g=r(g)),l&8||l&4&&typeof g=="object"&&g&&g.__esModule)return g;var z=Object.create(null);if(r.r(z),Object.defineProperty(z,"default",{enumerable:!0,value:g}),l&2&&typeof g!="string")for(var A in g)r.d(z,A,function(D){return g[D]}.bind(null,A));return z},r.n=function(g){var l=g&&g.__esModule?function(){return g.default}:function(){return g};return r.d(l,"a",l),l},r.o=function(g,l){return Object.prototype.hasOwnProperty.call(g,l)},r.p="/dist/",r(r.s=778)}({0:function(a,f){a.exports=s(42579)},1:function(a,f){a.exports=s(28866)},10:function(a,f){a.exports=s(42762)},13:function(a,f){a.exports=s(66273)},17:function(a,f){a.exports=s(85208)},18:function(a,f){a.exports=s(59791)},19:function(a,f){a.exports=s(83393)},2:function(a,f,r){"use strict";r.d(f,"a",function(){return g});function g(l,z,A,D,j,U,V,Q){var F=typeof l=="function"?l.options:l;z&&(F.render=z,F.staticRenderFns=A,F._compiled=!0),D&&(F.functional=!0),U&&(F._scopeId="data-v-"+U);var X;if(V?(X=function(u){u=u||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!u&&typeof __VUE_SSR_CONTEXT__<"u"&&(u=__VUE_SSR_CONTEXT__),j&&j.call(this,u),u&&u._registeredComponents&&u._registeredComponents.add(V)},F._ssrRegister=X):j&&(X=Q?function(){j.call(this,(F.functional?this.parent:this).$root.$options.shadowRoot)}:j),X)if(F.functional){F._injectStyles=X;var J=F.render;F.render=function(m,S){return X.call(S),J(m,S)}}else{var H=F.beforeCreate;F.beforeCreate=H?[].concat(H,X):[X]}return{exports:l,options:F}}},20:function(a,f){a.exports=s(5077)},21:function(a,f){a.exports=s(81806)},22:function(a,f){a.exports=s(69033)},24:function(a,f){a.exports=s(52909)},25:function(a,f){a.exports=s(43389)},27:function(a,f){a.exports=s(78756)},28:function(a,f){a.exports=s(32726)},30:function(a,f){a.exports=s(32569)},32:function(a,f){a.exports=s(17745)},37:function(a,f){a.exports=s(59602)},38:function(a,f){a.exports=s(26541)},4:function(a,f){a.exports=s(55616)},43:function(a,f){a.exports=s(47806)},483:function(a,f){a.exports=s(31638)},5:function(a,f){a.exports=s(5146)},50:function(a,f){a.exports=s(36583)},6:function(a,f){a.exports=s(83574)},63:function(a,f){a.exports=s(36161)},7:function(a,f){a.exports=s(17249)},778:function(a,f,r){"use strict";r.r(f);var g=r(0),l=r.n(g),z=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{directives:[{name:"show",rawName:"v-show",value:n.shouldShow,expression:"shouldShow"}],staticClass:"sh-flatten-tools"},[t("general-container",{attrs:{"is-show":n.visible,title:n.title?n.title:"\u5F00\u6316\u538B\u5E73","img-src":n.imgSrc?n.imgSrc:"flatten-tools","style-config":n.styleConfig,position:n.position,theme:n.theme,"drag-enable":n.dragEnable,"append-to-body":n.appendToBody,"theme-style":n.cardThemeStyle,"only-container":n.onlyContainer},on:{"update:isShow":function(i){n.visible=i},"update:is-show":function(i){n.visible=i},"change:isShow":n.onChangeIsShow}},[t("div",{staticClass:"clip_content"},[t("div",{staticClass:"clip_layers",class:{more:n.select_layers.length==1}},[t("span",{staticClass:"layers_label"},[n._v("\u5173\u8054\u56FE\u5C42:")]),t("el-select",{attrs:{"popper-class":"bff",size:"mini",multiple:"","collapse-tags":"",placeholder:"\u8BF7\u9009\u62E9\u5173\u8054\u56FE\u5C42"},on:{change:function(i){return n.changeTileset()}},model:{value:n.selectLayers,callback:function(i){n.selectLayers=i},expression:"selectLayers"}},n._l(n.layerArr,function(i){return t("el-option",{key:i.value,attrs:{label:i.label,value:i.id,disabled:i.disabled}})}),1)],1),t("div",{staticClass:"clip_list",attrs:{onselectstart:"return false;"}},[t("el-table",{attrs:{data:n.tableData,border:"","max-height":564,"row-class-name":n.tableRowClassName},on:{"row-click":n.rowClick}},[t("el-table-column",{attrs:{label:"\u9AD8\u5EA6(m)",align:"center",prop:"height","min-width":"60","show-overflow-tooltip":!0},scopedSlots:n._u([{key:"default",fn:function(i){return[n._v(`
              `+n._s(!i.row.flattenType||i.row.terrainType==="flatten"?i.row.height:0)+`
            `)]}}])}),t("el-table-column",{attrs:{prop:"flattenType",label:"\u7C7B\u578B",width:"78",align:"center"},scopedSlots:n._u([{key:"default",fn:function(i){return[t("el-switch",{attrs:{disabled:JSON.parse(i.row.layers).length==0,"active-text":JSON.parse(i.row.layers).length==0?"\u7981\u7528":"\u5F00\u6316","inactive-text":JSON.parse(i.row.layers).length==0?"\u7981\u7528":"\u538B\u5E73","active-color":JSON.parse(i.row.layers).length==0?"#848484":"#13ce66","inactive-color":JSON.parse(i.row.layers).length==0?"#848484":"#ff4949",width:55},on:{change:function(h){return n.changeType(i.row)}},model:{value:i.row.flattenType,callback:function(h){n.$set(i.row,"flattenType",h)},expression:"scope.row.flattenType"}})]}}])}),t("el-table-column",{attrs:{prop:"flattenType",label:"\u5730\u5F62",width:"78",align:"center"},scopedSlots:n._u([{key:"default",fn:function(i){return[t("el-select",{class:{flatten:i.row.terrainType==="flatten",disable:i.row.terrainType==="disable"},attrs:{"popper-class":"bff",size:"mini"},on:{change:function(h){return n.changeTerrainType(i.row)}},model:{value:i.row.terrainType,callback:function(h){n.$set(i.row,"terrainType",h)},expression:"scope.row.terrainType"}},n._l(n.terrainTypeArr,function(h,I){return t("el-option",{key:I,attrs:{label:h.label,value:h.value}})}),1)]}}])}),t("el-table-column",{attrs:{label:"\u64CD\u4F5C",align:"center",width:"50","class-name":"small-padding fixed-width cell-img"},scopedSlots:n._u([{key:"default",fn:function(i){return[t("div",[t("span",{attrs:{title:i.row.isShow?"\u663E\u793A":"\u9690\u85CF"}},[t("icon-svg",{staticStyle:{cursor:"pointer"},attrs:{"icon-class":i.row.isShow?"display":"hide"},nativeOn:{click:function(h){return h.stopPropagation(),n.handleShow(i.row)}}})],1),t("span",{attrs:{title:"\u5B9A\u4F4D"}},[t("icon-svg",{staticStyle:{cursor:"pointer"},attrs:{"icon-class":"coordinate-location"},nativeOn:{click:function(h){return h.stopPropagation(),n.handleLocation(i.row)}}})],1)]),t("div",{staticStyle:{"margin-left":"5px"}},[t("span",{attrs:{title:"\u7F16\u8F91"}},[t("icon-svg",{staticStyle:{cursor:"pointer"},attrs:{"icon-class":"edit",fillcolor:i.row.enabled?"#00FFFF":"#fff"},nativeOn:{click:function(h){return h.stopPropagation(),n.handleEdit(i.row)}}})],1),t("span",{attrs:{title:"\u5220\u9664"}},[t("icon-svg",{staticStyle:{cursor:"pointer"},attrs:{"icon-class":"delete"},nativeOn:{click:function(h){return h.stopPropagation(),n.handleDelete(i.row,i.row.flattenType)}}})],1)])]}}])})],1)],1),t("div",{staticClass:"btnBox"},[t("div",{staticClass:"btn",on:{click:function(i){return n.startClip()}}},[n._v("\u65B0\u589E")]),t("div",{staticClass:"btn",on:{click:function(i){return n.save()}}},[n._v("\u4FDD\u5B58")]),t("div",{staticClass:"btn",on:{click:function(i){return n.delPlane()}}},[n._v("\u6E05\u7A7A")])])])])],1)},A=[];z._withStripped=!0;var D=r(17),j=r.n(D),U=r(18),V=r.n(U),Q=r(19),F=r.n(Q),X=r(20),J=r.n(X),H=r(25),u=r.n(H),m=r(50),S=r.n(m),p=r(5),G=r.n(p),W=r(1),N=r.n(W),rt=r(21),Y=r.n(rt),ht=r(8),it=r.n(ht),ut=r(13),tt=r.n(ut),Ct=r(38),st=r.n(Ct),gt=r(22),lt=r.n(gt),c=r(24),b=r.n(c),o=r(80),d=r(90),T=r(483),C=r(30),P=r.n(C),y=r(63),M=r(9),O=r.n(M),Z=r(10),k=r.n(Z),q=r(27),at=r.n(q),_=r(37),K=r(4);function vt(n,e){var t=j()(n);if(V.a){var i=V()(n);e&&(i=it()(i).call(i,function(h){return F()(n,h).enumerable})),t.push.apply(t,i)}return t}function pt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vt(Object(t),!0).forEach(function(i){u()(n,i,t[i])}):J.a?Object.defineProperties(n,J()(t)):vt(Object(t)).forEach(function(i){Object.defineProperty(n,i,F()(t,i))})}return n}var St=function(){function n(e,t,i,h){O()(this,n),this.baseUrl=e,this.token=t,this.applicationId=i,this.schemeId=h}return k()(n,[{key:"get",value:function(t,i){var h=this;return new at.a(function(I,w){var x=this;l()(this,h),Object(_.getFromAdmin)(this.baseUrl+t,{params:pt({schemeId:this.schemeId},i),token:this.token,applicationId:this.applicationId}).then(function(v){l()(this,x);var B=Object(_.parseResult)(v);B.success?I(B.data):K.Message.error(B.message)}.bind(this)).catch(function(v){l()(this,x),w(v.data)}.bind(this))}.bind(this))}},{key:"post",value:function(t,i){var h=this;return new at.a(function(I,w){var x=this;l()(this,h),Object(_.postFromAdmin)(this.baseUrl+t,tt()(i),{token:this.token,applicationId:this.applicationId,params:{schemeId:this.schemeId}}).then(function(v){l()(this,x);var B=Object(_.parseResult)(v);B.success?I(B.data):K.Message.error(B.message)}.bind(this)).catch(function(v){l()(this,x),w(v.data)}.bind(this))}.bind(this))}},{key:"saveFlatten",value:function(t){return this.post("/press/save",t)}},{key:"editFlatten",value:function(t){return this.post("/press/modify",t)}},{key:"getFlattenList",value:function(t){return this.get("/press/list",t)}},{key:"deleteFlatten",value:function(t){return this.post("/press/del/"+t)}},{key:"saveList",value:function(t){return this.post("/press/modifyList",t)}},{key:"removeList",value:function(t){return this.post("/press/removeList",t)}}]),n}(),wt=r(6),Tt=r.n(wt),It=r(43),yt=r.n(It),mt=r(7),Pt=r.n(mt),Mt=r(32),$t=r.n(Mt);function At(n,e){var t=j()(n);if(V.a){var i=V()(n);e&&(i=it()(i).call(i,function(h){return F()(n,h).enumerable})),t.push.apply(t,i)}return t}function xt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?At(Object(t),!0).forEach(function(i){u()(n,i,t[i])}):J.a?Object.defineProperties(n,J()(t)):At(Object(t)).forEach(function(i){Object.defineProperty(n,i,F()(t,i))})}return n}var dt,et,R,$,Dt=[],Ot={drawtype:"polygon",style:{color:"#ffffff",opacity:.2,outline:!0,outlineWidth:5,outlineColor:"#FF0000",clampToGround:!1,zIndex:0},config:{height:!1,isSameHeight:!1,isFlatten:!0},attr:{isClip:!0,id:""}},ft,zt={name:"ShFlattenTools",components:{GeneralContainer:P.a,IconSvg:$t.a},mixins:[Tt.a,yt.a,Pt.a],props:{url:{type:String},schemeId:{type:String},isCustom:{type:Boolean,default:!1}},data:function(){return{shouldShow:!1,layer3dtiles:[],selectLayers:[],selecLayerIds:[],checkedLayers:[],lastChecked:[],tableData:[],terrainTypeArr:[{label:"\u5F00\u6316",value:"clipping"},{label:"\u538B\u5E73",value:"flatten"},{label:"\u7981\u7528",value:"disable"}],allData:[],pageSize:100,pageNum:1,hasTerrain:!1,currRowId:null,itemLayers:[],editId:"",edited:!1}},computed:{layerArr:function(){var e,t=this,i,h=G()(e=[]).call(e,S()(this.itemLayers),S()(this.layer3dtiles)),I={},w=h.reduce(function(v,B){return l()(this,t),I[B.id]||(I[B.id]=v.push(B)),v}.bind(this),[]),x=N()(i=this.layer3dtiles).call(i,function(v){return l()(this,t),v.id}.bind(this));return w.forEach(function(v){l()(this,t),Y()(x).call(x,v.id)?v.disabled=!1:v.disabled=!0}.bind(this)),w},select_layers:{get:function(){var e=this,t=this.selecLayerIds,i=[];return this.layerArr.forEach(function(h){l()(this,e),Y()(t).call(t,h.id)&&!h.disabled&&i.push(h.id)}.bind(this)),i},set:function(){}}},watch:{currentView:{handler:function(e){this.shouldShow=e==="earth"},immediate:!0},checkedLayers:{handler:function(e){var t=this;if(e!==this.lastChecked&&!this.isCustom){var i,h,I=N()(e).call(e,function(E){return l()(this,t),E.id}.bind(this)),w=N()(i=this.lastChecked).call(i,function(E){return l()(this,t),E.id}.bind(this));if(this.lastChecked.length>e.length){var x;h=it()(x=this.lastChecked).call(x,function(E){return l()(this,t),!Y()(I).call(I,E.id)}.bind(this))}else h=it()(e).call(e,function(E){return l()(this,t),!Y()(w).call(w,E.id)}.bind(this));var v=N()(h).call(h,function(E){return l()(this,t),E.type}.bind(this));if(!Y()(v).call(v,"3dtiles")&&!Y()(v).call(v,"I3S"))return;var B=[];Dt=it()(e).call(e,function(E){return l()(this,t),E.type==="3dtiles"||E.type==="I3S"}.bind(this)),N()(Dt).call(Dt,function(E){l()(this,t);var nt={};nt.label=E.label,nt.id=E.id,B.push(nt)}.bind(this)),this.layer3dtiles=B}this.lastChecked=JSON.parse(tt()(e))},deep:!0},select_layers:function(e){this.selectLayers=e},selectLayers:function(e,t){e!==t&&R&&this.visible&&R.clipArr(this.tableData)}},mounted:function(){var e=this;this.$earth&&setTimeout(function(){l()(this,e),this.begin()}.bind(this),0)},methods:{onChangeIsShow:function(e){var t=this;this.$emit("change:isShow",e),e?this.isCustom||this.initData():(this.edited&&this.$confirm("\u662F\u5426\u4FDD\u5B58\u5F00\u6316\u538B\u5E73\u6700\u65B0\u4FEE\u6539\uFF1F","\u63D0\u793A",{confirmButtonText:"\u4FDD\u5B58",cancelButtonText:"\u4E0D\u4FDD\u5B58",type:"warning"}).then(function(){l()(this,t),this.save("\u5DF2\u4FDD\u5B58\u5F00\u6316\u538B\u5E73\u6700\u65B0\u4FEE\u6539")}.bind(this)).catch(function(){l()(this,t)}.bind(this)),$.clearDraw(),et=null,this.stopDraw(),R.clipArr([]))},begin:function(){dt=this.$earth.viewer,this.initDraw(),!this.isCustom&&this.isShow&&this.initData()},initDraw:function(){var e=this,t=this;this.checkedLayers=dt.shine.layerManager.checkedLayers;var i={hasEdit:!1,horizontalBar:!1,labelShow:!0,polygonShow:!0,polylineShow:!0,showToolbar:!0,verticalBar:!0};$=new o.Draw(dt,i);var h={visible:!0,id:"flatten-tools",type:"geojson-draw"};dt.shine.addLayer(h),$.setEditLayer(h.id),$.on("change:active",function(w){l()(this,e),this.$emit("change:active",w.active)}.bind(this));var I=$.getDataSource();R=new T.FlattenTools(dt,I),$.on(d.DrawCreated,function(w){var x=this;et=w.entity;var v=[],B=JSON.parse(tt()(t.layerArr));B.forEach(function(nt){var ct;if(l()(this,x),Y()(ct=t.selectLayers).call(ct,nt.id)){var Et={id:nt.id,label:nt.label};v.push(Et)}}.bind(this));var E={flattenType:!0,isShow:!0,enabled:!1,height:Object(y.cartesian2lonlat)(et._positions_draw[0])[2],positions:tt()(et._positions_draw),schemaId:t.schemeId,terrainType:"clipping",id:et.id,layers:tt()(v)};t.tableData.push(E),$.setGeojsonFeatureId(et),t.toClip(),ft.saveFlatten(E).then(function(){l()(this,x),Object(K.Message)({message:"\u65B0\u589E\u6210\u529F",type:"success"})}.bind(this))}),$.on(d.EditStart,function(w){et=w.entity,t.startEditing()}),$.on(d.EditMovePoint,function(w){et=w.entity,t.startEditing()}),$.on(d.EditRemovePoint,function(w){et=w.entity,t.startEditing();var x=et._positions_draw;R.updateFlattenPolygon(x,et)})},initData:function(){ft=new St(this.url,this.token,this.fastApplicationId,this.schemeId),this.initList()},initList:function(){var e=this,t={schemaId:this.schemeId,current:this.pageNum,size:this.pageSize};ft.getFlattenList(t).then(function(i){var h=this;l()(this,e);var I=i.records;I.forEach(function(w){l()(this,h);var x={drawtype:"polygon",style:Ot.style,config:Ot.config,attr:{isClip:!0,id:w.id}},v=$.attributeToEntity(x,JSON.parse(w.positions));v.show=w.isShow}.bind(this)),this.tableData=I.reverse(),this.toClip()}.bind(this))},save:function(e){var t=this;ft.saveList(this.tableData).then(function(){l()(this,t),Object(K.Message)({message:e||"\u4FDD\u5B58\u6210\u529F!",type:"success"})}.bind(this))},startDraw:function(){var e=JSON.parse(tt()(Ot));$.startDraw(e)},startEditing:function(){var e=this,t,i=function(){var w,x=this,v;l()(this,e);var B=st()(w=this.tableData).call(w,function(ct){return l()(this,x),ct.id===this.editId}.bind(this)),E=$.getEntityById(this.editId),nt=xt({},this.tableData[B]);nt.positions=tt()(E._positions_draw),lt()(v=this.tableData).call(v,B,1,nt),R.clipArr(this.tableData)}.bind(this);i.id="flatten";var h=(t=$._events["drag-end"])===null||t===void 0?void 0:b()(t).call(t,function(I){return l()(this,e),I.fn.id==="flatten"}.bind(this));!h&&$.on("drag-end",i)},startClip:function(){this.startDraw()},changeTileset:function(){var e,t=this,i;if(this.currRowId){var h=st()(e=this.tableData).call(e,function(v){return l()(this,t),v.id===this.currRowId}.bind(this));if(h!==-1){var I=xt({},this.tableData[h]),w=[],x=JSON.parse(tt()(this.layerArr));x.forEach(function(v){var B;if(l()(this,t),Y()(B=this.selectLayers).call(B,v.id)){var E={id:v.id,label:v.label};w.push(E)}}.bind(this)),I.layers=tt()(w),lt()(i=this.tableData).call(i,h,1,I)}}},toClip:function(){R.clipArr(this.tableData)},changeTerrainType:function(e){this.edited=!0,R.clipArr(this.tableData),this.disableEdit(e)},changeType:function(e){this.edited=!0,R.clipArr(this.tableData),this.disableEdit(e)},handleShow:function(e){e.isShow=!e.isShow;var t=$.getEntityById(e.id);t.show=!t.show,this.disableEdit(e)},handleEdit:function(e){var t=this;this.edited=!0;var i=$.getEntityById(e.id);if(this.editId=e.id,i.editing._enabled)this.disableEdit(e);else{var h,I=st()(h=this.tableData).call(h,function(E){return l()(this,t),E.enabled===!0}.bind(this));if(I>-1){var w,x=this.tableData[I],v=$.getEntityById(x.id);v.editing.disable(),this.removeHeightDraggers(v),x.enabled=!1,lt()(w=this.tableData).call(w,I,1,x)}if(i.editing.activate(),e.enabled=!0,!e.flattenType||e.terrainType==="flatten"){R.createHeightDragger(i,e.height);var B=i.editing.newHeightDraggers;B.forEach(function(E){var nt=this;l()(this,t),E.onDragEnd=function(ct,Et){var Ft,Zt=this,Bt;l()(this,nt);var Lt=st()(Ft=this.tableData).call(Ft,function(Kt){return l()(this,Zt),Kt.id===this.editId}.bind(this)),jt=xt({},this.tableData[Lt]);jt.height=Object(y.cartesian2lonlat)(Et)[2],jt.positions=tt()(i._positions_draw),lt()(Bt=this.tableData).call(Bt,Lt,1,jt),R.clipArr(this.tableData)}.bind(this)}.bind(this)),this.startEditing()}}},disableEdit:function(e){var t=$.getEntityById(e.id);t.editing.disable(),e.enabled=!1,this.removeHeightDraggers(t)},handleDelete:function(e,t){var i=this;this.$confirm("\u786E\u8BA4\u5220\u9664\u8BE5"+(t?"\u5F00\u6316":"\u538B\u5E73")+"\u591A\u8FB9\u5F62\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(function(){var h=this;l()(this,i),ft.deleteFlatten(e.id).then(function(){var I,w=this,x;l()(this,h);var v=$.getEntityById(e.id);this.removeHeightDraggers(v),$.deleteEntity(v);var B=st()(I=this.tableData).call(I,function(E){return l()(this,w),E.id===e.id}.bind(this));lt()(x=this.tableData).call(x,B,1),Object(K.Message)({message:"\u5220\u9664\u6210\u529F!",type:"success"}),R.clipArr(this.tableData)}.bind(this))}.bind(this))},delPlane:function(){var e=this;this.$confirm("\u786E\u8BA4\u5220\u9664\u5168\u90E8\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(function(){var t,i=this;l()(this,e);var h=N()(t=this.tableData).call(t,function(I){return l()(this,i),I.id}.bind(this));ft.removeList(h).then(function(){l()(this,i),$.clearDraw(),et=null,this.tableData=[],Object(K.Message)({message:"\u6E05\u7A7A\u6210\u529F!",type:"success"}),R.clipArr(this.tableData)}.bind(this))}.bind(this))},handleLocation:function(e){var t=JSON.parse(e.positions),i=dt.shine.getGraphicExtent(t);dt.shine.centerAt(i)},removeHeightDraggers:function(e){for(var t=$.getDataSource(),i=e.editing.newHeightDraggers||[],h=0,I=i.length;h<I;h++)t.entities.remove(i[h]);e.editing.newHeightDraggers=[]},stopDraw:function(){$&&$.stopDraw()},tableRowClassName:function(e){var t=e.row;return t.id===this.currRowId?"highlight-row":""},rowClick:function(e){var t,i=this;this.currRowId=e.id,this.itemLayers=JSON.parse(e.layers),this.selecLayerIds=N()(t=this.itemLayers).call(t,function(h){return l()(this,i),h.id}.bind(this))},activateTileset:function(e,t,i){R.toClip(e,t,i)},deleteTilesetPolygon:function(e,t){t?R.deleteFlattenPolygon(e,t):R.clearDraw(e)},activateTerrain:function(e,t){R.terrainClip(e,t)},deleteTerrainPolygon:function(e){e?R.deleteIndexTerrain(e):R.deleteAllTerrain()},locatePolygon:function(e){R.centerAt(e)},clipTilesetByGeojson:function(e,t){R.toClip(t.tilesets,e,"clipping",!0)},flattenTilesetByGeojson:function(e,t){R.toClip(t.tilesets,e,"flatten",!0,t.height)},clipTerrainByGeojson:function(e){R.terrainClip(e,"clipping",!0)},flattenTerrainByGeojson:function(e,t){R.terrainClip(e,"flatten",!0,t.height)}}},Rt=zt,Nt=r(2),Ht=Object(Nt.a)(Rt,z,A,!1,null,null,null),Gt=Ht.exports,Jt=r(28),Ut=r.n(Jt),Wt=void 0,bt=Ut()(Gt,{transform:function(e,t,i){l()(this,Wt);var h=e.show,I=e.label,w=e.position,x=i.url,v=i.schemeId;return{isShow:h,title:I,position:w,url:x,schemeId:v}}.bind(void 0)});bt.install=function(n){n.component(bt.name,bt)};var Xt=f.default=bt},8:function(a,f){a.exports=s(22466)},80:function(a,f){a.exports=s(25074)},9:function(a,f){a.exports=s(22777)},90:function(a,f){a.exports=s(69973)}})},47806:function(ot,L,s){"use strict";var a=s(19534);Object.defineProperty(L,"__esModule",{value:!0}),L.default=void 0;var f=a(s(52909)),r=a(s(42579)),g=void 0,l={inject:{generalCardThemeStyle:{default:null}},props:{styleConfig:{type:Object,default:function(){(0,r.default)(this,g)}.bind(void 0)},position:{type:Object,default:function(){return(0,r.default)(this,g),{type:"absolute",top:"100px",right:"135px"}}.bind(void 0)},themeStyle:{type:Object},imgSrc:{type:String},title:{type:String},isShow:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!1},dragEnable:{type:Boolean,default:!0},onlyContainer:{type:Boolean,default:!1}},data:function(){return{visible:this.isShow,theme:"light"}},watch:{currentView:{handler:function(D){D==="earth"?this.theme="dark":this.theme="light"},immediate:!0},isShow:function(D){this.visible=D}},computed:{cardThemeStyle:function(){return this.themeStyle||this.generalCardThemeStyle}},mounted:function(){var D,j=this;this.$_mixin_generalCard=(0,f.default)(D=this.$children).call(D,function(U){return(0,r.default)(this,j),U.$options.name==="ShGeneralCard"}.bind(this))},methods:{changeShow:function(D){var j;if((j=this.$_mixin_generalCard)===null||j===void 0||j.changeShow(D),D===!1||D!==!0&&this.visible){var U;(U=this.deactivate)===null||U===void 0||U.call(this)}},changeStatus:function(D){var j;(j=this.$_mixin_generalCard)===null||j===void 0||j.changeStatus(D)},getPosition:function(){var D;return(D=this.$_mixin_generalCard)===null||D===void 0?void 0:D.getPosition()}}},z=l;L.default=z},59602:function(ot,L,s){"use strict";var a=s(19534);Object.defineProperty(L,"__esModule",{value:!0}),L.get=j,L.getFromAdmin=V,L.imgUrlConvert=H,L.parseError=X,L.parseGaResult=J,L.parseResult=F,L.post=U,L.postFromAdmin=Q;var f=a(s(42579)),r=a(s(78756)),g=a(s(66273)),l=a(s(43939)),z=a(s(5146)),A=a(s(10299)),D="Bearer";function j(u,m){var S=this;return new r.default(function(p,G){var W=this;(0,f.default)(this,S),A.default.get(u,{params:m}).then(function(N){(0,f.default)(this,W),p(N.data)}.bind(this)).catch(function(N){(0,f.default)(this,W),G(N.data)}.bind(this))}.bind(this))}function U(u,m){var S=this;return new r.default(function(p,G){var W=this;(0,f.default)(this,S),A.default.post(u,(0,g.default)(m)).then(function(N){(0,f.default)(this,W),p(N.data)}.bind(this)).catch(function(N){(0,f.default)(this,W),G(N.data)}.bind(this))}.bind(this))}function V(u,m){return m.headers||(m.headers={"Content-Type":"application/json"}),m.token&&(m.headers["X-Gisq-Token"]=D+" "+m.token),m.shinegaDatabaseId&&(m.headers.dataid=m.shinegaDatabaseId),m.applicationId&&(m.headers.ApplicationId=m.applicationId),A.default.get(u,m)}function Q(u,m,S){return S.headers||(S.headers={"Content-Type":"application/json"}),S.token&&(S.headers["X-Gisq-Token"]=D+" "+S.token),S.shinegaDatabaseId&&(S.headers.dataid=S.shinegaDatabaseId),S.applicationId&&(S.headers.ApplicationId=S.applicationId),A.default.post(u,m,S)}function F(u){if(u.data.code==="0000"||u.data.code===200){var m=u.data;return{success:!0,data:m.result?m.result:m.data}}else{var S=u.data.description?u.data.description:u.data.message;return{success:!1,message:S}}}function X(u){var m=u.response,S=m.data.description?m.data.description:m.data.message,p;return m.status===401?p=S||"\u7528\u6237\u6821\u9A8C\u5931\u8D25":p=S||"\u672A\u77E5\u9519\u8BEF, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",p}function J(u){var m=this;u=u.headers?u.data:u;var S=!0;if(u.code?S=u.code==="0000":u.message&&(S=u.message==="success"),S){var p=u.result?u.result:u.data;if(p.error)return{success:!1,message:p.error};if(p.IsSucess===!1){var G="";return p.EditErrors.forEach(function(N){(0,f.default)(this,m),G+=N.ErrorMsg+"<br/>"}.bind(this)),{success:!1,message:G}}else return{success:!0,data:p}}else{var W=u.description?u.description:u.message;return{success:!1,message:W}}}function H(u,m,S){var p,G=u,W="[adminserverstatic]";if(((p=G)===null||p===void 0?void 0:p.indexOf(W))>-1)if(G=G.replace(W,""),S){var N,rt,Y,ht="app_"+(0,l.default)(N=S.toLowerCase()).call(N,"-","");G=(0,z.default)(rt=(0,z.default)(Y="".concat(m,"/files/")).call(Y,ht,"/")).call(rt,G)}else{var it;G=(0,z.default)(it="".concat(m,"/files/shinegisclient/")).call(it,G)}return G}},42709:function(ot,L,s){"use strict";var a=s(48836);const f={data(){return this.map=null,this.timer="",{isEditor:window.location.href.indexOf("editor.html")>0}},inject:{reactiveViewMode:{default:function(){return()=>"23D"}}},computed:{viewMode(){return this.isSetMap_common?this.$_viewMode:this.reactiveViewMode()}},mounted(){!this.widgetInfo.parentId&&this.isEditor&&this.widgetInfo.action.gisMapId&&this.$nextTick(function(){this.updateWidgetParentId({widgetId:this.widgetInfo.id,parentId:this.widgetInfo.action.gisMapId,keepPosition:!0})})},methods:{...(0,a.nv)(["updateWidgetParentId"]),getBindMap(){typeof this.widgetInfo.action.gisMapId<"u"}}};L.Z=f},76010:function(ot,L){"use strict";const s={data(){return{isSpecial:!1,isEditor:window.location.href.indexOf("editor.html")>0}},computed:{isBindToPage(){return this.widgetInfo.config.styleConfig.dragEnable||this.isSpecial},position(){return this.isEditor||!this.isBindToPage?{type:"absolute",top:"0px",left:"0px",bottom:"unset",right:"unset",zIndex:this.widgetInfo.attr.z}:{type:"absolute",top:this.widgetInfo.attr.y+"px",left:this.widgetInfo.attr.x+"px",zIndex:this.widgetInfo.attr.z}},styleConfig(){return{isShowBtn:this.widgetInfo.config.styleConfig.isShowBtn,isStartFix:this.isEditor,titleBar:{miniBtn:!0,maxBtn:!1,closeBtn:!1,fixBtn:!this.isEditor,title:!0},autoVisible:!1,btnSize:{size:this.widgetInfo.config.styleConfig.btnSize.size+"px",padding:this.widgetInfo.config.styleConfig.btnSize.padding+"px",radius:this.widgetInfo.config.styleConfig.btnSize.radius+"px"},size:{radius:this.widgetInfo.config.styleConfig.size.radius+"px",width:this.widgetInfo.attr.w>150?this.widgetInfo.attr.w+"px":"275px",height:this.widgetInfo.attr.hh>100?this.widgetInfo.attr.hh+"px":"80vh"},toolBtnSize:{size:this.widgetInfo.config.styleConfig.toolBtnSize.size+"px",margin:(this.widgetInfo.config.styleConfig.btnSize.size-this.widgetInfo.config.styleConfig.toolBtnSize.size)/2+"px"}}},themeConfig(){let a=this.widgetInfo.config.themeStyle.light;return{light:{title:{backgroundImage:"url('"+a.title.backgroundImage+"')",backgroundColor:a.title.backgroundColor?a.title.backgroundColor:a.floatButton.fillcolor,backgroundSize:a.title.backgroundSize,fontSize:a.title.fontSize+"px",color:a.title.fontColor},primaryFont:{fontSize:a.primaryFont.fontSize+"px",fontColor:a.primaryFont.fontColor},toolButton:{color:a.toolButton.color},panel:{backgroundImage:"url('"+a.panel.backgroundImage+"')",backgroundColor:a.panel.fillcolor,backgroundSize:a.panel.backgroundSize,border:a.panel.border},floatButton:{backgroundColor:a.floatButton.fillcolor,shadowColor:a.floatButton.shadowColor,border:a.floatButton.border}}}}},methods:{bindToPage(a){a&&this.isBindToPage&&(a.parentElement.remove(a),document.getElementById("page_"+this.widgetInfo.pageId).append(a),a.style.pointerEvents="auto",document.getElementById("container_child_"+this.widgetInfo.id).remove())}}};L.Z=s},71526:function(ot,L,s){"use strict";s.r(L),s.d(L,{default:function(){return X}});var a=function(){var H=this,u=H._self._c;return u("div",{directives:[{name:"show",rawName:"v-show",value:H.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"content",style:{width:H.widgetInfo.attr.w+"px",height:H.widgetInfo.attr.hh+"px"}},[H.viewMode!=="2D"?u("FlattenTools",{ref:"flattenTools",attrs:{position:H.position,"scheme-id":H.flattenToolsSchemeId,url:H.flattenToolsUrl,"is-show":!0,"theme-style":H.themeConfig,"style-config":H.styleConfig,"drag-enable":H.widgetInfo.config.styleConfig.dragEnable}}):H._e()],1)},f=[],r=s(38068),g=s.n(r),l=s(86892),z=s(76010),A=s(45061),D=s(26711),j=s(42709),U={name:"GisFlattenTools",components:{FlattenTools:g()},mixins:[l.D,z.Z,A.u,D.H,j.Z],props:["widgetInfo"],data(){return{timer:"",mapAction:this.widgetInfo.action,btnAttr:this.widgetInfo.attr,flattenToolsUrl:this.widgetInfo.config.url,flattenToolsSchemeId:this.widgetInfo.config.schemeId}},mounted(){this.viewMode==="2D"&&this.$message("\u7EAF\u4E8C\u7EF4\u6A21\u5F0F\u65E0\u6CD5\u52A0\u8F7D'\u5F00\u6316\u538B\u5E73'\u7EC4\u4EF6"),this.isEditor||this.$nextTick(()=>{let J=this.$refs.flattenTools.$el;this.bindToPage(J)}),this.initAction(this.widgetInfo)},methods:{reLoadInfo(J){this.btnAttr=J.attr},initAction(J){this.registerAction(J,"configMap","mapList",this.doConfigMap),this.actionReceive(J)}}},V=U,Q=s(68141),F=(0,Q.Z)(V,a,f,!1,null,null,null),X=F.exports}}]);
