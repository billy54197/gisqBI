"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[9356],{56279:function(C,b,l){l.d(b,{P:function(){return D}});var x=l(86892),g=l(49500);const D={mixins:[x.D],created(){},methods:{lifecycleBeforeChartsLoad(y){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&g.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),g.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let I=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[y]);if(I)return I}return y},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&g.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),g.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},69356:function(C,b,l){l.r(b),l.d(b,{default:function(){return U}});var x=function(){var a=this,r=a._self._c;return r("div",{style:{width:a.widgetInfo.attr.w+"px",height:a.widgetInfo.attr.hh+"px"}},[r("hide-button",{attrs:{attr:a.widgetInfo.attr}}),r("div",{ref:"pieDoughnut",style:{width:a.widgetInfo.attr.w+"px",height:a.widgetInfo.attr.hh+"px"}})],1)},g=[],D=l(44513),y=l(27966),S=l(56279),I=l(45061),N=l(26711),A=l(90359),E=l(87798),J=l(99349),L=l(55616),O=l(75770),$=l(67157),p=l(50666);const B={mixins:[$.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(p.Z.charts.title)),legend:JSON.parse(JSON.stringify(p.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(p.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(p.Z.charts.toolbox)),xAxis:JSON.parse(JSON.stringify(p.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(p.Z.charts.yAxis)),color:["#29CC97"]}}},methods:{filterPredefineColoursSchemeConfig(t,a){this.getNewConfigWithArrary(t,a,this.filter_config)}}};var h=l(49500);const P=l(29426);var T={name:"PieDoughnut",components:{HideButton:D.Z},mixins:[A.u,S.P,I.u,N.H,E.P,J.P,B],props:["widgetInfo"],data(){return{autoInterval:null,source:[],dimensions:null,drillDown:{}}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=P.init(this.$refs.pieDoughnut,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo),this.initClick(this.widgetInfo)},destroyed(){this.echarts.dispose(),this.autoInterval&&clearInterval(this.autoInterval)},methods:{loadInfo(t){t.dataset[t.dataset.type]&&(this.source=t.dataset[t.dataset.type].source,this.dimensionsEx=t.dataset[t.dataset.type].dimensions),t.config.drillDown&&t.config.drillDown.enable==!0?(this.drillDown=JSON.parse(JSON.stringify(t.config.drillDown)),delete this.drillDown.graphic,this.drillDown.pid_arrary=[],this.doDrillDown(t,!0)):this.renderEcharts(t,this.source)},renderEcharts(t,a){let r=[],o=[],n={};r=this.getSeriesData(a,t.dataset[t.dataset.type].dimensions,t.dataset[t.dataset.type].encode),o=t.dataset[t.dataset.type].dimensionsAlias,n=t.dataset[t.dataset.type].encode;let e=JSON.parse(JSON.stringify(t.config.grid)),i=JSON.parse(JSON.stringify(t.config.series)),s=JSON.parse(JSON.stringify(t.config.title)),c=this.getLegend(t.config.legend),f=JSON.parse(JSON.stringify(t.config.toolbox)),k=this.getTooltip(t.config.tooltip),R=[];if(t.config.drillDown&&t.config.drillDown.enable==!0){let d=this.getGraphic(t.config.drillDown.graphic);d&&d.elements&&d.elements.length>0&&(d.elements[0].ignore=this.drillDown.pid_arrary.length<1),R.push(d)}r.length<1&&(c.show=!1),c.data=void 0;let u={color:this.$$global_editor.predefineColors,noDataLoadingOption:{text:"\u6682\u65E0\u6570\u636E",effect:"bubble",effectOption:{effect:{n:0}}},tooltip:k,toolbox:f,grid:{left:e.left+"%",right:e.right+"%",top:e.top+"%",bottom:e.bottom+"%"},title:{show:s.show,text:s.text,link:s.link,textAlign:s.textAlign,left:s.left+"%",right:s.right+"%",top:s.top+"%",bottom:s.bottom+"%",label:{fontSize:s.label.fontSize,fontFamily:s.label.fontFamily,color:s.label.color},textStyle:{fontSize:s.textStyle.fontSize,fontFamily:s.textStyle.fontFamily,color:s.textStyle.color}},legend:c,graphic:R,series:[{name:this.getLegendData(o,n.y),center:[i.center.x+"%",i.center.y+"%"],radius:[i.radius.in+"%",i.radius.out+"%"],type:"pie",data:r,roseType:i.roseType,startAngle:i.startAngle,minAngle:i.minAngle,avoidLabelOverlap:i.avoidLabelOverlap,clockWise:typeof i.clockWise>"u"?!0:i.clockWise,label:{formatter:this.getFormatterString(i.label.formatter),verticalAlign:"bottom",show:i.label.show,position:i.label.position,color:i.label.color,fontFamily:i.label.fontFamily,fontSize:i.label.fontSize,fontWeight:i.label.fontWeight,alignTo:i.label.alignTo,margin:i.label.margin,emphasis:{show:i.label.emphasis.show,textStyle:{fontWeight:"bold"}}},labelLine:{show:i.labelLine.show,length:i.labelLine.length,length2:i.labelLine.length2,smooth:i.labelLine.smooth,lineStyle:{color:i.labelLine.lineStyle.color,width:i.labelLine.lineStyle.width,type:i.labelLine.lineStyle.type}},emphasis:{itemStyle:i.emphasis.itemStyle},itemStyle:{borderColor:i.itemStyle.borderColor,borderWidth:i.itemStyle.borderWidth,borderRadius:this.borderRadius(i.itemStyle)}}]};if(t.config.colorCustom==!0&&(u.color=t.config.color),i.emphasis)try{let d=i.emphasis;if(d.script&&d.script.enabled){if(d.script.content){let v=new Function("index","item","data",d.script.content),m=u.series[0].data;if(m&&m.length>0)for(let w=0;w<m.length;++w)try{m[w].emphasis=v.call(this,w,m[w],m)}catch(z){h.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",z)}}}else i.emphasis.itemStyle&&i.emphasis.itemStyle.color&&(u.series[0].emphasis={itemStyle:{...i.emphasis.itemStyle}})}catch(d){h.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",d)}this.widgetInfo.action.sendOut.actionList&&this.widgetInfo.action.sendOut.actionList.length>=1?this.$$lib__.find(this.widgetInfo.action.sendOut.actionList,v=>v.enabled)||this.echarts.getZr().on("mousemove",()=>{this.echarts.getZr().setCursorStyle("default")}):this.echarts.getZr().on("mousemove",()=>{this.echarts.getZr().setCursorStyle("default")}),this.getAnimation(u,t),this.setOption(u,t,i),this.setAnimationLoop(t,()=>{this.setOption(u,t)})},setOption(t,a,r){if(this.echarts.getOption()&&this.echarts.clear(),setTimeout(()=>{this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0})},0),this.autoInterval&&(clearInterval(this.autoInterval),this.autoInterval=null),r.auto){let o=this,n=5;r.showTime&&(n=r.showTime),n=n*1e3;let e=0,i=t.series[0].data.length;this.autoInterval=setInterval(function(){o.echarts.dispatchAction({type:"downplay",seriesIndex:0,dataIndex:e}),e=(e+1)%i,o.echarts.dispatchAction({type:"highlight",seriesIndex:0,dataIndex:e})},n)}},reLoadInfo(t){t&&(this.$refs.pieDoughnut.style.width=t.attr.w+"px",this.$refs.pieDoughnut.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},getSeriesData(t,a,r){let o=[],n={},e=-1,i=-1;for(let s=0;s<a.length;s++)a[s]==r.x&&(e=s),a[s]==r.y&&(i=s),n[a[s]]=s;for(let s=0;s<t.length;s++){let c={};for(let f in n)c[f]=t[s][n[f]];o.push({name:t[s][e],value:t[s][i],source:t[s],dimensions:a,row:c})}return o},getLegendData(t,a){let r=this.$$lib__.find(t,o=>o.name==a);return r?r.alias&&r.alias!=""?r.alias:r.name:""},initAction(t){this.initClick(t),this.actionReceive(t)},actionOnClick(t,a){let r=this,o=[],n=t.action.sendOut.actionList;r.$$lib__.each(n,e=>{let i=e.code+"_"+t.id,s={};e.paramsExtend&&e.paramsExtend.length>0&&r.getParamsExtend(s,e.paramsExtend,t);let c=e.postMessage;if(s.x=a.data.name,s.y=a.data.value,e.enabled&&e.code==O.Z.click.code){if(t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(o=t.dataset[t.dataset.type].source[a.dataIndex]),r.getExtendParams(s,e.paramsExtend,o,t.dataset[t.dataset.type].dimensions),e.script&&e.script.enabled){if(h.log("Execute script for "+t.name+" component to "+t.name+" component"),e.script.content==""){L.Message.warning({message:e.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam=new Function("param,params",e.script.content),s=this.customScript_actionSend_clickParam(s,a)}y.Z.$emit(i,s),c&&r.doPostMessage(s)}else if(e.enabled&&e.code==O.Z.openLink.code){if(e.paramsExtend&&e.paramsExtend.length>0){let f=[];t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(f=t.dataset[t.dataset.type].source[a.dataIndex]),e.type===r.$$global_editor.linkType.dynamic.code&&(e[r.$$global_editor.linkType.dynamic.code].url=r.getActionUrl(e,t.dataset[t.dataset.type].source[a.dataIndex],t.dataset[t.dataset.type].dimensions)),r.getExtendParams(s,e.paramsExtend,f,t.dataset[t.dataset.type].dimensions)}if(e.script&&e.script.enabled){if(h.log("Execute script for "+e.name+" component to "+t.name+" component"),e.script.content==""){L.Message.warning({message:e.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam=new Function("param,params",e.script.content),s=this.customScript_actionSend_clickParam(s,a)}r.openLinkAction(e,s,a)}})},doDrillDown(t,a){let r=[];if(this.drillDown.pidValue&&this.drillDown.id&&this.drillDown.pid){let o={};for(let n=this.dimensionsEx.length-1;n>-1;--n)o[this.dimensionsEx[n]]=n;for(let n=0;n<this.source.length;++n){let e=this.source[n];e[o[this.drillDown.pid]]==this.drillDown.pidValue&&r.push(JSON.parse(JSON.stringify(e)))}}else h.error("\u5FC5\u987B\u914D\u7F6E\u4E0B\u94BB\u7684\u3010\u4E0A\u7EA7\u6570\u503C\u3001\u6570\u636E\u5B57\u6BB5\u3001\u4E0A\u7EA7\u5B57\u6BB5\u3011");if(r.length>0)this.renderEcharts(t,r);else{let o=this.drillDown.pid_arrary.length-1;this.drillDown.pid_arrary.length=o>0?o:0,h.info("\u4E0B\u94BB\u5DF2\u65E0\u6570\u636E"),a&&this.renderEcharts(t,r)}},initClick(t){this.echarts.on("click",a=>{if(a.componentType=="graphic"){if(this.drillDown&&this.drillDown.enable==!0){let r=this.drillDown.pid_arrary.length;r>0?(this.drillDown.pidValue=this.drillDown.pid_arrary[r-1],this.drillDown.pid_arrary.length=r-1,this.drillDown.pidValue?this.doDrillDown(t):h.error("\u4E0B\u94BB\u5B57\u6BB5\u672A\u83B7\u53D6\u5230\u6709\u6548\u503C")):h.error("\u5DF2\u7ECF\u662F\u6700\u9876\u7EA7\uFF0C\u4E0D\u53EF\u4EE5\u518D\u8FD4\u56DE")}}else a.componentType=="series"&&(this.actionOnClick(t,a),this.drillDown&&this.drillDown.enable==!0&&(this.drillDown.pid_arrary.length==0?this.drillDown.pid_arrary.push(t.config.drillDown.pidValue):this.$$lib__.contains(this.drillDown.pid_arrary,this.drillDown.pidValue)||this.drillDown.pid_arrary.push(this.drillDown.pidValue),this.drillDown.pidValue=a.data.row[this.drillDown.id],this.drillDown.pidValue?this.doDrillDown(t):h.error("\u4E0B\u94BB\u5B57\u6BB5\u672A\u83B7\u53D6\u5230\u6709\u6548\u503C")))})},borderRadius(t){let a;return t.borderRadiusType=="one"?a=this.borderRadiusValue(t.barBorderRadiusInfo[0],t.barBorderRadiusInfoUnit[0]):t.borderRadiusType=="tow"?a=[this.borderRadiusValue(t.barBorderRadiusInfo[0],t.barBorderRadiusInfoUnit[0]),this.borderRadiusValue(t.barBorderRadiusInfo[1],t.barBorderRadiusInfoUnit[1])]:t.borderRadiusType=="four"&&(a=[this.borderRadiusValue(t.barBorderRadiusInfo[0],t.barBorderRadiusInfoUnit[0]),this.borderRadiusValue(t.barBorderRadiusInfo[1],t.barBorderRadiusInfoUnit[1]),this.borderRadiusValue(t.barBorderRadiusInfo[2],t.barBorderRadiusInfoUnit[2]),this.borderRadiusValue(t.barBorderRadiusInfo[3],t.barBorderRadiusInfoUnit[3])]),a},borderRadiusValue(t,a){return(!t||t==""?0:t)+(a=="%"?"%":"")}}},V=T,Z=l(68141),F=(0,Z.Z)(V,x,g,!1,null,"07815275",null),U=F.exports}}]);
