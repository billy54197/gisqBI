"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[8897],{56279:function(N,b,n){n.d(b,{P:function(){return L}});var v=n(86892),p=n(49500);const L={mixins:[v.D],created(){},methods:{lifecycleBeforeChartsLoad(y){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&p.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let w=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[y]);if(w)return w}return y},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&p.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},48897:function(N,b,n){n.r(b),n.d(b,{default:function(){return H}});var v=function(){var t=this,o=t._self._c;return o("div",{style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[o("hide-button",{attrs:{attr:t.widgetInfo.attr}}),o("div",{ref:"graphSimple",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}})],1)},p=[],L=n(44513),y=n(27966),$=n(56279),w=n(45061),F=n(26711),J=n(59499),E=n(99349),B=n(55616),P=n(75770),A=n(67157),S=n(50666);const Z={mixins:[A.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(S.Z.charts.title)),legend:JSON.parse(JSON.stringify(S.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(S.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(S.Z.charts.toolbox)),series:{itemStyle:{color:"#DBE6FF",borderColor:"rgba(76, 132, 255, 0.5)",opacity:1},lineStyle:{opacity:1,color:"#B0C9FF"},label:{color:"#4C84FF"}}}}},methods:{filterPredefineColoursSchemeConfig(e,t){this.getNewConfigWithArrary(e,t,this.filter_config)}}};var O=n(49500);const D=n(29426);var T={name:"GraphSimple",components:{HideButton:L.Z},mixins:[$.P,w.u,F.H,E.P,J.u,Z],props:["widgetInfo"],data(){return{}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=D.init(this.$refs.graphSimple,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{loadInfo(e){let t=JSON.parse(JSON.stringify(e.config.series)),o=e.dataset[e.dataset.type].source,f=e.dataset[e.dataset.type].dimensions,r=e.dataset[e.dataset.type].encode,d=this.getSeriesData(o,f,r,t.positionList),u=JSON.parse(JSON.stringify(e.config.title)),x=this.getTooltip(e.config.tooltip),I=JSON.parse(JSON.stringify(e.config.toolbox));switch(t.label.formatter=this.getFormatterString(t.label.formatter),t.edgeLabel.formatter=this.getFormatterString(t.edgeLabel.formatter),t.label.borderWidth&&t.label.borderWidth>0&&(t.label.textBorderWidth||(t.label.textBorderColor="rgba(0,0,0,0)")),this.getSymbol(t),t.roamType){case"both":t.roam=!0;break;case"none":t.roam=!1;break;default:t.roam=t.roamType}let c=this.$$lib__.find(t.positionList,i=>i.name&&i.name!="");this.$$lib__.each(d.nodesList,(i,a)=>{if(t.layout=="none"){let l={name:i.name,value:d.data[a],symbolSize:d.data[a]};c?(l.x=i.x?i.x:t.data[a-1]?t.data[a-1].x+20:20*a,l.y=i.y?i.y:t.data[a-1]?t.data[a-1].y+20:20*a):(l.x=t.positionList[a]?t.positionList[a].x:10*a,l.y=t.positionList[a]?t.positionList[a].y:10*a),t.data.push(l)}else t.data.push({name:i.name,value:d.data[a],symbolSize:d.data[a]})}),this.$$lib__.each(d.linksList,i=>{t.links.push({source:i.source,target:i.target})}),t.itemStyle.shadowBlur=t.label.shadowBlur,t.itemStyle.shadowColor=t.label.shadowColor,t.itemStyle.shadowOffsetX=t.label.shadowOffsetX,t.itemStyle.shadowOffsetY=t.label.shadowOffsetY;let s={tooltip:x,toolbox:I,title:u,series:t};if(t.emphasis)try{let i=t.emphasis;if(i.script&&i.script.enabled&&i.script.content){let a=new Function("index","item","data",i.script.content),l=s.series.data;if(l&&l.length>0)for(let g=0;g<l.length;++g)try{l[g].emphasis=a.call(this,g,l[g],l)}catch(h){O.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",h)}}}catch(i){O.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",i)}s.series.type="graph",this.getAnimation(s,e),this.setOption(s),this.setAnimationLoop(e,()=>{this.setOption(s,e)})},setOption(e){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(e),{notMerge:!0})},reLoadInfo(e){e&&(this.$refs.graphSimple.style.width=e.attr.w+"px",this.$refs.graphSimple.style.height=e.attr.hh+"px"),this.loadInfo(e),this.echarts.resize()},getSymbol(e){e.symbolType=="img"&&e.symbol!=""&&(e.symbol=this.getSymbolURL(e.symbol)),e.symbolType=="svg"&&e.symbol!=""&&(e.symbol.indexOf("image/")>-1?e.symbol=e.symbol.indexOf("image://")==-1?"image://"+e.symbol:e.symbol:e.symbol=e.symbol.indexOf("path://")==-1?"path://"+e.symbol:e.symbol)},getSeriesData(e,t,o,f){let r=[],d=[],u=[],x=-1,I=-1,c=-1;for(let s=0;s<t.length;s++)t[s]==o.key&&(x=s),t[s]==o.linkKey&&(I=s),t[s]==o.value&&(c=s);for(let s=0;s<e.length;s++){let i=e[s][x],a=this.$$lib__.find(r,h=>h.name==i);if(!a){let h={name:i},m=this.$$lib__.find(f,C=>C.name==i);m&&(h.x=m.x,h.y=m.y),r.push(h),c>-1&&u.push(e[s][c])}let l=e[s][I];if(a=this.$$lib__.find(r,h=>h.name==l),!a){let h={name:l},m=this.$$lib__.find(f,C=>C.name==l);m&&(h.x=m.x,h.y=m.y),r.push(h),c>-1&&u.push(e[s][c])}this.$$lib__.find(d,h=>h.source==i&&h.target==l)||d.push({source:i,target:l})}return{nodesList:r,linksList:d,data:u}},initAction(e){this.actionSendout(e),this.actionReceive(e)},actionSendout(e){let t=this;this.$$lib__.each(e.action.sendOut.actionList,o=>{if(o.enabled){let f=o.code+"_"+e.id;if(o.paramsExtend&&o.paramsExtend.length>0){let r={};this.getParamsExtend(r,o.paramsExtend,e)}o.code==P.Z.click.code&&t.onClick(f,o)}})},onClick(e,t){let o=this;o.echarts.on("click",f=>{let r={};if(r.tag=f.name,r.value=f.value,t.script&&t.script.enabled){if(O.log("Execute script for "+o.widgetInfo.name+" component to "+t.name+" component"),t.script.content==""){B.Message.warning({message:t.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",t.script.content),r=this.customScript(r)}y.Z.$emit(e,r),t.postMessage&&o.doPostMessage(r),o.actionNameList.push(e)})}}},M=T,R=n(68141),z=(0,R.Z)(M,v,p,!1,null,"1f9193df",null),H=z.exports}}]);
