"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[4477],{74477:function(b,m,n){n.r(m);var p=n(62735),_=n(14888),M=n(42447),x=n(90583),v=n(55979),C=n(33288),r=n(7522),g=n(44727),z=n(13811),O=n(5689),P=n(82571),E=n(95659),A=n(23230),w=n(68640),I=n(76094),D=n(55616),k=n.n(D),F=n(53183),h=n.n(F),L=n(21300),B=n(49500);class U{constructor(t){this.map=t.map,this.config=t.configManager.config,this.parames=new v.Z,this.isZoom=!0,this.currentZoom=7,this.xzqdm_length=2,this.mapResolution=null}initscatter(t,e){this.callback=e,this.option=t;let i=this;this.isZoom=!0;let l=this.option.totaldata;JSON.stringify(l)!="{}"&&(i.isZoom=!1,i.getMapData(),i.map.render())}zoomFun(t){let e=t.oldValue,i=t.target.values_.resolution,l=e>i,o=null;if(l){let f=h()(".mousePosition")[0].innerHTML;if(f=="&nbsp;")o=this.map.getView().getCenter();else{let d=f.split(",");o=[Number(d[0]),Number(d[1])]}}else o=this.map.getView().getCenter();let a=this.map.getPixelFromCoordinate(o);this.xzqQuery(a,l)}clearscatter(){h()(".ol-overlay-container.ol-selectable").remove();let e=this.map.getLayerById("drawLayer").getSource();e.getFeatures().forEach(l=>{l.featureType=="scatterMap"&&e.clear(l)})}getMapData(){let t=this,e=this.config;if(e.toc&&e.toc.length>0){let i=e.toc,l=h().grep(i,function(o){return o.layerTag==t.option.layerTag});if(l.length<1){if(t.callback){let o={success:!1,mode:t.option.mode,message:"\u56FE\u5C42\u4E0D\u5B58\u5728"};t.callback(o)}t.isZoom=!0,(0,D.Message)({message:"\u672A\u67E5\u8BE2\u5230\u6570\u636E",center:!0,type:"warning"})}else{t.clearscatter();let o=l[0];this.featureLayer=o,t.queryTask=new M.Z(o),t._getFeature(o)}}else{if(t.callback){let i={success:!1,mode:t.option.mode,message:"\u56FE\u5C42\u4E0D\u5B58\u5728"};t.callback(i)}t.isZoom=!0,(0,D.Message)({message:"\u672A\u67E5\u8BE2\u5230\u6570\u636E",center:!0,type:"warning"})}}_getFeature(){let t=this,e=t.option.xzqdm?t.option.xzqdm:"33";t.parames.where="";let i=e.length;e.length<=4?i+=2:i+=3,t.parames.where="xzqdm like '"+e+"%' and length(xzqdm)="+i,this.xzqdm_length=i,t.parames.srsName=t.map.getView().getProjection().getCode(),t.queryTask.execute(t.parames).then(function(l){if(l&&l.features&&l.features.length>0){let o=l.features;t._handleAllFeatures(o,t.option.regionName)}else{if(t.callback){let o={success:!1,mode:t.option.mode,message:"\u672A\u67E5\u8BE2\u5230\u6570\u636E"};t.callback(o)}t.isZoom=!0,B.log("\u672A\u67E5\u8BE2\u5230\u6570\u636E")}})}_handleAllFeatures(t,e){let i=this;this.Extent=[],i.featureExtent=[1/0,1/0,-1/0,-1/0];let l=this.getRegionNameStyle(e);t.forEach(d=>{let s=d.geometry,u=s.type,S=d.properties.xzqmc,c=null;if(u=="MultiPolygon")c=new r.Z(s.coordinates);else if(u=="Polygon")c=new g.ZP(s.coordinates);else return;i.Extent.push(c.getExtent()),e&&e.show;let T=this.option.fillColor?this.option.fillColor:"rgba(5, 121, 138, 0.2)",y=new z.Z({geometry:c});y.featureType="scatterMap",y.properties=d.properties,y.area=c.getArea(),y.setStyle(i._getStyle(T,S)),i.map.getLayerById("drawLayer").getSource().addFeature(y)}),i.markerHtml(),this.isZoom=!1;let o=null;i.Extent.length>1?(i.Extent.forEach(d=>{let s=(0,I.getCenter)(d);i.getfeatureExtent(s)}),o=i.featureExtent):o=i.Extent[0];let a=this.option.xzqExtentSize?this.option.xzqExtentSize:1;this.mapResolution||(this.mapResolution=this.map.getView().getResolution());let f=this.mapResolution/a;this.map.getView().setResolution(f)}markerHtml(){let t=this,e=t.option.totaldata,i=t.option.modeColor,l={},o={},a=this.option.imageMakerList;i.forEach((s,u)=>{l[s.model]=s.color,a&&(o[s.model]=a[u])});let f="",d=t.getMarkStyle(t.option.mark);e&&e.length>0&&e.forEach(s=>{let u=(0,C.GW)(),S=s.positionPoint,c="<div class='labelTooltip2' id='scattercharts_"+u+"' title='"+(s.discription?s.discription:s.name)+"' style='cursor: pointer;'  ></div>";if(h()(".ol-overlaycontainer").append(c),t.option.isImageMarker&&o&&o[s.mode]){let W=o[s.mode]?L.appendImageBaseURL(o[s.mode]):"",R=t.option.imgSize?t.option.imgSize:20;W?f="<img src='"+W+"' style='width:"+R+"px;height:"+R+"px;'>":f=t.createSvgMarker("#000")}else f=t.createSvgMarker(l[s.mode]);h()("#scattercharts_"+u).append(f),t.option.mark.show&&s.mark&&s.mark!=""&&h()("#scattercharts_"+u).append("<div style='position: absolute;"+d+"'>"+s.mark+"</div>");let T=t.option.wkid,y=t.map.getView().getProjection().getCode();S=(0,x.transform)(S,T,y);let Z=new p.Z({position:S,positioning:"center-center",stopEvent:!1,element:document.getElementById("scattercharts_"+u)});t.map.addOverlay(Z)}),t.option.tooltip.show&&t.setTooltip(t.option.tooltip)}setTooltip(t){let e=10,i=20,l="",o=this.getTooltipStyle(t);h()("div.labelTooltip2").mouseover(function(a){l=this.title,this.title="";let f='<div id="myTooltip" style=" position:absolute; z-index: 1000;'+o+'">'+l+"</div>";h()("body").append(f),h()("#myTooltip").css({left:a.pageX+e+"px",top:a.pageY+i+"px"}).show()}).mouseout(function(){this.title=l,h()("#myTooltip").remove()}).mousemove(function(a){h()("#myTooltip").css({left:a.pageX+e+"px",top:a.pageY+i+"px"}).show()})}getMarkStyle(t){let e="";return t&&t.fontStyle&&(t.fontStyle.fontFamily&&t.fontStyle.fontFamily!=""&&(e=e+"font-family:"+t.fontStyle.fontFamily+";"),t.fontStyle.fontWeight&&t.fontStyle.fontWeight!=""&&(e=e+"font-weight:"+t.fontStyle.fontWeight+";"),t.fontStyle.color&&t.fontStyle.color!=""&&(e=e+"color:"+t.fontStyle.color+";"),t.fontStyle.fontSize&&t.fontStyle.fontSize!=""&&(e=e+"font-size:"+t.fontStyle.fontSize+"px;"),t.left&&t.left!=""&&(e=e+"left:"+t.left+"px;"),t.top&&t.top!=""&&(e=e+"top:"+t.top+"px;"),t.width&&t.width!=""&&(e=e+"width:"+t.width+"px;"),t.height&&t.height!=""&&(e=e+"height:"+t.height+"px;")),e}getTooltipStyle(t){let e="";return t&&t.fontStyle&&(t.fontStyle.fontFamily&&t.fontStyle.fontFamily!=""&&(e=e+"font-family:"+t.fontStyle.fontFamily+";"),t.fontStyle.fontWeight&&t.fontStyle.fontWeight!=""&&(e=e+"font-weight:"+t.fontStyle.fontWeight+";"),t.fontStyle.color&&t.fontStyle.color!=""&&(e=e+"color:"+t.fontStyle.color+";"),t.fontStyle.fontSize&&t.fontStyle.fontSize!=""&&(e=e+"font-size:"+t.fontStyle.fontSize+"px;"),t.border.width&&t.border.width!=""&&(e=e+"border-width:"+t.border.width+"px;"),t.border.style&&t.border.style!=""&&(e=e+"border-style:"+t.border.style+";"),t.border.color&&t.border.color!=""&&(e=e+"border-color:"+t.border.color+";"),t.border.radius&&t.border.radius!=""&&(e=e+"border-radius:"+t.border.radius+"px;"),t.autoWidth?e=e+"width: auto;":t.width&&t.width!=""&&(e=e+"width:"+t.width+"px;"),t.autoHeight?e=e+"height: auto;":t.height&&t.height!=""&&(e=e+"height:"+t.height+"px;"),t.padding.left&&t.padding.left!=""&&(e=e+"padding-left:"+t.padding.left+"px;"),t.padding.top&&t.padding.top!=""&&(e=e+"padding-top:"+t.padding.top+"px;"),t.backGround.backgroundColor&&t.backGround.backgroundColor!=""&&(e=e+"background-color:"+t.backGround.backgroundColor+";"),t.backGround.backgroundImage&&t.backGround.backgroundImage!=""&&(e=e+"background-image:"+L.appendImageBaseURL(t.backGround.backgroundImage)+";"),t.backGround.backgroundSize&&t.backGround.backgroundSize!=""&&(e=e+"background-size:"+t.backGround.backgroundSize+";")),e}getRegionNameStyle(t){let e="";return t&&t.fontStyle&&(t.fontStyle.fontFamily&&t.fontStyle.fontFamily!=""&&(e=e+"font-family:"+t.fontStyle.fontFamily+";"),t.fontStyle.fontWeight&&t.fontStyle.fontWeight!=""&&(e=e+"font-weight:"+t.fontStyle.fontWeight+";"),t.fontStyle.color&&t.fontStyle.color!=""&&(e=e+"color:"+t.fontStyle.color+";"),t.fontStyle.fontSize&&t.fontStyle.fontSize!=""&&(e=e+"font-size:"+t.fontStyle.fontSize+"px;")),e}setXzqName(t,e,i){let l=this.option.wkid,o=this.map.getView().getProjection().getCode();e=(0,x.transform)(e,l,o),h()(".ol-overlaycontainer").append('<span id="scatterText_'+t+'" style="'+i+'">'+t.replace("\u5E02","")+"</span>");let a=new p.Z({position:e,positioning:"center-center",stopEvent:!1,element:document.getElementById("scatterText_"+t)});this.map.addOverlay(a)}_getStyle(t,e){let i=new w.Z({color:t}),l=this.option.borderColor?this.option.borderColor:"rgba(0, 240, 255, 0.9)",o=new A.Z({color:l,width:1});const a=this.option.regionName.fontWeight==="bolder"?"bold":"";let f=new E.Z({text:e,font:`${a} ${this.option.regionName.fontStyle.fontSize}px ${this.option.regionName.fontStyle.fontFamily}`,fill:new w.Z({color:this.option.regionName.fontStyle.color?this.option.regionName.fontStyle.color:"#000"})});return new P.ZP({image:new O.Z({fill:i,stroke:o,radius:5}),fill:i,stroke:o,text:this.option.regionName&&this.option.regionName.show?f:void 0})}getfeatureExtent(t){t[0]<this.featureExtent[0]&&(this.featureExtent[0]=t[0]),t[1]<this.featureExtent[1]&&(this.featureExtent[1]=t[1]),t[0]>this.featureExtent[2]&&(this.featureExtent[2]=t[0]),t[1]>this.featureExtent[3]&&(this.featureExtent[3]=t[1])}xzqQuery(t,e){let i=this,l=i.map.getFeaturesAtPixel(t);if(!l)return;let o=l[0].properties.xzqdm;if(e==!0||e==!1){let a=this.map.getSize(),f=this.map.getView().calculateExtent(a),d=(0,I.getArea)(f),u=l[0].area/d;if((u>.3||o=="3309")&&e){if(this.xzqdm_up==o)return;this.xzqdm_down=null,this.xzqdm_up=o,_.Z.$emit("fit2region",{xzqdm:o,flag:e})}if(u<.1&&!e){if(i.xzqdm_length<=6?o=o.substring(0,o.length-4):i.xzqdm_length==9?o=o.substring(0,o.length-5):o=o.substring(0,o.length-6),this.xzqdm_down==o)return;this.xzqdm_up=null,this.xzqdm_down=o,_.Z.$emit("fit2region",{xzqdm:o,flag:e})}}else _.Z.$emit("fit2region",o)}createSvgMarker(t){let e=this.option.imgSize?this.option.imgSize:20;return'<svg  viewBox="0 0 1024 1024" width="'+e+'" height="'+e+'"><path d="M513.13664 22.17642667c-224.78734222 0-407.01610667 182.22762667-407.01610667 407.01610666 0 112.63089778 45.75118222 214.57464889 119.68056889 288.26624l-0.78961777 0.78961778L512 1005.23690667l274.39331555-274.39217778c82.15665778-74.46755555 133.76056889-182.03192889 133.7605689-301.65105778 0-224.78961778-182.22876445-407.01724445-407.01724445-407.01724444zM512 584.19086222c-84.97493333 0-153.86055111-68.88675555-153.86055111-153.86055111S427.02392889 276.47089778 512 276.47089778c84.97379555 0 153.86055111 68.88561778 153.86055111 153.86055111S596.97379555 584.19086222 512 584.19086222z" fill="'+t+'"></path></svg>'}}m.default=U},55979:function(b,m){class n{constructor(){this.where,this.srsName,this.outputFormat="application/json",this.maxFeatures,this.startIndex,this.resultType}}m.Z=n},42447:function(b,m,n){var p=n(69787),_=n.n(p),M=n(53183),x=n.n(M);class v{constructor(r){this.layerOption=r}execute(r){let g={service:"wfs",version:"1.1.0",request:"GetFeature",typeName:this.layerOption.visibleLayers[0],outputFormat:r.outputFormat};return r.where&&(g.CQL_FILTER=r.where),r.srsName&&(g.srsName=r.srsName),r.startIndex&&(g.startIndex=r.startIndex),r.maxFeatures&&(g.maxFeatures=r.maxFeatures),r.resultType&&(g.resultType=r.resultType),new Promise((z,O)=>{let P=this.layerOption.identifyField[0].lyr+"/"+this.layerOption.visibleLayers[0].split(":")[0]+"/wfs";x().ajax({url:P,type:"POST",data:_().stringify(g),success:E=>{z(E)},error:E=>{O(E)}})})}}m.Z=v}}]);
