"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[5499],{44864:function(){},96001:function(){},33367:function(){},56279:function(b,x,n){n.d(x,{P:function(){return g}});var L=n(86892),m=n(49500);const g={mixins:[L.D],created(){},methods:{lifecycleBeforeChartsLoad(h){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&m.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),m.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let S=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[h]);if(S)return S}return h},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&m.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),m.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},63565:function(b,x,n){var L=n(79023),m=n.n(L),g=n(39733),h=n(81602),v=n(95982),S=n(40321),p=(0,g.d)("image"),I=p[0],E=p[1];x.Z=I({props:{src:String,fit:String,alt:String,round:Boolean,width:[Number,String],height:[Number,String],radius:[Number,String],lazyLoad:Boolean,iconPrefix:String,showError:{type:Boolean,default:!0},showLoading:{type:Boolean,default:!0},errorIcon:{type:String,default:"photo-fail"},loadingIcon:{type:String,default:"photo"}},data:function(){return{loading:!0,error:!1}},watch:{src:function(){this.loading=!0,this.error=!1}},computed:{style:function(){var l={};return(0,h.Xq)(this.width)&&(l.width=(0,v.N)(this.width)),(0,h.Xq)(this.height)&&(l.height=(0,v.N)(this.height)),(0,h.Xq)(this.radius)&&(l.overflow="hidden",l.borderRadius=(0,v.N)(this.radius)),l}},created:function(){var l=this.$Lazyload;l&&h._f&&(l.$on("loaded",this.onLazyLoaded),l.$on("error",this.onLazyLoadError))},beforeDestroy:function(){var l=this.$Lazyload;l&&(l.$off("loaded",this.onLazyLoaded),l.$off("error",this.onLazyLoadError))},methods:{onLoad:function(l){this.loading=!1,this.$emit("load",l)},onLazyLoaded:function(l){var r=l.el;r===this.$refs.image&&this.loading&&this.onLoad()},onLazyLoadError:function(l){var r=l.el;r===this.$refs.image&&!this.error&&this.onError()},onError:function(l){this.error=!0,this.loading=!1,this.$emit("error",l)},onClick:function(l){this.$emit("click",l)},genPlaceholder:function(){var l=this.$createElement;if(this.loading&&this.showLoading)return l("div",{class:E("loading")},[this.slots("loading")||l(S.Z,{attrs:{name:this.loadingIcon,classPrefix:this.iconPrefix},class:E("loading-icon")})]);if(this.error&&this.showError)return l("div",{class:E("error")},[this.slots("error")||l(S.Z,{attrs:{name:this.errorIcon,classPrefix:this.iconPrefix},class:E("error-icon")})])},genImage:function(){var l=this.$createElement,r={class:E("img"),attrs:{alt:this.alt},style:{objectFit:this.fit}};if(!this.error)return this.lazyLoad?l("img",m()([{ref:"image",directives:[{name:"lazy",value:this.src}]},r])):l("img",m()([{attrs:{src:this.src},on:{load:this.onLoad,error:this.onError}},r]))}},render:function(){var l=arguments[0];return l("div",{class:E({round:this.round}),style:this.style,on:{click:this.onClick}},[this.genImage(),this.genPlaceholder(),this.slots()])}})},53204:function(b,x,n){n.d(x,{f:function(){return L}});var L={inject:{vanField:{default:null}},watch:{value:function(){var g=this.vanField;g&&(g.resetValidation(),g.validateWithTrigger("onChange"))}},created:function(){var g=this.vanField;g&&!g.children&&(g.children=this)}}},9114:function(b,x,n){var L=n(4017),m=n(39733),g=n(40799),h=(0,m.d)("swipe-item"),v=h[0],S=h[1];x.Z=v({mixins:[(0,g.j)("vanSwipe")],data:function(){return{offset:0,inited:!1,mounted:!1}},mounted:function(){var I=this;this.$nextTick(function(){I.mounted=!0})},computed:{style:function(){var I={},E=this.parent,u=E.size,l=E.vertical;return u&&(I[l?"height":"width"]=u+"px"),this.offset&&(I.transform="translate"+(l?"Y":"X")+"("+this.offset+"px)"),I},shouldRender:function(){var I=this.index,E=this.inited,u=this.parent,l=this.mounted;if(!u.lazyRender||E)return!0;if(!l)return!1;var r=u.activeIndicator,o=u.count-1,c=r===0&&u.loop?o:r-1,d=r===o&&u.loop?0:r+1,y=I===r||I===c||I===d;return y&&(this.inited=!0),y}},render:function(){var I=arguments[0];return I("div",{class:S(),style:this.style,on:(0,L.Z)({},this.$listeners)},[this.shouldRender&&this.slots()])}})},46366:function(b,x,n){var L=n(39733),m=n(50947),g=n(50068),h=n(94599),v=n(80269),S=n(34672),p=n(40799),I=n(6053),E=(0,L.d)("swipe"),u=E[0],l=E[1];x.Z=u({mixins:[S.D,(0,p.G)("vanSwipe"),(0,I.X)(function(r,o){r(window,"resize",this.resize,!0),r(window,"orientationchange",this.resize,!0),r(window,"visibilitychange",this.onVisibilityChange),o?this.initialize():this.clear()})],props:{width:[Number,String],height:[Number,String],autoplay:[Number,String],vertical:Boolean,lazyRender:Boolean,indicatorColor:String,loop:{type:Boolean,default:!0},duration:{type:[Number,String],default:500},touchable:{type:Boolean,default:!0},initialSwipe:{type:[Number,String],default:0},showIndicators:{type:Boolean,default:!0},stopPropagation:{type:Boolean,default:!0}},data:function(){return{rect:null,offset:0,active:0,deltaX:0,deltaY:0,swiping:!1,computedWidth:0,computedHeight:0}},watch:{children:function(){this.initialize()},initialSwipe:function(){this.initialize()},autoplay:function(o){o>0?this.autoPlay():this.clear()}},computed:{count:function(){return this.children.length},maxCount:function(){return Math.ceil(Math.abs(this.minOffset)/this.size)},delta:function(){return this.vertical?this.deltaY:this.deltaX},size:function(){return this[this.vertical?"computedHeight":"computedWidth"]},trackSize:function(){return this.count*this.size},activeIndicator:function(){return(this.active+this.count)%this.count},isCorrectDirection:function(){var o=this.vertical?"vertical":"horizontal";return this.direction===o},trackStyle:function(){var o={transitionDuration:(this.swiping?0:this.duration)+"ms",transform:"translate"+(this.vertical?"Y":"X")+"("+this.offset+"px)"};if(this.size){var c=this.vertical?"height":"width",d=this.vertical?"width":"height";o[c]=this.trackSize+"px",o[d]=this[d]?this[d]+"px":""}return o},indicatorStyle:function(){return{backgroundColor:this.indicatorColor}},minOffset:function(){return(this.vertical?this.rect.height:this.rect.width)-this.size*this.count}},mounted:function(){this.bindTouchEvent(this.$refs.track)},methods:{initialize:function(o){if(o===void 0&&(o=+this.initialSwipe),!(!this.$el||(0,m.x)(this.$el))){clearTimeout(this.timer);var c=this.$el.getBoundingClientRect();this.rect=c,this.swiping=!0,this.active=o,this.computedWidth=+this.width||c.width,this.computedHeight=+this.height||c.height,this.offset=this.getTargetOffset(o),this.children.forEach(function(d){d.offset=0}),this.autoPlay()}},resize:function(){this.initialize(this.activeIndicator)},onVisibilityChange:function(){document.hidden?this.clear():this.autoPlay()},onTouchStart:function(o){this.touchable&&(this.clear(),this.touchStartTime=Date.now(),this.touchStart(o),this.correctPosition())},onTouchMove:function(o){!this.touchable||!this.swiping||(this.touchMove(o),this.isCorrectDirection&&((0,g.PF)(o,this.stopPropagation),this.move({offset:this.delta})))},onTouchEnd:function(){if(!(!this.touchable||!this.swiping)){var o=this.size,c=this.delta,d=Date.now()-this.touchStartTime,y=c/d,z=Math.abs(y)>.25||Math.abs(c)>o/2;if(z&&this.isCorrectDirection){var R=this.vertical?this.offsetY:this.offsetX,M=0;this.loop?M=R>0?c>0?-1:1:0:M=-Math[c>0?"ceil":"floor"](c/o),this.move({pace:M,emitChange:!0})}else c&&this.move({pace:0});this.swiping=!1,this.autoPlay()}},getTargetActive:function(o){var c=this.active,d=this.count,y=this.maxCount;return o?this.loop?(0,v.w)(c+o,-1,d):(0,v.w)(c+o,0,y):c},getTargetOffset:function(o,c){c===void 0&&(c=0);var d=o*this.size;this.loop||(d=Math.min(d,-this.minOffset));var y=c-d;return this.loop||(y=(0,v.w)(y,this.minOffset,0)),y},move:function(o){var c=o.pace,d=c===void 0?0:c,y=o.offset,z=y===void 0?0:y,R=o.emitChange,M=this.loop,F=this.count,_=this.active,B=this.children,W=this.trackSize,N=this.minOffset;if(!(F<=1)){var D=this.getTargetActive(d),A=this.getTargetOffset(D,z);if(M){if(B[0]&&A!==N){var U=A<N;B[0].offset=U?W:0}if(B[F-1]&&A!==0){var Z=A>0;B[F-1].offset=Z?-W:0}}this.active=D,this.offset=A,R&&D!==_&&this.$emit("change",this.activeIndicator)}},prev:function(){var o=this;this.correctPosition(),this.resetTouchStatus(),(0,h.d1)(function(){o.swiping=!1,o.move({pace:-1,emitChange:!0})})},next:function(){var o=this;this.correctPosition(),this.resetTouchStatus(),(0,h.d1)(function(){o.swiping=!1,o.move({pace:1,emitChange:!0})})},swipeTo:function(o,c){var d=this;c===void 0&&(c={}),this.correctPosition(),this.resetTouchStatus(),(0,h.d1)(function(){var y;d.loop&&o===d.count?y=d.active===0?0:o:y=o%d.count,c.immediate?(0,h.d1)(function(){d.swiping=!1}):d.swiping=!1,d.move({pace:y-d.active,emitChange:!0})})},correctPosition:function(){this.swiping=!0,this.active<=-1&&this.move({pace:this.count}),this.active>=this.count&&this.move({pace:-this.count})},clear:function(){clearTimeout(this.timer)},autoPlay:function(){var o=this,c=this.autoplay;c>0&&this.count>1&&(this.clear(),this.timer=setTimeout(function(){o.next(),o.autoPlay()},c))},genIndicator:function(){var o=this,c=this.$createElement,d=this.count,y=this.activeIndicator,z=this.slots("indicator");if(z)return z;if(this.showIndicators&&d>1)return c("div",{class:l("indicators",{vertical:this.vertical})},[Array.apply(void 0,Array(d)).map(function(R,M){return c("i",{class:l("indicator",{active:M===y}),style:M===y?o.indicatorStyle:null})})])}},render:function(){var o=arguments[0];return o("div",{class:l()},[o("div",{ref:"track",style:this.trackStyle,class:l("track",{vertical:this.vertical})},[this.slots()]),this.genIndicator()])}})},94599:function(b,x,n){n.d(x,{$d:function(){return E},Wn:function(){return p},d1:function(){return I}});var L=n(81602),m=Date.now();function g(u){var l=Date.now(),r=Math.max(0,16-(l-m)),o=setTimeout(u,r);return m=l+r,o}var h=L.sk?n.g:window,v=h.requestAnimationFrame||g,S=h.cancelAnimationFrame||h.clearTimeout;function p(u){return v.call(h,u)}function I(u){p(function(){p(u)})}function E(u){S.call(h,u)}},50947:function(b,x,n){n.d(x,{x:function(){return L}});function L(m){var g=window.getComputedStyle(m),h=g.display==="none",v=m.offsetParent===null&&g.position!=="fixed";return h||v}},80269:function(b,x,n){n.d(x,{u:function(){return g},w:function(){return L}});function L(h,v,S){return Math.min(Math.max(h,v),S)}function m(h,v,S){var p=h.indexOf(v),I="";return p===-1?h:v==="-"&&p!==0?h.slice(0,p):(v==="."&&h.match(/^(\.|-\.)/)&&(I=p?"-0":"0"),I+h.slice(0,p+1)+h.slice(p).replace(S,""))}function g(h,v,S){v===void 0&&(v=!0),S===void 0&&(S=!0),v?h=m(h,".",/\./g):h=h.split(".")[0],S?h=m(h,"-",/-/g):h=h.replace(/-/,"");var p=v?/[^-0-9.]/g:/[^-0-9]/g;return h.replace(p,"")}},95499:function(b,x,n){n.r(x),n.d(x,{default:function(){return Mt}});var L=function(){var t=this,i=t._self._c;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"dialog",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[i("uploader",{attrs:{accept:t.widgetInfo.config.accept,"preview-size":t.widgetInfo.config.previewSize+"px","preview-image":t.widgetInfo.config.previewImage,"preview-full-image":t.widgetInfo.config.previewFullImage,disabled:t.widgetInfo.config.disabled,deletable:t.widgetInfo.config.deletable,capture:t.widgetInfo.config.capture,"max-size":t.widgetInfo.config.maxSize*1024,"max-count":t.widgetInfo.config.maxCount,"image-fit":t.widgetInfo.config.imageFit,"after-read":t.afterRead,"before-read":t.beforeRead},on:{oversize:t.oversize,delete:t.deleteFile},model:{value:t.fileList,callback:function(a){t.fileList=a},expression:"fileList"}})],1)},m=[],g=n(32590),h=n(77714),v=n(86569),S=n(79141),p=n(91905),I=n(51595),E=n(44864),u=n(98839),l=n(91508),r=n(33367),o=n(96001),c=n(4017),d=n(39733),y=n(95982),z=n(81602);function R(e){return Array.isArray(e)?e:[e]}function M(e,t){return new Promise(function(i){if(t==="file"){i();return}var a=new FileReader;a.onload=function(s){i(s.target.result)},t==="dataUrl"?a.readAsDataURL(e):t==="text"&&a.readAsText(e)})}function F(e,t){return R(e).some(function(i){return i.size>t})}var _=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function B(e){return _.test(e)}function W(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?B(e.url):e.content?e.content.indexOf("data:image")===0:!1}var N=n(53204),D=n(40321),A=n(63565),U=n(13013),Z=n(42160),j=(0,d.d)("image-preview"),it=j[0],O=j[1],nt=n(79487),V=n(34672),at=n(6053),ot=n(46366),X=n(80269),G=n(50068),st=n(9114);function J(e){return Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2))}var rt={mixins:[V.D],props:{src:String,show:Boolean,active:Number,minZoom:[Number,String],maxZoom:[Number,String],rootWidth:Number,rootHeight:Number},data:function(){return{scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}},computed:{vertical:function(){var t=this.rootWidth,i=this.rootHeight,a=i/t;return this.imageRatio>a},imageStyle:function(){var t=this.scale,i={transitionDuration:this.zooming||this.moving?"0s":".3s"};if(t!==1){var a=this.moveX/t,s=this.moveY/t;i.transform="scale("+t+", "+t+") translate("+a+"px, "+s+"px)"}return i},maxMoveX:function(){if(this.imageRatio){var t=this.vertical?this.rootHeight/this.imageRatio:this.rootWidth;return Math.max(0,(this.scale*t-this.rootWidth)/2)}return 0},maxMoveY:function(){if(this.imageRatio){var t=this.vertical?this.rootHeight:this.rootWidth*this.imageRatio;return Math.max(0,(this.scale*t-this.rootHeight)/2)}return 0}},watch:{active:"resetScale",show:function(t){t||this.resetScale()}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{resetScale:function(){this.setScale(1),this.moveX=0,this.moveY=0},setScale:function(t){t=(0,X.w)(t,+this.minZoom,+this.maxZoom),t!==this.scale&&(this.scale=t,this.$emit("scale",{scale:this.scale,index:this.active}))},toggleScale:function(){var t=this.scale>1?1:2;this.setScale(t),this.moveX=0,this.moveY=0},onTouchStart:function(t){var i=t.touches,a=this.offsetX,s=a===void 0?0:a;this.touchStart(t),this.touchStartTime=new Date,this.startMoveX=this.moveX,this.startMoveY=this.moveY,this.moving=i.length===1&&this.scale!==1,this.zooming=i.length===2&&!s,this.zooming&&(this.startScale=this.scale,this.startDistance=J(t.touches))},onTouchMove:function(t){var i=t.touches;if(this.touchMove(t),(this.moving||this.zooming)&&(0,G.PF)(t,!0),this.moving){var a=this.deltaX+this.startMoveX,s=this.deltaY+this.startMoveY;this.moveX=(0,X.w)(a,-this.maxMoveX,this.maxMoveX),this.moveY=(0,X.w)(s,-this.maxMoveY,this.maxMoveY)}if(this.zooming&&i.length===2){var f=J(i),w=this.startScale*f/this.startDistance;this.setScale(w)}},onTouchEnd:function(t){var i=!1;(this.moving||this.zooming)&&(i=!0,this.moving&&this.startMoveX===this.moveX&&this.startMoveY===this.moveY&&(i=!1),t.touches.length||(this.zooming&&(this.moveX=(0,X.w)(this.moveX,-this.maxMoveX,this.maxMoveX),this.moveY=(0,X.w)(this.moveY,-this.maxMoveY,this.maxMoveY),this.zooming=!1),this.moving=!1,this.startMoveX=0,this.startMoveY=0,this.startScale=1,this.scale<1&&this.resetScale())),(0,G.PF)(t,i),this.checkTap(),this.resetTouchStatus()},checkTap:function(){var t=this,i=this.offsetX,a=i===void 0?0:i,s=this.offsetY,f=s===void 0?0:s,w=new Date-this.touchStartTime,C=250,$=10;a<$&&f<$&&w<C&&(this.doubleTapTimer?(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null,this.toggleScale()):this.doubleTapTimer=setTimeout(function(){t.$emit("close"),t.doubleTapTimer=null},C))},onLoad:function(t){var i=t.target,a=i.naturalWidth,s=i.naturalHeight;this.imageRatio=s/a}},render:function(){var t=arguments[0],i={loading:function(){return t(U.Z,{attrs:{type:"spinner"}})}};return t(st.Z,{class:O("swipe-item")},[t(A.Z,{attrs:{src:this.src,fit:"contain"},class:O("image",{vertical:this.vertical}),style:this.imageStyle,scopedSlots:i,on:{load:this.onLoad}})])}},K=it({mixins:[V.D,(0,nt.e)({skipToggleEvent:!0}),(0,at.X)(function(e){e(window,"resize",this.resize,!0),e(window,"orientationchange",this.resize,!0)})],props:{className:null,closeable:Boolean,asyncClose:Boolean,showIndicators:Boolean,images:{type:Array,default:function(){return[]}},loop:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},transition:{type:String,default:"van-fade"},showIndex:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},overlayClass:{type:String,default:O("overlay")},closeIcon:{type:String,default:"clear"},closeOnPopstate:{type:Boolean,default:!0},closeIconPosition:{type:String,default:"top-right"}},data:function(){return{active:0,rootWidth:0,rootHeight:0,doubleClickTimer:null}},mounted:function(){this.resize()},watch:{startPosition:"setActive",value:function(t){var i=this;t?(this.setActive(+this.startPosition),this.$nextTick(function(){i.resize(),i.$refs.swipe.swipeTo(+i.startPosition,{immediate:!0})})):this.$emit("close",{index:this.active,url:this.images[this.active]})}},methods:{resize:function(){if(this.$el&&this.$el.getBoundingClientRect){var t=this.$el.getBoundingClientRect();this.rootWidth=t.width,this.rootHeight=t.height}},emitClose:function(){this.asyncClose||this.$emit("input",!1)},emitScale:function(t){this.$emit("scale",t)},setActive:function(t){t!==this.active&&(this.active=t,this.$emit("change",t))},genIndex:function(){var t=this.$createElement;if(this.showIndex)return t("div",{class:O("index")},[this.slots("index",{index:this.active})||this.active+1+" / "+this.images.length])},genCover:function(){var t=this.$createElement,i=this.slots("cover");if(i)return t("div",{class:O("cover")},[i])},genImages:function(){var t=this,i=this.$createElement;return i(ot.Z,{ref:"swipe",attrs:{lazyRender:!0,loop:this.loop,duration:this.swipeDuration,initialSwipe:this.startPosition,showIndicators:this.showIndicators,indicatorColor:"white"},class:O("swipe"),on:{change:this.setActive}},[this.images.map(function(a){return i(rt,{attrs:{src:a,show:t.value,active:t.active,maxZoom:t.maxZoom,minZoom:t.minZoom,rootWidth:t.rootWidth,rootHeight:t.rootHeight},on:{scale:t.emitScale,close:t.emitClose}})})])},genClose:function(){var t=this.$createElement;if(this.closeable)return t(D.Z,{attrs:{role:"button",name:this.closeIcon},class:O("close-icon",this.closeIconPosition),on:{click:this.emitClose}})},onClosed:function(){this.$emit("closed")},swipeTo:function(t,i){this.$refs.swipe&&this.$refs.swipe.swipeTo(t,i)}},render:function(){var t=arguments[0];return t("transition",{attrs:{name:this.transition},on:{afterLeave:this.onClosed}},[this.shouldRender?t("div",{directives:[{name:"show",value:this.value}],class:[O(),this.className]},[this.genClose(),this.genImages(),this.genIndex(),this.genCover()]):null])}}),T,lt={loop:!0,value:!0,images:[],maxZoom:3,minZoom:1/3,onClose:null,onChange:null,className:"",showIndex:!0,closeable:!1,closeIcon:"clear",asyncClose:!1,transition:"van-fade",getContainer:"body",startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"},ht=function(){T=new(Z.default.extend(K))({el:document.createElement("div")}),document.body.appendChild(T.$el),T.$on("change",function(t){T.onChange&&T.onChange(t)}),T.$on("scale",function(t){T.onScale&&T.onScale(t)})},H=function(t,i){if(i===void 0&&(i=0),!z.sk){T||ht();var a=Array.isArray(t)?{images:t,startPosition:i}:t;return(0,c.Z)(T,lt,a),T.$once("input",function(s){T.value=s}),T.$once("closed",function(){T.images=[]}),a.onClose&&(T.$off("close"),T.$once("close",a.onClose)),T}};H.Component=K,H.install=function(){Z.default.use(K)};var ct=H,Q=(0,d.d)("uploader"),ft=Q[0],P=Q[1],ut=ft({inheritAttrs:!1,mixins:[N.f],model:{prop:"fileList"},props:{disabled:Boolean,lazyLoad:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],previewOptions:Object,name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:[Number,String],default:Number.MAX_VALUE},maxCount:{type:[Number,String],default:Number.MAX_VALUE},deletable:{type:Boolean,default:!0},showUpload:{type:Boolean,default:!0},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"},uploadIcon:{type:String,default:"photograph"}},computed:{previewSizeWithUnit:function(){return(0,y.N)(this.previewSize)},value:function(){return this.fileList}},methods:{getDetail:function(t){return t===void 0&&(t=this.fileList.length),{name:this.name,index:t}},onChange:function(t){var i=this,a=t.target.files;if(!(this.disabled||!a.length)){if(a=a.length===1?a[0]:[].slice.call(a),this.beforeRead){var s=this.beforeRead(a,this.getDetail());if(!s){this.resetInput();return}if((0,z.tI)(s)){s.then(function(f){f?i.readFile(f):i.readFile(a)}).catch(this.resetInput);return}}this.readFile(a)}},readFile:function(t){var i=this,a=F(t,this.maxSize);if(Array.isArray(t)){var s=this.maxCount-this.fileList.length;t.length>s&&(t=t.slice(0,s)),Promise.all(t.map(function(f){return M(f,i.resultType)})).then(function(f){var w=t.map(function(C,$){var Y={file:C,status:"",message:""};return f[$]&&(Y.content=f[$]),Y});i.onAfterRead(w,a)})}else M(t,this.resultType).then(function(f){var w={file:t,status:"",message:""};f&&(w.content=f),i.onAfterRead(w,a)})},onAfterRead:function(t,i){var a=this;this.resetInput();var s=t;if(i){var f=t;Array.isArray(t)?(f=[],s=[],t.forEach(function(C){C.file&&(C.file.size>a.maxSize?f.push(C):s.push(C))})):s=null,this.$emit("oversize",f,this.getDetail())}var w=Array.isArray(s)?!!s.length:!!s;w&&(this.$emit("input",[].concat(this.fileList,R(s))),this.afterRead&&this.afterRead(s,this.getDetail()))},onDelete:function(t,i){var a,s=this,f=(a=t.beforeDelete)!=null?a:this.beforeDelete;if(f){var w=f(t,this.getDetail(i));if(!w)return;if((0,z.tI)(w)){w.then(function(){s.deleteFile(t,i)}).catch(z.ZT);return}}this.deleteFile(t,i)},deleteFile:function(t,i){var a=this.fileList.slice(0);a.splice(i,1),this.$emit("input",a),this.$emit("delete",t,this.getDetail(i))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onPreviewImage:function(t){var i=this;if(this.previewFullImage){var a=this.fileList.filter(function(f){return W(f)}),s=a.map(function(f){return f.content||f.url});this.imagePreview=ct((0,c.Z)({images:s,startPosition:a.indexOf(t),onClose:function(){i.$emit("close-preview")}},this.previewOptions))}},closeImagePreview:function(){this.imagePreview&&this.imagePreview.close()},chooseFile:function(){this.disabled||this.$refs.input&&this.$refs.input.click()},genPreviewMask:function(t){var i=this.$createElement,a=t.status,s=t.message;if(a==="uploading"||a==="failed"){var f=a==="failed"?i(D.Z,{attrs:{name:"close"},class:P("mask-icon")}):i(U.Z,{class:P("loading")}),w=(0,z.Xq)(s)&&s!=="";return i("div",{class:P("mask")},[f,w&&i("div",{class:P("mask-message")},[s])])}},genPreviewItem:function(t,i){var a,s=this,f,w,C=this.$createElement,$=(a=t.deletable)!=null?a:this.deletable,Y=t.status!=="uploading"&&$,Dt=Y&&C("div",{class:P("preview-delete"),on:{click:function(At){At.stopPropagation(),s.onDelete(t,i)}}},[C(D.Z,{attrs:{name:"cross"},class:P("preview-delete-icon")})]),k=this.slots("preview-cover",(0,c.Z)({index:i},t)),q=k&&C("div",{class:P("preview-cover")},[k]),tt=(f=t.previewSize)!=null?f:this.previewSize,$t=(w=t.imageFit)!=null?w:this.imageFit,bt=W(t)?C(A.Z,{attrs:{fit:$t,src:t.content||t.url,width:tt,height:tt,lazyLoad:this.lazyLoad},class:P("preview-image"),on:{click:function(){s.onPreviewImage(t)}}},[q]):C("div",{class:P("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[C(D.Z,{class:P("file-icon"),attrs:{name:"description"}}),C("div",{class:[P("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url]),q]);return C("div",{class:P("preview"),on:{click:function(){s.$emit("click-preview",t,s.getDetail(i))}}},[bt,this.genPreviewMask(t),Dt])},genPreviewList:function(){if(this.previewImage)return this.fileList.map(this.genPreviewItem)},genUpload:function(){var t=this.$createElement;if(!(this.fileList.length>=this.maxCount||!this.showUpload)){var i=this.slots(),a=t("input",{attrs:(0,c.Z)({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:P("input"),on:{change:this.onChange}});if(i)return t("div",{class:P("input-wrapper")},[i,a]);var s;if(this.previewSize){var f=this.previewSizeWithUnit;s={width:f,height:f}}return t("div",{class:P("upload"),style:s},[t(D.Z,{attrs:{name:this.uploadIcon},class:P("upload-icon")}),this.uploadText&&t("span",{class:P("upload-text")},[this.uploadText]),a])}}},render:function(){var t=arguments[0];return t("div",{class:P()},[t("div",{class:P("wrapper",{disabled:this.disabled})},[this.genPreviewList(),this.genUpload()])])}}),dt=n(27966),vt=n(45061),mt=n(26711),gt=n(56279),pt=n(23400),wt=n(26082),yt=n(67157);const It={mixins:[yt.c],data(){return{config_extend:{config:{}},filter_config:{}}},methods:{filterPredefineColoursSchemeConfig(e,t){this.getNewConfigWithArrary(e,t,this.filter_config)}}};var St=n(17977),Pt=n.n(St),Ct=n(48836);const xt=Pt().create({timeout:1e4});var Lt={name:"upload-file",props:["widgetInfo"],components:{Uploader:ut},mixins:[wt.u,It,vt.u,mt.H,gt.P,pt.j],data(){return{fileList:[],resultUrlList:[],deleteList:[]}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},computed:{...(0,Ct.Se)(["getCanvasSetting","isView"])},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},methods:{loadInfo(){this.lifecycleAfterLoad()},reLoadInfo(e){this.loadInfo(e)},initAction(e){this.actionReceive(e)},afterRead(e,{index:t}){let i={};this.deleteList=this.deleteList.map(s=>s!==t);let a=new FormData;a.set("file",e.file),i=a,e.status="uploading",e.message="\u4E0A\u4F20\u4E2D...",xt.request({method:"post",data:i,headers:{"Content-Type":"multipart/form-data"},url:this.widgetInfo.config.postData.url}).then(s=>{if(e.status="done",e.message="\u4E0A\u4F20\u6210\u529F",s.data.data.url&&(this.resultUrlList[t]=s.data.data.url,this.resultUrlList.filter(w=>!w).length===0)){let w=this.resultUrlList.filter((C,$)=>this.deleteList.indexOf($)===-1);this.uploadDone(w)}}).catch(()=>{e.status="failed",e.message="\u4E0A\u4F20\u5931\u8D25"})},uploadDone(e){let t=this,i=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(i,a=>{if(a.enabled&&a.code===t.$$global_editor.actionType.open.code){let s=t.$$global_editor.actionType.open.code+"_"+t.widgetInfo.id,f={urlList:e};a.paramsExtend&&a.paramsExtend.length>0&&this.getExtendParams(f,a.paramsExtend),dt.Z.$emit(s,f),a.postMessage&&this.doPostMessage(f),this.actionNameList.push(s)}})},deleteFile(e,{index:t}){this.deleteList.push(t)},beforeRead(){return!0},oversize(){(0,h.Z)(`\u6587\u4EF6\u5927\u5C0F\u8D85\u8FC7${this.widgetInfo.config.maxSize}KB`)}}},Et=Lt,Tt=n(68141),zt=(0,Tt.Z)(Et,L,m,!1,null,"1cef78e1",null),Mt=zt.exports}}]);
