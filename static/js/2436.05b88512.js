"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[2436],{102436:function(D,g,o){o.r(g),o.d(g,{default:function(){return b}});var m=function(){var e=this,a=e._self._c;return a("div",{staticClass:"my-div"},[a("el-form",{ref:"form",attrs:{size:"mini","label-width":"70px","label-position":"right",model:e.currentWidget.dataset}},[a("el-form-item",{attrs:{label:"\u6570\u636E\u7C7B\u578B"}},[a("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90\u7C7B\u578B"},on:{change:e.changeDatasetType},model:{value:e.currentWidget.dataset.type,callback:function(t){e.$set(e.currentWidget.dataset,"type",t)},expression:"currentWidget.dataset.type"}},e._l(this.$$global_editor.dataSourcTypeList3,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),a("vue-lazy-component",[a("el-form-item",{attrs:{label:"\u8282\u70B9"}},[a("el-select",{staticStyle:{"margin-bottom":"4px"},attrs:{size:"mini",placeholder:"\u8BF7\u9009\u62E9\u8282\u70B9\u5B57\u6BB5"},on:{change:e.getConfigData},model:{value:e.currentWidget.dataset[e.currentWidget.dataset.type].encode.key,callback:function(t){e.$set(e.currentWidget.dataset[e.currentWidget.dataset.type].encode,"key",t)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.key"}},e._l(e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias,function(t){return a("el-option",{key:t.name,attrs:{label:t.alias!=""?t.alias:t.name,value:t.name}})}),1)],1),a("el-form-item",{attrs:{label:"\u6307\u5411\u8282\u70B9"}},[a("el-select",{staticStyle:{"margin-bottom":"4px"},attrs:{size:"mini",placeholder:"\u8BF7\u9009\u62E9\u6307\u5411\u8282\u70B9\u5B57\u6BB5"},on:{change:e.getConfigData},model:{value:e.currentWidget.dataset[e.currentWidget.dataset.type].encode.linkKey,callback:function(t){e.$set(e.currentWidget.dataset[e.currentWidget.dataset.type].encode,"linkKey",t)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.linkKey"}},e._l(e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias,function(t){return a("el-option",{key:t.name,attrs:{label:t.alias!=""?t.alias:t.name,value:t.name}})}),1)],1),a("el-form-item",{attrs:{label:"\u7EDF\u8BA1\u503C"}},[a("el-select",{staticStyle:{"margin-bottom":"4px"},attrs:{size:"mini",placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u503C\u5B57\u6BB5"},on:{change:e.getConfigData},model:{value:e.currentWidget.dataset[e.currentWidget.dataset.type].encode.value,callback:function(t){e.$set(e.currentWidget.dataset[e.currentWidget.dataset.type].encode,"value",t)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.value"}},e._l(e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias,function(t){return a("el-option",{key:t.name,attrs:{label:t.alias!=""?t.alias:t.name,value:t.name}})}),1)],1)],1),a("setting-dataset",{ref:"settingDataset",attrs:{currentWidget:e.currentWidget},on:{getDataSetData:e.getConfigData,clearDynamicEncode:e.clearDynamicEncode}})],1)],1)},p=[],y=o(589908),h=o(723400),f={name:"sankey-simple-data",components:{SettingDataset:y.Z},mixins:[h.j],props:["currentWidget"],data(){return{}},mounted(){this.getItemColor(this.currentWidget.dataset.type)},watch:{"currentWidget.dataset":{deep:!0,handler:function(){this.getItemColor(this.currentWidget.dataset.type)}}},methods:{changeDatasetType(){this.$refs.settingDataset.loadPreview(),this.currentWidget.dataset.dynamic.encode.key="",this.currentWidget.dataset.dynamic.encode.linkKey="",this.currentWidget.dataset.dynamic.encode.value="",this.getConfigData()},clearDynamicEncode(){this.currentWidget.dataset.dynamic.encode.key="",this.currentWidget.dataset.dynamic.encode.linkKey="",this.currentWidget.dataset.dynamic.encode.value=""},getItemColor(i){let e=this,a=[];e.currentWidget.config.series.itemColor&&e.currentWidget.config.series.itemColor.length>0?a=JSON.parse(JSON.stringify(e.currentWidget.config.series.itemColor)):a=e.currentWidget.config.series.colorList,e.currentWidget.config.series.itemColor=[];let t=e.currentWidget.dataset[i].source,l=e.currentWidget.dataset[i].dimensionsAlias,d=e.currentWidget.dataset[i].encode,c=this.getDataList(d,l,t);this.$$lib__.each(c.data,(s,n)=>{if(!s.name){e.currentWidget.config.series.itemColor.push({name:"",color:a[n].color,emphasisColor:a[n].color});return}if(a&&a[n]&&a[n].color)e.currentWidget.config.series.itemColor.push({name:s.name,color:a[n].color,emphasisColor:a[n].color});else{let r=e.currentWidget.config.series.colorList;e.currentWidget.config.series.itemColor.push({name:s.name,color:r[n]?r[n]:r[n%r],emphasisColor:r[n]?r[n]:r[n%r]})}})},getDataList(i,e,a){let t=null,l=null,d=null,c=[],s=[];return this.$$lib__.each(e,(n,r)=>{n.name==i.key&&(t=r),n.name==i.linkKey&&(l=r),n.name==i.value&&(d=r)}),this.$$lib__.each(a,n=>{c.push({source:n[t],target:n[l],value:n[d]});let r=this.$$lib__.find(s,u=>u.name==n[t]);n[t]!=""&&!r&&s.push({name:n[t]});let C=this.$$lib__.find(s,u=>u.name==n[l]);n[l]!=""&&!C&&s.push({name:n[l]})}),{links:c,data:s}}}},W=f,v=o(768141),k=(0,v.Z)(W,m,p,!1,null,"9f43f314",null),b=k.exports}}]);
