"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[3115],{56279:function(C,p,r){r.d(p,{P:function(){return h}});var y=r(86892),d=r(49500);const h={mixins:[y.D],created(){},methods:{lifecycleBeforeChartsLoad(g){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&d.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),d.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let f=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[g]);if(f)return f}return g},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&d.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),d.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},44513:function(C,p,r){r.d(p,{Z:function(){return v}});var y=function(){var s=this,w=s._self._c;return s.attr.buttonHide?w("div",{style:{position:"absolute",right:s.attr.buttonHideRight+"px",top:s.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(k){return s.onHide()}}},[s.openTooltip?w("el-tooltip",{attrs:{"open-delay":1e3,content:s.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[w("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):w("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):s._e()},d=[],h=r(52246),g={props:["attr"],name:"hide-button",data(){return{isPc:h.b}},computed:{openTooltip:function(){let u=!1,s=this.attr.buttonHideTooltipContent;return h.b&&s&&s!=null&&s.trim()!=""&&(u=!0),u}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},b=g,f=r(68141),I=(0,f.Z)(b,y,d,!1,null,"bf399b9a",null),v=I.exports},3115:function(C,p,r){r.r(p),r.d(p,{default:function(){return z}});var y=function(){var e=this,i=e._self._c;return i("div",{ref:"titleGeneral",style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px",overflow:"hidden"}},[i("hide-button",{attrs:{attr:e.widgetInfo.attr},on:{sendButtonHide:e.sendButtonHide}}),i("div",{directives:[{name:"popover",rawName:"v-popover:titlePopup",arg:"titlePopup"}],style:e.getTitleStyle(),on:{click:e.onClick,mouseover:function(o){return e.mouseover("widget")},mouseleave:function(o){return e.mouseleave("widget")}}},[i("span",{style:e.getSpanStyle(e.widgetInfo)},[e._v(" "+e._s(e.innerTextInfo)+" ")])]),e.widgetInfo.config.popover?i("div",[e.widgetInfo.config.popover.showWidget?i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:e.widgetInfo.config.popover.widgetStyle.show,expression:"widgetInfo.config.popover.widgetStyle.show"}],ref:"titleGeneralPopup",staticClass:"titleGeneral-popup",attrs:{id:"titleGeneral-popup"+e.widgetInfo.id},on:{mouseover:function(o){return e.mouseover("popWidget")},mouseleave:function(o){return e.mouseleave("popWidget")}}},[i("div",{staticClass:"popper-arrow"})])]):i("el-popover",{ref:"titlePopup",attrs:{"popper-class":`title-popover title-popover-${e.widgetInfo.id}`,transition:"fade-in-linear",width:e.widgetInfo.config.popover.width,trigger:e.widgetInfo.config.popover.trigger,placement:e.widgetInfo.config.popover.placement,disabled:e.widgetInfo.config.popover.disabled,offset:e.widgetInfo.config.popover.offset,"visible-arrow":e.widgetInfo.config.popover.arrow}},[i("div",{domProps:{innerHTML:e._s(e.tooltipText)}})])],1):e._e()],1)},d=[],h=r(44513),g=r(27966),b=r(26711),f=r(45061),I=r(56279),v=r(69184),u=r(55616),s=r(48836),w=r(75770),k=r(67157);const N={mixins:[k.c],data(){return{config_extend:{config:{text:{margin:{top:0,left:0},number:{fontSize:18,fontFamily:"alibabaPuHuiTiMedium"}}}},filter_config:{text:{label:{color:"",startColor:"",endColor:""}},popover:{backgroundColor:"",fontStyle:{color:""},widgetStyle:{shadowColor:"",left:0,top:0}}}}},methods:{filterPredefineColoursSchemeConfig(t,e){this.getNewConfig(t,e,this.filter_config)}}};var m=r(21300),H=r(55946),x=r(49500),W={props:["widgetInfo"],name:"title-general",components:{HideButton:h.Z},mixins:[v.uN,N,b.H,f.u,I.P],computed:{...(0,s.Se)(["isView","getCanvasSettingInfo","getCanvasSetting","getWidgets"]),lockX(){return this.getCanvasSetting.transformType==this.$$global_editor.transformType.autoBoth.code&&this.widgetInfo.attr.lockedW},lockY(){return this.getCanvasSetting.transformType==this.$$global_editor.transformType.autoBoth.code&&this.widgetInfo.attr.lockedH},innerTextInfo(){let t=this.textInfo;return this.widgetInfo.config.alarm&&this.widgetInfo.config.alarm.enabled==!0&&this.getCompareResult(this.widgetInfo)==!0&&(t=this.getContent(this.widgetInfo)),t},tooltipText(){return this.widgetInfo?.config?.popover?.content||this.textInfo}},data(){return{paddingT:0,lineH:0,textInfo:"",widgetStatus:"leave",popWidgetStatus:"leave",actionType:JSON.parse(JSON.stringify(w.Z)),arrow:null,permissionDisabled:!1}},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},beforeDestroy(){let t=document.querySelector(`#titleGeneral-popup${this.widgetInfo.id}`);t&&t.parentElement.removeChild(t)},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},methods:{...(0,s.nv)(["updateCurrentWidget"]),getTitleStyle(){let t={};return t.width=this.widgetInfo.attr.w-m.getNewPxW(this.widgetInfo.config.text.margin.left,this.lockX)+"px",t.height=this.widgetInfo.attr.hh-m.getNewPxH(this.widgetInfo.config.text.margin.top,this.lockY)+"px",t.paddingLeft=m.getNewPxW(this.widgetInfo.config.text.margin.left,this.lockX)+"px",t.paddingTop=this.paddingT+"px",t.fontSize=m.getNewFontSize(this.widgetInfo.config.text.label.fontSize,this.lockX,this.lockY)+"px",t.color=this.widgetInfo.config.text.label.color,t.fontWeight=this.widgetInfo.config.text.label.fontWeight,t.fontFamily=this.widgetInfo.config.text.label.fontFamily,t.fontStyle=this.widgetInfo.config.text.label.fontStyle,t.textDecoration=this.widgetInfo.config.text.label.textDecoration,t.textAlign=this.widgetInfo.config.text.label.horizontalAlignment,t.lineHeight=this.lineH+"px",t.overflow=this.widgetInfo.config.text.label.overflow==!0?"auto":"hidden",t.cursor=this.getCursor(this.widgetInfo.action,this.actionType.click.code,this.actionType.openLink.code),this.permissionDisabled=m.getWidgetPermissionDisabled(this.widgetInfo,"disabled"),this.permissionDisabled==!0&&(t.cursor="not-allowed",t.filter="opacity(50%)"),t},computeFontSize(t,e,i){let o=document.createElement("span");o.style.fontSize=e,o.style.opacity="0",o.style.fontFamily=i,o.innerHTML=t,document.body.append(o);let n={};return n.width=o.offsetWidth,n.height=o.offsetHeight,o.remove(),n},loadInfo(t){let e=this.computeFontSize("\u4F60\u597D",t.config.text.label.fontSize+"px",t.config.text.label.fontFamily);if(t.config.text.label.singleLine)switch(t.config.text.label.verticalAlignment){case"top":this.lineH=e.height,this.paddingT=this.mUtils.getNewPxH(t.config.text.margin.top,this.lockY);break;case"middle":this.lineH=t.attr.hh-this.mUtils.getNewPxH(t.config.text.margin.top,this.lockY),this.paddingT=this.mUtils.getNewPxH(t.config.text.margin.top,this.lockY);break;case"bottom":this.lineH=e.height,this.paddingT=t.attr.hh-e.height;break}else this.lineH=e.height,this.paddingT=this.mUtils.getNewPxH(t.config.text.margin.top,this.lockY);t.dataset[t.dataset.type]&&t.dataset[t.dataset.type].dimensions&&t.dataset[t.dataset.type].dimensions.length>0?this.textInfo=this.getFieldVal(t.dataset[t.dataset.type].source[0],t.dataset[t.dataset.type].dimensions,t.dataset[t.dataset.type].encode.text):this.textInfo=t.dataset[t.dataset.type].encode.text,this.initPopover(t),this.initAlarm(t),this.lifecycleAfterLoad()},reLoadInfo(t){t&&(this.$refs.titleGeneral.style.width=t.attr.w+"px",this.$refs.titleGeneral.style.height=t.attr.hh+"px"),this.loadInfo(t)},initAction(t){this.actionReceive(t)},initPopover(t){if(!t.config.popover)return;let e=document.getElementById("myBoardArea");this.arrow=this.$refs.titleGeneral.querySelector(".popper-arrow")||this.$refs?.titleGeneralPopup?.querySelector(".popper-arrow");const i=t?.config?.popover?.widgetStyle;if(t?.config?.popover?.showWidget&&!e&&i?.bindWidgetId){this.setBindWidgetHide();let o=this.$refs.titleGeneralPopup,n=document.querySelector(`#widget_${i.bindWidgetId}`);o.style.right=this.mUtils.getNewPxW(i.right)+"px",o.style.bottom=this.mUtils.getNewPxH(i.bottom)+t.attr.h+"px",o.style.boxShadow=`${i.shadowOffsetX||0}px ${i.shadowOffsetY||0}px ${i.shadowBlur||0}px ${i.shadowColor||"rgba(0,0,0,0)"} `+(i.inset?" inset":"");let l=!1;this.$$lib__.each(document.querySelector("body").childNodes,c=>{c.id=="titleGeneral-popup"+t.id&&(l=this.$$lib__.contains(c.childNodes,"#widget_"+t.config.popover.widgetStyle.bindWidgetId))}),n&&!l&&(o.style.borderRadius=n.style.borderRadius,o.appendChild(n),this.setPopup(t))}else i?.show&&!e&&this.arrow?.style&&(this.arrow.style.display="none");this.registerPopoerStyle(t)},mouseover(t){if(this.isView&&(t=="widget"&&(!this.widgetInfo.config.popover.widgetStyle.trigger||this.widgetInfo.config.popover.widgetStyle.trigger=="hover")?this.widgetStatus="over":t=="widget-click"&&this.widgetInfo.config.popover.widgetStyle.trigger=="click"?this.widgetStatus="over":t=="popWidget"&&(this.popWidgetStatus="over"),this.widgetInfo.config.popover?.showWidget&&this.widgetInfo.config.popover?.widgetStyle?.bindWidgetId&&this.widgetStatus=="over")){this.setPopup();let e=document.querySelector("#widget_"+this.widgetInfo.config.popover.widgetStyle.bindWidgetId);e&&e.parentNode&&(e.style.display="block",e.parentNode.style.display="block")}},mouseleave(t){this.isView&&(t=="widget"?setTimeout(()=>{this.popWidgetStatus=="leave"&&(this.widgetStatus="leave")},500):t=="popWidget"&&(this.widgetStatus="leave",this.popWidgetStatus="leave"),setTimeout(()=>{if(this.widgetInfo.config.popover.showWidget&&this.widgetStatus=="leave"&&this.popWidgetStatus=="leave"){let e=document.querySelector("#widget_"+this.widgetInfo.config.popover.widgetStyle.bindWidgetId);e&&e.parentNode&&(e.style.display="none",e.parentNode.style.display="none")}},1e3))},setPopup(t){t||(t=this.widgetInfo);let e=t?.config?.popover;if(!this.isView||!e)return;let i=document.querySelector(`#titleGeneral-popup${t.id}`),o=document.querySelector(`#widget_${e.widgetStyle.bindWidgetId}`);i.style.position="absolute",i.style.width=parseInt(o.style.width)+"px",i.style.height=parseInt(o.style.height)+"px";let n=t.attr.y,l=t.attr.x;if(t.parentId)try{let a=this.getWidgets[t.parentId];a?.attr&&(n+=a.attr.y,l+=a.attr.x)}catch(a){x.error(a)}let c=this.mUtils.getNewPxW(e.widgetStyle.left)||0,S=this.mUtils.getNewPxH(e.widgetStyle.top)||0;if(e.position=="top"){let a=this.mUtils.getNewPxH(e.widgetStyle.bottom)||0;n=n-parseInt(o.style.height)-16-a,l+=c}else e.position=="left"?(n+=S,l=l-c-parseInt(o.style.width)-16):e.position=="right"?(n+=S,l=l+c+t.attr.w+16):(n=n+t.attr.h+S+16,l+=c);if(i.style.top=`${n}px`,i.style.left=`${l}px`,document.querySelector("#my_bi_screen").appendChild(i),e.showArrow){this.arrow.style.display="inline-block";let a=e.arrowLeft||parseInt(o.style.width)*.2,$=e.arrowLeft||parseInt(o.style.height)*.2;e.position=="top"?(this.arrow.style.left=`${a}px`,this.arrow.style.bottom="-16px",this.arrow.style.borderTopColor=o.style.backgroundColor):e.position=="left"?(this.arrow.style.top=`${$}px`,this.arrow.style.right="-16px",this.arrow.style.borderLeftColor=o.style.backgroundColor):e.position=="right"?(this.arrow.style.top=`${$}px`,this.arrow.style.left="-16px",this.arrow.style.borderRightColor=o.style.backgroundColor):(this.arrow.style.top="-16px",this.arrow.style.left=`${a}px`,this.arrow.style.borderBottomColor=o.style.backgroundColor)}else this.arrow.style.display="none"},setBindWidgetHide(){let t=JSON.parse(JSON.stringify(this.getWidgets[this.widgetInfo.config.popover.widgetStyle.bindWidgetId]));t.attr.hide=!0,this.updateCurrentWidget(JSON.parse(JSON.stringify(t)))},registerPopoerStyle(t){const e=t.config.popover||{};this.mUtils.appendCss(`title-popover-${t.id}`,`.title-popover-${t.id} {
                  background-color: ${e?.backgroundColor};
                  border-color:  ${e?.backgroundColor};
                  font-size: ${this.mUtils.getNewFontSize(e?.fontStyle?.fontSize)}px;
                  font-family: ${e?.fontStyle?.fontFamily};
                  color: ${e?.fontStyle?.color};
            }`)},getSpanStyle(t){let e=t.config.text.label,i={};return e.textShadow&&(i.textShadow=e.hShadow+"px "+e.vShadow+"px "+e.textShadowBlur+"px "+e.textShadowColor||"rgba(0,0,0,0)"),e.textStroke&&(i.webkitTextStrokeWidth=e.textStrokeWidth+"px",i.webkitTextStrokeColor=e.textStrokeColor),e.gradient&&(i.backgroundImage="linear-gradient("+e.angle+"deg,"+e.startColor+","+e.endColor+")",i.webkitBackgroundClip="text",i.webkitTextFillColor="transparent"),e.singleLine&&(i.height="100%",i.width="100%",i.display="inline-block",i.whiteSpace="nowrap",e.enabledEllipsis&&(i.textOverflow="ellipsis",i.overflow="hidden")),i},onClick(){if(this.permissionDisabled==!0)return;this.mouseover("widget-click");let t=this,e=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(e,i=>{let o={text:t.textInfo};if(i.paramsExtend&&i.paramsExtend.length>0){let n=[];t.widgetInfo.dataset[t.widgetInfo.dataset.type].source&&t.widgetInfo.dataset[t.widgetInfo.dataset.type].source.length>0&&(n=t.widgetInfo.dataset[t.widgetInfo.dataset.type].source[0]),this.getExtendParams(o,i.paramsExtend,n,t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions)}if(i.enabled&&i.code==t.actionType.click.code){let n=i.code+"_"+t.widgetInfo.id;if(i.script&&i.script.enabled){if(x.log("Execute script for "+this.widgetInfo.name+" component to "+i.name+" component"),i.script.content==""){u.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",i.script.content),o=this.customScript(o)}g.Z.$emit(n,o),i.postMessage&&this.doPostMessage(o),this.actionNameList.push(n)}else if(i.enabled&&i.code==t.actionType.openLink.code){if(i.script&&i.script.enabled){if(x.log("Execute script for "+i.name+" action"),i.script.content==""){u.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",i.script.content),o=this.customScript(o)}i.type===this.$$global_editor.linkType.dynamic.code&&(i[t.$$global_editor.linkType.dynamic.code].url=t.getActionUrl(i,t.widgetInfo.dataset[t.widgetInfo.dataset.type].source[0],t.widgetInfo.dataset[t.widgetInfo.dataset.type].dimensions)),this.openLinkAction(i,o)}else i.enabled&&i.code==t.actionType.showPage.code&&this.showPageAction(i,o)})},initAlarm(t){if(t=JSON.parse(JSON.stringify(t)),this.clearAlarm(t),!t.config.alarm||t.config.alarm.enabled==!1||!t.config.alarm.field||t.config.alarm.field==""||!t.dataset[t.dataset.type]||!t.dataset[t.dataset.type].source||!t.dataset[t.dataset.type].dimensions)return;let e=this.getCompareResult(t),i=t.config.alarm;i.mode==="style"&&e==!0&&this.$nextTick(()=>{let o=this.$refs.titleGeneral;o.style.backgroundColor=i.backgroundColor,o.style.backgroundImage=i.backgroundImage!=""?this.getImageUrl(i.backgroundImage):"",o.style.backgroundSize=i.backgroundSize,o.children[0].style.color=i.color,o.children[0].style.fontWeight=i.fontWeight,o.children[0].style.fontStyle=i.fontStyle,o.children[0].style.textDecoration=i.textDecoration}),i.mode=="showHide"&&!H.Z.state.editor.isBoardEditor&&(t.attr.hide=!e,this.$emit("attrChange",t))},getCompareResult(t){t=JSON.parse(JSON.stringify(t));let e=t.config.alarm,i=!1;if(e.script&&e.script.enabled==!0&&e.script.scriptContent&&e.script.scriptContent!="")i=new Function("info",e.script.scriptContent)(t);else{let o=JSON.parse(JSON.stringify(t.dataset[t.dataset.type])),n=this.getFieldVal(o.source[0],o.dimensions,e.field);n&&n!=""&&e.limit&&e.limit!=""&&(isNaN(n)||isNaN(e.limit)||(n=n-0,e.limit=e.limit-0,e.rule=="greater"&&(i=n>e.limit),e.rule=="less"&&(i=n<e.limit)),e.rule=="equal"&&(i=n==e.limit))}return i},getContent(t){let e=JSON.parse(JSON.stringify(t.config.alarm));if(!e||!e.content||e.content=="")return"";let i="";if(e.contentScript&&e.contentScript.enabled==!0&&e.contentScript.scriptContent&&e.contentScript.scriptContent!="")i=new Function("info",e.contentScript.scriptContent)(t);else{i=e.content;let o="\\$\\{(.*?)\\}",n=i.match(o);for(;n!=null;)i=i.replace(n[0],this.textInfo),n=i.match(o)}return i},clearAlarm(t){this.$nextTick(()=>{let e=this.$refs.titleGeneral;e.style.backgroundColor=t.attr.backgroundColor?t.attr.backgroundColor:"",e.style.backgroundImage=t.attr.backgroundImage&&t.attr.backgroundImage!=""?this.getImageUrl(t.attr.backgroundImage):"",e.style.backgroundSize=t.attr.backgroundSize?t.attr.backgroundSize:"",e.children[0].style.color=t.config.text.label.color,e.children[0].style.fontWeight=t.config.text.label.fontWeight,e.children[0].style.fontStyle=t.config.text.label.fontStyle,e.children[0].style.textDecoration=t.config.text.label.textDecoration})},getImageUrl(t){if(t&&t!="")return"url("+m.appendImageBaseURL(t)+")"}}},T=W,P=r(68141),L=(0,P.Z)(T,y,d,!1,null,"6fb78fd3",null),z=L.exports}}]);
