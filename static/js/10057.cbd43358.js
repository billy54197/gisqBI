"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[10057],{56279:function(B,I,d){d.d(I,{P:function(){return g}});var f=d(386892),p=d(149500);const g={mixins:[f.D],created(){},methods:{lifecycleBeforeChartsLoad(v){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&p.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let C=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[v]);if(C)return C}return v},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&p.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},752246:function(B,I,d){d.d(I,{X:function(){return f},b:function(){return p}});let f={versions:function(){var g=navigator.userAgent;return{trident:g.indexOf("Trident")>-1,presto:g.indexOf("Presto")>-1,webKit:g.indexOf("AppleWebKit")>-1,gecko:g.indexOf("Gecko")>-1&&g.indexOf("KHTML")==-1,mobile:!!g.match(/AppleWebKit.*Mobile.*/),ios:!!g.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:g.indexOf("Android")>-1,iPhone:g.indexOf("iPhone")>-1,iPad:g.indexOf("iPad")>-1,webApp:g.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},p;f.versions.mobile||f.versions.ios||f.versions.android||f.versions.iPhone||f.versions.iPad?p=!1:p=!0},210057:function(B,I,d){d.r(I),d.d(I,{default:function(){return et}});var f=function(){var s=this,e=s._self._c;return e("div",{style:{width:s.widgetInfo.attr.w+"px",height:s.widgetInfo.attr.hh+"px",overflow:"hidden"}},[e("hide-button",{attrs:{attr:s.widgetInfo.attr}}),e("div",{ref:"pictorialBar",style:{width:s.widgetInfo.attr.w+"px",height:s.widgetInfo.attr.hh+"px"}})],1)},p=[],g=d(844513),v=d(711334),D=d(56279),C=d(445061),F=d(126711),Y=d(99349),P=d(927966),c=d(555616),L=d(275770),M=d(67157),A=d(150813);const K={mixins:[M.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(A.Z.charts.title)),legend:JSON.parse(JSON.stringify(A.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(A.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(A.Z.charts.toolbox)),xAxis:JSON.parse(JSON.stringify(A.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(A.Z.charts.yAxis)),series:{label:{color:"#000999"},itemStyle:{colorInfo:{type:"gradation",pureColor:"",gradation:{start:"rgba(20, 122, 217,0.1)",end:"rgba(20, 122, 217, 1)"}},opacity:1}},barList:[{series:{label:{color:"#3A4151"},itemStyle:{colorInfo:{type:"gradation",pureColor:"rgba(52, 152, 219, 1)",gradation:{start:"rgba(76, 132, 255, 0.1)",end:"rgba(76, 132, 255, 1)"}},opacity:1}}}]}}},methods:{filterPredefineColoursSchemeConfig(t,s){if(this.getNewConfigWithArrary(t,s,this.filter_config),s.barList.length==0)for(let e=0;e<t.barList.length;e++)this.getNewConfigWithArrary(t.barList[e].series,this.filter_config.series,this.filter_config.series)}}};var G=d(321300),$=d(149500);const k=d(954255);var Q={name:"PictorialBar",components:{HideButton:g.Z},mixins:[D.P,C.u,F.H,Y.P,v.baseConfig,K],props:["widgetInfo"],data(){return{alias:"",indexX:-1,indexY:-1,rangeX:0,rangeY:0,mydata:[]}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=k.init(this.$refs.pictorialBar,null,{devicePixelRatio:2}),this.loadInfo(this.widgetInfo),this.initAction(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{initAction(t){this.actionSendout(t),this.actionReceive(t)},getBarList(t){let s=JSON.parse(JSON.stringify(t.config.series));this.indexX>-1&&this.$$lib__.each(this.mydata,(e,n)=>{t.config.barList[n]&&t.config.barList[n].name==e.xValue||(t.config.barList.length=this.mydata.length,t.config.barList[n]={index:n+1,name:e.xValue,series:JSON.parse(JSON.stringify(s))})})},loadInfo(t){let s=this.getTitle(t.config.title),e=this.getLegend(t.config.legend),n=this.getGrid(t.config.grid),r=this.getTooltip(t.config.tooltip),a=JSON.parse(JSON.stringify(t.config.toolbox)),i=this.getyAxis(t.config.yAxis),h=this.getxAxis(t.config.xAxis);h.axisTick.lineStyle.color=this.getColorInfo(h.axisTick.lineStyle.colorInfo),i.axisTick.lineStyle.color=this.getColorInfo(i.axisTick.lineStyle.colorInfo),h.axisLine.lineStyle.color=this.getColorInfo(h.axisLine.lineStyle.colorInfo),i.axisLine.lineStyle.color=this.getColorInfo(i.axisLine.lineStyle.colorInfo),this.calAllDatas(t),this.getBarList(this.widgetInfo),this.$nextTick(()=>{let m=this.getData(t),x=m.dataItem,z=m.dataImg,l=t.config.series;l.itemStyle.color=this.getColor(l.itemStyle.colorInfo),l.itemStyle.shadowColor=l.itemStyle.shadowColor?l.itemStyle.shadowColor:"transparent";let V=JSON.parse(JSON.stringify(l.label));V.formatter=this.getFormatterString(l.label.formatter);let T=this.getBgSeries(),N={type:"pictorialBar",name:this.alias,data:x,label:V,itemStyle:l.itemStyle,barWidth:l.barWidth?`${l.barWidth}%`:null,symbol:this.getSymbol(l.symbol),symbolSize:l.symbolSizePercent?[l.symbolSize[0]+"%",l.symbolSize[1]+"%"]:[l.symbolSize[0],l.symbolSize[1]],symbolPosition:l.symbolPosition,symbolOffset:this.getSymbolOffset(l.symbolOffset),symbolRotate:l.symbolRotate,symbolRepeat:l.symbolRepeat,symbolRepeatDirection:l.symbolRepeatDirection?"start":"end",symbolMargin:l.symbolMargin,symbolClip:l.symbolClip,animationDelay:function(b,w){return w.index*300}};l.symbolClip&&(N.symbolSizePercent=!1,N.symbolBoundingData=this.rangeY[1]),N.symbol!=""&&T.push(N);let O={name:this.alias+"img",type:"pictorialBar",barGap:"-100%",symbolPosition:"end",barWidth:N.barWidth?`${N.barWidth}%`:null,symbolSize:["100%","100%"],symbolOffset:[0,0],data:z};if(t.config.forceDefault)if(t.config.series.topImgType==="custom"&&t.config.series.topImgCustomList&&t.config.series.topImgCustomList.length>0){O.type="custom";let b=t.config.series.topImgCustomList,w=this;O.renderItem=function(S,y){const H=y.coord([y.value(0),y.value(1)]);let U=y.size([1,w.rangeY[1]]),X=U[0]*(t.config.series.barWidth?t.config.series.barWidth/100:1),W=U[1],j=w.mydata[S.dataIndex].data,Z=[];for(let E=b.length-1;E>=0;E--){let o=b[E];if(!o.disabled)if(o.type=="text"){let u="";if(o.textStyle.script&&o.textStyle.script.enabled&&o.textStyle.script.content)try{w.textFunc=new Function("index","value","data",o.textStyle.script.content),u=w.textFunc(y.value(0),y.value(1),j)||""}catch(R){$.error("\u81EA\u5B9A\u4E49\u9876\u90E8\u5143\u7D20\uFF0C\u751F\u6210\u6587\u672C\u811A\u672C\u8FD0\u884C\u5931\u8D25",R)}else u=o.textStyle.text,u&&(u=u.replaceAll(/\\n/g,`
`),Object.keys(j).forEach(R=>{u=u.replace(`{${R}}`,j[R]||"")}));Z.push({type:"text",style:{text:u,x:o.textStyle.x?X/100*o.textStyle.x:0,y:o.textStyle.y?W/100*o.textStyle.y:0,textFont:y.font({fontWeight:o.textStyle.fontWeight||"normal",fontStyle:o.textStyle.fontStyle||"",textDecoration:"",fontSize:o.textStyle.fontSize||14,fontFamily:o.textStyle.fontFamily||"\u9ED1\u4F53"}),textAlign:o.textStyle.textAlign||"center",textVerticalAlign:o.textStyle.textVerticalAlign||"center",fill:o.textStyle.colorList&&o.textStyle.colorList.length>0?o.textStyle.colorList[S.dataIndex%o.textStyle.colorList.length]:"#FFF"},position:H})}else{let u=[o.imageStyle.x?`${o.imageStyle.x}%`:0,o.imageStyle.y?`${o.imageStyle.y}%`:0];Z.push({type:"image",style:{textConfig:{position:u},image:(0,G.appendImageBaseURL)(o.imageStyle.url),x:o.imageStyle.x?X/100*o.imageStyle.x:0,y:o.imageStyle.y?W/100*o.imageStyle.y:0,width:X/100*o.imageStyle.width,height:W/100*o.imageStyle.height},position:H})}}return{type:"group",children:Z}}}else{t.config.series.topImgType==="img"&&(O.symbol=this.getSymbolURL(t.config.series.topImg));let b=t.config.series.topImgSizePercent?"%":"";O.symbolSize=O.symbol?[`${t.config.series.topImgWidth||0}${b}`,`${t.config.series.topImgHeight||0}`]:[0,0],O.symbolOffset=O.symbol?[t.config.series.topImgOffsetX?`${t.config.series.topImgOffsetX}%`:0,t.config.series.topImgOffsetY?`${t.config.series.topImgOffsetY}%`:0]:[0,0]}T.push(O);let J={title:s,legend:e,grid:n,xAxis:Object.assign(JSON.parse(JSON.stringify(h)),this.getXAxisData(x)),yAxis:i,tooltip:r,toolbox:a,series:T};if(t.config.dataZoom&&t.config.dataZoom.type&&(J.dataZoom=t.config.dataZoom),l.emphasis)try{let b=l.emphasis;if(b.script&&b.script.enabled){if(b.script.content){let w=new Function("index","item","data",b.script.content),S=J.series[0].data;if(S&&S.length>0)for(let y=0;y<S.length;++y)try{S[y].emphasis=w.call(this,y,S[y],S)}catch(H){$.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",H)}}}else l.emphasis.itemStyle&&l.emphasis.itemStyle.color&&(J.series[0].emphasis={itemStyle:{...l.emphasis.itemStyle}})}catch(b){$.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",b)}this.getAnimation(J,t),this.setOption(J),this.setAnimationLoop(t,()=>{this.setOption(J,t)})})},setOption(t){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0})},getXAxisData(t){let s={data:[]};return t.forEach(e=>{s.data.push(e.name)}),s},calAllDatas(t){this.indexX=-1,this.indexY=-1,this.rangeX=[0,0],this.rangeY=[0,0],this.mydata=[];let s=t.dataset[t.dataset.type].encode,e=t.dataset[t.dataset.type].dimensionsAlias,n=t.dataset[t.dataset.type].source,r=t.dataset[t.dataset.type].columnList;if(e)for(let a=e.length;a--;)s.x&&e[a].name==s.x&&(this.indexX=a),s.y&&e[a].name==s.y&&(this.indexY=a,this.alias=e[a].alias);if(n&&n.length>0){let a=[],i=[];for(let h=0;h<n.length;h++){let m={};for(let x=0;x<r.length;++x)m[r[x].name]=n[h][r[x].index];this.mydata.push({value:n[h][this.indexY]-0,xValue:n[h][this.indexX],data:JSON.parse(JSON.stringify(m))}),a.push(n[h][this.indexY]-0),i.push(h)}this.echarts.setOption({xAxis:{type:"category",data:i},yAxis:{type:"value"},series:[{type:"bar",itemStyle:{color:"rgba(0,0,0,0)"},name:"cal-max",data:a}]}),this.rangeY=this.echarts.getModel().getComponent("yAxis").axis.scale._extent,this.rangeX=this.echarts.getModel().getComponent("xAxis").axis.scale._extent,this.echarts.clear()}$.debug("calAllData:",this.mydata,this.indexX,this.indexY,this.rangeX,this.rangeY)},getSymbol(t){if(t){let s=t.path;return t.type=="img"&&t.path!=""&&(s=this.getSymbolURL(t.path)),t.type=="svg"&&t.path!=""&&(s=t.path.indexOf("path://")==-1?"path://"+t.path:t.path),s}return""},getColor(t){let s={};return t.type=="pureColor"?s=t.pureColor:(t.direction=="linear"&&(s={type:t.direction,x:t.linear.x,y:t.linear.y,x2:t.linear.x2,y2:t.linear.y2,colorStops:[{offset:0,color:t.gradation.start?t.gradation.start:"#e54035"},{offset:1,color:t.gradation.end?t.gradation.end:"#e54035"}]}),t.direction=="radial"&&(s={type:t.direction,x:t.radial.x,y:t.radial.y,r:t.radial.r,colorStops:[{offset:0,color:t.gradation.start?t.gradation.start:"#e54035"},{offset:1,color:t.gradation.end?t.gradation.end:"#e54035"}]})),s},getData(t){let s=[],e=[];if(this.mydata&&this.mydata.length>0)for(let r=0;r<this.mydata.length;r++){let a={name:this.mydata[r].xValue,value:this.mydata[r].value,mydata:this.mydata[r].data},i={};t.config.forceDefault||(t.config.barList[r]&&t.config.barList[r].series?i=JSON.parse(JSON.stringify(t.config.barList[r].series)):i=JSON.parse(JSON.stringify(t.config.barList[0].series)),delete i.label,i.symbol=this.getSymbol(i.symbol),i.symbolRepeatDirection=i.symbolRepeatDirection?"start":"end",i.symbolSize=i.symbolSizePercent?[i.symbolSize[0]+"%",i.symbolSize[1]+"%"]:[i.symbolSize[0],i.symbolSize[1]],i.symbolOffset=[i.symbolOffset[0]?i.symbolOffset[0]:this.widgetInfo.config.series.symbolOffset[0],i.symbolOffset[1]?i.symbolOffset[1]:this.widgetInfo.config.series.symbolOffset[1]],i.itemStyle.shadowColor=i.itemStyle.shadowColor?i.itemStyle.shadowColor:"transparent",i.itemStyle.color=this.getColor(i.itemStyle.colorInfo),i.symbolClip&&(i.symbolSizePercent=!1,i.symbolBoundingData=this.rangeY[1]));let h=Object.assign(a,i);s.push(h);let m={};if(m.value=this.mydata[r].value,!this.widgetInfo.config.forceDefault){m.symbol=this.getSymbolURL(i.topImg);let x=i.topImgSizePercent?"%":"";if(m.symbolSize=m.symbol?[`${i.topImgWidth}${x}`,`${i.topImgHeight}`]:[0,0],m.symbolOffset=[i.topImgOffsetX?`${i.topImgOffsetX}%`:0,i.topImgOffsetY?`${i.topImgOffsetY}%`:0],!m.symbol&&e.length>0)for(let z=e.length-1;z>0;z--)e[z].symbol&&(m.symbol=e[z].symbol)}e.push(m)}return{dataItem:s,dataImg:e}},reLoadInfo(t){t&&(this.$refs.pictorialBar.style.width=t.attr.w+"px",this.$refs.pictorialBar.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},actionSendout(t){let s=this;this.$$lib__.each(t.action.sendOut.actionList,e=>{if(e.enabled){let n=e.code+"_"+t.id;if(e.paramsExtend&&e.paramsExtend.length>0){let r={};this.getParamsExtend(r,e.paramsExtend,t)}e.code==L.default.click.code&&s.onClick(n,e)}})},onClick(t,s){let e=this;e.echarts.on("click",n=>{let r={};r.x=n.name,r.y=n.value;let a=[],i=e.widgetInfo.action.sendOut.actionList;if(e.widgetInfo.dataset[e.widgetInfo.dataset.type].source&&e.widgetInfo.dataset[e.widgetInfo.dataset.type].source.length>0&&(a=e.widgetInfo.dataset[e.widgetInfo.dataset.type].source[n.dataIndex]),e.getExtendParams(r,i[0].paramsExtend,a,e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions),s.script&&s.script.enabled){if($.log("Execute script for "+e.widgetInfo.name+" component to "+s.name+" component"),s.script.content==""){c.Message.warning({message:s.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",s.script.content),r=this.customScript(r)}P.Z.$emit(t,r),s.postMessage&&e.doPostMessage(r),e.actionNameList.push(t)})},getBgSeries(){let t=[],s=JSON.parse(JSON.stringify(this.widgetInfo.config.series));if(this.widgetInfo.config.bgList&&this.widgetInfo.config.bgList.length>0){let e=this.widgetInfo.config.bgList;for(let n=e.length-1;n>=0;n--){let r=[];if(this.mydata&&this.mydata.length>0)for(let i=0;i<this.mydata.length;i++)r.push({name:this.mydata[i].xValue,value:e[n].useValue?this.mydata[i].value:this.rangeY[1]});let a=JSON.parse(JSON.stringify(e[n].series));a.symbol=this.getSymbol(a.symbol),a.symbol!=""&&(a.type="pictorialBar",a.name=`bg${n}`,a.data=r,a.label={show:!1},a.tooltip={show:!1},a.itemStyle.shadowColor=a.itemStyle.shadowColor?a.itemStyle.shadowColor:"transparent",a.itemStyle.color=this.getColor(a.itemStyle.colorInfo),a.barWidth=s.barWidth?`${s.barWidth}%`:null,e[n].useValue?a.symbolSize=a.symbolSizePercent?[a.symbolSize[0]+"%","100%"]:[a.symbolSize[0],"100%"]:a.symbolSize=a.symbolSizePercent?[a.symbolSize[0]+"%",a.symbolSize[1]+"%"]:[a.symbolSize[0],a.symbolSize[1]],a.symbolRepeatDirection=a.symbolRepeatDirection?"start":"end",a.animationDelay=function(i,h){return h.index*300},t.push(a))}}return t},getSymbolOffset(t){if(t&&t instanceof Array&&t.length!=0){let s=0,e=0;t.length==1?s=t[0]&&t[0]!=null&&t[0]!=""?t[0]:0:(s=t[0]&&t[0]!=null&&t[0]!=""?t[0]:0,e=t[1]&&t[1]!=null&&t[1]!=""?t[1]:0),t=[s,e]}else t=[0,0];return t}}},_=Q,q=d(768141),tt=(0,q.Z)(_,f,p,!1,null,"b47e3018",null),et=tt.exports},844513:function(B,I,d){d.d(I,{Z:function(){return Y}});var f=function(){var c=this,L=c._self._c;return c.attr.buttonHide?L("div",{style:{position:"absolute",right:c.attr.buttonHideRight+"px",top:c.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(M){return c.onHide()}}},[c.openTooltip?L("el-tooltip",{attrs:{"open-delay":1e3,content:c.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[L("el-button",{class:c.attr.buttonHideIconClass&&c.attr.buttonHideIconClass!=""?c.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:c.attr.buttonHideColor,fontSize:c.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):L("el-button",{class:c.attr.buttonHideIconClass&&c.attr.buttonHideIconClass!=""?c.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:c.attr.buttonHideColor,fontSize:c.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):c._e()},p=[],g=d(752246),v={props:["attr"],name:"hide-button",data(){return{isPc:g.b}},computed:{openTooltip:function(){let P=!1,c=this.attr.buttonHideTooltipContent;return g.b&&c&&c!=null&&c.trim()!=""&&(P=!0),P}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},D=v,C=d(768141),F=(0,C.Z)(D,f,p,!1,null,"bf399b9a",null),Y=F.exports}}]);
