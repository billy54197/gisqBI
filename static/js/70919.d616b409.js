"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[70919],{370919:function(j,p,i){i.r(p),i.d(p,{default:function(){return _}});var C=function(){var e=this,a=e._self._c;return a("div",[a("el-form",{ref:"form",attrs:{size:"mini","label-width":"70px","label-position":"right",model:e.currentWidget.dataset},nativeOn:{submit:function(t){t.preventDefault()}}},[a("div",[a("el-form-item",{attrs:{label:"\u6570\u636E\u7C7B\u578B"}},[a("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90\u7C7B\u578B"},on:{change:e.changeDatasetType},model:{value:e.currentWidget.dataset.type,callback:function(t){e.$set(e.currentWidget.dataset,"type",t)},expression:"currentWidget.dataset.type"}},e._l(e.$$global_editor.dataSourcTypeList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),a("div",[a("el-form-item",{attrs:{label:"\u884C\u653F\u533A"}},[a("el-select",{ref:"encodeX",attrs:{size:"mini",placeholder:"\u8BF7\u9009\u62E9\u884C\u653F\u533A\u5B57\u6BB5"},on:{change:e.changeData},model:{value:e.currentWidget.dataset[e.currentWidget.dataset.type].encode.x,callback:function(t){e.$set(e.currentWidget.dataset[e.currentWidget.dataset.type].encode,"x",t)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.x"}},e._l(e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias,function(t){return a("el-option",{key:t.name,attrs:{label:t.alias!=""?t.alias:t.name,value:t.name}})}),1)],1),a("el-form-item",{attrs:{label:"\u6E10\u53D8\u6570\u503C"}},[a("el-select",{ref:"encodeY",attrs:{size:"mini",placeholder:"\u8BF7\u9009\u62E9\u884C\u653F\u533A\u5B57\u6BB5"},on:{change:e.changeData},model:{value:e.currentWidget.dataset[e.currentWidget.dataset.type].encode.y,callback:function(t){e.$set(e.currentWidget.dataset[e.currentWidget.dataset.type].encode,"y",t)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.y"}},e._l(e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias,function(t){return a("el-option",{key:t.name,attrs:{label:t.alias!=""?t.alias:t.name,value:t.name}})}),1)],1),a("el-form-item",{attrs:{label:"\u7EDF\u8BA1\u5B57\u6BB5"}},[a("el-select",{ref:"encodeY",attrs:{size:"mini",multiple:!0,"multiple-limit":10,placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u5B57\u6BB5"},on:{change:e.changeDimensionsAlias},model:{value:e.currentWidget.dataset[e.currentWidget.dataset.type].encode.z,callback:function(t){e.$set(e.currentWidget.dataset[e.currentWidget.dataset.type].encode,"z",t)},expression:"currentWidget.dataset[currentWidget.dataset.type].encode.z"}},e._l(e.currentWidget.dataset[e.currentWidget.dataset.type].dimensionsAlias,function(t){return a("el-option",{key:t.name,attrs:{label:t.alias!=""?t.alias:t.name,value:t.name}})}),1)],1)],1),a("setting-dataset",{ref:"settingDataset",attrs:{"current-widget":e.currentWidget},on:{getDataSetData:e.getConfigData,clearDynamicEncode:e.clearDynamicEncode}})],1)])],1)},z=[],O=i(723400),A=i(589908),W=i(42160),k={name:"GisThemeChartsData",components:{SettingDataset:A.Z},mixins:[O.j],props:["currentWidget"],data(){return{isInit:!1}},mounted(){this.$nextTick(()=>{this.getConfigData()})},methods:{changeDatasetType(){this.$refs.settingDataset.loadPreview(),this.changeData()},changeData(){this.currentWidget.config.rampData={},this.currentWidget.config.chartOption.data={},this.initChartsData(),this.getConfigData()},initChartsData(){let l=this.currentWidget.dataset.type||"",a=(this.currentWidget.dataset||{})[l]||{},t=a.dimensions,h=a.encode.x,y=t.indexOf(h),s=a.encode.y,o=t.indexOf(s),u=a.encode.z,r=[];u.forEach((n,g)=>{let d=t.indexOf(n);r.push(d)});const m={};a.source.forEach((n,g)=>{let d=n[y];W.default.set(this.currentWidget.config.rampData,d,n[o]);let D=[];r.forEach((c,b)=>{let f={value:n[c],name:a.dimensionsAlias[c].alias||a.dimensionsAlias[c].name};D.push(f)}),W.default.set(this.currentWidget.config.chartOption.data,d,D);const x={};n.forEach((c,b)=>{const f=a.dimensionsAlias[b].name;x[f]=c}),m[d]=x}),this.currentWidget.config.chartOption.chartInfo=m;const v=this.currentWidget.config.chartOption.legend;this.currentWidget.config.chartOption.legend=[],a.encode.z.forEach((n,g)=>{this.currentWidget.config.chartOption.legend.push({name:n,color:v[g]?v[g].color:"#ff7300"})})},changeDimensionsAlias(l){let e=this.currentWidget.config.chartOption.legend,a=this.currentWidget.dataset[this.currentWidget.dataset.type]||{},t=[];l.forEach((h,y)=>{let s=null;s=a.dimensionsAlias.filter((r,m)=>r.name===h);let o=s[0].name||s[0].alias,u="rgb("+Math.random()*255+","+Math.random()*255+","+Math.random()*255+")";if(e){for(let r of e)if(r.name==o){u=r.color;break}}t.push({name:o,color:u})}),this.currentWidget.config.chartOption.legend=t,this.changeData()},clearDynamicEncode(){this.currentWidget.dataset.dynamic.encode.x="",this.currentWidget.dataset.dynamic.encode.y="",this.currentWidget.dataset.dynamic.encode.z=[]}}},E=k,$=i(768141),I=(0,$.Z)(E,C,z,!1,null,"58998667",null),_=I.exports}}]);
