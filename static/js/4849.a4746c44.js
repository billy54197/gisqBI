"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[4849],{9132:function(b,c,a){a.d(c,{M:function(){return p}});var _=a(79876),u=a(45643),r=a(55616),f=a.n(r),h=a(27966),g=a(48836),d=a(49500);const p={props:{widgetId:{type:String},value:{default:null},condition_config:{}},mixins:[_.G,u.E],data(){return{global_query:this.$$global_query,condition_value:void 0}},computed:{...(0,g.Se)(["enumInfoFun","datasetInfoFun"]),enumInfo(){return this.enumInfoFun(this.widgetId)},datasetInfo(){return this.datasetInfoFun(this.widgetId)}},mounted(){h.Z.$on("busGetEnumDataSetJson"+(this.widgetId?"_"+this.widgetId:""),o=>{this.getEnumDataSetJson(o)})},methods:{afterChangeValue(){this.scriptChangeValue(),this.condition_config.change_query==!0&&this.doQuery()},scriptChangeValue(){if(this.condition_config.is_change_value&&this.condition_config.is_change_value==!0){if(!this.condition_config.script_change_value||this.condition_config.script_change_value==""){d.warn(this.condition_name+this.condition_config.label+"\u56DE\u8F66\u4E8B\u4EF6\u811A\u672C\u4E3A\u7A7A");return}d.info("\u6267\u884C"+this.condition_name+this.condition_config.label+" \u56DE\u8F66\u4E8B\u4EF6\u811A\u672C");let o=new Function("condition_config","value",this.condition_config.script_change_value);this.condition_config.control_type==this.global_query.control_type.selectTree.code?o.apply(this,[this.condition_config,this.condition_value.value]):o.apply(this,[this.condition_config,this.condition_value])}},keyupEnter(){if(this.condition_config.attributes&&this.condition_config.attributes.is_condition_enter&&this.condition_config.attributes.is_condition_enter==!0){if(!this.condition_config.attributes.script_condition_enter||this.condition_config.attributes.script_condition_enter==""){d.warn(this.condition_name+this.condition_config.label+"\u56DE\u8F66\u4E8B\u4EF6\u811A\u672C\u4E3A\u7A7A");return}d.info("\u6267\u884C"+this.condition_name+this.condition_config.label+" \u56DE\u8F66\u4E8B\u4EF6\u811A\u672C"),this.keyupEnterScript=new Function("condition_config,value",this.condition_config.attributes.script_condition_enter),this.condition_config.control_type==this.global_query.control_type.selectTree.code?this.keyupEnterScript(this.condition_config,this.condition_value.value):this.keyupEnterScript(this.condition_config,this.condition_value)}},getEnumDataSetJson(o){let n=null;this.$$lib__.each(this.queryConfig.field,i=>{i.guid==o&&i.enum_type==this.global_query.enum_type.data_set.code&&i.data_set.dataSetId&&i.data_set.dataSetId!=""&&(n=JSON.parse(JSON.stringify(i)))}),this.$$lib__.each(this.queryConfig.condition,i=>{i.guid==o&&(i.control_type==this.global_query.control_type.select.code||i.control_type==this.global_query.control_type.selectTree.code||i.control_type==this.global_query.control_type.cascader.code||i.control_type==this.global_query.control_type.radio.code||i.control_type==this.global_query.control_type.checkbox.code)&&i.control_enum_type==this.global_query.enum_type.data_set.code&&i.data_set.dataSetId&&i.data_set.dataSetId!=""&&(n=JSON.parse(JSON.stringify(i)))});let t=null;if(n)t=n.data_set.dataSetId+"_"+o,this.updateDatasetInfo({key:t,data:[],isOk:!1,widgetId:this.widgetId});else{d.error("\u672A\u627E\u5230\u4E3B\u952EID\u4E3A["+o+"]\u7684\u67E5\u8BE2\u7ED3\u679C\u5217\u6216\u67E5\u8BE2\u6761\u4EF6");return}let l={dataSet:JSON.stringify(this.handleDataSetParam(n.data_set))};this.getDataSetSource(l,i=>{let s=[];i&&i.status==200?s=this.getDataSetObjectData(i.data,n.data_set.query,n.data_set.dimensionsAlias,n.data_set.dataSetId):r.Message.error({message:"\u6570\u636E\u96C6:[ "+n.data_set.dataSetName+" ]\u83B7\u53D6\u5931\u8D25\uFF0C"+i.msg,offset:60}),this.updateDatasetInfo({key:t,data:s,widgetId:this.widgetId})})},getEnumList(){let o=[];if(this.condition_config.control_enum_type==this.$$global_query.enum_type.data_set.code)this.condition_config.guid!=""&&this.condition_config.data_set.dataSetId!=""&&this.$$lib__.each(this.datasetInfo.datasetJson[this.condition_config.data_set.dataSetId+"_"+this.condition_config.guid],n=>{n.enumValue=n[this.condition_config.data_set.field_value],n.enumName=n[this.condition_config.data_set.field_name];let t=n[this.condition_config.data_set.field_disabled];t&&(t.toString()=="1"||t.toString()=="true")?n.disabled=!0:t&&(t.toString()=="0"||t.toString()=="false")&&(n.disabled=!1),o.push(n)});else{let n=this.enumInfo.enumJson[this.condition_config.control_enum_name];n&&(o=JSON.parse(JSON.stringify(n)),o=this.$$lib__.sortBy(o,"enumOrder"))}return o}}}},14849:function(b,c,a){a.r(c),a.d(c,{default:function(){return o}});var _=function(){var t=this,e=t._self._c;return e("div",[e("el-cascader",{style:{width:t.condition_config.attributes.width_control!=null?t.condition_config.attributes.width_control+"px":void 0},attrs:{clearable:t.condition_config.attributes.clearable,"collapse-tags":t.condition_config.attributes.collapse_tags,disabled:t.condition_config.attributes.disabled,filterable:t.condition_config.attributes.filterable,options:t.tree_data,placeholder:t.condition_config.attributes.placeholder==null||t.condition_config.attributes.placeholder==""?"\u8BF7\u8F93\u5165"+t.condition_config.label:t.condition_config.attributes.placeholder,props:{expandTrigger:t.condition_config.attributes.expandTrigger,multiple:t.condition_config.attributes.multiple,emitPath:!1,checkStrictly:t.condition_config.attributes.checkStrictly},readonly:t.condition_config.attributes.readonly,separator:t.condition_config.attributes.separator,"show-all-levels":t.condition_config.attributes.show_all_levels,"popper-class":"dropdown-white"},on:{change:t.changeValue},scopedSlots:t._u([{key:"default",fn:function({node:l,data:i}){return[e("el-tooltip",{attrs:{content:i.label,disabled:!t.condition_config.attributes.menu_label_tooltip,"open-delay":1e3,effect:"light",placement:"top"}},[e("div",{staticClass:"my-cascader-text",style:{width:t.condition_config.attributes.menu_label_width!=null?t.condition_config.attributes.menu_label_width+"px":void 0}},[e("span",[t._v(t._s(i.label))])])])]}}]),model:{value:t.condition_value,callback:function(l){t.condition_value=l},expression:"condition_value"}})],1)},u=[],r=a(9132),f=a(49500),h={name:"control-cascader",model:{prop:"value",event:"change"},props:{widgetId:{type:String},value:{default:null},condition_config:{}},mixins:[r.M],data(){return{condition_value:null,tree_root:null}},computed:{tree_data(){return this.rebuildData()}},watch:{value(n){this.condition_config.attributes.multiple==!0?n instanceof Array?this.condition_value=n:this.condition_value=[n]:this.condition_value=n}},mounted(){this.condition_config.attributes.multiple==!0?this.value instanceof Array?this.condition_value=this.value:this.condition_value=[this.value]:this.condition_value=this.value},methods:{changeValue(){this.$emit("change",this.condition_value!=""?this.condition_value:null),this.afterChangeValue()},getEnumList(){let n=[];if(this.tree_root=null,this.condition_config.control_enum_type==this.$$global_query.enum_type.data_set.code)this.condition_config.guid!=""&&this.condition_config.data_set.dataSetId!=""&&this.$$lib__.each(this.datasetInfo.datasetJson[this.condition_config.data_set.dataSetId+"_"+this.condition_config.guid],t=>{t.enumValue=t[this.condition_config.data_set.field_value],t.enumName=t[this.condition_config.data_set.field_name],t.fldEnumId=t[this.condition_config.data_set.field_value],t.parentEnumValue=t[this.condition_config.data_set.parent_value];let e=t[this.condition_config.data_set.field_disabled];e&&(e.toString()=="1"||e.toString()=="true")?t.disabled=!0:e&&(e.toString()=="0"||e.toString()=="false")&&(t.disabled=!1),n.push(t)}),this.condition_config.data_set.tree_root&&(this.tree_root=this.condition_config.data_set.tree_root);else{let t=this.enumInfo.enumJson[this.condition_config.control_enum_name];t&&(n=JSON.parse(JSON.stringify(t)),n=this.$$lib__.sortBy(n,"enumOrder"))}return n},rebuildData(){let n=this.getEnumList();this.condition_config.attributes.is_enum_filter==!0&&((!this.condition_config.attributes.script_enum_filter||this.condition_config.attributes.script_enum_filter=="")&&f.warn("\u7EA7\u8054\u9009\u62E9\u5668\u679A\u4E3E\u8FC7\u6EE4\u7684\u811A\u672C\u4E3A\u7A7A"),f.info("\u6267\u884C\u7EA7\u8054\u9009\u62E9\u5668\u679A\u4E3E\u8FC7\u6EE4\u7684\u811A\u672C\u4E3A\u7A7A"),n=new Function("enum_list",this.condition_config.attributes.script_enum_filter).apply(this,[JSON.parse(JSON.stringify(n))]));let t=this.tree_root&&this.tree_root!="",e={},l=[];return this.$$lib__.each(n,i=>{let s=i.parentEnumValue;t?(i.id=i.enumValue,i.value=i.enumValue,i.label=i.enumName,i.disabled=i.disabled,s&&s!=this.tree_root?(e[s]||(e[s]=[]),e[s].push(i)):s==this.tree_root&&l.push(i)):(i.id=i.enumValue,i.value=i.enumValue,i.label=i.enumName,i.disabled=i.disabled,s!=null&&s!=""?(e[s]||(e[s]=[]),e[s].push(i)):l.push(i))}),this.transferFl(l,e),l},transferFl(n,t){this.$$lib__.each(n,e=>{let l=t[e.fldEnumId];l&&(e.children=l,this.transferFl(l,t))})}}},g=h,d=a(68141),p=(0,d.Z)(g,_,u,!1,null,"8aed883c",null),o=p.exports}}]);
