"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[46512],{816917:function(){},296001:function(){},533367:function(){},963565:function(R,T,n){var z=n(579023),E=n.n(z),S=n(439733),u=n(281602),v=n(395982),P=n(340321),m=(0,S.d)("image"),w=m[0],x=m[1];T.Z=w({props:{src:String,fit:String,alt:String,round:Boolean,width:[Number,String],height:[Number,String],radius:[Number,String],lazyLoad:Boolean,iconPrefix:String,showError:{type:Boolean,default:!0},showLoading:{type:Boolean,default:!0},errorIcon:{type:String,default:"photo-fail"},loadingIcon:{type:String,default:"photo"}},data:function(){return{loading:!0,error:!1}},watch:{src:function(){this.loading=!0,this.error=!1}},computed:{style:function(){var l={};return(0,u.Xq)(this.width)&&(l.width=(0,v.N)(this.width)),(0,u.Xq)(this.height)&&(l.height=(0,v.N)(this.height)),(0,u.Xq)(this.radius)&&(l.overflow="hidden",l.borderRadius=(0,v.N)(this.radius)),l}},created:function(){var l=this.$Lazyload;l&&u._f&&(l.$on("loaded",this.onLazyLoaded),l.$on("error",this.onLazyLoadError))},beforeDestroy:function(){var l=this.$Lazyload;l&&(l.$off("loaded",this.onLazyLoaded),l.$off("error",this.onLazyLoadError))},methods:{onLoad:function(l){this.loading=!1,this.$emit("load",l)},onLazyLoaded:function(l){var r=l.el;r===this.$refs.image&&this.loading&&this.onLoad()},onLazyLoadError:function(l){var r=l.el;r===this.$refs.image&&!this.error&&this.onError()},onError:function(l){this.error=!0,this.loading=!1,this.$emit("error",l)},onClick:function(l){this.$emit("click",l)},genPlaceholder:function(){var l=this.$createElement;if(this.loading&&this.showLoading)return l("div",{class:x("loading")},[this.slots("loading")||l(P.Z,{attrs:{name:this.loadingIcon,classPrefix:this.iconPrefix},class:x("loading-icon")})]);if(this.error&&this.showError)return l("div",{class:x("error")},[this.slots("error")||l(P.Z,{attrs:{name:this.errorIcon,classPrefix:this.iconPrefix},class:x("error-icon")})])},genImage:function(){var l=this.$createElement,r={class:x("img"),attrs:{alt:this.alt},style:{objectFit:this.fit}};if(!this.error)return this.lazyLoad?l("img",E()([{ref:"image",directives:[{name:"lazy",value:this.src}]},r])):l("img",E()([{attrs:{src:this.src},on:{load:this.onLoad,error:this.onError}},r]))}},render:function(){var l=arguments[0];return l("div",{class:x({round:this.round}),style:this.style,on:{click:this.onClick}},[this.genImage(),this.genPlaceholder(),this.slots()])}})},953204:function(R,T,n){n.d(T,{f:function(){return z}});var z={inject:{vanField:{default:null}},watch:{value:function(){var S=this.vanField;S&&(S.resetValidation(),S.validateWithTrigger("onChange"))}},created:function(){var S=this.vanField;S&&!S.children&&(S.children=this)}}},9114:function(R,T,n){var z=n(604017),E=n(439733),S=n(40799),u=(0,E.d)("swipe-item"),v=u[0],P=u[1];T.Z=v({mixins:[(0,S.j)("vanSwipe")],data:function(){return{offset:0,inited:!1,mounted:!1}},mounted:function(){var w=this;this.$nextTick(function(){w.mounted=!0})},computed:{style:function(){var w={},x=this.parent,f=x.size,l=x.vertical;return f&&(w[l?"height":"width"]=f+"px"),this.offset&&(w.transform="translate"+(l?"Y":"X")+"("+this.offset+"px)"),w},shouldRender:function(){var w=this.index,x=this.inited,f=this.parent,l=this.mounted;if(!f.lazyRender||x)return!0;if(!l)return!1;var r=f.activeIndicator,a=f.count-1,h=r===0&&f.loop?a:r-1,d=r===a&&f.loop?0:r+1,p=w===r||w===h||w===d;return p&&(this.inited=!0),p}},render:function(){var w=arguments[0];return w("div",{class:P(),style:this.style,on:(0,z.Z)({},this.$listeners)},[this.shouldRender&&this.slots()])}})},46366:function(R,T,n){var z=n(439733),E=n(450947),S=n(750068),u=n(294599),v=n(880269),P=n(734672),m=n(40799),w=n(406053),x=(0,z.d)("swipe"),f=x[0],l=x[1];T.Z=f({mixins:[P.D,(0,m.G)("vanSwipe"),(0,w.X)(function(r,a){r(window,"resize",this.resize,!0),r(window,"orientationchange",this.resize,!0),r(window,"visibilitychange",this.onVisibilityChange),a?this.initialize():this.clear()})],props:{width:[Number,String],height:[Number,String],autoplay:[Number,String],vertical:Boolean,lazyRender:Boolean,indicatorColor:String,loop:{type:Boolean,default:!0},duration:{type:[Number,String],default:500},touchable:{type:Boolean,default:!0},initialSwipe:{type:[Number,String],default:0},showIndicators:{type:Boolean,default:!0},stopPropagation:{type:Boolean,default:!0}},data:function(){return{rect:null,offset:0,active:0,deltaX:0,deltaY:0,swiping:!1,computedWidth:0,computedHeight:0}},watch:{children:function(){this.initialize()},initialSwipe:function(){this.initialize()},autoplay:function(a){a>0?this.autoPlay():this.clear()}},computed:{count:function(){return this.children.length},maxCount:function(){return Math.ceil(Math.abs(this.minOffset)/this.size)},delta:function(){return this.vertical?this.deltaY:this.deltaX},size:function(){return this[this.vertical?"computedHeight":"computedWidth"]},trackSize:function(){return this.count*this.size},activeIndicator:function(){return(this.active+this.count)%this.count},isCorrectDirection:function(){var a=this.vertical?"vertical":"horizontal";return this.direction===a},trackStyle:function(){var a={transitionDuration:(this.swiping?0:this.duration)+"ms",transform:"translate"+(this.vertical?"Y":"X")+"("+this.offset+"px)"};if(this.size){var h=this.vertical?"height":"width",d=this.vertical?"width":"height";a[h]=this.trackSize+"px",a[d]=this[d]?this[d]+"px":""}return a},indicatorStyle:function(){return{backgroundColor:this.indicatorColor}},minOffset:function(){return(this.vertical?this.rect.height:this.rect.width)-this.size*this.count}},mounted:function(){this.bindTouchEvent(this.$refs.track)},methods:{initialize:function(a){if(a===void 0&&(a=+this.initialSwipe),!(!this.$el||(0,E.x)(this.$el))){clearTimeout(this.timer);var h=this.$el.getBoundingClientRect();this.rect=h,this.swiping=!0,this.active=a,this.computedWidth=+this.width||h.width,this.computedHeight=+this.height||h.height,this.offset=this.getTargetOffset(a),this.children.forEach(function(d){d.offset=0}),this.autoPlay()}},resize:function(){this.initialize(this.activeIndicator)},onVisibilityChange:function(){document.hidden?this.clear():this.autoPlay()},onTouchStart:function(a){this.touchable&&(this.clear(),this.touchStartTime=Date.now(),this.touchStart(a),this.correctPosition())},onTouchMove:function(a){!this.touchable||!this.swiping||(this.touchMove(a),this.isCorrectDirection&&((0,S.PF)(a,this.stopPropagation),this.move({offset:this.delta})))},onTouchEnd:function(){if(!(!this.touchable||!this.swiping)){var a=this.size,h=this.delta,d=Date.now()-this.touchStartTime,p=h/d,L=Math.abs(p)>.25||Math.abs(h)>a/2;if(L&&this.isCorrectDirection){var b=this.vertical?this.offsetY:this.offsetX,M=0;this.loop?M=b>0?h>0?-1:1:0:M=-Math[h>0?"ceil":"floor"](h/a),this.move({pace:M,emitChange:!0})}else h&&this.move({pace:0});this.swiping=!1,this.autoPlay()}},getTargetActive:function(a){var h=this.active,d=this.count,p=this.maxCount;return a?this.loop?(0,v.w)(h+a,-1,d):(0,v.w)(h+a,0,p):h},getTargetOffset:function(a,h){h===void 0&&(h=0);var d=a*this.size;this.loop||(d=Math.min(d,-this.minOffset));var p=h-d;return this.loop||(p=(0,v.w)(p,this.minOffset,0)),p},move:function(a){var h=a.pace,d=h===void 0?0:h,p=a.offset,L=p===void 0?0:p,b=a.emitChange,M=this.loop,F=this.count,K=this.active,B=this.children,W=this.trackSize,N=this.minOffset;if(!(F<=1)){var $=this.getTargetActive(d),A=this.getTargetOffset($,L);if(M){if(B[0]&&A!==N){var U=A<N;B[0].offset=U?W:0}if(B[F-1]&&A!==0){var Z=A>0;B[F-1].offset=Z?-W:0}}this.active=$,this.offset=A,b&&$!==K&&this.$emit("change",this.activeIndicator)}},prev:function(){var a=this;this.correctPosition(),this.resetTouchStatus(),(0,u.d1)(function(){a.swiping=!1,a.move({pace:-1,emitChange:!0})})},next:function(){var a=this;this.correctPosition(),this.resetTouchStatus(),(0,u.d1)(function(){a.swiping=!1,a.move({pace:1,emitChange:!0})})},swipeTo:function(a,h){var d=this;h===void 0&&(h={}),this.correctPosition(),this.resetTouchStatus(),(0,u.d1)(function(){var p;d.loop&&a===d.count?p=d.active===0?0:a:p=a%d.count,h.immediate?(0,u.d1)(function(){d.swiping=!1}):d.swiping=!1,d.move({pace:p-d.active,emitChange:!0})})},correctPosition:function(){this.swiping=!0,this.active<=-1&&this.move({pace:this.count}),this.active>=this.count&&this.move({pace:-this.count})},clear:function(){clearTimeout(this.timer)},autoPlay:function(){var a=this,h=this.autoplay;h>0&&this.count>1&&(this.clear(),this.timer=setTimeout(function(){a.next(),a.autoPlay()},h))},genIndicator:function(){var a=this,h=this.$createElement,d=this.count,p=this.activeIndicator,L=this.slots("indicator");if(L)return L;if(this.showIndicators&&d>1)return h("div",{class:l("indicators",{vertical:this.vertical})},[Array.apply(void 0,Array(d)).map(function(b,M){return h("i",{class:l("indicator",{active:M===p}),style:M===p?a.indicatorStyle:null})})])}},render:function(){var a=arguments[0];return a("div",{class:l()},[a("div",{ref:"track",style:this.trackStyle,class:l("track",{vertical:this.vertical})},[this.slots()]),this.genIndicator()])}})},294599:function(R,T,n){n.d(T,{$d:function(){return x},Wn:function(){return m},d1:function(){return w}});var z=n(281602),E=Date.now();function S(f){var l=Date.now(),r=Math.max(0,16-(l-E)),a=setTimeout(f,r);return E=l+r,a}var u=z.sk?n.g:window,v=u.requestAnimationFrame||S,P=u.cancelAnimationFrame||u.clearTimeout;function m(f){return v.call(u,f)}function w(f){m(function(){m(f)})}function x(f){P.call(u,f)}},880269:function(R,T,n){n.d(T,{u:function(){return S},w:function(){return z}});function z(u,v,P){return Math.min(Math.max(u,v),P)}function E(u,v,P){var m=u.indexOf(v),w="";return m===-1?u:v==="-"&&m!==0?u.slice(0,m):(v==="."&&u.match(/^(\.|-\.)/)&&(w=m?"-0":"0"),w+u.slice(0,m+1)+u.slice(m).replace(P,""))}function S(u,v,P){v===void 0&&(v=!0),P===void 0&&(P=!0),v?u=E(u,".",/\./g):u=u.split(".")[0],P?u=E(u,"-",/-/g):u=u.replace(/-/,"");var m=v?/[^-0-9.]/g:/[^-0-9]/g;return u.replace(m,"")}},395499:function(R,T,n){n.r(T),n.d(T,{default:function(){return Mt}});var z=function(){var t=this,i=t._self._c;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.widgetInfo.attr.hide!==!0,expression:"widgetInfo.attr.hide !== true"}],ref:"dialog",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[i("uploader",{attrs:{accept:t.widgetInfo.config.accept,"preview-size":t.widgetInfo.config.previewSize+"px","preview-image":t.widgetInfo.config.previewImage,"preview-full-image":t.widgetInfo.config.previewFullImage,disabled:t.widgetInfo.config.disabled,deletable:t.widgetInfo.config.deletable,capture:t.widgetInfo.config.capture,"max-size":t.widgetInfo.config.maxSize*1024,"max-count":t.widgetInfo.config.maxCount,"image-fit":t.widgetInfo.config.imageFit,"after-read":t.afterRead,"before-read":t.beforeRead},on:{oversize:t.oversize,delete:t.deleteFile},model:{value:t.fileList,callback:function(s){t.fileList=s},expression:"fileList"}})],1)},E=[],S=n(232590),u=n(777714),v=n(586569),P=n(279141),m=n(691905),w=n(751595),x=n(816917),f=n(398839),l=n(891508),r=n(533367),a=n(296001),h=n(604017),d=n(439733),p=n(395982),L=n(281602);function b(e){return Array.isArray(e)?e:[e]}function M(e,t){return new Promise(function(i){if(t==="file"){i();return}var s=new FileReader;s.onload=function(o){i(o.target.result)},t==="dataUrl"?s.readAsDataURL(e):t==="text"&&s.readAsText(e)})}function F(e,t){return b(e).some(function(i){return i.size>t})}var K=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function B(e){return K.test(e)}function W(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?B(e.url):e.content?e.content.indexOf("data:image")===0:!1}var N=n(953204),$=n(340321),A=n(963565),U=n(313013),Z=n(42160),j=(0,d.d)("image-preview"),it=j[0],O=j[1],nt=n(779487),V=n(734672),st=n(406053),at=n(46366),X=n(880269),G=n(750068),ot=n(9114);function J(e){return Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2))}var rt={mixins:[V.D],props:{src:String,show:Boolean,active:Number,minZoom:[Number,String],maxZoom:[Number,String],rootWidth:Number,rootHeight:Number},data:function(){return{scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}},computed:{vertical:function(){var t=this.rootWidth,i=this.rootHeight,s=i/t;return this.imageRatio>s},imageStyle:function(){var t=this.scale,i={transitionDuration:this.zooming||this.moving?"0s":".3s"};if(t!==1){var s=this.moveX/t,o=this.moveY/t;i.transform="scale("+t+", "+t+") translate("+s+"px, "+o+"px)"}return i},maxMoveX:function(){if(this.imageRatio){var t=this.vertical?this.rootHeight/this.imageRatio:this.rootWidth;return Math.max(0,(this.scale*t-this.rootWidth)/2)}return 0},maxMoveY:function(){if(this.imageRatio){var t=this.vertical?this.rootHeight:this.rootWidth*this.imageRatio;return Math.max(0,(this.scale*t-this.rootHeight)/2)}return 0}},watch:{active:"resetScale",show:function(t){t||this.resetScale()}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{resetScale:function(){this.setScale(1),this.moveX=0,this.moveY=0},setScale:function(t){t=(0,X.w)(t,+this.minZoom,+this.maxZoom),t!==this.scale&&(this.scale=t,this.$emit("scale",{scale:this.scale,index:this.active}))},toggleScale:function(){var t=this.scale>1?1:2;this.setScale(t),this.moveX=0,this.moveY=0},onTouchStart:function(t){var i=t.touches,s=this.offsetX,o=s===void 0?0:s;this.touchStart(t),this.touchStartTime=new Date,this.startMoveX=this.moveX,this.startMoveY=this.moveY,this.moving=i.length===1&&this.scale!==1,this.zooming=i.length===2&&!o,this.zooming&&(this.startScale=this.scale,this.startDistance=J(t.touches))},onTouchMove:function(t){var i=t.touches;if(this.touchMove(t),(this.moving||this.zooming)&&(0,G.PF)(t,!0),this.moving){var s=this.deltaX+this.startMoveX,o=this.deltaY+this.startMoveY;this.moveX=(0,X.w)(s,-this.maxMoveX,this.maxMoveX),this.moveY=(0,X.w)(o,-this.maxMoveY,this.maxMoveY)}if(this.zooming&&i.length===2){var c=J(i),g=this.startScale*c/this.startDistance;this.setScale(g)}},onTouchEnd:function(t){var i=!1;(this.moving||this.zooming)&&(i=!0,this.moving&&this.startMoveX===this.moveX&&this.startMoveY===this.moveY&&(i=!1),t.touches.length||(this.zooming&&(this.moveX=(0,X.w)(this.moveX,-this.maxMoveX,this.maxMoveX),this.moveY=(0,X.w)(this.moveY,-this.maxMoveY,this.maxMoveY),this.zooming=!1),this.moving=!1,this.startMoveX=0,this.startMoveY=0,this.startScale=1,this.scale<1&&this.resetScale())),(0,G.PF)(t,i),this.checkTap(),this.resetTouchStatus()},checkTap:function(){var t=this,i=this.offsetX,s=i===void 0?0:i,o=this.offsetY,c=o===void 0?0:o,g=new Date-this.touchStartTime,I=250,D=10;s<D&&c<D&&g<I&&(this.doubleTapTimer?(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null,this.toggleScale()):this.doubleTapTimer=setTimeout(function(){t.$emit("close"),t.doubleTapTimer=null},I))},onLoad:function(t){var i=t.target,s=i.naturalWidth,o=i.naturalHeight;this.imageRatio=o/s}},render:function(){var t=arguments[0],i={loading:function(){return t(U.Z,{attrs:{type:"spinner"}})}};return t(ot.Z,{class:O("swipe-item")},[t(A.Z,{attrs:{src:this.src,fit:"contain"},class:O("image",{vertical:this.vertical}),style:this.imageStyle,scopedSlots:i,on:{load:this.onLoad}})])}},H=it({mixins:[V.D,(0,nt.e)({skipToggleEvent:!0}),(0,st.X)(function(e){e(window,"resize",this.resize,!0),e(window,"orientationchange",this.resize,!0)})],props:{className:null,closeable:Boolean,asyncClose:Boolean,showIndicators:Boolean,images:{type:Array,default:function(){return[]}},loop:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},transition:{type:String,default:"van-fade"},showIndex:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},overlayClass:{type:String,default:O("overlay")},closeIcon:{type:String,default:"clear"},closeOnPopstate:{type:Boolean,default:!0},closeIconPosition:{type:String,default:"top-right"}},data:function(){return{active:0,rootWidth:0,rootHeight:0,doubleClickTimer:null}},mounted:function(){this.resize()},watch:{startPosition:"setActive",value:function(t){var i=this;t?(this.setActive(+this.startPosition),this.$nextTick(function(){i.resize(),i.$refs.swipe.swipeTo(+i.startPosition,{immediate:!0})})):this.$emit("close",{index:this.active,url:this.images[this.active]})}},methods:{resize:function(){if(this.$el&&this.$el.getBoundingClientRect){var t=this.$el.getBoundingClientRect();this.rootWidth=t.width,this.rootHeight=t.height}},emitClose:function(){this.asyncClose||this.$emit("input",!1)},emitScale:function(t){this.$emit("scale",t)},setActive:function(t){t!==this.active&&(this.active=t,this.$emit("change",t))},genIndex:function(){var t=this.$createElement;if(this.showIndex)return t("div",{class:O("index")},[this.slots("index",{index:this.active})||this.active+1+" / "+this.images.length])},genCover:function(){var t=this.$createElement,i=this.slots("cover");if(i)return t("div",{class:O("cover")},[i])},genImages:function(){var t=this,i=this.$createElement;return i(at.Z,{ref:"swipe",attrs:{lazyRender:!0,loop:this.loop,duration:this.swipeDuration,initialSwipe:this.startPosition,showIndicators:this.showIndicators,indicatorColor:"white"},class:O("swipe"),on:{change:this.setActive}},[this.images.map(function(s){return i(rt,{attrs:{src:s,show:t.value,active:t.active,maxZoom:t.maxZoom,minZoom:t.minZoom,rootWidth:t.rootWidth,rootHeight:t.rootHeight},on:{scale:t.emitScale,close:t.emitClose}})})])},genClose:function(){var t=this.$createElement;if(this.closeable)return t($.Z,{attrs:{role:"button",name:this.closeIcon},class:O("close-icon",this.closeIconPosition),on:{click:this.emitClose}})},onClosed:function(){this.$emit("closed")},swipeTo:function(t,i){this.$refs.swipe&&this.$refs.swipe.swipeTo(t,i)}},render:function(){var t=arguments[0];return t("transition",{attrs:{name:this.transition},on:{afterLeave:this.onClosed}},[this.shouldRender?t("div",{directives:[{name:"show",value:this.value}],class:[O(),this.className]},[this.genClose(),this.genImages(),this.genIndex(),this.genCover()]):null])}}),C,lt={loop:!0,value:!0,images:[],maxZoom:3,minZoom:1/3,onClose:null,onChange:null,className:"",showIndex:!0,closeable:!1,closeIcon:"clear",asyncClose:!1,transition:"van-fade",getContainer:"body",startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"},ht=function(){C=new(Z.default.extend(H))({el:document.createElement("div")}),document.body.appendChild(C.$el),C.$on("change",function(t){C.onChange&&C.onChange(t)}),C.$on("scale",function(t){C.onScale&&C.onScale(t)})},_=function(t,i){if(i===void 0&&(i=0),!L.sk){C||ht();var s=Array.isArray(t)?{images:t,startPosition:i}:t;return(0,h.Z)(C,lt,s),C.$once("input",function(o){C.value=o}),C.$once("closed",function(){C.images=[]}),s.onClose&&(C.$off("close"),C.$once("close",s.onClose)),C}};_.Component=H,_.install=function(){Z.default.use(H)};var ct=_,Q=(0,d.d)("uploader"),ut=Q[0],y=Q[1],ft=ut({inheritAttrs:!1,mixins:[N.f],model:{prop:"fileList"},props:{disabled:Boolean,lazyLoad:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],previewOptions:Object,name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:[Number,String],default:Number.MAX_VALUE},maxCount:{type:[Number,String],default:Number.MAX_VALUE},deletable:{type:Boolean,default:!0},showUpload:{type:Boolean,default:!0},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"},uploadIcon:{type:String,default:"photograph"}},computed:{previewSizeWithUnit:function(){return(0,p.N)(this.previewSize)},value:function(){return this.fileList}},methods:{getDetail:function(t){return t===void 0&&(t=this.fileList.length),{name:this.name,index:t}},onChange:function(t){var i=this,s=t.target.files;if(!(this.disabled||!s.length)){if(s=s.length===1?s[0]:[].slice.call(s),this.beforeRead){var o=this.beforeRead(s,this.getDetail());if(!o){this.resetInput();return}if((0,L.tI)(o)){o.then(function(c){c?i.readFile(c):i.readFile(s)}).catch(this.resetInput);return}}this.readFile(s)}},readFile:function(t){var i=this,s=F(t,this.maxSize);if(Array.isArray(t)){var o=this.maxCount-this.fileList.length;t.length>o&&(t=t.slice(0,o)),Promise.all(t.map(function(c){return M(c,i.resultType)})).then(function(c){var g=t.map(function(I,D){var Y={file:I,status:"",message:""};return c[D]&&(Y.content=c[D]),Y});i.onAfterRead(g,s)})}else M(t,this.resultType).then(function(c){var g={file:t,status:"",message:""};c&&(g.content=c),i.onAfterRead(g,s)})},onAfterRead:function(t,i){var s=this;this.resetInput();var o=t;if(i){var c=t;Array.isArray(t)?(c=[],o=[],t.forEach(function(I){I.file&&(I.file.size>s.maxSize?c.push(I):o.push(I))})):o=null,this.$emit("oversize",c,this.getDetail())}var g=Array.isArray(o)?!!o.length:!!o;g&&(this.$emit("input",[].concat(this.fileList,b(o))),this.afterRead&&this.afterRead(o,this.getDetail()))},onDelete:function(t,i){var s,o=this,c=(s=t.beforeDelete)!=null?s:this.beforeDelete;if(c){var g=c(t,this.getDetail(i));if(!g)return;if((0,L.tI)(g)){g.then(function(){o.deleteFile(t,i)}).catch(L.ZT);return}}this.deleteFile(t,i)},deleteFile:function(t,i){var s=this.fileList.slice(0);s.splice(i,1),this.$emit("input",s),this.$emit("delete",t,this.getDetail(i))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onPreviewImage:function(t){var i=this;if(this.previewFullImage){var s=this.fileList.filter(function(c){return W(c)}),o=s.map(function(c){return c.content||c.url});this.imagePreview=ct((0,h.Z)({images:o,startPosition:s.indexOf(t),onClose:function(){i.$emit("close-preview")}},this.previewOptions))}},closeImagePreview:function(){this.imagePreview&&this.imagePreview.close()},chooseFile:function(){this.disabled||this.$refs.input&&this.$refs.input.click()},genPreviewMask:function(t){var i=this.$createElement,s=t.status,o=t.message;if(s==="uploading"||s==="failed"){var c=s==="failed"?i($.Z,{attrs:{name:"close"},class:y("mask-icon")}):i(U.Z,{class:y("loading")}),g=(0,L.Xq)(o)&&o!=="";return i("div",{class:y("mask")},[c,g&&i("div",{class:y("mask-message")},[o])])}},genPreviewItem:function(t,i){var s,o=this,c,g,I=this.$createElement,D=(s=t.deletable)!=null?s:this.deletable,Y=t.status!=="uploading"&&D,$t=Y&&I("div",{class:y("preview-delete"),on:{click:function(Ot){Ot.stopPropagation(),o.onDelete(t,i)}}},[I($.Z,{attrs:{name:"cross"},class:y("preview-delete-icon")})]),k=this.slots("preview-cover",(0,h.Z)({index:i},t)),q=k&&I("div",{class:y("preview-cover")},[k]),tt=(c=t.previewSize)!=null?c:this.previewSize,Dt=(g=t.imageFit)!=null?g:this.imageFit,At=W(t)?I(A.Z,{attrs:{fit:Dt,src:t.content||t.url,width:tt,height:tt,lazyLoad:this.lazyLoad},class:y("preview-image"),on:{click:function(){o.onPreviewImage(t)}}},[q]):I("div",{class:y("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[I($.Z,{class:y("file-icon"),attrs:{name:"description"}}),I("div",{class:[y("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url]),q]);return I("div",{class:y("preview"),on:{click:function(){o.$emit("click-preview",t,o.getDetail(i))}}},[At,this.genPreviewMask(t),$t])},genPreviewList:function(){if(this.previewImage)return this.fileList.map(this.genPreviewItem)},genUpload:function(){var t=this.$createElement;if(!(this.fileList.length>=this.maxCount||!this.showUpload)){var i=this.slots(),s=t("input",{attrs:(0,h.Z)({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:y("input"),on:{change:this.onChange}});if(i)return t("div",{class:y("input-wrapper")},[i,s]);var o;if(this.previewSize){var c=this.previewSizeWithUnit;o={width:c,height:c}}return t("div",{class:y("upload"),style:o},[t($.Z,{attrs:{name:this.uploadIcon},class:y("upload-icon")}),this.uploadText&&t("span",{class:y("upload-text")},[this.uploadText]),s])}}},render:function(){var t=arguments[0];return t("div",{class:y()},[t("div",{class:y("wrapper",{disabled:this.disabled})},[this.genPreviewList(),this.genUpload()])])}}),dt=n(927966),vt=n(445061),mt=n(126711),gt=n(56279),pt=n(723400),wt=n(426082),yt=n(67157);const It={mixins:[yt.c],data(){return{config_extend:{config:{}},filter_config:{}}},methods:{filterPredefineColoursSchemeConfig(e,t){this.getNewConfigWithArrary(e,t,this.filter_config)}}};var St=n(17977),Pt=n.n(St),xt=n(148836);const Ct=Pt().create({timeout:1e4});var Et={name:"upload-file",props:["widgetInfo"],components:{Uploader:ft},mixins:[wt.baseConfig,It,vt.u,mt.H,gt.P,pt.j],data(){return{fileList:[],resultUrlList:[],deleteList:[]}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},computed:{...(0,xt.Se)(["getCanvasSetting","isView"])},mounted(){this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},methods:{loadInfo(){this.lifecycleAfterLoad()},reLoadInfo(e){this.loadInfo(e)},initAction(e){this.actionReceive(e)},afterRead(e,{index:t}){let i={};this.deleteList=this.deleteList.map(o=>o!==t);let s=new FormData;s.set("file",e.file),i=s,e.status="uploading",e.message="\u4E0A\u4F20\u4E2D...",Ct.request({method:"post",data:i,headers:{"Content-Type":"multipart/form-data"},url:this.widgetInfo.config.postData.url}).then(o=>{if(e.status="done",e.message="\u4E0A\u4F20\u6210\u529F",o.data.data.url&&(this.resultUrlList[t]=o.data.data.url,this.resultUrlList.filter(g=>!g).length===0)){let g=this.resultUrlList.filter((I,D)=>this.deleteList.indexOf(D)===-1);this.uploadDone(g)}}).catch(()=>{e.status="failed",e.message="\u4E0A\u4F20\u5931\u8D25"})},uploadDone(e){let t=this,i=this.widgetInfo.action.sendOut.actionList;this.$$lib__.each(i,s=>{if(s.enabled&&s.code===t.$$global_editor.actionType.open.code){let o=t.$$global_editor.actionType.open.code+"_"+t.widgetInfo.id,c={urlList:e};s.paramsExtend&&s.paramsExtend.length>0&&this.getExtendParams(c,s.paramsExtend),dt.Z.$emit(o,c),s.postMessage&&this.doPostMessage(c),this.actionNameList.push(o)}})},deleteFile(e,{index:t}){this.deleteList.push(t)},beforeRead(){return!0},oversize(){(0,u.Z)(`\u6587\u4EF6\u5927\u5C0F\u8D85\u8FC7${this.widgetInfo.config.maxSize}KB`)}}},Tt=Et,zt=n(768141),Lt=(0,zt.Z)(Tt,z,E,!1,null,"1cef78e1",null),Mt=Lt.exports}}]);
