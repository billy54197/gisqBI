"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[4292],{56279:function(O,u,l){l.d(u,{P:function(){return v}});var w=l(86892),m=l(49500);const v={mixins:[w.D],created(){},methods:{lifecycleBeforeChartsLoad(p){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&m.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),m.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let y=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[p]);if(y)return y}return p},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&m.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),m.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},74292:function(O,u,l){l.r(u),l.d(u,{default:function(){return F}});var w=function(){var t=this,i=t._self._c;return i("div",{style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}},[i("hide-button",{attrs:{attr:t.widgetInfo.attr}}),i("div",{ref:"sankeySimple",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px"}})],1)},m=[],v=l(44513),p=l(27966),C=l(24553),y=l(56279),b=l(45061),L=l(26711),N=l(99349),$=l(55616),J=l(75770),x=l(67157),I=l(50666);const k={mixins:[x.c],data(){return{config_extend:{config:{series:{label:{fontSize:14}}}},filter_config:{title:JSON.parse(JSON.stringify(I.Z.charts.title)),legend:JSON.parse(JSON.stringify(I.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(I.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(I.Z.charts.toolbox)),series:{colorList:["rgba(76, 132, 255, 0.3)"],levels:[{itemStyle:{normal:{color:"#D13438",borderColor:"#D13438"}}}],label:{color:"#3A4151"},itemColor:[{color:"rgba(76, 132, 255, 0.3)",emphasisColor:"rgba(76, 132, 255, 0.3)"}],itemStyle:{color:"#ec0000",borderColor:"#8A0000",color0:"#00da3c",borderColor0:"#008F28",opacity:1},lineStyle:{opacity:1,color:"source"}}}}},methods:{filterPredefineColoursSchemeConfig(e,t){this.getNewConfigWithArrary(e,t,this.filter_config)}}};var A=l(49500);const D=l(29426);var E={name:"SankeySimple",components:{HideButton:v.Z},mixins:[N.P,y.P,b.u,L.H,C.u,k],props:["widgetInfo"],data(){return{}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=D.init(this.$refs.sankeySimple,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{loadInfo(e){this.getItemColor(e.dataset.type);let t=e.dataset[e.dataset.type].source,i=e.dataset[e.dataset.type].dimensionsAlias,a=e.dataset[e.dataset.type].encode,n=this.getDataList(a,i,t),f=JSON.parse(JSON.stringify(e.config.title)),g=JSON.parse(JSON.stringify(e.config.legend)),d=this.getTooltip(e.config.tooltip),o=JSON.parse(JSON.stringify(e.config.toolbox)),r=JSON.parse(JSON.stringify(e.config.series)),S=JSON.parse(JSON.stringify(e.config.series.label.formatter));r.links=n.links,r.data=this.getSeriesData();let s={legend:g,tooltip:d,toolbox:o,title:f,series:r};if(s.series.data&&s.series.links&&S.c){for(let c=0;c<s.series.data.length;c++){s.series.data[c].value?s.series.data[c].value=0:s.series.data[c]=Object.assign(s.series.data[c],{value:0});for(let h=0;h<s.series.links.length;h++)s.series.data[c].name==s.series.links[h].target&&(s.series.data[c].value=this.addNum(s.series.data[c].value,s.series.links[h].value))}for(let c=0;c<s.series.data.length;c++)if(s.series.data[c].value==0)for(let h=0;h<s.series.links.length;h++)s.series.data[c].name==s.series.links[h].source&&(s.series.data[c].value=this.addNum(s.series.data[c].value,s.series.links[h].value))}s.series.label.formatter=this.getFormatterString(S),s.series.type="sankey",this.getAnimation(s,e),this.setOption(s),this.setAnimationLoop(e,()=>{this.setOption(s,e)})},setOption(e){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(e),{notMerge:!0})},getLength(e){let t;try{const i=e.toString();if(i.search("e")!==-1){const a=parseInt(i.split("e")[1]);t=Math.abs(a)}else t=e.toString().split(".")[1].length}catch{t=0}return t},addNum(e,t){let i,a,n;return i=this.getLength(e),a=this.getLength(t),n=Math.pow(10,Math.max(i,a)+1),(e*n+t*n)/n},getItemColor(e){let t=this,i=[];t.widgetInfo.config.series.itemColor&&t.widgetInfo.config.series.itemColor.length>0?i=JSON.parse(JSON.stringify(t.widgetInfo.config.series.itemColor)):i=t.widgetInfo.config.series.colorList,t.widgetInfo.config.series.itemColor=[];let a=t.widgetInfo.dataset[e].source,n=t.widgetInfo.dataset[e].dimensionsAlias,f=t.widgetInfo.dataset[e].encode,g=this.getDataList(f,n,a);this.$$lib__.each(g.data,(d,o)=>{if(!d.name){t.widgetInfo.config.series.itemColor.push({name:"",color:i[o].color,emphasisColor:i[o].color});return}if(i&&i[o]&&i[o].color)t.widgetInfo.config.series.itemColor.push({name:d.name,color:i[o].color,emphasisColor:i[o].color});else{let r=t.widgetInfo.config.series.colorList;t.widgetInfo.config.series.itemColor.push({name:d.name,color:r[o]?r[o]:r[o%r],emphasisColor:r[o]?r[o]:r[o%r]})}})},getSeriesData(){let e=[];if(this.widgetInfo.config.series.dataItemStyle.itemStyleType=="simple")this.$$lib__.each(this.widgetInfo.config.series.itemColor,t=>{e.push({name:t.name,itemStyle:{normal:{color:t.color},emphasis:{color:t.emphasisColor}}})});else if(this.widgetInfo.config.series.dataItemStyle.itemStyleType=="multiple"){let t=this.widgetInfo.config.series.dataItemStyle.nodeStyle.length;this.$$lib__.each(this.widgetInfo.config.series.itemColor,(i,a)=>{if(t>0){let n=this.$$lib__.find(this.widgetInfo.config.series.dataItemStyle.nodeStyle,f=>f.name&&f.name!=""&&f.name==i.name);if(n)e.push(JSON.parse(JSON.stringify(n)));else{let f={};if(a<t)f=JSON.parse(JSON.stringify(this.widgetInfo.config.series.dataItemStyle.nodeStyle[a]));else{let g=parseInt(a%t);f=JSON.parse(JSON.stringify(this.widgetInfo.config.series.dataItemStyle.nodeStyle[g]))}f.name=i.name,e.push(f)}}else e.push({name:i.name})})}return e},getLegendData(e,t){let i=[];return this.$$lib__.each(e,a=>{a.name&&i.push(a.name)}),this.$$lib__.each(t,a=>{a.name&&i.push(a.name)}),i},reLoadInfo(e){e&&(this.$refs.sankeySimple.style.width=e.attr.w+"px",this.$refs.sankeySimple.style.height=e.attr.hh+"px"),this.loadInfo(e),this.echarts.resize()},getDataList(e,t,i){let a=null,n=null,f=null,g=[],d=[];return this.$$lib__.each(t,(o,r)=>{o.name==e.key&&(a=r),o.name==e.linkKey&&(n=r),o.name==e.value&&(f=r)}),this.$$lib__.each(i,o=>{g.push({source:o[a],target:o[n],value:o[f]});let r=this.$$lib__.find(d,s=>s.name==o[a]);o[a]!=""&&!r&&d.push({name:o[a]});let S=this.$$lib__.find(d,s=>s.name==o[n]);o[n]!=""&&!S&&d.push({name:o[n]})}),{links:g,data:d}},initAction(e){this.actionSendout(e),this.actionReceive(e)},actionSendout(e){let t=this;this.$$lib__.each(e.action.sendOut.actionList,i=>{if(i.enabled){let a=i.code+"_"+e.id;if(i.paramsExtend&&i.paramsExtend.length>0){let n={};this.getParamsExtend(n,i.paramsExtend,e)}i.code==J.Z.click.code&&t.onClick(a,i)}})},onClick(e,t){let i=this;i.echarts.on("click",a=>{let n={};if(n.value=a.value,t.script&&t.script.enabled){if(A.log("Execute script for "+i.widgetInfo.name+" component to "+t.name+" component"),t.script.content==""){$.Message.warning({message:t.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",t.script.content),n=this.customScript(n)}p.Z.$emit(e,n),t.postMessage&&i.doPostMessage(n),i.actionNameList.push(e)})}}},M=E,P=l(68141),Z=(0,P.Z)(M,w,m,!1,null,"bb0f87d0",null),F=Z.exports}}]);
