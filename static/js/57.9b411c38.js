"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[57],{56279:function(E,v,g){g.d(v,{P:function(){return D}});var J=g(86892),x=g(49500);const D={mixins:[J.D],created(){},methods:{lifecycleBeforeChartsLoad(L){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&x.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),x.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let A=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[L]);if(A)return A}return L},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&x.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),x.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},10057:function(E,v,g){g.r(v),g.d(v,{default:function(){return et}});var J=function(){var s=this,e=s._self._c;return e("div",{style:{width:s.widgetInfo.attr.w+"px",height:s.widgetInfo.attr.hh+"px",overflow:"hidden"}},[e("hide-button",{attrs:{attr:s.widgetInfo.attr}}),e("div",{ref:"pictorialBar",style:{width:s.widgetInfo.attr.w+"px",height:s.widgetInfo.attr.hh+"px"}})],1)},x=[],D=g(44513),L=g(11334),X=g(56279),A=g(45061),Z=g(26711),T=g(99349),M=g(27966),V=g(55616),U=g(75770),H=g(67157),u=g(50666);const G={mixins:[H.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(u.Z.charts.title)),legend:JSON.parse(JSON.stringify(u.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(u.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(u.Z.charts.toolbox)),xAxis:JSON.parse(JSON.stringify(u.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(u.Z.charts.yAxis)),series:{label:{color:"#000999"},itemStyle:{colorInfo:{type:"gradation",pureColor:"",gradation:{start:"rgba(20, 122, 217,0.1)",end:"rgba(20, 122, 217, 1)"}},opacity:1}},barList:[{series:{label:{color:"#3A4151"},itemStyle:{colorInfo:{type:"gradation",pureColor:"rgba(52, 152, 219, 1)",gradation:{start:"rgba(76, 132, 255, 0.1)",end:"rgba(76, 132, 255, 1)"}},opacity:1}}}]}}},methods:{filterPredefineColoursSchemeConfig(t,s){if(this.getNewConfigWithArrary(t,s,this.filter_config),s.barList.length==0)for(let e=0;e<t.barList.length;e++)this.getNewConfigWithArrary(t.barList[e].series,this.filter_config.series,this.filter_config.series)}}};var K=g(21300),C=g(49500);const Q=g(29426);var k={name:"PictorialBar",components:{HideButton:D.Z},mixins:[X.P,A.u,Z.H,T.P,L.u,G],props:["widgetInfo"],data(){return{alias:"",indexX:-1,indexY:-1,rangeX:0,rangeY:0,mydata:[]}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=Q.init(this.$refs.pictorialBar,null,{devicePixelRatio:2}),this.loadInfo(this.widgetInfo),this.initAction(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{initAction(t){this.actionSendout(t),this.actionReceive(t)},getBarList(t){let s=JSON.parse(JSON.stringify(t.config.series));this.indexX>-1&&this.$$lib__.each(this.mydata,(e,n)=>{t.config.barList[n]&&t.config.barList[n].name==e.xValue||(t.config.barList.length=this.mydata.length,t.config.barList[n]={index:n+1,name:e.xValue,series:JSON.parse(JSON.stringify(s))})})},loadInfo(t){let s=this.getTitle(t.config.title),e=this.getLegend(t.config.legend),n=this.getGrid(t.config.grid),r=this.getTooltip(t.config.tooltip),a=JSON.parse(JSON.stringify(t.config.toolbox)),i=this.getyAxis(t.config.yAxis),d=this.getxAxis(t.config.xAxis);d.axisTick.lineStyle.color=this.getColorInfo(d.axisTick.lineStyle.colorInfo),i.axisTick.lineStyle.color=this.getColorInfo(i.axisTick.lineStyle.colorInfo),d.axisLine.lineStyle.color=this.getColorInfo(d.axisLine.lineStyle.colorInfo),i.axisLine.lineStyle.color=this.getColorInfo(i.axisLine.lineStyle.colorInfo),this.calAllDatas(t),this.getBarList(this.widgetInfo),this.$nextTick(()=>{let c=this.getData(t),f=c.dataItem,I=c.dataImg,o=t.config.series;o.itemStyle.color=this.getColor(o.itemStyle.colorInfo),o.itemStyle.shadowColor=o.itemStyle.shadowColor?o.itemStyle.shadowColor:"transparent";let W=JSON.parse(JSON.stringify(o.label));W.formatter=this.getFormatterString(o.label.formatter);let $=this.getBgSeries(),O={type:"pictorialBar",name:this.alias,data:f,label:W,itemStyle:o.itemStyle,barWidth:o.barWidth?`${o.barWidth}%`:null,symbol:this.getSymbol(o.symbol),symbolSize:o.symbolSizePercent?[o.symbolSize[0]+"%",o.symbolSize[1]+"%"]:[o.symbolSize[0],o.symbolSize[1]],symbolPosition:o.symbolPosition,symbolOffset:this.getSymbolOffset(o.symbolOffset),symbolRotate:o.symbolRotate,symbolRepeat:o.symbolRepeat,symbolRepeatDirection:o.symbolRepeatDirection?"start":"end",symbolMargin:o.symbolMargin,symbolClip:o.symbolClip,animationDelay:function(y,b){return b.index*300}};o.symbolClip&&(O.symbolSizePercent=!1,O.symbolBoundingData=this.rangeY[1]),O.symbol!=""&&$.push(O);let S={name:this.alias+"img",type:"pictorialBar",barGap:"-100%",symbolPosition:"end",barWidth:O.barWidth?`${O.barWidth}%`:null,symbolSize:["100%","100%"],symbolOffset:[0,0],data:I};if(t.config.forceDefault)if(t.config.series.topImgType==="custom"&&t.config.series.topImgCustomList&&t.config.series.topImgCustomList.length>0){S.type="custom";let y=t.config.series.topImgCustomList,b=this;S.renderItem=function(p,h){const N=h.coord([h.value(0),h.value(1)]);let j=h.size([1,b.rangeY[1]]),P=j[0]*(t.config.series.barWidth?t.config.series.barWidth/100:1),B=j[1],R=b.mydata[p.dataIndex].data,Y=[];for(let F=y.length-1;F>=0;F--){let l=y[F];if(!l.disabled)if(l.type=="text"){let m="";if(l.textStyle.script&&l.textStyle.script.enabled&&l.textStyle.script.content)try{b.textFunc=new Function("index","value","data",l.textStyle.script.content),m=b.textFunc(h.value(0),h.value(1),R)||""}catch(z){C.error("\u81EA\u5B9A\u4E49\u9876\u90E8\u5143\u7D20\uFF0C\u751F\u6210\u6587\u672C\u811A\u672C\u8FD0\u884C\u5931\u8D25",z)}else m=l.textStyle.text,m&&(m=m.replaceAll(/\\n/g,`
`),Object.keys(R).forEach(z=>{m=m.replace(`{${z}}`,R[z]||"")}));Y.push({type:"text",style:{text:m,x:l.textStyle.x?P/100*l.textStyle.x:0,y:l.textStyle.y?B/100*l.textStyle.y:0,textFont:h.font({fontWeight:l.textStyle.fontWeight||"normal",fontStyle:l.textStyle.fontStyle||"",textDecoration:"",fontSize:l.textStyle.fontSize||14,fontFamily:l.textStyle.fontFamily||"\u9ED1\u4F53"}),textAlign:l.textStyle.textAlign||"center",textVerticalAlign:l.textStyle.textVerticalAlign||"center",fill:l.textStyle.colorList&&l.textStyle.colorList.length>0?l.textStyle.colorList[p.dataIndex%l.textStyle.colorList.length]:"#FFF"},position:N})}else{let m=[l.imageStyle.x?`${l.imageStyle.x}%`:0,l.imageStyle.y?`${l.imageStyle.y}%`:0];Y.push({type:"image",style:{textConfig:{position:m},image:(0,K.appendImageBaseURL)(l.imageStyle.url),x:l.imageStyle.x?P/100*l.imageStyle.x:0,y:l.imageStyle.y?B/100*l.imageStyle.y:0,width:P/100*l.imageStyle.width,height:B/100*l.imageStyle.height},position:N})}}return{type:"group",children:Y}}}else{t.config.series.topImgType==="img"&&(S.symbol=this.getSymbolURL(t.config.series.topImg));let y=t.config.series.topImgSizePercent?"%":"";S.symbolSize=S.symbol?[`${t.config.series.topImgWidth||0}${y}`,`${t.config.series.topImgHeight||0}`]:[0,0],S.symbolOffset=S.symbol?[t.config.series.topImgOffsetX?`${t.config.series.topImgOffsetX}%`:0,t.config.series.topImgOffsetY?`${t.config.series.topImgOffsetY}%`:0]:[0,0]}$.push(S);let w={title:s,legend:e,grid:n,xAxis:Object.assign(JSON.parse(JSON.stringify(d)),this.getXAxisData(f)),yAxis:i,tooltip:r,toolbox:a,series:$};if(t.config.dataZoom&&t.config.dataZoom.type&&(w.dataZoom=t.config.dataZoom),o.emphasis)try{let y=o.emphasis;if(y.script&&y.script.enabled){if(y.script.content){let b=new Function("index","item","data",y.script.content),p=w.series[0].data;if(p&&p.length>0)for(let h=0;h<p.length;++h)try{p[h].emphasis=b.call(this,h,p[h],p)}catch(N){C.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",N)}}}else o.emphasis.itemStyle&&o.emphasis.itemStyle.color&&(w.series[0].emphasis={itemStyle:{...o.emphasis.itemStyle}})}catch(y){C.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",y)}this.getAnimation(w,t),this.setOption(w),this.setAnimationLoop(t,()=>{this.setOption(w,t)})})},setOption(t){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0})},getXAxisData(t){let s={data:[]};return t.forEach(e=>{s.data.push(e.name)}),s},calAllDatas(t){this.indexX=-1,this.indexY=-1,this.rangeX=[0,0],this.rangeY=[0,0],this.mydata=[];let s=t.dataset[t.dataset.type].encode,e=t.dataset[t.dataset.type].dimensionsAlias,n=t.dataset[t.dataset.type].source,r=t.dataset[t.dataset.type].columnList;if(e)for(let a=e.length;a--;)s.x&&e[a].name==s.x&&(this.indexX=a),s.y&&e[a].name==s.y&&(this.indexY=a,this.alias=e[a].alias);if(n&&n.length>0){let a=[],i=[];for(let d=0;d<n.length;d++){let c={};for(let f=0;f<r.length;++f)c[r[f].name]=n[d][r[f].index];this.mydata.push({value:n[d][this.indexY]-0,xValue:n[d][this.indexX],data:JSON.parse(JSON.stringify(c))}),a.push(n[d][this.indexY]-0),i.push(d)}this.echarts.setOption({xAxis:{type:"category",data:i},yAxis:{type:"value"},series:[{type:"bar",itemStyle:{color:"rgba(0,0,0,0)"},name:"cal-max",data:a}]}),this.rangeY=this.echarts.getModel().getComponent("yAxis").axis.scale._extent,this.rangeX=this.echarts.getModel().getComponent("xAxis").axis.scale._extent,this.echarts.clear()}C.debug("calAllData:",this.mydata,this.indexX,this.indexY,this.rangeX,this.rangeY)},getSymbol(t){if(t){let s=t.path;return t.type=="img"&&t.path!=""&&(s=this.getSymbolURL(t.path)),t.type=="svg"&&t.path!=""&&(s=t.path.indexOf("path://")==-1?"path://"+t.path:t.path),s}return""},getColor(t){let s={};return t.type=="pureColor"?s=t.pureColor:(t.direction=="linear"&&(s={type:t.direction,x:t.linear.x,y:t.linear.y,x2:t.linear.x2,y2:t.linear.y2,colorStops:[{offset:0,color:t.gradation.start?t.gradation.start:"#e54035"},{offset:1,color:t.gradation.end?t.gradation.end:"#e54035"}]}),t.direction=="radial"&&(s={type:t.direction,x:t.radial.x,y:t.radial.y,r:t.radial.r,colorStops:[{offset:0,color:t.gradation.start?t.gradation.start:"#e54035"},{offset:1,color:t.gradation.end?t.gradation.end:"#e54035"}]})),s},getData(t){let s=[],e=[];if(this.mydata&&this.mydata.length>0)for(let r=0;r<this.mydata.length;r++){let a={name:this.mydata[r].xValue,value:this.mydata[r].value,mydata:this.mydata[r].data},i={};t.config.forceDefault||(t.config.barList[r]&&t.config.barList[r].series?i=JSON.parse(JSON.stringify(t.config.barList[r].series)):i=JSON.parse(JSON.stringify(t.config.barList[0].series)),delete i.label,i.symbol=this.getSymbol(i.symbol),i.symbolRepeatDirection=i.symbolRepeatDirection?"start":"end",i.symbolSize=i.symbolSizePercent?[i.symbolSize[0]+"%",i.symbolSize[1]+"%"]:[i.symbolSize[0],i.symbolSize[1]],i.symbolOffset=[i.symbolOffset[0]?i.symbolOffset[0]:this.widgetInfo.config.series.symbolOffset[0],i.symbolOffset[1]?i.symbolOffset[1]:this.widgetInfo.config.series.symbolOffset[1]],i.itemStyle.shadowColor=i.itemStyle.shadowColor?i.itemStyle.shadowColor:"transparent",i.itemStyle.color=this.getColor(i.itemStyle.colorInfo),i.symbolClip&&(i.symbolSizePercent=!1,i.symbolBoundingData=this.rangeY[1]));let d=Object.assign(a,i);s.push(d);let c={};if(c.value=this.mydata[r].value,!this.widgetInfo.config.forceDefault){c.symbol=this.getSymbolURL(i.topImg);let f=i.topImgSizePercent?"%":"";if(c.symbolSize=c.symbol?[`${i.topImgWidth}${f}`,`${i.topImgHeight}`]:[0,0],c.symbolOffset=[i.topImgOffsetX?`${i.topImgOffsetX}%`:0,i.topImgOffsetY?`${i.topImgOffsetY}%`:0],!c.symbol&&e.length>0)for(let I=e.length-1;I>0;I--)e[I].symbol&&(c.symbol=e[I].symbol)}e.push(c)}return{dataItem:s,dataImg:e}},reLoadInfo(t){t&&(this.$refs.pictorialBar.style.width=t.attr.w+"px",this.$refs.pictorialBar.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},actionSendout(t){let s=this;this.$$lib__.each(t.action.sendOut.actionList,e=>{if(e.enabled){let n=e.code+"_"+t.id;if(e.paramsExtend&&e.paramsExtend.length>0){let r={};this.getParamsExtend(r,e.paramsExtend,t)}e.code==U.Z.click.code&&s.onClick(n,e)}})},onClick(t,s){let e=this;e.echarts.on("click",n=>{let r={};r.x=n.name,r.y=n.value;let a=[],i=e.widgetInfo.action.sendOut.actionList;if(e.widgetInfo.dataset[e.widgetInfo.dataset.type].source&&e.widgetInfo.dataset[e.widgetInfo.dataset.type].source.length>0&&(a=e.widgetInfo.dataset[e.widgetInfo.dataset.type].source[n.dataIndex]),e.getExtendParams(r,i[0].paramsExtend,a,e.widgetInfo.dataset[e.widgetInfo.dataset.type].dimensions),s.script&&s.script.enabled){if(C.log("Execute script for "+e.widgetInfo.name+" component to "+s.name+" component"),s.script.content==""){V.Message.warning({message:s.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",s.script.content),r=this.customScript(r)}M.Z.$emit(t,r),s.postMessage&&e.doPostMessage(r),e.actionNameList.push(t)})},getBgSeries(){let t=[],s=JSON.parse(JSON.stringify(this.widgetInfo.config.series));if(this.widgetInfo.config.bgList&&this.widgetInfo.config.bgList.length>0){let e=this.widgetInfo.config.bgList;for(let n=e.length-1;n>=0;n--){let r=[];if(this.mydata&&this.mydata.length>0)for(let i=0;i<this.mydata.length;i++)r.push({name:this.mydata[i].xValue,value:e[n].useValue?this.mydata[i].value:this.rangeY[1]});let a=JSON.parse(JSON.stringify(e[n].series));a.symbol=this.getSymbol(a.symbol),a.symbol!=""&&(a.type="pictorialBar",a.name=`bg${n}`,a.data=r,a.label={show:!1},a.tooltip={show:!1},a.itemStyle.shadowColor=a.itemStyle.shadowColor?a.itemStyle.shadowColor:"transparent",a.itemStyle.color=this.getColor(a.itemStyle.colorInfo),a.barWidth=s.barWidth?`${s.barWidth}%`:null,e[n].useValue?a.symbolSize=a.symbolSizePercent?[a.symbolSize[0]+"%","100%"]:[a.symbolSize[0],"100%"]:a.symbolSize=a.symbolSizePercent?[a.symbolSize[0]+"%",a.symbolSize[1]+"%"]:[a.symbolSize[0],a.symbolSize[1]],a.symbolRepeatDirection=a.symbolRepeatDirection?"start":"end",a.animationDelay=function(i,d){return d.index*300},t.push(a))}}return t},getSymbolOffset(t){if(t&&t instanceof Array&&t.length!=0){let s=0,e=0;t.length==1?s=t[0]&&t[0]!=null&&t[0]!=""?t[0]:0:(s=t[0]&&t[0]!=null&&t[0]!=""?t[0]:0,e=t[1]&&t[1]!=null&&t[1]!=""?t[1]:0),t=[s,e]}else t=[0,0];return t}}},q=k,_=g(68141),tt=(0,_.Z)(q,J,x,!1,null,"b47e3018",null),et=tt.exports}}]);
