"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[45061],{445061:function(P,L,m){m.d(L,{u:function(){return D}});var u=m(927966),x=m(148836),S=m(42160),g=m(555616),O=m.n(g),$=m(386892),f=m(149500);const D={mixins:[$.D],data(){return{Message:g.Message}},created(){},computed:{...(0,x.Se)(["getCanvasSetting","getCanvasSettingInfo"])},methods:{...(0,x.nv)(["addChildInitFinish"]),actionReceive(i){if(i.action==null||i.action.receive==null)return;let s=i.action.receive.replaceParams;if(s&&s.enabled){let y=s.replaceList;this.doParams(y,i)}let t=i.action.receive.reloadLocalData;t&&t.enabled&&t.reloadList&&t.reloadList.length>0&&this.doReloadLocalData(t.reloadList,t.value,t.script,i.name);let n=i.action.receive.replaceSource;if(n&&n.enabled){let y=n.replaceList;this.doSource(y,i)}let e=i.action.receive.replaceText;if(e&&e.enabled){let y=e.replaceList;this.doChangeText(y,i)}let a=i.action.receive.show;a&&a.enabled&&a.showList&&a.showList.length>0&&this.doActionShowOrHide(a.showList,a.value,a.script,i.name,"show",a.values?a.values:[]);let r=i.action.receive.hide;r&&r.enabled&&r.hideList&&r.hideList.length>0&&this.doActionShowOrHide(r.hideList,r.value,r.script,i.name,"hide",r.values?r.values:[]);let l=i.action.receive.showHide;l&&l.enabled&&l.showHideList&&l.showHideList.length>0&&this.doActionShowOrHide(l.showHideList,l.value,l.script,i.name,"showHide",l.values?l.values:[]);let o=i.action.receive.start;o&&o.enabled&&o.startList&&o.startList.length>0&&this.doActionStartOrPause(o.startList,o.value,o.script,i.name,!1);let c=i.action.receive.pause;c&&c.enabled&&c.pauseList&&c.pauseList.length>0&&this.doActionStartOrPause(c.pauseList,c.value,c.script,i.name,!0);let d=i.action.receive.replacePage;d&&d.enabled&&d.pageList&&d.pageList.length>0&&this.doPage(d.pageList,i);let h=i.action.receive.replaceCheckVal;h&&h.enabled&&h.replaceList&&h.replaceList.length>0&&this.doReplaceCheckVal(h.replaceList,h.script,i,this);let p=i.action.receive.configMap;p&&p.enabled&&p.mapList&&p.mapList.length>0&&this.doConfig(p.mapList,i);const w=i.action.receive.preview;w&&w.enabled&&w.previewList&&w.previewList.length&&this.doActionPreview(w);const _=i.action.receive.formSubmit;_&&_.enabled&&_.formSubmitList&&_.formSubmitList.length&&this.doActionFormSubmit(_);let b=i.action.receive.receiveGlobalTitle;b&&b.enabled&&b.receiveGlobalTitleList&&b.receiveGlobalTitleList.length>0&&this.doReceiveGlobalTitle(b,i.name);let v=i.action.receive.replaceSelectDate;v&&v.enabled&&v.widgetsList&&v.widgetsList.length>0&&this.doReceiveReplaceSelectDate(v,i.name),this.addChildInitFinish()},doReceiveGlobalTitle(i,s){this.$$lib__.each(i.receiveGlobalTitleList,t=>{let n=t[0][1]+"_"+t[0][0];t[0][1].indexOf("_")>-1&&(n=t[0][1]),u.Z.$on(n,e=>{let a=t[0][2],r=a.indexOf("|");if(r>-1&&(a=t[0][2].substring(r+1)),i.script&&i.script.enabled){if(f.log("Execute script for "+s+" component to "+i.name+" component"),i.script.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.globalTitle=new Function("data","param_key",i.script.content)}this.globalTitle(e,a)})})},globalTitle(i,s){this.widgetInfo.title.h==null&&this.$message.info("\u8BF7\u914D\u7F6E\u63A5\u6536\u5BB9\u5668\u5168\u5C40\u6807\u9898\u7684\u9AD8\u5EA6"),this.widgetInfo.title.text=i[s]},registerAction(i,s,t,n){let e=i.action.receive[s];e&&e.enabled&&e[t]&&e[t].length>0&&this.doConfig2(e[t],i,e,n)},doParams(i,s){let t={};if(this.$$lib__.each(i,n=>{let e=n.replaceParam;for(let a=0;a<e.length;a++)if(e[a].length==3){let r=e[a][1]+"_"+e[a][0],l=e[a][2],o=l.indexOf("|");e[a][1].indexOf("_")>-1&&(r=e[a][1]),o>-1&&(l=e[a][2].substring(o+1)),t[r]||S.default.set(t,r,{}),t[r][n.param]||S.default.set(t[r],n.param,l)}}),!this.$$lib__.isEmpty(t))for(let n in t)u.Z.$on(n,e=>{(s.dataset.dynamic.query==null||!s.dataset.dynamic.query.params==null)&&(s.dataset.dynamic.query={params:[],page:{enabled:!1,pageNum:1,pageSize:10},orders:[]});let a=!0,r=!1;if(s.action.receive.replaceParams.script&&s.action.receive.replaceParams.script.enabled){if(r=!0,f.log("Execute script for "+s.name+" component to replace dataset parameters"),s.action.receive.replaceParams.script.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60}),a=!1;return}this.doActionParams=new Function("info","data","param_key",s.action.receive.replaceParams.script.content)}a&&(this.doActionParams(s,e,t[n]),r&&f.log("Replace data set parameter of "+s.name+" component Script execution complete"))})},doReloadLocalData(i,s,t,n){i&&i.length<1||this.$$lib__.each(i,e=>{if(e&&e.length<1)return;let a=e[0][1]+"_"+e[0][0];e[0][1].indexOf("_")>-1&&(a=e[0][1]),u.Z.$on(a,r=>{let l=e[0][2];if(l){let d=l.indexOf("|");d>-1&&(l=e[0][2].substring(d+1))}let o=!0,c=!1;if(t&&t.enabled){if(c=!0,f.log("Execute script for "+n+" component to reloadLocalData component"),t.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.doLocalData=new Function("data","param_key","value",t.content)}o&&(this.doLocalData(r,l,s),c&&f.log("reloadLocalData component of "+n+" component Script execution complete"))})})},doSource(i,s){this.$$lib__.each(i,t=>{let n=t[0][1];u.Z.$on(n,e=>{s.action.receive.replaceSource.script&&s.action.receive.replaceSource.script.enabled&&(f.log("Execute the script to execute model to the "+s.name+" component"),this.doActionSource=new Function("info","data","action",s.action.receive.replaceSource.script.content)),this.doActionSource(s,e,t)})})},doChangeText(i,s){this.$$lib__.each(i,t=>{let n=t[0][1],e=t[0][2];if(e){let a=e.indexOf("|");a>-1&&(e=t[0][2].substring(a+1))}u.Z.$on(n,a=>{s.action.receive.replaceText.script&&s.action.receive.replaceText.script.enabled&&(f.log("Execute the script to execute model to the "+s.name+" component"),this.doActionText=new Function("info","data","param_key",s.action.receive.replaceText.script.content)),this.doActionText(s,a,e)})})},doActionSource(i,s,t){f.debug(t);let n=[],e=1;this.$$lib__.each(s.data,a=>{let r=JSON.parse(a),l={};r&&(l=JSON.parse(JSON.stringify(r.properties)),l.dkxh=e,l.dkid=l.DK_GUID,l.dkyt=l.DK_YT==""?"\u5DE5\u4E1A\u7528\u5730":l.DK_YT,l.dkmc=l.DK_MC,l.dkmj=(l.SHAPE_AREA*(15/1e4)).toFixed(4),l.tdzl=l.TD_ZL),n.push(l),e++}),this.resetSource(n)},doActionText(i,s,t){if(t)this.textInfo=s[t];else{for(let n in s)i.dataset[i.dataset.type].source[0][0]=s[n];this.reLoadInfo(i)}},doReceiveReplaceSelectDate(i,s){if(i.widgetsList&&i.widgetsList.length<1)return;const t=i.script,n={today:{index:"1",handler(){return[new Date,new Date]}},week:{index:"2",handler(){let e=new Date,a=e.getDay(),r=e.getDate(),l=e.getMonth(),o=e.getFullYear();return[new Date(o,l,r-a),new Date(o,l,r+6-a)]}},mouth:{index:"3",handler(){let e=new Date,a=e.getMonth(),r=e.getFullYear();return[new Date(r,a,1),new Date(r,a+1,0)]}},quarter:{index:"4",handler(){let e=new Date,a=e.getMonth(),r=e.getFullYear(),l=Math.ceil((a+1)/3);return[new Date(r,(l-1)*3,1),new Date(r,l*3,0)]}},year:{index:"5",handler(){let a=new Date().getFullYear();return[new Date(a,0,1),new Date(a,11,31)]}}};this.$$lib__.each(i.widgetsList,e=>{let a=e.widget;if(a&&a.length<1)return;const r=a[1],l=this.widgetInfo.config&&this.widgetInfo.config.type&&this.widgetInfo.config.type.indexOf("range")>-1;u.Z.$on(r,o=>{const c={DateType:n,getHandler(d){return d=d+"",n[d]||n[Object.keys(n).find(h=>n[h].index===d)||"undefined"]}};if(t&&t.enabled){if(f.log("Execute script for "+s+" component to "+r+" component"),t.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.doReceiveReplaceSelectDateFunc=this.doReceiveReplaceSelectDateFunc||new Function("data","action","isRange","utils",t.content),this.doReceiveReplaceSelectDateFunc(o,e,l,c);return}if(e.fieldType&&o[e.fieldType]){const d=c.getHandler(o[e.fieldType]);if(d){let h=d.handler();this.dateValue=l?h:h[0],this.onChange()}}else if(e.field||e.fieldEnd){let d=e.field&&o[e.field],h=e.fieldEnd&&o[e.fieldEnd];try{d&&(d=new Date(d)),h&&(h=new Date(h)),this.dateValue=l?[d,h||d]:d,this.onChange()}catch(p){f.error(p)}}})})},resetSource(i){this.widgetInfo.dataset.type;let s=this.widgetInfo.dataset[this.widgetInfo.dataset.type].dimensions;this.widgetInfo.dataset[this.widgetInfo.dataset.type].source=[],s&&s.length>0&&this.$$lib__.each(i,t=>{let n=[];for(let e=0;e<s.length;e++)n.push(t[s[e]]);this.widgetInfo.dataset[this.widgetInfo.dataset.type].source.push(n)}),this.reLoadInfo(this.widgetInfo)},doActionShowOrHide(i,s,t,n,e,a){i&&i.length<1||this.$$lib__.each(i,r=>{if(r&&r.length<1)return;let l=r[0][1]+"_"+r[0][0];r[0][1].indexOf("_")>-1&&(l=r[0][1]),u.Z.$on(l,o=>{f.debug(o);let c=r[0][2];if(c){let p=c.indexOf("|");p>-1&&(c=r[0][2].substring(p+1))}let d=!0,h=!1;if(t&&t.enabled){if(h=!0,f.log("Execute script for "+n+" component to "+e+" component"),t.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60}),d=!1;return}e=="show"&&(this.doShow=new Function("data","param_key","value","values",t.content)),e=="hide"&&(this.doHide=new Function("data","param_key","value","values",t.content)),e=="showHide"&&(this.doShowHide=new Function("data","param_key","value","values",t.content))}d&&(e=="show"&&this.doShow(o,c,s,a),e=="hide"&&this.doHide(o,c,s,a),e=="showHide"&&this.doShowHide(o,c,s,a),h&&f.log(e+" component of "+n+" component Script execution complete"))})})},doShow(i,s,t,n){let e=[];e.push(t),n&&(e=e.concat(n)),e.forEach(a=>{(a==null||a==null||a==""||a==i[s])&&(this.widgetInfo.attr.hide=!1)})},doHide(i,s,t,n){let e=[];e.push(t),n&&(e=e.concat(n)),e.forEach(a=>{(a==null||a==null||a==""||a==i[s])&&(this.widgetInfo.attr.hide=!0)})},doShowHide(i,s,t,n){let e=[];e.push(t),n&&(e=e.concat(n)),e.forEach(a=>{(a==null||a==null||a==""||a==i[s])&&(this.widgetInfo.attr.hide=!this.widgetInfo.attr.hide)})},doPreview(i,s){this.setPreviewSrcList(i[s])},doFormSubmit(i,s,t){t==null||t==""||t==null?this.gisqFormTriggerEvent("formSubmit"):i[s]===t&&this.gisqFormTriggerEvent("formSubmit")},doActionStartOrPause(i,s,t,n,e){i&&i.length<1||this.$$lib__.each(i,a=>{if(a&&a.length<1)return;let r=a[0][1]+"_"+a[0][0];a[0][1].indexOf("_")>-1&&(r=a[0][1]),u.Z.$on(r,l=>{f.debug(l);let o=a[0][2];if(o){let p=o.indexOf("|");p>-1&&(o=a[0][2].substring(p+1))}let c=e==!0?"start":"pause",d=!0,h=!1;if(t&&t.enabled){if(h=!0,f.log("Execute script for "+n+" component to "+c+" component"),t.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60}),d=!1;return}e?this.doPause=new Function("data","param_key","value",t.content):this.doStart=new Function("data","param_key","value",t.content)}d&&(e?this.doPause(l,o,s):this.doStart(l,o,s),h&&f.log(c+" component of "+n+" component Script execution complete"))})})},doStart(i,s,t){t==null||t==""||t==null?this.widgetInfo.attr.pause=!1:t==i[s]&&(this.widgetInfo.attr.pause=!1)},doPause(i,s,t){t==null||t==""||t==null?this.widgetInfo.attr.pause=!0:t==i[s]&&(this.widgetInfo.attr.pause=!0)},doPage(i,s){this.$$lib__.each(i,t=>{let n=t.widget[1];u.Z.$on(n,e=>{this.doReplacePage(s,t,e)})})},doReplaceCheckVal(i,s,t){let n={};if(this.$$lib__.each(i,e=>{for(let a=0;a<e.length;a++)if(e[a].length==3){let r=e[a][1]+"_"+e[a][0],l=e[a][2],o=l.indexOf("|");e[a][1].indexOf("_")>-1&&(r=e[a][1]),o>-1&&(l=e[a][2].substring(o+1)),n[r]||S.default.set(n,r,{}),n[r][l]||S.default.set(n[r],l,l)}}),!this.$$lib__.isEmpty(n))for(let e in n)u.Z.$on(e,a=>{let r=!0,l=!1;if(t.action.receive.replaceCheckVal.script&&t.action.receive.replaceCheckVal.script.enabled){if(l=!0,f.log("Execute script for "+t.name+" component to replace dataset parameters"),t.action.receive.replaceCheckVal.script.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60}),r=!1;return}this.doActionRepCheckVal=new Function("data","checkboxInfo","param_key",t.action.receive.replaceCheckVal.script.content)}if(r){let o=this.doActionRepCheckVal(a,this.checkboxInfo,n[e]);this.checkedValues=o,this.changecheckboxGroup(o),l&&f.log("Replace data set parameter of "+t.name+" component Script execution complete")}})},doActionRepCheckVal(i,s,t){let n=[];for(let e in t)for(let a in i)t[e]==a&&this.$$lib__.each(s,r=>{if(Array.isArray(i[a]))for(let l=0;l<i[a].length;l++)i[a][l]==r.value&&n.push(i[a][l]);else i[a]==r.value&&n.push(i[a])});return n},doConfig(i,s){this.$$lib__.each(i,t=>{if(t&&t.length<1)return;let n=t[0][1]+"_"+t[0][0];t[0][1].indexOf("_")>-1&&(n=t[0][1]),u.Z.$on(n,e=>{let a=t[0][2];if(a){let r=a.indexOf("|");r>-1&&(a=t[0][2].substring(r+1))}this.doConfigMap(s,e,a)})})},doConfig2(i,s,t,n){this.$$lib__.each(i,e=>{if(e&&e.length<1)return;let a=e[0][1]+"_"+e[0][0];e[0][1].indexOf("_")>-1&&(a=e[0][1]),u.Z.$on(a,r=>{let l=e[0][2];if(l){let o=l.indexOf("|");o>-1&&(l=e[0][2].substring(o+1))}n.call(this,s,r,l,t)})})},doActionParams(i,s,t){let n=i.dataset.dynamic.query.params,e=Object.keys(s);for(let a in t)this.$$lib__.each(n,r=>{if(r.name==a){let l=t[a];this.$$lib__.contains(e,l)?r.defaultVal=s[l]:f.warn("\u7EC4\u4EF6["+i.name+"]\u7684\u63A5\u6536\u4E8B\u4EF6\u53C2\u6570\u4E2D\uFF0Cdata\u6CA1\u6709["+l+"]\u8FD9\u4E2A\u5C5E\u6027")}});this.widgetInfo.dataset.dynamic.query.params=JSON.parse(JSON.stringify(n)),this.setFirstPage(),this.$emit("doGetPreviewData",JSON.parse(JSON.stringify(this.widgetInfo)))},doLocalData(i,s,t){t==null||t==""||t==null?this.$emit("doGetPreviewData",this.widgetInfo):t==i[s]&&this.$emit("doGetPreviewData",this.widgetInfo)},doReplaceParams(i,s,t,n){let e=n[t],a=i.dataset.dynamic.query,r=[];a&&a.params?r=a.params:i.dataset.dynamic.query={params:[],page:{enabled:!1,pageNum:1,pageSize:10},orders:[]},this.$$lib__.each(r,l=>{l.name==s&&(l.defaultVal=e)}),i.dataset.dynamic.query.params=JSON.parse(JSON.stringify(r)),this.$emit("doGetPreviewData",JSON.parse(JSON.stringify(i)))},doReplacePage(i,s,t){let n=t[s.num],e=t[s.size];i.dataset.dynamic.query&&i.dataset.dynamic.query.page&&(s.num&&(n?i.dataset.dynamic.query.page.pageNum=n:f.error("\u5F53\u524D\u9875\u6570\u53C2\u6570\u503C\u672A\u77E5")),s.size&&(e?i.dataset.dynamic.query.page.pageSize=e:f.error("\u6BCF\u9875\u6761\u6570\u53C2\u6570\u503C\u672A\u77E5"))),this.$emit("doGetPreviewData",JSON.parse(JSON.stringify(i)))},doConfigMap(){},setFirstPage(){this.widgetInfo.dataset.type==this.$$global_editor.dataSourcType.dynamic.code&&this.widgetInfo.dataset.dynamic&&this.widgetInfo.dataset.dynamic.query&&this.widgetInfo.dataset.dynamic.query.page&&this.widgetInfo.dataset.dynamic.query.page.enabled&&this.widgetInfo.action.receive&&this.widgetInfo.action.receive.replaceParams&&this.widgetInfo.action.receive.replaceParams.firstPage&&(this.widgetInfo.dataset.dynamic.query.page.pageNum=1)},doActionPreview(i){i.previewList.map(s=>{if(s&&!s.length)return;let t=s[0][1]+"_"+s[0][0];s[0][1].indexOf("_")>-1&&(t=s[0][1]),u.Z.$on(t,n=>{const e=s[0][2].replace(s[0][1]+"|",""),{script:a}=i;if(a&&a.enabled){if(a.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.doPreview=new Function("data","param_key",a.content)}this.doPreview(n,e)})})},doActionFormSubmit(i){i.formSubmitList.map(s=>{if(s&&!s.length)return;let t=s[0][1]+"_"+s[0][0];s[0][1].indexOf("_")>-1&&(t=s[0][1]),u.Z.$on(t,n=>{const e=s[0][2].replace(s[0][1]+"|",""),{script:a,value:r}=i;if(a&&a.enabled){if(a.content==""){g.Message.warning({message:"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.doFormSubmit=new Function("data","param_key","value",a.content)}this.doFormSubmit(n,e,r)})})}}}}}]);
