"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[44337],{944337:function(v,d,a){a.d(d,{Z:function(){return k}});var f=function(){var e=this,t=e._self._c;return t("div",[t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u4ECE\u56FE\u5C42\u5E93\u4E2D\u9009\u62E9\u56FE\u5C42",effect:"dark",placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:function(i){return e.openLayer()}}})],1),t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u5237\u65B0\u5DF2\u9009\u62E9\u7684\u56FE\u5C42",effect:"dark",placement:"top"}},[t("el-button",{attrs:{disabled:e.toc.length==0||e.toc==null,icon:"el-icon-refresh",size:"mini",type:"success"},on:{click:function(i){return e.refreshToc()}}})],1),t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u6E05\u7A7A\u5DF2\u9009\u62E9\u7684\u56FE\u5C42",effect:"dark",placement:"top"}},[t("el-button",{attrs:{disabled:e.toc.length==0||e.toc==null,icon:"el-icon-brush",size:"mini",type:"warning"},on:{click:function(i){return e.clearToc()}}})],1),t("el-dialog",{staticClass:"my-toc-dialog",staticStyle:{padding:"0px"},attrs:{"append-to-body":!0,"close-on-click-modal":!1,visible:e.dialogVisibleToc,width:e.dialogWidth,title:"\u9009\u62E9\u56FE\u5C42\u76EE\u5F55",top:"10px"},on:{"update:visible":function(i){e.dialogVisibleToc=i}}},[t("div",{staticStyle:{height:"460px"}},[t("el-card",{staticClass:"tocTree",style:e.tocTreeWidth,attrs:{"body-style":{padding:"5px",backgroundColor:"#fff",height:"360px"},header:"\u56FE\u5C42\u5E93\u4E2D\u7684\u56FE\u5C42"}},[t("el-tree",{ref:"toc_unselect",attrs:{data:e.tree.unselect,"expand-on-click-node":!1,"check-on-click-node":"","default-expand-all":"","highlight-current":"","node-key":"id","show-checkbox":""},scopedSlots:e._u([{key:"default",fn:function({node:i,data:l}){return t("span",{staticClass:"custom-tree-node"},[l.tp=="directory"?t("span",{attrs:{title:"\u76EE\u5F55 [ "+i.label+" ]"}},[t("i",{directives:[{name:"show",rawName:"v-show",value:i.expanded===!0,expression:"node.expanded === true"}],staticClass:"iconfont bi-iconfont",style:{color:"#e1b013",fontSize:"20px",marginRight:"10px"}},[e._v("\uE71D")]),t("i",{directives:[{name:"show",rawName:"v-show",value:i.expanded!==!0,expression:"node.expanded !== true"}],staticClass:"iconfont bi-iconfont",style:{color:"#e1b013",fontSize:"20px",marginRight:"10px"}},[e._v("\uE71C")]),e._v(" "+e._s(i.label))]):e._e(),l.tp=="layer"?t("span",{attrs:{title:"\u56FE\u5C42 [ "+i.label+" ]"}},[t("i",{staticClass:"bi-iconfont iconfont",style:{color:e.theme.btn_bgc,fontSize:"16px"}},[e._v("\uE721")]),e._v(e._s(i.label))]):e._e()])}}])})],1),t("div",{staticClass:"transfer_buttons"},[t("el-row",{staticStyle:{"margin-top":"190px"}},[t("el-col",[t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u4ECE\u56FE\u5C42\u5E93\u4E2D\u9009\u62E9\u5230\u5F53\u524D\u7EC4\u4EF6\u4E2D",effect:"dark",placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-d-arrow-right",round:"",size:"small",type:"primary"},on:{click:function(i){return e.toSelect("unselect","select")}}})],1)],1)],1),t("el-row",{staticStyle:{"margin-top":"20px"}},[t("el-col",[t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u4ECE\u5F53\u524D\u7EC4\u4EF6\u4E2D\u79FB\u9664",effect:"dark",placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-d-arrow-left",round:"",size:"small",type:"primary"},on:{click:function(i){return e.toSelect("select","unselect")}}})],1)],1)],1)],1),t("el-card",{staticClass:"tocTree",style:e.tocTreeWidth,attrs:{"body-style":{padding:"5px",backgroundColor:"#fff",height:"360px"},header:"\u5F53\u524D\u7EC4\u4EF6\u5DF2\u7ECF\u9009\u62E9\u7684\u56FE\u5C42"}},[t("el-tree",{ref:"toc_select",attrs:{"check-on-click-node":!1,data:e.tree.select,"expand-on-click-node":!1,"default-expand-all":"","highlight-current":"","node-key":"id","show-checkbox":""},on:{"node-click":e.setInitLoadFun},scopedSlots:e._u([{key:"default",fn:function({node:i,data:l}){return t("span",{staticClass:"custom-tree-node"},[l.tp=="directory"?t("span",{attrs:{title:"\u76EE\u5F55 [ "+i.label+" ]"}},[t("i",{directives:[{name:"show",rawName:"v-show",value:i.expanded===!0,expression:"node.expanded === true"}],staticClass:"iconfont bi-iconfont",style:{color:"#e1b013",fontSize:"20px",marginRight:"10px"}},[e._v("\uE71D")]),t("i",{directives:[{name:"show",rawName:"v-show",value:i.expanded!==!0,expression:"node.expanded !== true"}],staticClass:"iconfont bi-iconfont",style:{color:"#e1b013",fontSize:"20px",marginRight:"10px"}},[e._v("\uE71C")]),e._v(" "+e._s(i.label))]):e._e(),l.tp=="layer"?t("span",{attrs:{title:"\u56FE\u5C42 [ "+i.label+" ]"}},[t("i",{staticClass:"bi-iconfont iconfont",style:{color:e.theme.btn_bgc,fontSize:"16px"}},[e._v("\uE721")]),e._v(e._s(i.label))]):e._e()])}}])})],1),t("el-card",{directives:[{name:"show",rawName:"v-show",value:e.showSetting,expression:"showSetting"}],staticClass:"settingClass",staticStyle:{width:"160px"},attrs:{"body-style":{padding:"5px",backgroundColor:"#fff",height:"360px"},header:"\u56FE\u5C42\u57FA\u7840\u914D\u7F6E"}},[e.isShowCheckDiv?t("div",[t("span",[e._v("\u3010"+e._s(e.lyrName)+"\u3011")]),e.lyrConfig.initChecked!==void 0&&e.lyrConfig.initChecked!==null?t("el-checkbox",{attrs:{label:"\u521D\u59CB\u52A0\u8F7D"},on:{change:function(i){return e.checkedChange("initChecked")}},model:{value:e.lyrConfig.initChecked,callback:function(i){e.$set(e.lyrConfig,"initChecked",i)},expression:"lyrConfig.initChecked"}}):e._e(),e.lyrConfig.isPop!==void 0&&e.lyrConfig.isPop!==null?t("el-checkbox",{attrs:{label:"\u67E5\u8BE2\u5F39\u7A97"},on:{change:function(i){return e.checkedChange("isPop")}},model:{value:e.lyrConfig.isPop,callback:function(i){e.$set(e.lyrConfig,"isPop",i)},expression:"lyrConfig.isPop"}}):e._e(),e.lyrConfig.isFit!==void 0&&e.lyrConfig.isFit!==null?t("el-checkbox",{attrs:{label:"\u7F29\u653E\u5230\u5F53\u524D\u56FE\u5C42"},on:{change:function(i){return e.checkedChange("isFit")}},model:{value:e.lyrConfig.isFit,callback:function(i){e.$set(e.lyrConfig,"isFit",i)},expression:"lyrConfig.isFit"}}):e._e(),t("el-checkbox",{attrs:{label:"\u56FE\u4F8B\u5C55\u793A"},on:{change:function(i){return e.checkedChange("isShowLegend")}},model:{value:e.lyrConfig.isShowLegend,callback:function(i){e.$set(e.lyrConfig,"isShowLegend",i)},expression:"lyrConfig.isShowLegend"}}),e.lyrConfig.isProxy!==void 0&&e.lyrConfig.isProxy!==null?t("el-checkbox",{attrs:{label:"\u542F\u7528\u4EE3\u7406"},on:{change:function(i){return e.checkedChange("isProxy")}},model:{value:e.lyrConfig.isProxy,callback:function(i){e.$set(e.lyrConfig,"isProxy",i)},expression:"lyrConfig.isProxy"}}):e._e()],1):t("div",[e._v("\u8BF7\u9009\u62E9\u56FE\u5C42")])])],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelEidt}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getToc}},[e._v("\u786E \u5B9A")])],1)])],1)},y=[],h=a(675434),c=a(555616),u=a(42160),p=a(321300),g={name:"LayerDirectoryMultiple",props:["toc","showSetting","lyrInfoSetting"],data(){return{dialogVisibleToc:!1,dialogWidth:this.showSetting?"960px":"880px",tocTreeWidth:this.showSetting?"width:300px;":"width:348px;",isShowCheckDiv:!1,lyrName:"",checkLyrData:void 0,lyrConfig:{},myToc:[],list:{all:{directory:[],layer:[]},unselect:{directory:[],layer:[]},select:{directory:[],layer:[]}},tree:{unselect:[],select:[]}}},mounted(){this.setLyrConfig(),this.initAllLayer()},methods:{initAllLayer(){h.N.getLayerTree().then(s=>{s&&s.status==200?(this.list.all.directory=s.data.directoryList,this.list.all.layer=s.data.layerList):c.Message.error({message:s.msg,offset:60})})},setLyrConfig(){this.lyrInfoSetting?this.lyrConfig=this.lyrInfoSetting:this.lyrConfig={isFit:!1,isShowLegend:!1,initChecked:!1,isPop:!1,isSwitch:!1,isFilter:!1,mobile:!1,mobileOpacity:!1,isProxy:!1,isUserPictureLegend:!1}},toSelect(s,e){let t=this.$refs["toc_"+s].getCheckedNodes(),i=this.$refs["toc_"+s].getHalfCheckedNodes();if(t.length==0&&i.length==0)return;let l=this.$$lib__.filter(t,o=>o.tp=="directory"),r=this.$$lib__.filter(t,o=>o.tp=="layer");this.listPush(l,this.list[e].directory),this.listPush(i,this.list[e].directory),this.listPush(r,this.list[e].layer),s=="select"&&this.listSplice(l,this.list[s].directory),this.listSplice(r,this.list[s].layer),this.isShowCheckDiv=!1,this.handleTreeData()},listPush(s,e){this.$$lib__.each(s,t=>{u.default.delete(t,"children"),this.$$lib__.find(e,l=>l.id==t.id)==null&&e.push(t)})},listSplice(s,e){this.$$lib__.each(s,t=>{for(let i=0;i<e.length;i++)t.id==e[i].id&&e.splice(i,1)})},handleData(){this.list.select.directory=[],this.list.select.layer=[],this.list.unselect.directory=[],this.list.unselect.layer=[],this.sortingDirectory(),this.sortingLayer(),this.handleTreeData()},sortingDirectory(){this.$$lib__.each(this.list.all.directory,s=>{let e={id:s.directoryId,label:s.directoryName,showIndex:s.sort,initChecked:s.initChecked,parent:s.parentId};this.$$lib__.find(this.myToc,i=>i.id==e.id)&&this.list.select.directory.push(e),this.list.unselect.directory.push(e)})},sortingLayer(){this.$$lib__.each(this.list.all.layer,s=>{let e=JSON.parse(s.layerCongfig);e.id=s.layerId,e.showIndex=s.sort,e.mapIndex=s.mapIndex,e.initChecked=p.stringToBoolean(s.initChecked),e.parent=s.directoryId;let t=this.$$lib__.find(this.myToc,i=>i.id==e.id);if(t){if(this.showSetting)for(const i in this.lyrConfig)e[i]=t[i];this.list.select.layer.push(e)}else this.list.unselect.layer.push(e)})},handleTreeData(){this.tree.unselect=this.rebuildData(this.$$lib__.sortBy(this.list.unselect.directory,"showIndex"),this.$$lib__.sortBy(this.list.unselect.layer,"showIndex")),this.tree.select=this.rebuildData(this.$$lib__.sortBy(this.list.select.directory,"showIndex"),this.$$lib__.sortBy(this.list.select.layer,"showIndex"))},openLayer(){this.myToc=JSON.parse(JSON.stringify(this.toc)),this.handleData(),this.dialogVisibleToc=!0},refreshToc(){h.N.getLayerTree().then(s=>{if(s&&s.status==200){this.list.all.directory=s.data.directoryList,this.list.all.layer=s.data.layerList,this.myToc=JSON.parse(JSON.stringify(this.toc)),this.handleData();let e=this.$$lib__.union(this.list.select.directory,this.list.select.layer);this.myToc=JSON.parse(JSON.stringify(e)),this.$emit("on-toc-change",e),c.Message.success({message:"\u5237\u65B0\u5B8C\u6210",offset:60})}else c.Message.error({message:s.msg,offset:60})})},clearToc(){this.myToc=[],this.list.select.directory=[],this.list.select.layer=[],this.list.unselect.directory=JSON.parse(JSON.stringify(this.list.all.directory)),this.list.unselect.layer=JSON.parse(JSON.stringify(this.list.all.layer)),this.handleTreeData(),this.$emit("on-toc-change",[]),c.Message.success({message:"\u6E05\u7A7A\u5B8C\u6210",offset:60})},getToc(){let s=this.$$lib__.union(this.list.select.directory,this.list.select.layer);this.myToc=JSON.parse(JSON.stringify(s)),this.$emit("on-toc-change",s),this.dialogVisibleToc=!1},cancelEidt(){this.dialogVisibleToc=!1},rebuildData(s,e){let t=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(s)),l={},r={},o=[];return this.$$lib__.each(t,n=>{n.tp="layer",l[n.parent]||(l[n.parent]=[]),l[n.parent].push(n)}),this.$$lib__.each(i,n=>{n.tp="directory",n.parent!=null?(r[n.parent]||(r[n.parent]=[]),r[n.parent].push(n)):o.push(n)}),this.transferFl(o,r,l),o},transferFl(s,e,t){this.$$lib__.each(s,i=>{let l=e[i.id];l?(i.children=l,t[i.id]&&this.$$lib__.each(t[i.id],r=>{i.children.push(r)}),i.children.sort(this.getSortFun),this.transferFl(l,e,t)):t[i.id]&&(i.children=t[i.id],i.children.sort(this.getSortFun))})},getSortFun(s,e){return s.showIndex===void 0&&(s.showIndex=0),e.showIndex===void 0&&(e.showIndex=0),s.showIndex-e.showIndex},setInitLoadFun(s){if(s.tp==="layer"){this.isShowCheckDiv=!0,this.lyrName=s.label,this.checkLyrData=s;for(const e in this.lyrConfig)typeof s[e]>"u"&&(s[e]=!1,this.checkLyrDataChange(e,!1)),this.lyrConfig[e]=s[e];this.lyrConfig.type=s.type,(s.isShowLegend===null||s.isShowLegend===void 0)&&this.$set(this.lyrConfig,"isShowLegend",!0)}else this.isShowCheckDiv=!1},checkedChange(s){let e=this.$refs.toc_select.getNode(this.checkLyrData.id);e&&(e.data[s]=typeof this.lyrConfig[s]<"u"?this.lyrConfig[s]:!1);let t=this.list.select.layer;for(let i=0;i<t.length;i++)if(t[i].id===this.checkLyrData.id){this.list.select.layer[i]=e.data;break}},checkLyrDataChange(s,e){let t=this.$refs.toc_select.getNode(this.checkLyrData.id);t&&(t.data[s]=e);let i=this.list.select.layer;for(let l=0;l<i.length;l++)if(i[l].id===this.checkLyrData.id){this.list.select.layer[l]=t.data;break}}}},b=g,C=a(768141),x=(0,C.Z)(b,f,y,!1,null,"df01b8d0",null),k=x.exports}}]);
