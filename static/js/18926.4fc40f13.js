(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[18926],{906228:function(P){/* @preserve
 * JSONPatch.js
 *
 * A Dharmafly project written by Thomas Parslow
 * <tom@almostobsolete.net> and released with the kind permission of
 * NetDev.
 *
 * Copyright 2011-2013 Thomas Parslow. All rights reserved.
 * Permission is hereby granted,y free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * Implements the JSON Patch IETF RFC 6902 as specified at:
 *
 *   http://tools.ietf.org/html/rfc6902
 *
 * Also implements the JSON Pointer IETF RFC 6901 as specified at:
 *
 *   http://tools.ietf.org/html/rfc6901
 *
 */(function(v,c){c(P.exports)})(this,function(v){var c,b,d,y,p;p=Array.isArray||function(t){return Object.prototype.toString.call(t)=="[object Array]"},v.apply_patch=c=function(t,i){return new b(i).apply(t)};function m(t){Error.call(this,t),this.message=t}v.InvalidPatch=m,m.prototype=new Error;function g(t){Error.call(this,t),this.message=t}v.PatchApplyError=g,g.prototype=new Error,v.JSONPointer=d=function(i){var n,s,o=[];if(s=i.split("/"),s[0]!=="")throw new m("JSONPointer must start with a slash (or be an empty string)!");for(n=1;n<s.length;n++)o[n-1]=s[n].replace(/~1/g,"/").replace(/~0/g,"~");this.path=o,this.length=o.length},d.prototype._get_segment=function(t,i){var n=this.path[t];if(p(i))if(n==="-")n=i.length;else{if(!n.match(/^0$|^[1-9][0-9]*$/))throw new g("Expected a number to segment an array");n=parseInt(n,10)}return n};function N(t){var i,n;if(p(t))return t.slice();if(t===null)return t;if(typeof t=="object"){i={};for(n in t)Object.hasOwnProperty.call(t,n)&&(i[n]=t[n]);return i}else return t}d.prototype._action=function(t,i,n){var s=this;function o(a,h){var e,r;if(n||(a=N(a)),e=s._get_segment(h,a),h==s.path.length-1)a=i(a,e);else{if(p(a)){if(a.length<=e)throw new g("Path not found in document")}else if(typeof a=="object"){if(!Object.hasOwnProperty.call(a,e))throw new g("Path not found in document")}else throw new g("Path not found in document");r=o(a[e],h+1),n||(a[e]=r)}return a}return o(t,0)},d.prototype.add=function(t,i,n){return this.length===0?i:this._action(t,function(s,o){if(p(s)){if(o>s.length)throw new g("Add operation must not attempt to create a sparse array!");s.splice(o,0,i)}else s[o]=i;return s},n)},d.prototype.remove=function(t,i){if(this.length!==0)return this._action(t,function(n,s){if(!Object.hasOwnProperty.call(n,s))throw new g("Remove operation must point to an existing value!");return p(n)?n.splice(s,1):delete n[s],n},i)},d.prototype.replace=function(t,i,n){return this.length===0?i:this._action(t,function(s,o){if(!Object.hasOwnProperty.call(s,o))throw new g("Replace operation must point to an existing value!");return p(s)?s.splice(o,1,i):s[o]=i,s},n)},d.prototype.get=function(t){var i;return this.length===0?t:(this._action(t,function(n,s){if(!Object.hasOwnProperty.call(n,s))throw new g("Path not found in document");return i=n[s],n},!0),i)},d.prototype.subsetOf=function(t){if(this.length<=t.length)return!1;for(var i=0;i<t.length;i++)if(t.path[i]!==this.path[i])return!1;return!0},y={add:["value"],replace:["value"],test:["value"],remove:[],move:["from"],copy:["from"]};function S(t,i){var n;if(t===i)return!0;if(typeof t!=typeof i)return!1;if(typeof t=="object"){var s=p(t),o=p(i);if(s!==o)return!1;if(s){if(t.length!=i.length)return!1;for(var a=0;a<t.length;a++)if(!S(t[a],i[a]))return!1;return!0}else{for(n in t)if(Object.hasOwnProperty(t,n)&&!(Object.hasOwnProperty(i,n)&&S(t[n],i[n])))return!1;for(n in i)if(Object.hasOwnProperty(i,n)&&!Object.hasOwnProperty(t,n))return!1;return!0}}else return!1}function O(t){var i,n;if(!t.op)throw new m("Operation missing!");if(!y.hasOwnProperty(t.op))throw new m("Invalid operation!");if(!("path"in t))throw new m("Path missing!");for(n=y[t.op],i=0;i<n.length;i++)if(!(n[i]in t))throw new m(t.op+" must have key "+n[i])}function C(t,i){O(t);var n=t.op,s=new d(t.path),o=t.value,a=t.from?new d(t.from):null;switch(n){case"add":return function(h){return s.add(h,o,i)};case"remove":return function(h){return s.remove(h,i)};case"replace":return function(h){return s.replace(h,o,i)};case"move":if(s.subsetOf(a))throw new m("destination must not be a child of source");return function(h){var e=a.get(h),r=a.remove(h,i);return s.add(r,e,i)};case"copy":return function(h){var e=a.get(h);return s.add(h,e,i)};case"test":return function(h){if(!S(s.get(h),o))throw new g("Test operation failed. Value did not match.");return h}}}v.JSONPatch=b=function(i,n){this._compile(i,n)},b.prototype._compile=function(t,i){var n,s=this;if(this.compiledOps=[],typeof t=="string"&&(t=JSON.parse(t)),!p(t))throw new m("Patch must be an array of operations");for(n=0;n<t.length;n++){var o=C(t[n],i);s.compiledOps.push(o)}},v.JSONPatch.prototype.apply=function(t){var i;for(i=0;i<this.compiledOps.length;i++)t=this.compiledOps[i](t);return t}})},518926:function(P,v,c){"use strict";c.r(v),c.d(v,{default:function(){return h}});var b=function(){var r=this,l=r._self._c;return l("div",[l("div",{ref:"biAiContainer",staticClass:"bi-ai-container",style:r.biAiStyle},[l("div",{ref:"biAiBtn",staticClass:"bi-ai-btn",on:{click:r.openIframe,mousemove:function(f){return r.drag(f)},mouseup:function(f){return r.dragEnd(f)}}}),l("transition",{attrs:{name:"fade"}},[l("div",{directives:[{name:"show",rawName:"v-show",value:r.drawerVisible,expression:"drawerVisible"}],class:`bi-ai-iframe ${r.iframeCls}`},[l("div",{staticClass:"bi-ai-iframe-move",on:{mousemove:function(f){return r.drag(f)},mouseup:function(f){return r.dragEnd(f)}}}),l("iframe",{attrs:{frameborder:"0",scrolling:"no",src:`${r.aiFrameUrl}&componentType=${r.getCurrentWidget?.typeName||""}`}})])])],1)])},d=[],y=c(927966),p=c(148836),m=c(906228),g=c.n(m),N=c(231954),S=c(846577),O=c(321300),C=c(149500);const t="```json",i="```";var n={name:"bi-ai",data(){return{isFullScreen:!1,containerStyle:{top:0,left:0},move:{offsetX:0,offsetY:0,timeout:0},widgetConfig:{},isWidget:!1,aiFrameUrl:N.Z.baseConfig.aiFrameUrl,drawerVisible:!1,token:O.getStoreToken()}},computed:{...(0,p.Se)(["getCurrentWidget","getCanvasSetting","getApplicationId"]),biAiStyle(){return{top:this.containerStyle.top+"px",left:this.containerStyle.left+"px"}},iframeCls(){return this.isFullScreen?"is-fullscreen":""}},mounted(){this.aiFrameUrl&&(window.addEventListener("message",this.aiFrameMsg),this.containerStyle.top=window.innerHeight-this.$refs.biAiContainer.clientHeight-20,this.containerStyle.left=window.innerWidth-this.$refs.biAiContainer.clientWidth-110)},unmounted(){this.aiFrameUrl&&window.removeEventListener("message",this.aiFrameMsg)},watch:{drawerVisible(e){if(!e){const r=this.$refs.biAiBtn.getBoundingClientRect();r.x>window.innerWidth-80?this.containerStyle.left-=r.x+80-window.innerWidth:r.x<0&&(this.containerStyle.left-=r.x),r.y>window.innerHeight-80?this.containerStyle.top-=r.y+80-window.innerHeight:r.y<0&&(this.containerStyle.top-=r.y)}}},methods:{...(0,p.nv)(["addWidget","setActionRelation","updateCurrentWidget","setActiveScreen","setCurrentWidget","setSelectMultiple","clearMultipleWidget"]),openIframe(){this.move.timeout==0&&this.move.offsetX==0&&this.move.offsetY==0&&(this.drawerVisible=!this.drawerVisible)},drag(e){if(e.buttons===1){if(this.move.offsetX==0&&this.move.offsetY==0){const r=this.$refs.biAiContainer.getBoundingClientRect();this.move.offsetX=e.clientX-r.x,this.move.offsetY=e.clientY-r.y}this.containerStyle.top=e.clientY-this.move.offsetY,this.containerStyle.left=e.clientX-this.move.offsetX}},dragEnd(e){this.move.offsetY>0||this.move.offsetX>0?(this.containerStyle.top=e.clientY-this.move.offsetY,this.containerStyle.left=e.clientX-this.move.offsetX,this.move.offsetX=0,this.move.offsetY=0,this.move.timeout>0&&clearTimeout(this.move.timeout),this.move.timeout=setTimeout(20,()=>{this.move.timeout=0})):this.move.timeout=0},aiFrameMsg(e){if(e.data)try{let r=JSON.parse(e.data);if(r.from==="gisq-cloud-ai"){if(r.action==="closeAi")this.drawerVisible=!1,this.isFullScreen=!1;else if(r.action==="fullScreenAi")this.isFullScreen=!0;else if(r.action==="exitFullScreenAi")this.isFullScreen=!1;else if(r.action==="generateComponent"&&(this.getCurrentWidget&&this.getCurrentWidget.id&&this.getCurrentWidget.id!=""||this.addToScreen('DSL: ```json {"typeName": "'+r.data.componentType+'"}```'),r.data.jsonpatch)){const l=typeof r.data.jsonpatch=="string"?JSON.parse(r.data.jsonpatch):r.data.jsonpatch;if(Object.keys(l).length>0||l?.length>0){let f=[],w={};if(l.forEach(u=>{u.path&&!w[u.path]&&(w[u.path]=!0,u.op="add",u.path=u.path.replace(/\./g,"/").replace(/\[/,"/").replace(/\]/,""),f.push(u))}),f.length>0){let u=g().apply_patch(this.getCurrentWidget,f);this.updateCurrentWidget(JSON.parse(JSON.stringify(u)))}}}}}catch{}},checkDSL(e,r){if(this.widgetConfig=null,e.indexOf("\u62B1\u6B49")>-1)this.isWidget=!1;else if(e.indexOf("DSL")>-1){this.isWidget=!0;let l=e.indexOf(t);if(l>-1){let f=e.substring(l+t.length),w=f.indexOf(i);w>-1&&(f=f.substring(0,w)),this.checkWidget(f,r);return}C.error(e)}},checkWidget(e,r){let l=null;try{l=JSON.parse(e),this.typeName=l.typeName,this.typeName?(r?(C.info("====",r),this.widgetConfig=JSON.parse(JSON.stringify(r))):this.widgetConfig=this.newWidget(),this.setProperties(l.properties),this.widgetConfig.attr.widgetW=this.widgetConfig.attr.w,this.widgetConfig.attr.hh=this.widgetConfig.attr.h):this.contentInfo="\u5F88\u62B1\u6B49\uFF0CAI\u76EE\u524D\u53EA\u80FD\u8BC6\u522B\u51FA\u3010\u901A\u7528\u6807\u9898\u3011\u548C\u3010\u57FA\u672C\u67F1\u72B6\u56FE\u3011\u7EC4\u4EF6\uFF0C\u5176\u4ED6\u7EC4\u4EF6\u6B63\u5728\u5F00\u53D1\u4E2D\u3002"+this.contentInfo}catch{this.contentInfo="\u5F88\u62B1\u6B49\uFF0CAI\u672A\u80FD\u6210\u529F\u8BC6\u522B\u60A8\u7684\u9700\u6C42~"+this.contentInfo,C.error(e)}},newWidget(){let e={};if(this.typeName=="title-general"){let r=this.typeName.replace(/-/g,"_");e=JSON.parse(JSON.stringify(S.Z.text.title[r])),e.name="\u901A\u7528\u6807\u9898_"+O.randomString(),e.typeId="8a680df0514111e983787f3950749631",e.typeName=this.typeName,e.widgetType="text",e.widgetGroup="title",e.typeTitle="\u901A\u7528\u6807\u9898",e.attr.predefineColoursScheme=this.getCanvasSetting.predefineColoursScheme,e.attr.widgetW||(e.attr.widgetW=e.attr.w)}else if(this.typeName=="bar-simple"){let r=this.typeName.replace(/-/g,"_");e=JSON.parse(JSON.stringify(S.Z.charts.bar[r])),e.name="\u57FA\u672C\u67F1\u72B6\u56FE_"+O.randomString(),e.typeId="9a8f8530513e11e981b139c1e3651c7d",e.typeName=this.typeName,e.widgetType="charts",e.widgetGroup="bar",e.typeTitle="\u57FA\u672C\u67F1\u72B6\u56FE",e.attr.predefineColoursScheme=this.getCanvasSetting.predefineColoursScheme,e.attr.widgetW||(e.attr.widgetW=e.attr.w)}else return this.contentInfo="\u5F88\u62B1\u6B49\uFF0CAI\u76EE\u524D\u53EA\u80FD\u8BC6\u522B\u51FA\u3010\u901A\u7528\u6807\u9898\u3011\u548C\u3010\u57FA\u672C\u67F1\u72B6\u56FE\u3011\u7EC4\u4EF6\uFF0C\u5176\u4ED6\u7EC4\u4EF6\u6B63\u5728\u5F00\u53D1\u4E2D\u3002"+this.contentInfo,null;return C.info("11111",e),e},setProperties(e){if(e)for(let r in e){let l={},f=r.split("."),w=f[f.length-1];f.pop();let u=l;f.forEach(W=>{u[W]||(u[W]={}),u=u[W]}),u[w]=e[r],this.widgetConfig=O.mergeObjs(JSON.parse(JSON.stringify(this.widgetConfig)),l)}},addToScreen(e){if(this.checkDSL(e),!this.isWidget)return;let r=JSON.parse(JSON.stringify(this.widgetConfig));this.addWidget(r),this.setActionRelation(),y.Z.$on("widgetDefaultMounted"+this.getCurrentWidget.id,()=>{this.$nextTick(()=>{y.Z.$emit("onInitConfigExtend"+this.getCurrentWidget.id),this.getCanvasSetting.predefineColoursScheme&&this.getCanvasSetting.predefineColoursScheme!=this.$$global_editor.predefineColoursScheme.default.code&&y.Z.$emit("onSetPredefineColoursScheme"+this.getCurrentWidget.id,{predefineColoursSchemeValue:this.getCanvasSetting.predefineColoursScheme}),y.Z.$off("widgetDefaultMounted"+this.getCurrentWidget.id)})})}}},s=n,o=c(768141),a=(0,o.Z)(s,b,d,!1,null,"f46b1706",null),h=a.exports}}]);
