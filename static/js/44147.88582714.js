"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[44147],{768792:function(j,c,a){a.r(c),a.d(c,{default:function(){return b}});var g=function(){var t=this,e=t._self._c;return e("div",[e("el-collapse",[e("el-collapse-item",[e("template",{slot:"title"},[e("div",{staticClass:"my-title"},[t._v("\u5730\u56FE\u8BBE\u7F6E")])]),e("vue-lazy-component",[e("el-form",{ref:"form",attrs:{size:"mini","label-width":"75px"}},[e("el-form-item",{attrs:{label:"\u5E95\u56FE\u9009\u62E9"}},[e("layer-directory-multiple",{attrs:{toc:t.currentWidget.mapLayer.toc,"show-setting":!0},on:{"on-toc-change":t.onLayerChange}})],1),e("el-form-item",{attrs:{label:"\u5B9A\u4F4D\u7C7B\u578B"}},t._l(t.radios,function(i,o){return e("el-radio",{key:o,attrs:{label:i.label},on:{change:t.getConfigData},model:{value:t.currentWidget.config.options.isXZQ,callback:function(r){t.$set(t.currentWidget.config.options,"isXZQ",r)},expression:"currentWidget.config.options.isXZQ"}},[t._v(t._s(i.text)+" ")])}),1),t.currentWidget.config.options.isXZQ?e("div",[e("el-form-item",{attrs:{label:"\u884C\u653F\u533A\u5212",prop:"currentXZQ"}},[e("el-select",{ref:"xzqSelect",staticStyle:{width:"195px"},attrs:{value:t.currentWidget.config.options.currentXZQMC}},[e("el-option",{attrs:{id:"xzq-select-tree",value:t.currentWidget.config.options.currentXZQ,label:t.currentWidget.config.options.currentXZQMC}},[e("el-tree",{attrs:{data:t.$$region_data.citiesTree,"default-expanded-keys":["china"],"check-on-click-node":!0,"expand-on-click-node":!1,"node-key":"id","current-node-key":t.currentWidget.config.options.currentXZQ},on:{"node-click":t.handleNodeClickXzq}})],1)],1)],1)],1):e("div",[e("el-form-item",{attrs:{label:"\u4E2D\u5FC3\u70B9"}},[e("el-input",{staticStyle:{width:"195px"},on:{change:t.getConfigData},model:{value:t.currentWidget.config.options.center,callback:function(i){t.$set(t.currentWidget.config.options,"center",i)},expression:"currentWidget.config.options.center"}})],1),e("el-form-item",{attrs:{label:"\u7F29\u653E\u500D\u6570"}},[e("el-input-number",{staticStyle:{width:"195px"},attrs:{step:1,max:24,min:1},on:{change:t.getConfigData},model:{value:t.currentWidget.config.options.zoom,callback:function(i){t.$set(t.currentWidget.config.options,"zoom",i)},expression:"currentWidget.config.options.zoom"}})],1)],1),e("el-collapse-item",{attrs:{title:"\u63A7\u4EF6\u914D\u7F6E"}},[e("el-form-item",{attrs:{label:"\u653E\u5927\u7F29\u5C0F"}},[e("el-switch",{on:{change:t.getConfigData},model:{value:t.currentWidget.config.options.zoomControl,callback:function(i){t.$set(t.currentWidget.config.options,"zoomControl",i)},expression:"currentWidget.config.options.zoomControl"}})],1),e("el-form-item",{attrs:{label:"\u9F20\u6807\u4F4D\u7F6E"}},[e("el-switch",{on:{change:t.getConfigData},model:{value:t.currentWidget.config.options.mouseposition,callback:function(i){t.$set(t.currentWidget.config.options,"mouseposition",i)},expression:"currentWidget.config.options.mouseposition"}})],1),e("el-form-item",{attrs:{label:"\u6BD4\u4F8B\u5C3A"}},[e("el-switch",{on:{change:t.getConfigData},model:{value:t.currentWidget.config.options.scale,callback:function(i){t.$set(t.currentWidget.config.options,"scale",i)},expression:"currentWidget.config.options.scale"}})],1),e("el-form-item",{attrs:{label:"\u5168\u5C4F"}},[e("el-switch",{on:{change:t.getConfigData},model:{value:t.currentWidget.config.options.fullscreen,callback:function(i){t.$set(t.currentWidget.config.options,"fullscreen",i)},expression:"currentWidget.config.options.fullscreen"}})],1),e("el-form-item",{attrs:{label:"\u5E95\u56FE\u5207\u6362"}},[e("el-switch",{on:{change:t.getConfigData},model:{value:t.currentWidget.config.options.basemapcontrol,callback:function(i){t.$set(t.currentWidget.config.options,"basemapcontrol",i)},expression:"currentWidget.config.options.basemapcontrol"}})],1)],1)],1)],1)],2)],1),t.zjLayers&&t.zjLayers.length>0?e("el-collapse",[e("el-collapse-item",[e("template",{slot:"title"},[e("div",{staticClass:"my-title"},[t._v("\u6807\u6CE8\u6837\u5F0F\u914D\u7F6E")])]),e("vue-lazy-component",[t._l(t.zjLayers,function(i,o){return e("el-collapse-item",{key:o},[e("template",{slot:"title"},[e("div",{staticClass:"my-title"},[e("span",[t._v(t._s(i.label))])])]),e("el-form",{ref:"form",refInFor:!0,attrs:{size:"mini","label-width":"75px"}},[e("el-form-item",{attrs:{label:"\u5B57\u53F7"}},[e("el-input-number",{staticClass:"my-style-number",staticStyle:{width:"160px"},attrs:{placeholder:"\u5B57\u53F7\u5927\u5C0F","controls-position":"right",step:.5,min:10,max:100},on:{change:function(r){return t.refreshZjStyle(i)}},model:{value:t.currentWidget.config.zjOptions[i.layerTag].fontSize,callback:function(r){t.$set(t.currentWidget.config.zjOptions[i.layerTag],"fontSize",r)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].fontSize"}})],1),e("el-form-item",{attrs:{label:"\u5B57\u4F53\u989C\u8272"}},[e("el-row",[e("el-col",{attrs:{span:18}},[e("el-input",{attrs:{placeholder:"\u9009\u62E9\u989C\u8272"},on:{change:function(r){return t.refreshZjStyle(i)}},model:{value:t.currentWidget.config.zjOptions[i.layerTag].fontColor,callback:function(r){t.$set(t.currentWidget.config.zjOptions[i.layerTag],"fontColor",r)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].fontColor"}})],1),e("el-col",{attrs:{span:6}},[e("el-color-picker",{staticStyle:{"margin-left":"5px"},attrs:{"show-alpha":""},on:{change:function(r){return t.refreshZjStyle(i)}},model:{value:t.currentWidget.config.zjOptions[i.layerTag].fontColor,callback:function(r){t.$set(t.currentWidget.config.zjOptions[i.layerTag],"fontColor",r)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].fontColor"}})],1)],1)],1),e("el-form-item",{attrs:{label:"\u63CF\u8FB9\u989C\u8272"}},[e("el-row",[e("el-col",{attrs:{span:18}},[e("el-input",{attrs:{placeholder:"\u9009\u62E9\u989C\u8272"},on:{change:function(r){return t.refreshZjStyle(i)}},model:{value:t.currentWidget.config.zjOptions[i.layerTag].strokeColor,callback:function(r){t.$set(t.currentWidget.config.zjOptions[i.layerTag],"strokeColor",r)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].strokeColor"}})],1),e("el-col",{attrs:{span:6}},[e("el-color-picker",{staticStyle:{"margin-left":"5px"},attrs:{"show-alpha":""},on:{change:function(r){return t.refreshZjStyle(i)}},model:{value:t.currentWidget.config.zjOptions[i.layerTag].strokeColor,callback:function(r){t.$set(t.currentWidget.config.zjOptions[i.layerTag],"strokeColor",r)},expression:"currentWidget.config.zjOptions[zjLayer.layerTag].strokeColor"}})],1)],1)],1)],1)],2)}),e("div",{staticStyle:{position:"relative","text-align":"center","margin-top":"10px"}},[e("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.isStartTranslate,expression:"!isStartTranslate"}],attrs:{size:"mini",type:"primary"},on:{click:t.translate}},[t._v("\u79FB\u52A8 ")]),e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isStartTranslate,expression:"isStartTranslate"}],attrs:{size:"mini",type:"danger"},on:{click:t.stopTranslate}},[t._v("\u505C\u6B62\u79FB\u52A8 ")])],1)],2)],2)],1):t._e()],1)},u=[],f=a(723400),d=a(944337),p=a(653183),m=a.n(p),s=a(927966),l=a(149500),h={name:"Gis3dmapStyle",components:{layerDirectoryMultiple:d.Z},mixins:[f.j],props:["currentWidget"],data(){return{basemap:null,formLabelWidth:"120px",zjLayers:[],isStartTranslate:this.currentWidget.config.isStartTranslate,radiosObj:[{label:!0,text:"\u542F\u7528"},{label:!1,text:"\u5173\u95ED"}],radios:[{label:!1,text:"\u81EA\u5B9A\u4E49\u5B9A\u4F4D"},{label:!0,text:"\u884C\u653F\u533A\u5B9A\u4F4D"}]}},watch:{"currentWidget.mapLayer.toc":{handler(n){this.createZjLayers(n)}}},mounted(){l.log(this.currentWidget.config.options)},methods:{submitForm(n){this.$refs[n].validate(t=>{if(t)this.dialogFormVisible=!1;else return!1})},addType(n){this.dialogTableVisible=!0},changeType(n){this.currentFileType=n},handleChange(n,t){t.enable=!t.enable},handleEdit(n,t){this.dialogFormVisible=!0,this.ruleForm.name=t.name,this.ruleForm.type=t.suffix},onLayerChange(n){this.currentWidget.mapLayer.toc=n;let t=JSON.stringify(n);s.Z.$emit("refreshLayer",t),this.getConfigData()},onLayerChangeBase(n){this.currentWidget.config.options.defaultmap=n.id,this.mapLayerPush(n),this.getConfigData()},mapLayerPush(n){this.currentWidget.mapLayer==null&&(this.currentWidget.mapLayer={toc:[]}),this.currentWidget.mapLayer.toc=[],this.currentWidget.config.options.basemaps=[],n&&n.id&&(this.currentWidget.config.options.basemaps=[this.basemapHandel(n)],this.currentWidget.mapLayer.toc=[n])},newGuid(){for(var n="",t=1;t<=32;t++){var e=Math.floor(Math.random()*16).toString(16);n+=e,(t==8||t==12||t==16||t==20)&&(n+="-")}return n},basemapHandel(n){let t=null;return t={id:n.id,name:n.label,thumbnailUrl:n.thumbUrl,layers:[n]},t},handleNodeClickXzq(n){this.currentWidget.config.options.currentXZQ=n.id,this.currentWidget.config.options.currentXZQMC=n.label,this.$refs.xzqSelect.blur(),this.getXZQlist(n.id,()=>{this.getConfigData()})},getXZQlist(n,t){n=this.initXZQ_fun(n);let e=`http://api.tianditu.gov.cn/administrative?postStr={"searchWord":"${n}", "searchType":"0","needSubInfo":"true","needAll":"false", "needPre":"true"}&tk=73f429c4c1d4550cdbac3def1243aa9c`;return m().ajax({url:e,success:i=>{if(i=JSON.parse(i),i.returncode==="100"){let o=i.data.bound.split(",");o.forEach((z,C)=>{let T=Number(z);o[C]=T});let r=""+(o[0]+o[2])/2+","+(o[1]+o[3])/2,x=i.data.level;this.currentWidget.config.options.center=r,this.currentWidget.config.options.zoom=x,this.currentWidget.config.options.extent=o,t()}else l.log(i.msg),t()}}),!1},initXZQ_fun(n){let t=(n||this.currentWidget.config.options.currentXZQ)+"";if(t){for(;t.length<6;)t+="0";t.indexOf("156")===-1&&(t="156"+t)}return t},createZjLayers(n){this.zjLayers=[];for(let t of n)t.type=="feature-zj"&&(this.zjLayers.push(t),this.currentWidget.config.zjOptions[t.layerTag]||(this.currentWidget.config.zjOptions[t.layerTag]=this.currentWidget.config.zjDefaultOptions));l.log(this.zjLayers)},refreshZjStyle(n){s.Z.$emit("gis-map-zj-refreshStyle",n,this.currentWidget.config.zjOptions[n.layerTag])},translate(){this.isStartTranslate=this.currentWidget.config.isStartTranslate=!0,s.Z.$emit("gis-map-zj-startTranslate")},stopTranslate(){this.isStartTranslate=this.currentWidget.config.isStartTranslate=!1,s.Z.$emit("gis-map-zj-stopTranslate")}}},y=h,W=a(768141),v=(0,W.Z)(y,g,u,!1,null,"30b1c2a1",null),b=v.exports}}]);
