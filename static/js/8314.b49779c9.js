"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[8314],{308314:function(m,o,c){c.r(o),c.d(o,{default:function(){return z}});var u=function(){var e=this,t=e._self._c;return t("el-collapse",{model:{value:e.activeNames,callback:function(s){e.activeNames=s},expression:"activeNames"}},[t("el-collapse-item",{attrs:{name:"1"}},[t("template",{slot:"title"},[t("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[t("span",{staticClass:"my-title"},[e._v("\u56FE\u5C42\u65B9\u6848\u8BBE\u7F6E")]),t("i",{staticClass:"el-icon-plus",staticStyle:{color:"tomato",cursor:"pointer","margin-right":"4px","text-align":"center","line-height":"48px"},attrs:{title:"\u65B0\u589E"},on:{click:function(s){return s.stopPropagation(),e.addNewScheme.apply(null,arguments)}}})])]),t("el-row",{staticStyle:{"margin-top":"10px"}},e._l(e.currentWidget.config.scheme,function(s,a){return t("el-col",{key:a,staticStyle:{position:"relative"},attrs:{span:10,offset:1},nativeOn:{click:function(l){return e.editScheme(s)}}},[t("el-card",{staticClass:"my-card",attrs:{"body-style":{padding:"0px"}}},[t("img",{staticClass:"image",staticStyle:{width:"100%",height:"100px"},attrs:{src:s.fileInfo}}),t("div",{staticStyle:{padding:"8px"}},[t("span",[e._v(e._s(s.name))]),t("i",{staticClass:"el-icon-delete",staticStyle:{color:"tomato",cursor:"pointer",position:"absolute",right:"4px",bottom:"12px"},on:{click:function(l){return l.stopPropagation(),e.deleteScheme(a)}}})])])],1)}),1)],2),t("layer-directory-scheme",{ref:"scheme",attrs:{existSchemeIdArr:e.existSchemeIdArr},on:{"on-scheme-change":e.onSchemeChange},model:{value:e.isSchemeShow,callback:function(s){e.isSchemeShow=s},expression:"isSchemeShow"}})],1)},y=[],g=c(723400),v=c(110563),S=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{staticClass:"dialog-content",staticStyle:{padding:"0px"},attrs:{title:"\u9009\u62E9\u56FE\u5C42\u76EE\u5F55",top:"10px","append-to-body":!0,"close-on-click-modal":!1,"show-close":!1,visible:e.showDialog,width:"880px"},on:{"update:visible":function(s){e.showDialog=s}}},[t("el-form",{ref:"form",attrs:{"label-width":"80px"}},[t("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"ID"}},[t("el-input",{staticStyle:{width:"195px"},model:{value:e.scheme.id,callback:function(s){e.$set(e.scheme,"id",s)},expression:"scheme.id"}})],1),t("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"\u65B9\u6848\u540D\u79F0"}},[t("el-input",{staticStyle:{width:"195px"},model:{value:e.scheme.name,callback:function(s){e.$set(e.scheme,"name",s)},expression:"scheme.name"}})],1),t("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"\u65B9\u6848\u56FE\u6807"}},[t("select-img",{staticStyle:{"margin-bottom":"20px"},attrs:{image:e.scheme.fileInfoBI},on:{openSelectImage:function(s){return e.openSelectImage(e.scheme)},clearSelectImage:function(s){return e.clearSelectImage(e.scheme)}}})],1)],1),t("div",{staticStyle:{height:"460px"}},[t("el-card",{staticClass:"tocTree",attrs:{header:"\u56FE\u5C42\u5E93\u4E2D\u7684\u56FE\u5C42","body-style":{padding:"5px",backgroundColor:"#fff",height:"360px"}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-tree",{ref:"all_tree",attrs:{data:e.tree,"default-expand-all":"","node-key":"id","show-checkbox":"","highlight-current":"","expand-on-click-node":!1,"default-checked-keys":e.scheme.selectLeafs},scopedSlots:e._u([{key:"default",fn:function({node:s,data:a}){return t("span",{staticClass:"custom-tree-node"},[a.tp==="directory"?t("span",{attrs:{title:"\u76EE\u5F55 [ "+s.label+" ]"}},[t("i",{directives:[{name:"show",rawName:"v-show",value:s.expanded===!0,expression:"node.expanded === true"}],staticClass:"iconfont bi-iconfont",style:{color:"#e1b013",fontSize:"20px",marginRight:"10px"}},[e._v("\uE71D")]),t("i",{directives:[{name:"show",rawName:"v-show",value:s.expanded!==!0,expression:"node.expanded !== true"}],staticClass:"iconfont bi-iconfont",style:{color:"#e1b013",fontSize:"20px",marginRight:"10px"}},[e._v("\uE71C")]),e._v(" "+e._s(s.label))]):e._e(),a.tp==="layer"?t("span",{attrs:{title:"\u56FE\u5C42 [ "+s.label+" ]"}},[t("el-checkbox",{on:{change:function(l){return e.changeChecked(a,s)}},model:{value:a.initChecked,callback:function(l){e.$set(a,"initChecked",l)},expression:"data.initChecked"}},[t("i",{staticClass:"bi-iconfont iconfont",style:{color:e.theme.btn_bgc,fontSize:"16px"}},[e._v("\uE721")]),e._v(e._s(s.label)+" ")])],1):e._e()])}}])})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelEidt}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getScheme}},[e._v("\u786E \u5B9A")])],1)],1),t("el-dialog",{staticClass:"my-image-dialog",staticStyle:{padding:"0px"},attrs:{title:"\u9009\u62E9\u56FE\u7247",top:"10px","append-to-body":!0,"close-on-click-modal":!1,visible:e.dialogVisibleImg,width:e.dialogWidth},on:{"update:visible":function(s){e.dialogVisibleImg=s}}},[t("div",[t("image-manage",{ref:"imageMange",attrs:{"is-dialog":!0,type:["image"]}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelImgSelect}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getImage}},[e._v("\u786E \u5B9A")])],1)])],1)},x=[],_=c(721829),I=c(582333),b=c(321300),k=c(675434),h=c(555616),r=c(149500),$={name:"LayerDirectoryScheme",components:{ImageManage:I.default,selectImg:_.Z},mixins:[g.j],model:{prop:"showDialog",event:"changeShowDialog"},props:{showDialog:{type:Boolean,default:!1},existSchemeIdArr:{type:Array,default:()=>[]}},data(){return{editId:"",dialogVisibleImg:!1,dialogVisibleScheme:!1,dialogWidth:"90%",scheme:{},requestList:{directory:[],layer:[]},list:{all:{directory:[],layer:[]},checked:[],select:[]},tree:[]}},watch:{},mounted(){this.initAllLayer()},methods:{openDialog(i,e){this.scheme=JSON.parse(JSON.stringify(i)),e?this.editId=this.scheme.id:this.editId="",r.log(this.scheme),this.handleData(),this.changeSchemeDialog(!0)},changeSchemeDialog(i){this.$emit("changeShowDialog",i)},clearSelectImage(i){i.fileInfo="",i.fileInfoBI="",this.$forceUpdate()},getImage(){let i=this.$refs.imageMange.getSelectImage();if(i!=null){if(this.$$global.fileType.image.indexOf(i.imageFileType)==-1){h.Message.warning("\u9009\u62E9\u7684\u4E0D\u662F\u56FE\u7247");return}this.dialogVisibleImg=!1,this.scheme.fileInfoBI=i.fileUrlPath;let e=b.appendImageBaseURL(i.fileUrlPath);this.scheme.fileInfo=e}else h.Message.warning("\u672A\u9009\u62E9\u4EFB\u4F55\u56FE\u7247")},cancelImgSelect(){this.dialogVisibleImg=!1},openSelectImage(i){let e=this;this.dialogVisibleImg=!0,setTimeout(function(){e.$refs.imageMange.getImageList(null),e.selectScatterName=i.type},500)},initAllLayer(){k.N.getLayerTree().then(i=>{i&&i.status==200?(this.requestList.directory=i.data.directoryList,this.requestList.layer=i.data.layerList):h.Message.error({message:i.msg,offset:60})})},handleData(){this.list.all.directory=[],this.list.all.layer=[],this.list.select=[],this.list.checked=[],this.sortingDirectory(),this.sortingLayer(),this.handleTreeData()},sortingDirectory(){this.$$lib__.each(this.requestList.directory,i=>{let e={id:i.directoryId,label:i.directoryName,showIndex:i.sort,initChecked:i.initChecked=="true"||i.initChecked==!0,parent:i.parentId};this.list.all.directory.push(e)})},sortingLayer(){this.$$lib__.each(this.requestList.layer,i=>{let e=JSON.parse(i.layerCongfig);e.id=i.layerId,e.showIndex=i.sort,e.mapIndex=i.mapIndex,e.initChecked=i.initChecked=="true"||i.initChecked==!0,e.parent=i.directoryId,this.$$lib__.find(this.scheme.checked,s=>s==e.id)?(e.initChecked=!0,this.list.checked.push(e.id)):e.initChecked=!1,this.list.all.layer.push(e)})},handleTreeData(){this.tree=this.rebuildData(this.$$lib__.sortBy(this.list.all.directory,"showIndex"),this.$$lib__.sortBy(this.list.all.layer,"showIndex"))},changeChecked(i,e){r.log(i);let t=this.list.checked.indexOf(i.id);r.log(t),i.initChecked?(e.checked=!0,t==-1&&this.list.checked.push(i.id)):t>=0&&this.list.checked.splice(t,1),r.log(this.list.checked)},getScheme(){let i=this.$refs.all_tree.getCheckedNodes(!1,!0),e=this.$refs.all_tree.getCheckedNodes(!0,!0),t=this.$refs.all_tree.getCheckedNodes(!0);if(t=t.map(({id:s,initChecked:a,enable:l})=>({id:s,initChecked:a,enable:l})),this.scheme.id===""){this.$message.info("ID\u4E0D\u80FD\u4E3A\u7A7A");return}if(this.existSchemeIdArr.indexOf(this.scheme.id)>-1&&this.editId!==this.scheme.id){this.$message.info("ID\u91CD\u590D\u8BF7\u68C0\u67E5");return}if(t.length>0&&this.scheme.name!==void 0&&this.scheme.name.trim()!==""){let s=[],a=[];this.$$lib__.each(i,l=>{s.push(l.id)}),this.$$lib__.each(e,l=>{a.push(l.id)}),this.scheme.select=s,this.scheme.selectLeafs=a,this.scheme.checked=this.list.checked,this.scheme.tocInfoList=t,this.scheme.fileInfo||(this.scheme.fileInfo=c(669408)),r.log("fileInfoBI",this.scheme.fileInfo),this.$emit("on-scheme-change",this.scheme)}else if(t.length<1){this.$message.info("\u672A\u9009\u4E2D\u4EFB\u4F55\u56FE\u5C42");return}else if(this.scheme.name===void 0||this.scheme.name.trim()===""){this.$message.info("\u65B9\u6848\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A");return}this.changeSchemeDialog(!1)},cancelEidt(){this.changeSchemeDialog(!1)},rebuildData(i,e){let t=JSON.parse(JSON.stringify(e)),s=JSON.parse(JSON.stringify(i)),a={},l={},d=[];return this.$$lib__.each(t,n=>{n.tp="layer",a[n.parent]||(a[n.parent]=[]),a[n.parent].push(n)}),this.$$lib__.each(s,n=>{n.tp="directory",n.parent!=null?(l[n.parent]||(l[n.parent]=[]),l[n.parent].push(n)):d.push(n)}),this.transferFl(d,l,a),d},transferFl(i,e,t){this.$$lib__.each(i,s=>{let a=e[s.id];a?(s.children=a,t[s.id]&&this.$$lib__.each(t[s.id],l=>{s.children.push(l)}),this.transferFl(a,e,t)):t[s.id]&&(s.children=t[s.id])})}}},C=$,f=c(768141),D=(0,f.Z)(C,S,x,!1,null,"0cc7a93e",null),w=D.exports,L=c(42160),p=c(149500),N={name:"GisLayerSchemeData",components:{LayerDirectoryScheme:w},mixins:[g.j],props:["currentWidget"],data(){return{schemeList:[1,2,3,4,5,6,7,8,9],isSchemeShow:!1,activeNames:["1"]}},computed:{existSchemeIdArr(){return this.currentWidget.config.scheme&&this.currentWidget.config.scheme.length>0?this.currentWidget.config.scheme.map(i=>i.id):[]}},methods:{editScheme(i){p.log("---edit----"),this.$refs.scheme.openDialog(i,!0)},addNewScheme(){this.$refs.scheme.openDialog({id:(0,v.newGuid)()})},deleteScheme(i){this.currentWidget.config.scheme.splice(i,1),this.getConfigData()},onSchemeChange(i){p.log(i);let e=!1;for(let t in this.currentWidget.config.scheme)if(this.currentWidget.config.scheme[t].id==i.id){L.default.set(this.currentWidget.config.scheme,t,i),e=!0;break}e||this.currentWidget.config.scheme.push(i),this.getConfigData()}}},W=N,O=(0,f.Z)(W,u,y,!1,null,"e895fbbe",null),z=O.exports},669408:function(m,o,c){m.exports=c.p+"static/img/tocscheme.e4909860.png"}}]);
