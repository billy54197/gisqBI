"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[21162],{21162:function(g,o,r){r.r(o),r.d(o,{default:function(){return N}});var m=function(){var e=this,t=e._self._c;return t("el-collapse",{staticClass:"widget-list",model:{value:e.activeNames,callback:function(i){e.activeNames=i},expression:"activeNames"}},[t("el-tabs",{model:{value:e.tabActiveNames,callback:function(i){e.tabActiveNames=i},expression:"tabActiveNames"}},[t("el-tab-pane",{attrs:{label:"\u4E8C\u7EF4\u914D\u7F6E",name:"2D"}},[t("el-collapse-item",{attrs:{name:"1"}},[t("template",{slot:"title"},[t("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[t("span",{staticClass:"my-title"},[e._v("\u5E95\u56FE\u65B9\u6848\u8BBE\u7F6E")]),t("i",{staticClass:"el-icon-plus",staticStyle:{color:"tomato",cursor:"pointer","margin-right":"4px","text-align":"center","line-height":"48px"},attrs:{title:"\u65B0\u589E"},on:{click:function(i){return i.stopPropagation(),e.addNewBaselayer("2dBaseLayer")}}})])]),e._l(e.currentWidget.config.baseLayer,function(i,s){return t("el-row",{key:s,staticStyle:{"margin-top":"10px",border:"1px solid #0c605c !important",padding:"8px"},nativeOn:{click:function(l){return e.editBaselayer("2dBaseLayer",i)}}},[t("el-col",{staticStyle:{position:"relative"},attrs:{span:13}},[t("img",{staticClass:"image",staticStyle:{"margin-left":"10px",width:"128px",height:"64px"},attrs:{src:i.thumbnailUrl}}),e.currentWidget.config.defaultShow===i.id?t("div",{staticClass:"widget-checkbox",on:{click:function(l){return l.stopPropagation(),e.onDefaultShowChange("2dDefaultShow",i.id)}}},[t("span",{staticClass:"iconfont bi_finish"})]):t("div",{staticClass:"widget-checkbox",on:{click:function(l){return l.stopPropagation(),e.onDefaultShowChange("2dDefaultShow",i.id)}}},[t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u70B9\u51FB\u52FE\u9009\u7EC4\u4EF6",effect:"light",placement:"right"}},[t("span",{staticClass:"el-icon-full-screen unCheckedIcon"})])],1)]),t("el-col",{staticStyle:{height:"100%"},attrs:{span:11}},[t("span",{staticStyle:{"text-align":"center","line-height":"64px","font-size":"18px"}},[e._v(e._s(i.label))])]),t("i",{staticClass:"el-icon-delete",staticStyle:{color:"tomato",cursor:"pointer",position:"absolute",right:"4px",top:"4px"},on:{click:function(l){return l.stopPropagation(),e.deleteBase("2dBaseLayer",s)}}})],1)})],2)],1),t("el-tab-pane",{attrs:{label:"\u4E09\u7EF4\u914D\u7F6E",name:"3D"}},[t("el-collapse-item",{attrs:{name:"1"}},[t("template",{slot:"title"},[t("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"100%"}},[t("span",{staticClass:"my-title"},[e._v("\u5E95\u56FE\u65B9\u6848\u8BBE\u7F6E")]),t("i",{staticClass:"el-icon-plus",staticStyle:{color:"tomato",cursor:"pointer","margin-right":"4px","text-align":"center","line-height":"48px"},attrs:{title:"\u5220\u9664"},on:{click:function(i){return i.stopPropagation(),e.addNewBaselayer("3dBaseLayer")}}})])]),e._l(e.currentWidget.config.baseLayer3d,function(i,s){return t("el-row",{key:s,staticStyle:{"margin-top":"10px",border:"1px solid #0c605c !important",padding:"8px"},nativeOn:{click:function(l){return e.editBaselayer("3dBaseLayer",i)}}},[t("el-col",{staticStyle:{position:"relative"},attrs:{span:13}},[t("img",{staticClass:"image",staticStyle:{"margin-left":"10px",width:"128px",height:"64px"},attrs:{src:i.thumbnailUrl}}),e.currentWidget.config.defaultShow3d===i.id?t("div",{staticClass:"widget-checkbox",on:{click:function(l){return l.stopPropagation(),e.onDefaultShowChange("3dDefaultShow",i.id)}}},[t("span",{staticClass:"iconfont bi_finish"})]):t("div",{staticClass:"widget-checkbox",on:{click:function(l){return l.stopPropagation(),e.onDefaultShowChange("3dDefaultShow",i.id)}}},[t("el-tooltip",{attrs:{"open-delay":1e3,content:"\u70B9\u51FB\u52FE\u9009\u7EC4\u4EF6",effect:"light",placement:"right"}},[t("span",{staticClass:"el-icon-full-screen unCheckedIcon"})])],1)]),t("el-col",{staticStyle:{height:"100%"},attrs:{span:11}},[t("span",{staticStyle:{"text-align":"center","line-height":"64px","font-size":"18px"}},[e._v(e._s(i.label))])]),t("i",{staticClass:"el-icon-delete",staticStyle:{color:"tomato",cursor:"pointer",position:"absolute",right:"4px",top:"4px"},on:{click:function(l){return l.stopPropagation(),e.deleteBase("3dBaseLayer",s)}}})],1)})],2)],1)],1),t("layer-directory-baselayer",{ref:"baselayer",on:{"on-baselayer-change":e.onLayerChange},model:{value:e.isBaselayerShow,callback:function(i){e.isBaselayerShow=i},expression:"isBaselayerShow"}})],1)},b=[],p=r(723400),u=r(110563),f=r(42160),v=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{staticClass:"dialog-content",staticStyle:{padding:"0px"},attrs:{title:"\u9009\u62E9\u56FE\u5C42\u76EE\u5F55",top:"10px","append-to-body":!0,"close-on-click-modal":!1,"show-close":!1,visible:e.showDialog,width:"880px"},on:{"update:visible":function(i){e.showDialog=i}}},[t("el-form",{ref:"form",attrs:{"label-width":"80px"}},[t("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"\u5E95\u56FE\u540D\u79F0"}},[t("el-input",{staticStyle:{width:"195px"},model:{value:e.baselayer.label,callback:function(i){e.$set(e.baselayer,"label",i)},expression:"baselayer.label"}})],1),t("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"\u5E95\u56FE\u56FE\u6807"}},[t("select-img",{staticStyle:{"margin-bottom":"20px"},attrs:{image:e.baselayer.imgBI},on:{openSelectImage:function(i){return e.openSelectImage(e.baselayer)},clearSelectImage:function(i){return e.clearSelectImage(e.baselayer)}}})],1)],1),t("div",{staticStyle:{height:"460px"}},[t("el-card",{staticClass:"tocTree",attrs:{header:"\u56FE\u5C42\u5E93\u4E2D\u7684\u56FE\u5C42","body-style":{padding:"5px",backgroundColor:"#fff",height:"360px"}}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("el-tree",{ref:"all_tree",attrs:{data:e.tree,"default-expand-all":"","node-key":"id","show-checkbox":"","highlight-current":"","expand-on-click-node":!1,"default-checked-keys":e.baselayer.select},scopedSlots:e._u([{key:"default",fn:function({node:i,data:s}){return t("span",{staticClass:"custom-tree-node"},[s.tp=="directory"?t("span",{attrs:{title:"\u76EE\u5F55 [ "+i.label+" ]"}},[t("i",{directives:[{name:"show",rawName:"v-show",value:i.expanded===!0,expression:"node.expanded === true"}],staticClass:"iconfont bi-iconfont",style:{color:"#e1b013",fontSize:"20px",marginRight:"10px"}},[e._v("\uE71D")]),t("i",{directives:[{name:"show",rawName:"v-show",value:i.expanded!==!0,expression:"node.expanded !== true"}],staticClass:"iconfont bi-iconfont",style:{color:"#e1b013",fontSize:"20px",marginRight:"10px"}},[e._v("\uE71C")]),e._v(" "+e._s(i.label))]):e._e(),s.tp=="layer"?t("span",{attrs:{title:"\u56FE\u5C42 [ "+i.label+" ]"}},[t("i",{staticClass:"bi-iconfont iconfont",style:{color:e.theme.btn_bgc,fontSize:"16px"}},[e._v("\uE721")]),e._v(e._s(i.label)+" ")]):e._e()])}}])})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelEidt}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getScheme}},[e._v("\u786E \u5B9A")])],1)],1),t("el-dialog",{staticClass:"my-image-dialog",staticStyle:{padding:"0px"},attrs:{title:"\u9009\u62E9\u56FE\u7247",top:"10px","append-to-body":!0,"close-on-click-modal":!1,visible:e.dialogVisibleImg,width:e.dialogWidth},on:{"update:visible":function(i){e.dialogVisibleImg=i}}},[t("div",[t("image-manage",{ref:"imageMange",attrs:{"is-dialog":!0,type:["image"]}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelImgSelect}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getImage}},[e._v("\u786E \u5B9A")])],1)])],1)},x=[],S=r(721829),_=r(582333),w=r(321300),C=r(675434),c=r(555616),d=r(149500),B={name:"LayerDirectoryBaselayer",components:{ImageManage:_.default,selectImg:S.Z},mixins:[p.j],model:{prop:"showDialog",event:"changeShowDialog"},props:{showDialog:{type:Boolean,default:!1}},data(){return{dialogVisibleImg:!1,dialogVisibleScheme:!1,dialogWidth:"90%",baselayer:{},requestList:{directory:[],layer:[]},list:{all:{directory:[],layer:[]},select:[]},tree:[]}},watch:{},mounted(){this.initAllLayer()},methods:{openDialog(a){this.baselayer=JSON.parse(JSON.stringify(a)),d.log(this.baselayer),this.handleData(),this.changeBaselayerDialog(!0)},changeBaselayerDialog(a){this.$emit("changeShowDialog",a)},clearSelectImage(a){a.thumbnailUrl="",a.imgBI="",this.$forceUpdate()},getImage(){let a=this.$refs.imageMange.getSelectImage();if(a!=null){if(this.$$global.fileType.image.indexOf(a.imageFileType)==-1){c.Message.warning("\u9009\u62E9\u7684\u4E0D\u662F\u56FE\u7247");return}this.dialogVisibleImg=!1,this.baselayer.imgBI=a.fileUrlPath;let e=w.appendImageBaseURL(a.fileUrlPath);this.baselayer.thumbnailUrl=e}else c.Message.warning("\u672A\u9009\u62E9\u4EFB\u4F55\u56FE\u7247")},cancelImgSelect(){this.dialogVisibleImg=!1},openSelectImage(a){let e=this;this.dialogVisibleImg=!0,setTimeout(function(){e.$refs.imageMange.getImageList(null),e.selectScatterName=a.type},500)},initAllLayer(){C.N.getLayerTree().then(a=>{a&&a.status==200?(this.requestList.directory=a.data.directoryList,this.requestList.layer=a.data.layerList):c.Message.error({message:a.msg,offset:60})})},handleData(){this.list.all.directory=[],this.list.all.layer=[],this.list.select=[],this.sortingDirectory(),this.sortingLayer(),this.handleTreeData()},sortingDirectory(){this.$$lib__.each(this.requestList.directory,a=>{let e={id:a.directoryId,label:a.directoryName,showIndex:a.sort,initChecked:a.initChecked=="true"||a.initChecked==!0,parent:a.parentId};this.list.all.directory.push(e)})},sortingLayer(){this.$$lib__.each(this.requestList.layer,a=>{let e=JSON.parse(a.layerCongfig);e.id=a.layerId,e.showIndex=a.sort,e.mapIndex=a.mapIndex,e.initChecked=a.initChecked=="true"||a.initChecked==!0,e.parent=a.directoryId,this.list.all.layer.push(e)})},handleTreeData(){this.tree=this.rebuildData(this.$$lib__.sortBy(this.list.all.directory,"showIndex"),this.$$lib__.sortBy(this.list.all.layer,"showIndex"))},getScheme(){let a=this.$refs.all_tree.getCheckedNodes(!0);if(d.log("checkedNodes",a.length),a.length>0&&this.baselayer.label!==void 0&&this.baselayer.label.trim()!==""){let e=[],t=[];this.$$lib__.each(a,i=>{e.push(i.id),this.$$lib__.each(this.list.all.layer,s=>{s.id==i.id&&(s.isDefault=!0,s.isBaseMapLayer=!0,t.push(s))})}),this.baselayer.id=this.baselayer.id?this.baselayer.id:(0,u.newGuid)(),this.baselayer.select=e,this.baselayer.children=t,this.baselayer.thumbnailUrl||(this.baselayer.thumbnailUrl=r(112309)),d.log(this.baselayer),this.$emit("on-baselayer-change",this.baselayer)}else if(a.length<1){this.$message.info("\u672A\u9009\u4E2D\u4EFB\u4F55\u56FE\u5C42");return}else if(this.baselayer.label===void 0||this.baselayer.label.trim()===""){this.$message.info("\u5E95\u56FE\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A");return}this.changeBaselayerDialog(!1)},cancelEidt(){this.changeBaselayerDialog(!1)},rebuildData(a,e){let t=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(a)),s={},l={},h=[];return this.$$lib__.each(t,n=>{n.tp="layer",s[n.parent]||(s[n.parent]=[]),s[n.parent].push(n)}),this.$$lib__.each(i,n=>{n.tp="directory",n.parent!=null?(l[n.parent]||(l[n.parent]=[]),l[n.parent].push(n)):h.push(n)}),this.transferFl(h,l,s),h},transferFl(a,e,t){this.$$lib__.each(a,i=>{let s=e[i.id];s?(i.children=s,t[i.id]&&this.$$lib__.each(t[i.id],l=>{i.children.push(l)}),this.transferFl(s,e,t)):t[i.id]&&(i.children=t[i.id])})}}},D=B,y=r(768141),L=(0,y.Z)(D,v,x,!1,null,"89b6cdae",null),k=L.exports,$={name:"GisLayerBaseData",components:{LayerDirectoryBaselayer:k},mixins:[p.j],props:["currentWidget"],data(){return{dialogType:"2dBaseLayer",baselayerList:[1,2,3,4,5,6,7,8,9],isBaselayerShow:!1,activeNames:["1"],tabActiveNames:"2D"}},methods:{editBaselayer(a,e){this.dialogType=a,this.$refs.baselayer.openDialog(e)},addNewBaselayer(a){this.dialogType=a,this.$refs.baselayer.openDialog({id:(0,u.newGuid)()})},deleteBase(a,e){a==="2dBaseLayer"?this.currentWidget.config.baseLayer.splice(e,1):this.currentWidget.config.baseLayer3d.splice(e,1),this.refreshOptions()},onBaselayer3dChange(a){let e=!1;for(let t in this.currentWidget.config.baseLayer3d)if(this.currentWidget.config.baseLayer3d[t].id===a.id){f.default.set(this.currentWidget.config.baseLayer3d,t,a),e=!0;break}e||(this.currentWidget.config.baseLayer3d.length===0&&(this.currentWidget.config.defaultShow3d=a.id),this.currentWidget.config.baseLayer3d.push(a))},onBaselayerChange(a){let e=!1;for(let t in this.currentWidget.config.baseLayer)if(this.currentWidget.config.baseLayer[t].id===a.id){f.default.set(this.currentWidget.config.baseLayer,t,a),e=!0;break}e||(this.currentWidget.config.baseLayer.length===0&&(this.currentWidget.config.defaultShow=a.id),this.currentWidget.config.baseLayer.push(a))},onLayerChange(a){this.dialogType==="2dBaseLayer"?this.onBaselayerChange(a):this.onBaselayer3dChange(a),this.refreshOptions()},refreshOptions(){this.currentWidget.config.options=[{type:"map",defaultShow:this.currentWidget.config.defaultShow,children:this.currentWidget.config.baseLayer},{type:"earth",defaultShow:this.currentWidget.config.defaultShow3d,children:this.currentWidget.config.baseLayer3d}],this.getConfigData()},onDefaultShowChange(a,e){a==="2dDefaultShow"?this.currentWidget.config.defaultShow=e:this.currentWidget.config.defaultShow3d=e,this.refreshOptions()}}},I=$,W=(0,y.Z)(I,m,b,!1,null,"5eb78bdd",null),N=W.exports},112309:function(g,o,r){g.exports=r.p+"static/img/defaultBaseMap.2cbdaf44.png"}}]);
