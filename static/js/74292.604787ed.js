"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[74292],{56279:function(L,y,a){a.d(y,{P:function(){return d}});var g=a(386892),p=a(149500);const d={mixins:[g.D],created(){},methods:{lifecycleBeforeChartsLoad(v){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&p.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let b=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[v]);if(b)return b}return v},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&p.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),p.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},752246:function(L,y,a){a.d(y,{X:function(){return g},b:function(){return p}});let g={versions:function(){var d=navigator.userAgent;return{trident:d.indexOf("Trident")>-1,presto:d.indexOf("Presto")>-1,webKit:d.indexOf("AppleWebKit")>-1,gecko:d.indexOf("Gecko")>-1&&d.indexOf("KHTML")==-1,mobile:!!d.match(/AppleWebKit.*Mobile.*/),ios:!!d.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:d.indexOf("Android")>-1,iPhone:d.indexOf("iPhone")>-1,iPad:d.indexOf("iPad")>-1,webApp:d.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},p;g.versions.mobile||g.versions.ios||g.versions.android||g.versions.iPhone||g.versions.iPad?p=!1:p=!0},274292:function(L,y,a){a.r(y),a.d(y,{default:function(){return z}});var g=function(){var e=this,i=e._self._c;return i("div",{style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px"}},[i("hide-button",{attrs:{attr:e.widgetInfo.attr}}),i("div",{ref:"sankeySimple",style:{width:e.widgetInfo.attr.w+"px",height:e.widgetInfo.attr.hh+"px"}})],1)},p=[],d=a(844513),v=a(927966),x=a(624553),b=a(56279),N=a(445061),$=a(126711),w=a(99349),l=a(555616),S=a(275770),J=a(67157),C=a(150813);const k={mixins:[J.c],data(){return{config_extend:{config:{series:{label:{fontSize:14}}}},filter_config:{title:JSON.parse(JSON.stringify(C.Z.charts.title)),legend:JSON.parse(JSON.stringify(C.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(C.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(C.Z.charts.toolbox)),series:{colorList:["rgba(76, 132, 255, 0.3)"],levels:[{itemStyle:{normal:{color:"#D13438",borderColor:"#D13438"}}}],label:{color:"#3A4151"},itemColor:[{color:"rgba(76, 132, 255, 0.3)",emphasisColor:"rgba(76, 132, 255, 0.3)"}],itemStyle:{color:"#ec0000",borderColor:"#8A0000",color0:"#00da3c",borderColor0:"#008F28",opacity:1},lineStyle:{opacity:1,color:"source"}}}}},methods:{filterPredefineColoursSchemeConfig(t,e){this.getNewConfigWithArrary(t,e,this.filter_config)}}};var H=a(149500);const A=a(954255);var P={name:"SankeySimple",components:{HideButton:d.Z},mixins:[w.P,b.P,N.u,$.H,x.baseConfig,k],props:["widgetInfo"],data(){return{}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.echarts=A.init(this.$refs.sankeySimple,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo)},destroyed(){this.echarts.dispose()},methods:{loadInfo(t){this.getItemColor(t.dataset.type);let e=t.dataset[t.dataset.type].source,i=t.dataset[t.dataset.type].dimensionsAlias,n=t.dataset[t.dataset.type].encode,r=this.getDataList(n,i,e),h=JSON.parse(JSON.stringify(t.config.title)),I=JSON.parse(JSON.stringify(t.config.legend)),u=this.getTooltip(t.config.tooltip),o=JSON.parse(JSON.stringify(t.config.toolbox)),c=JSON.parse(JSON.stringify(t.config.series)),O=JSON.parse(JSON.stringify(t.config.series.label.formatter));c.links=r.links,c.data=this.getSeriesData();let s={legend:I,tooltip:u,toolbox:o,title:h,series:c};if(s.series.data&&s.series.links&&O.c){for(let f=0;f<s.series.data.length;f++){s.series.data[f].value?s.series.data[f].value=0:s.series.data[f]=Object.assign(s.series.data[f],{value:0});for(let m=0;m<s.series.links.length;m++)s.series.data[f].name==s.series.links[m].target&&(s.series.data[f].value=this.addNum(s.series.data[f].value,s.series.links[m].value))}for(let f=0;f<s.series.data.length;f++)if(s.series.data[f].value==0)for(let m=0;m<s.series.links.length;m++)s.series.data[f].name==s.series.links[m].source&&(s.series.data[f].value=this.addNum(s.series.data[f].value,s.series.links[m].value))}s.series.label.formatter=this.getFormatterString(O),s.series.type="sankey",this.getAnimation(s,t),this.setOption(s),this.setAnimationLoop(t,()=>{this.setOption(s,t)})},setOption(t){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0})},getLength(t){let e;try{const i=t.toString();if(i.search("e")!==-1){const n=parseInt(i.split("e")[1]);e=Math.abs(n)}else e=t.toString().split(".")[1].length}catch{e=0}return e},addNum(t,e){let i,n,r;return i=this.getLength(t),n=this.getLength(e),r=Math.pow(10,Math.max(i,n)+1),(t*r+e*r)/r},getItemColor(t){let e=this,i=[];e.widgetInfo.config.series.itemColor&&e.widgetInfo.config.series.itemColor.length>0?i=JSON.parse(JSON.stringify(e.widgetInfo.config.series.itemColor)):i=e.widgetInfo.config.series.colorList,e.widgetInfo.config.series.itemColor=[];let n=e.widgetInfo.dataset[t].source,r=e.widgetInfo.dataset[t].dimensionsAlias,h=e.widgetInfo.dataset[t].encode,I=this.getDataList(h,r,n);this.$$lib__.each(I.data,(u,o)=>{if(!u.name){e.widgetInfo.config.series.itemColor.push({name:"",color:i[o].color,emphasisColor:i[o].color});return}if(i&&i[o]&&i[o].color)e.widgetInfo.config.series.itemColor.push({name:u.name,color:i[o].color,emphasisColor:i[o].color});else{let c=e.widgetInfo.config.series.colorList;e.widgetInfo.config.series.itemColor.push({name:u.name,color:c[o]?c[o]:c[o%c],emphasisColor:c[o]?c[o]:c[o%c]})}})},getSeriesData(){let t=[];if(this.widgetInfo.config.series.dataItemStyle.itemStyleType=="simple")this.$$lib__.each(this.widgetInfo.config.series.itemColor,e=>{t.push({name:e.name,itemStyle:{normal:{color:e.color},emphasis:{color:e.emphasisColor}}})});else if(this.widgetInfo.config.series.dataItemStyle.itemStyleType=="multiple"){let e=this.widgetInfo.config.series.dataItemStyle.nodeStyle.length;this.$$lib__.each(this.widgetInfo.config.series.itemColor,(i,n)=>{if(e>0){let r=this.$$lib__.find(this.widgetInfo.config.series.dataItemStyle.nodeStyle,h=>h.name&&h.name!=""&&h.name==i.name);if(r)t.push(JSON.parse(JSON.stringify(r)));else{let h={};if(n<e)h=JSON.parse(JSON.stringify(this.widgetInfo.config.series.dataItemStyle.nodeStyle[n]));else{let I=parseInt(n%e);h=JSON.parse(JSON.stringify(this.widgetInfo.config.series.dataItemStyle.nodeStyle[I]))}h.name=i.name,t.push(h)}}else t.push({name:i.name})})}return t},getLegendData(t,e){let i=[];return this.$$lib__.each(t,n=>{n.name&&i.push(n.name)}),this.$$lib__.each(e,n=>{n.name&&i.push(n.name)}),i},reLoadInfo(t){t&&(this.$refs.sankeySimple.style.width=t.attr.w+"px",this.$refs.sankeySimple.style.height=t.attr.hh+"px"),this.loadInfo(t),this.echarts.resize()},getDataList(t,e,i){let n=null,r=null,h=null,I=[],u=[];return this.$$lib__.each(e,(o,c)=>{o.name==t.key&&(n=c),o.name==t.linkKey&&(r=c),o.name==t.value&&(h=c)}),this.$$lib__.each(i,o=>{I.push({source:o[n],target:o[r],value:o[h]});let c=this.$$lib__.find(u,s=>s.name==o[n]);o[n]!=""&&!c&&u.push({name:o[n]});let O=this.$$lib__.find(u,s=>s.name==o[r]);o[r]!=""&&!O&&u.push({name:o[r]})}),{links:I,data:u}},initAction(t){this.actionSendout(t),this.actionReceive(t)},actionSendout(t){let e=this;this.$$lib__.each(t.action.sendOut.actionList,i=>{if(i.enabled){let n=i.code+"_"+t.id;if(i.paramsExtend&&i.paramsExtend.length>0){let r={};this.getParamsExtend(r,i.paramsExtend,t)}i.code==S.default.click.code&&e.onClick(n,i)}})},onClick(t,e){let i=this;i.echarts.on("click",n=>{let r={};if(r.value=n.value,e.script&&e.script.enabled){if(H.log("Execute script for "+i.widgetInfo.name+" component to "+e.name+" component"),e.script.content==""){l.Message.warning({message:e.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript=new Function("param",e.script.content),r=this.customScript(r)}v.Z.$emit(t,r),e.postMessage&&i.doPostMessage(r),i.actionNameList.push(t)})}}},D=P,M=a(768141),T=(0,M.Z)(D,g,p,!1,null,"bb0f87d0",null),z=T.exports},844513:function(L,y,a){a.d(y,{Z:function(){return $}});var g=function(){var l=this,S=l._self._c;return l.attr.buttonHide?S("div",{style:{position:"absolute",right:l.attr.buttonHideRight+"px",top:l.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(J){return l.onHide()}}},[l.openTooltip?S("el-tooltip",{attrs:{"open-delay":1e3,content:l.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[S("el-button",{class:l.attr.buttonHideIconClass&&l.attr.buttonHideIconClass!=""?l.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:l.attr.buttonHideColor,fontSize:l.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):S("el-button",{class:l.attr.buttonHideIconClass&&l.attr.buttonHideIconClass!=""?l.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:l.attr.buttonHideColor,fontSize:l.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):l._e()},p=[],d=a(752246),v={props:["attr"],name:"hide-button",data(){return{isPc:d.b}},computed:{openTooltip:function(){let w=!1,l=this.attr.buttonHideTooltipContent;return d.b&&l&&l!=null&&l.trim()!=""&&(w=!0),w}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},x=v,b=a(768141),N=(0,b.Z)(x,g,p,!1,null,"bf399b9a",null),$=N.exports}}]);
