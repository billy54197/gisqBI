"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[3210],{96411:function(le,_,G){G.d(_,{Z:function(){return X}});function oe(L,p){let E=L.length-p,R=0;do{for(let P=p;P>0;P--)L[R+p]+=L[R],R++;E-=p}while(E>0)}function ce(L,p,E){let R=0,P=L.length;const B=P/E;for(;P>p;){for(let A=p;A>0;--A)L[R+p]+=L[R],++R;P-=p}const q=L.slice();for(let A=0;A<B;++A)for(let j=0;j<E;++j)L[E*A+j]=q[(E-j-1)*B+A]}function Z(L,p,E,R,P,B){if(!p||p===1)return L;for(let j=0;j<P.length;++j){if(P[j]%8!==0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(P[j]!==P[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const q=P[0]/8,A=B===2?1:P.length;for(let j=0;j<R&&!(j*A*E*q>=L.byteLength);++j){let J;if(p===2){switch(P[0]){case 8:J=new Uint8Array(L,j*A*E*q,A*E*q);break;case 16:J=new Uint16Array(L,j*A*E*q,A*E*q/2);break;case 32:J=new Uint32Array(L,j*A*E*q,A*E*q/4);break;default:throw new Error(`Predictor 2 not allowed with ${P[0]} bits per sample.`)}oe(J,A,q)}else p===3&&(J=new Uint8Array(L,j*A*E*q,A*E*q),ce(J,A,q))}return L}class X{async decode(p,E){const R=await this.decodeBlock(E),P=p.Predictor||1;if(P!==1){const B=!p.StripOffsets,q=B?p.TileWidth:p.ImageWidth,A=B?p.TileLength:p.RowsPerStrip||p.ImageLength;return Z(R,P,q,A,p.BitsPerSample,p.PlanarConfiguration)}return R}}},53210:function(le,_,G){G.r(_),G.d(_,{default:function(){return fe}});var oe=G(96411),ce=G(49500);const Z=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),X=4017,L=799,p=3406,E=2276,R=1567,P=3784,B=5793,q=2896;function A(H,l){let o=0;const u=[];let M=16;for(;M>0&&!H[M-1];)--M;u.push({children:[],index:0});let C=u[0],g;for(let t=0;t<M;t++){for(let h=0;h<H[t];h++){for(C=u.pop(),C.children[C.index]=l[o];C.index>0;)C=u.pop();for(C.index++,u.push(C);u.length<=t;)u.push(g={children:[],index:0}),C.children[C.index]=g.children,C=g;o++}t+1<M&&(u.push(g={children:[],index:0}),C.children[C.index]=g.children,C=g)}return u[0].children}function j(H,l,o,u,M,C,g,t,h){const{mcusPerLine:d,progressive:r}=o,c=l;let F=l,i=0,b=0;function m(){if(b>0)return b--,i>>b&1;if(i=H[F++],i===255){const a=H[F++];if(a)throw new Error(`unexpected marker: ${(i<<8|a).toString(16)}`)}return b=7,i>>>7}function x(a){let f=a,w;for(;(w=m())!==null;){if(f=f[w],typeof f=="number")return f;if(typeof f!="object")throw new Error("invalid huffman sequence")}return null}function v(a){let f=a,w=0;for(;f>0;){const S=m();if(S===null)return;w=w<<1|S,--f}return w}function k(a){const f=v(a);return f>=1<<a-1?f:f+(-1<<a)+1}function y(a,f){const w=x(a.huffmanTableDC),S=w===0?0:k(w);a.pred+=S,f[0]=a.pred;let I=1;for(;I<64;){const U=x(a.huffmanTableAC),O=U&15,W=U>>4;if(O===0){if(W<15)break;I+=16}else{I+=W;const z=Z[I];f[z]=k(O),I++}}}function D(a,f){const w=x(a.huffmanTableDC),S=w===0?0:k(w)<<h;a.pred+=S,f[0]=a.pred}function s(a,f){f[0]|=m()<<h}let n=0;function T(a,f){if(n>0){n--;return}let w=C;const S=g;for(;w<=S;){const I=x(a.huffmanTableAC),U=I&15,O=I>>4;if(U===0){if(O<15){n=v(O)+(1<<O)-1;break}w+=16}else{w+=O;const W=Z[w];f[W]=k(U)*(1<<h),w++}}}let e=0,re;function ue(a,f){let w=C;const S=g;let I=0;for(;w<=S;){const U=Z[w],O=f[U]<0?-1:1;switch(e){case 0:{const W=x(a.huffmanTableAC),z=W&15;if(I=W>>4,z===0)I<15?(n=v(I)+(1<<I),e=4):(I=16,e=1);else{if(z!==1)throw new Error("invalid ACn encoding");re=k(z),e=I?2:3}continue}case 1:case 2:f[U]?f[U]+=(m()<<h)*O:(I--,I===0&&(e=e===2?3:0));break;case 3:f[U]?f[U]+=(m()<<h)*O:(f[U]=re<<h,e=0);break;case 4:f[U]&&(f[U]+=(m()<<h)*O);break;default:break}w++}e===4&&(n--,n===0&&(e=0))}function he(a,f,w,S,I){const U=w/d|0,O=w%d,W=U*a.v+S,z=O*a.h+I;f(a,a.blocks[W][z])}function de(a,f,w){const S=w/a.blocksPerLine|0,I=w%a.blocksPerLine;f(a,a.blocks[S][I])}const ee=u.length;let K,V,ne,te,$,N;r?C===0?N=t===0?D:s:N=t===0?T:ue:N=y;let Y=0,se,Q;ee===1?Q=u[0].blocksPerLine*u[0].blocksPerColumn:Q=d*o.mcusPerColumn;const ie=M||Q;for(;Y<Q;){for(V=0;V<ee;V++)u[V].pred=0;if(n=0,ee===1)for(K=u[0],$=0;$<ie;$++)de(K,N,Y),Y++;else for($=0;$<ie;$++){for(V=0;V<ee;V++){K=u[V];const{h:a,v:f}=K;for(ne=0;ne<f;ne++)for(te=0;te<a;te++)he(K,N,Y,ne,te)}if(Y++,Y===Q)break}if(b=0,se=H[F]<<8|H[F+1],se<65280)throw new Error("marker was not found");if(se>=65488&&se<=65495)F+=2;else break}return F-c}function J(H,l){const o=[],{blocksPerLine:u,blocksPerColumn:M}=l,C=u<<3,g=new Int32Array(64),t=new Uint8Array(64);function h(d,r,c){const F=l.quantizationTable;let i,b,m,x,v,k,y,D,s;const n=c;let T;for(T=0;T<64;T++)n[T]=d[T]*F[T];for(T=0;T<8;++T){const e=8*T;if(n[1+e]===0&&n[2+e]===0&&n[3+e]===0&&n[4+e]===0&&n[5+e]===0&&n[6+e]===0&&n[7+e]===0){s=B*n[0+e]+512>>10,n[0+e]=s,n[1+e]=s,n[2+e]=s,n[3+e]=s,n[4+e]=s,n[5+e]=s,n[6+e]=s,n[7+e]=s;continue}i=B*n[0+e]+128>>8,b=B*n[4+e]+128>>8,m=n[2+e],x=n[6+e],v=q*(n[1+e]-n[7+e])+128>>8,D=q*(n[1+e]+n[7+e])+128>>8,k=n[3+e]<<4,y=n[5+e]<<4,s=i-b+1>>1,i=i+b+1>>1,b=s,s=m*P+x*R+128>>8,m=m*R-x*P+128>>8,x=s,s=v-y+1>>1,v=v+y+1>>1,y=s,s=D+k+1>>1,k=D-k+1>>1,D=s,s=i-x+1>>1,i=i+x+1>>1,x=s,s=b-m+1>>1,b=b+m+1>>1,m=s,s=v*E+D*p+2048>>12,v=v*p-D*E+2048>>12,D=s,s=k*L+y*X+2048>>12,k=k*X-y*L+2048>>12,y=s,n[0+e]=i+D,n[7+e]=i-D,n[1+e]=b+y,n[6+e]=b-y,n[2+e]=m+k,n[5+e]=m-k,n[3+e]=x+v,n[4+e]=x-v}for(T=0;T<8;++T){const e=T;if(n[1*8+e]===0&&n[2*8+e]===0&&n[3*8+e]===0&&n[4*8+e]===0&&n[5*8+e]===0&&n[6*8+e]===0&&n[7*8+e]===0){s=B*c[T+0]+8192>>14,n[0*8+e]=s,n[1*8+e]=s,n[2*8+e]=s,n[3*8+e]=s,n[4*8+e]=s,n[5*8+e]=s,n[6*8+e]=s,n[7*8+e]=s;continue}i=B*n[0*8+e]+2048>>12,b=B*n[4*8+e]+2048>>12,m=n[2*8+e],x=n[6*8+e],v=q*(n[1*8+e]-n[7*8+e])+2048>>12,D=q*(n[1*8+e]+n[7*8+e])+2048>>12,k=n[3*8+e],y=n[5*8+e],s=i-b+1>>1,i=i+b+1>>1,b=s,s=m*P+x*R+2048>>12,m=m*R-x*P+2048>>12,x=s,s=v-y+1>>1,v=v+y+1>>1,y=s,s=D+k+1>>1,k=D-k+1>>1,D=s,s=i-x+1>>1,i=i+x+1>>1,x=s,s=b-m+1>>1,b=b+m+1>>1,m=s,s=v*E+D*p+2048>>12,v=v*p-D*E+2048>>12,D=s,s=k*L+y*X+2048>>12,k=k*X-y*L+2048>>12,y=s,n[0*8+e]=i+D,n[7*8+e]=i-D,n[1*8+e]=b+y,n[6*8+e]=b-y,n[2*8+e]=m+k,n[5*8+e]=m-k,n[3*8+e]=x+v,n[4*8+e]=x-v}for(T=0;T<64;++T){const e=128+(n[T]+8>>4);e<0?r[T]=0:e>255?r[T]=255:r[T]=e}}for(let d=0;d<M;d++){const r=d<<3;for(let c=0;c<8;c++)o.push(new Uint8Array(C));for(let c=0;c<u;c++){h(l.blocks[d][c],t,g);let F=0;const i=c<<3;for(let b=0;b<8;b++){const m=o[r+b];for(let x=0;x<8;x++)m[i+x]=t[F++]}}}return o}class ae{constructor(){this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}resetFrames(){this.frames=[]}parse(l){let o=0;function u(){const t=l[o]<<8|l[o+1];return o+=2,t}function M(){const t=u(),h=l.subarray(o,o+t-2);return o+=h.length,h}function C(t){let h=0,d=0,r,c;for(c in t.components)t.components.hasOwnProperty(c)&&(r=t.components[c],h<r.h&&(h=r.h),d<r.v&&(d=r.v));const F=Math.ceil(t.samplesPerLine/8/h),i=Math.ceil(t.scanLines/8/d);for(c in t.components)if(t.components.hasOwnProperty(c)){r=t.components[c];const b=Math.ceil(Math.ceil(t.samplesPerLine/8)*r.h/h),m=Math.ceil(Math.ceil(t.scanLines/8)*r.v/d),x=F*r.h,v=i*r.v,k=[];for(let y=0;y<v;y++){const D=[];for(let s=0;s<x;s++)D.push(new Int32Array(64));k.push(D)}r.blocksPerLine=b,r.blocksPerColumn=m,r.blocks=k}t.maxH=h,t.maxV=d,t.mcusPerLine=F,t.mcusPerColumn=i}let g=u();if(g!==65496)throw new Error("SOI not found");for(g=u();g!==65497;){switch(g){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:{const t=M();g===65504&&t[0]===74&&t[1]===70&&t[2]===73&&t[3]===70&&t[4]===0&&(this.jfif={version:{major:t[5],minor:t[6]},densityUnits:t[7],xDensity:t[8]<<8|t[9],yDensity:t[10]<<8|t[11],thumbWidth:t[12],thumbHeight:t[13],thumbData:t.subarray(14,14+3*t[12]*t[13])}),g===65518&&t[0]===65&&t[1]===100&&t[2]===111&&t[3]===98&&t[4]===101&&t[5]===0&&(this.adobe={version:t[6],flags0:t[7]<<8|t[8],flags1:t[9]<<8|t[10],transformCode:t[11]});break}case 65499:{const h=u()+o-2;for(;o<h;){const d=l[o++],r=new Int32Array(64);if(d>>4)if(d>>4===1)for(let c=0;c<64;c++){const F=Z[c];r[F]=u()}else throw new Error("DQT: invalid table spec");else for(let c=0;c<64;c++){const F=Z[c];r[F]=l[o++]}this.quantizationTables[d&15]=r}break}case 65472:case 65473:case 65474:{u();const t={extended:g===65473,progressive:g===65474,precision:l[o++],scanLines:u(),samplesPerLine:u(),components:{},componentsOrder:[]},h=l[o++];let d;for(let r=0;r<h;r++){d=l[o];const c=l[o+1]>>4,F=l[o+1]&15,i=l[o+2];t.componentsOrder.push(d),t.components[d]={h:c,v:F,quantizationIdx:i},o+=3}C(t),this.frames.push(t);break}case 65476:{const t=u();for(let h=2;h<t;){const d=l[o++],r=new Uint8Array(16);let c=0;for(let i=0;i<16;i++,o++)r[i]=l[o],c+=r[i];const F=new Uint8Array(c);for(let i=0;i<c;i++,o++)F[i]=l[o];h+=17+c,d>>4?this.huffmanTablesAC[d&15]=A(r,F):this.huffmanTablesDC[d&15]=A(r,F)}break}case 65501:u(),this.resetInterval=u();break;case 65498:{u();const t=l[o++],h=[],d=this.frames[0];for(let b=0;b<t;b++){const m=d.components[l[o++]],x=l[o++];m.huffmanTableDC=this.huffmanTablesDC[x>>4],m.huffmanTableAC=this.huffmanTablesAC[x&15],h.push(m)}const r=l[o++],c=l[o++],F=l[o++],i=j(l,o,d,h,this.resetInterval,r,c,F>>4,F&15);o+=i;break}case 65535:l[o]!==255&&o--;break;default:if(l[o-3]===255&&l[o-2]>=192&&l[o-2]<=254){o-=3;break}throw new Error(`unknown JPEG marker ${g.toString(16)}`)}g=u()}}getResult(){const{frames:l}=this;if(this.frames.length===0)throw new Error("no frames were decoded");this.frames.length>1&&ce.warn("more than one frame is not supported");for(let r=0;r<this.frames.length;r++){const c=this.frames[r].components;for(const F of Object.keys(c))c[F].quantizationTable=this.quantizationTables[c[F].quantizationIdx],delete c[F].quantizationIdx}const o=l[0],{components:u,componentsOrder:M}=o,C=[],g=o.samplesPerLine,t=o.scanLines;for(let r=0;r<M.length;r++){const c=u[M[r]];C.push({lines:J(o,c),scaleX:c.h/o.maxH,scaleY:c.v/o.maxV})}const h=new Uint8Array(g*t*C.length);let d=0;for(let r=0;r<t;++r)for(let c=0;c<g;++c)for(let F=0;F<C.length;++F){const i=C[F];h[d]=i.lines[0|r*i.scaleY][0|c*i.scaleX],++d}return h}}class fe extends oe.Z{constructor(l){super(),this.reader=new ae,l.JPEGTables&&this.reader.parse(l.JPEGTables)}decodeBlock(l){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(l)),this.reader.getResult().buffer}}}}]);
