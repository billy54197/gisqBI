"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[8090],{56279:function($,S,r){r.d(S,{P:function(){return N}});var C=r(86892),w=r(49500);const N={mixins:[C.D],created(){},methods:{lifecycleBeforeChartsLoad(x){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&w.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),w.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let b=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[x]);if(b)return b}return x},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&w.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),w.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},8090:function($,S,r){r.r(S),r.d(S,{default:function(){return j}});var C=function(){var s=this,l=s._self._c;return l("div",{ref:"myBar",style:{width:s.widgetInfo.attr.w+"px",height:s.widgetInfo.attr.hh+"px"}},[l("hide-button",{attrs:{attr:s.widgetInfo.attr}}),l("div",{ref:"barNegative",style:{width:s.widgetInfo.attr.w+"px"}})],1)},w=[],N=r(44513),x=r(27966),L=r(94480),b=r(45061),Z=r(26711),B=r(99349),P=r(55616),R=r(75770),M=r(67157),p=r(50666);const T={mixins:[M.c],data(){return{config_extend:{},filter_config:{title:JSON.parse(JSON.stringify(p.Z.charts.title)),legend:JSON.parse(JSON.stringify(p.Z.charts.legend)),tooltip:JSON.parse(JSON.stringify(p.Z.charts.tooltip)),toolbox:JSON.parse(JSON.stringify(p.Z.charts.toolbox)),visualMap:{inRange:{color:["#000000"]}},dataZoom:JSON.parse(JSON.stringify(p.Z.charts.dataZoom)),xAxis:JSON.parse(JSON.stringify(p.Z.charts.xAxis)),yAxis:JSON.parse(JSON.stringify(p.Z.charts.yAxis)),series:[{itemStyle:{colorInfo:[{type:"gradation",pureColor:"",gradation:{top:"rgba(146, 203, 255, 1)",bottom:"rgba(20, 122, 217, 1)"}}],opacity:1}}]}}},methods:{filterPredefineColoursSchemeConfig(t,s){this.getNewConfigWithArrary(t,s,this.filter_config)}}};var V=r(56279),g=r(49500);const J=r(29426);var G={name:"BarNegative",components:{HideButton:N.Z},mixins:[L.u,b.u,Z.H,V.P,B.P,T],props:["widgetInfo"],data(){return{dimensionsAliasEx:null}},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo)}},mounted(){this.setContentAreaStyle(this.widgetInfo),this.echarts=J.init(this.$refs.barNegative,null,{devicePixelRatio:2}),this.initAction(this.widgetInfo),this.loadInfo(this.widgetInfo),this.initClick(this.widgetInfo)},destroyed(){this.echarts.dispose(),this.clearAutoCarousel()},methods:{loadInfo(t){t.dataset[t.dataset.type]&&(this.source=t.dataset[t.dataset.type].source,this.dimensionsEx=t.dataset[t.dataset.type].dimensions),t.config.drillDown&&t.config.drillDown.enable==!0?(this.drillDown=JSON.parse(JSON.stringify(t.config.drillDown)),delete this.drillDown.graphic,this.drillDown.pid_arrary=[],this.doDrillDown(t,!0)):this.beforeRenderEcharts(t,this.source)},renderEcharts(t,s){let l=[],o=[];t.dataset[t.dataset.type]&&(l=t.dataset[t.dataset.type].dimensions,o=t.dataset[t.dataset.type].dimensionsAlias),this.dimensionsAliasEx=o;let e=JSON.parse(JSON.stringify(t.config.series)),d=this.getTooltip(t.config.tooltip),v=JSON.parse(JSON.stringify(t.config.toolbox)),Y=this.getTooltip(t.config.dataZoom),n=JSON.parse(JSON.stringify(t.config.legend)),h=JSON.parse(JSON.stringify(t.config.title)),D=JSON.parse(JSON.stringify(t.config.grid)),O=this.getxAxis(t.config.xAxis);O.axisLine.lineStyle.color=this.getColorInfo(O.axisLine.lineStyle.colorInfo);let I=this.getyAxis(t.config.yAxis);I.axisLine.lineStyle.color=this.getColorInfo(I.axisLine.lineStyle.colorInfo);let E=[];if(t.config.drillDown&&t.config.drillDown.enable==!0){let i=this.getGraphic(t.config.drillDown.graphic);i&&i.elements&&i.elements.length>0&&(i.elements[0].ignore=this.drillDown.pid_arrary.length<1),E.push(i)}for(let i=0;i<e.length;i++){e[i].dimensions=l,e[i].type="bar",e[i].barGap&&(e[i].barGap=e[i].barGap+"%"),e[i].barWidth&&(e[i].barWidth=e[i].barWidth+"%"),e[i].itemStyle.barBorderRadiusInfo&&(e[i].itemStyle.barBorderRadius=this.getItemStyleBarBorderRadius(e[i].itemStyle.barBorderRadiusInfo)),e[i].name||(e[i].name=this.getLegendData(o,e[i].encode.x),t.config.series[i].name=e[i].name),e[i].itemStyle.colorInfo[0].type&&(e[i].itemStyle.color=this.getItemStyleColor(e[i].itemStyle.colorInfo[0])),e[i].label=this.getLabelStyle(e[i].label);let m={},c=[],F=[];for(let a=e[i].dimensions.length-1;a>-1;--a)m[l[a]]=a;for(let a=0;a<s.length;++a){let u=s[a],f={};for(let A in m)f[A]=u[m[A]]||"";c.push({name:u[m[e[i].encode.y]]||"",value:u[m[e[i].encode.x]]||"",itemStyle:{color:e[i].itemStyle.colorInfo[a]?this.getItemStyleColor(e[i].itemStyle.colorInfo[a]):this.getItemStyleColor(e[i].itemStyle.colorInfo[0])},row:f}),F.push(u[m[e[i].encode.y]]||""),e[i].label.show&&e[i].label.position&&u[m[e[i].encode.x]]<0&&(e[i].label.position==="left"&&(c[a].label={position:"right"}),e[i].label.position==="right"&&(c[a].label={position:"left"}))}if(e[i].data=c,e[i].emphasis)try{let a=e[i].emphasis;if(a.script&&a.script.enabled){if(a.script.content){let u=new Function("index","item","data",a.script.content);if(c&&c.length>0)for(let f=0;f<c.length;++f)try{c[f].emphasis=u.call(this,f,c[f],c)}catch(A){g.error("\u5904\u7406\u81EA\u5B9A\u4E49\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",A)}}}else a.itemStyle&&a.itemStyle.color&&(e[i].emphasis={itemStyle:{...a.itemStyle}})}catch(a){g.error("\u5904\u7406\u9AD8\u4EAE\u6837\u5F0F\u51FA\u9519\uFF1A",a)}I.data=F}let y={color:this.$$global_editor.predefineColors,tooltip:d,toolbox:v,dataZoom:Y,visualMap:t.config.visualMap.show?this.getVisualMap(t.config.visualMap):"",title:{show:h.show,text:h.text,link:h.link,textAlign:h.textAlign,left:h.left+"%",right:h.right+"%",top:h.top+"%",bottom:h.bottom+"%",textStyle:{fontSize:h.textStyle.fontSize,fontFamily:h.textStyle.fontFamily,color:h.textStyle.color}},legend:{show:n.show,type:n.type,itemWidth:n.itemWidth,itemHeight:n.itemHeight,icon:n.icon,orient:n.orient,align:n.align,itemGap:n.itemGap,left:n.left+"%",right:n.right+"%",top:n.top+"%",bottom:n.bottom+"%",textStyle:{fontSize:n.textStyle.fontSize,fontFamily:n.textStyle.fontFamily,color:n.textStyle.color}},graphic:E,grid:{left:D.left+"%",right:D.right+"%",top:D.top+"%",bottom:D.bottom+"%",containLabel:!0},xAxis:O,yAxis:I,dataset:{source:s,sourceHeader:!1},series:e};y.xAxis.min==""&&delete y.xAxis.min,y.xAxis.max==""&&delete y.xAxis.max,this.getAnimation(y,t),this.setOption(y),this.setAnimationLoop(t,()=>{this.setOption(y,t)})},setOption(t){this.echarts.getOption()&&this.echarts.clear(),this.echarts.setOption(this.lifecycleBeforeChartsLoad(t),{notMerge:!0})},reLoadInfo(t){this.mergeConfig(t),this.setContentAreaStyle(t),this.loadInfo(t),this.echarts.resize()},setContentAreaStyle(t){t&&(this.$refs.barNegative.style.width=t.attr.w+"px",this.$refs.myBar.style.overflowX="hidden",t.config.contentArea.show?(this.$refs.barNegative.style.height=t.dataset[t.dataset.type].source.length*t.config.contentArea.barAllW+"px",this.$refs.barNegative.style.marginTop=t.config.contentArea.top+"px",this.$refs.myBar.style.overflowY=t.config.contentArea.scrollAreay?"auto":"hidden"):(this.$refs.barNegative.style.height=t.attr.hh+"px",this.$refs.barNegative.style.marginTop="0px",this.$refs.myBar.style.overflowY="hidden"))},getLegendData(t,s){let l=this.$$lib__.find(t,o=>o.name==s);return l?l.alias&&l.alias!=""?l.alias:l.name:""},getItemStyleColor(t){let s=null;return t.pureColor&&t.type==this.$$global_editor.colorType.pureColor.code?s=t.pureColor:t.type==this.$$global_editor.colorType.gradation.code&&(s=new J.graphic.LinearGradient(1,0,0,0,[{offset:0,color:t.gradation.top!=null&&t.gradation.top!=""?t.gradation.top:"#FFFFFF"},{offset:1,color:t.gradation.bottom!=null&&t.gradation.bottom!=""?t.gradation.bottom:"#FFFFFF"}])),s},getItemStyleBarBorderRadius(t){let s=[];return s.push(t.lt),s.push(t.rt),s.push(t.rb),s.push(t.lb),s},initAction(t){this.actionReceive(t)},doDrillDown(t,s){let l=[];if(this.drillDown.pidValue&&this.drillDown.id&&this.drillDown.pid){let o={};for(let e=this.dimensionsEx.length-1;e>-1;--e)o[this.dimensionsEx[e]]=e;for(let e=0;e<this.source.length;++e){let d=this.source[e];d[o[this.drillDown.pid]]==this.drillDown.pidValue&&l.push(JSON.parse(JSON.stringify(d)))}}else g.error("\u5FC5\u987B\u914D\u7F6E\u4E0B\u94BB\u7684\u3010\u4E0A\u7EA7\u6570\u503C\u3001\u6570\u636E\u5B57\u6BB5\u3001\u4E0A\u7EA7\u5B57\u6BB5\u3011");if(l.length>0)this.beforeRenderEcharts(t,l);else{let o=this.drillDown.pid_arrary.length-1;this.drillDown.pid_arrary.length=o>0?o:0,g.info("\u4E0B\u94BB\u5DF2\u65E0\u6570\u636E"),s&&this.renderEcharts(t,l)}},initClick(t){this.echarts.on("click",s=>{if(s.componentType=="graphic"){if(this.drillDown&&this.drillDown.enable==!0){let l=this.drillDown.pid_arrary.length;l>0?(this.drillDown.pidValue=this.drillDown.pid_arrary[l-1],this.drillDown.pid_arrary.length=l-1,this.drillDown.pidValue?this.doDrillDown(t):g.error("\u4E0B\u94BB\u5B57\u6BB5\u672A\u83B7\u53D6\u5230\u6709\u6548\u503C")):g.error("\u5DF2\u7ECF\u662F\u6700\u9876\u7EA7\uFF0C\u4E0D\u53EF\u4EE5\u518D\u8FD4\u56DE")}}else s.componentType=="series"&&(this.actionOnClick(t,s),this.drillDown&&this.drillDown.enable==!0&&(this.drillDown.pid_arrary.length==0?this.drillDown.pid_arrary.push(t.config.drillDown.pidValue):this.$$lib__.contains(this.drillDown.pid_arrary,this.drillDown.pidValue)||this.drillDown.pid_arrary.push(this.drillDown.pidValue),this.drillDown.pidValue=s.data.row[this.drillDown.id],this.drillDown.pidValue?this.doDrillDown(t):g.error("\u4E0B\u94BB\u5B57\u6BB5\u672A\u83B7\u53D6\u5230\u6709\u6548\u503C")))})},actionOnClick(t,s){let l=this;this.$$lib__.each(t.action.sendOut.actionList,o=>{if(o.enabled){let e=o.code+"_"+t.id;if(o.paramsExtend&&o.paramsExtend.length>0){let d={};this.getParamsExtend(d,o.paramsExtend,t)}if(o.code==R.Z.click.code){let d={};d.x=s.name,d.y=s.value;let v=[];if(t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(v=t.dataset[t.dataset.type].source[s.dataIndex]),l.getExtendParams(d,o.paramsExtend,v,t.dataset[t.dataset.type].dimensions),o.script&&o.script.enabled){if(g.log("Execute script for "+t.name+" component to "+o.name+" component"),o.script.content==""){P.Message.warning({message:o.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}this.customScript_actionSend_clickParam=new Function("param,params",o.script.content),d=this.customScript_actionSend_clickParam(d,s)}x.Z.$emit(e,d),o.postMessage&&l.doPostMessage(d)}}})},getFieldIndex(t,s){for(let l=0;l<t.length;l++)if(t[l]==s)return l},beforeRenderEcharts(t,s){this.clearAutoCarousel(),t.config.autoCarousel.enable==!0?this.setAutoCarousel(t,s):this.renderEcharts(t,s)}}},z=G,H=r(68141),W=(0,H.Z)(z,C,w,!1,null,"576c60d7",null),j=W.exports}}]);
