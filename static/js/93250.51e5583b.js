"use strict";(self.webpackChunkdatavisual=self.webpackChunkdatavisual||[]).push([[93250],{56279:function(L,b,r){r.d(b,{P:function(){return l}});var u=r(386892),h=r(149500);const l={mixins:[u.D],created(){},methods:{lifecycleBeforeChartsLoad(v){if(this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.beforeChartsLoad&&this.widgetInfo.action.lifecycle.beforeChartsLoad.enabled){(!this.widgetInfo.action.lifecycle.beforeChartsLoad.script||!this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content||this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content=="")&&h.warn("\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C\u4E3A\u7A7A"),h.info("\u6267\u884C\u5E38\u89C4\u56FE\u8868["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u524D\u7684\u811A\u672C");let y=new Function("option",this.widgetInfo.action.lifecycle.beforeChartsLoad.script.content).apply(this,[v]);if(y)return y}return v},lifecycleAfterLoad(){this.widgetInfo.action&&this.widgetInfo.action.lifecycle&&this.widgetInfo.action.lifecycle.afterLoad&&this.widgetInfo.action.lifecycle.afterLoad.enabled&&((!this.widgetInfo.action.lifecycle.afterLoad.script||!this.widgetInfo.action.lifecycle.afterLoad.script.content||this.widgetInfo.action.lifecycle.afterLoad.script.content=="")&&h.warn("\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C\u4E3A\u7A7A"),h.info("\u6267\u884C\u7EC4\u4EF6["+this.widgetInfo.name+"]\u52A0\u8F7D\u4E4B\u540E\u7684\u811A\u672C"),new Function("",this.widgetInfo.action.lifecycle.afterLoad.script.content).apply(this,[]))}}}},752246:function(L,b,r){r.d(b,{X:function(){return u},b:function(){return h}});let u={versions:function(){var l=navigator.userAgent;return{trident:l.indexOf("Trident")>-1,presto:l.indexOf("Presto")>-1,webKit:l.indexOf("AppleWebKit")>-1,gecko:l.indexOf("Gecko")>-1&&l.indexOf("KHTML")==-1,mobile:!!l.match(/AppleWebKit.*Mobile.*/),ios:!!l.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:l.indexOf("Android")>-1,iPhone:l.indexOf("iPhone")>-1,iPad:l.indexOf("iPad")>-1,webApp:l.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},h;u.versions.mobile||u.versions.ios||u.versions.android||u.versions.iPhone||u.versions.iPad?h=!1:h=!0},844513:function(L,b,r){r.d(b,{Z:function(){return S}});var u=function(){var s=this,I=s._self._c;return s.attr.buttonHide?I("div",{style:{position:"absolute",right:s.attr.buttonHideRight+"px",top:s.attr.buttonHideTop+"px",width:"30px",height:"25px",cursor:"pointer",zIndex:"9999"},on:{click:function(x){return s.onHide()}}},[s.openTooltip?I("el-tooltip",{attrs:{"open-delay":1e3,content:s.attr.buttonHideTooltipContent,effect:"dark",placement:"top"}},[I("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):I("el-button",{class:s.attr.buttonHideIconClass&&s.attr.buttonHideIconClass!=""?s.attr.buttonHideIconClass:"iconfont bi_eyeslash",staticStyle:{"margin-left":"6px",padding:"3px 0",width:"15px",height:"15px"},style:{color:s.attr.buttonHideColor,fontSize:s.attr.buttonHideIconFontSize+"px"},attrs:{size:"small",type:"text"}})],1):s._e()},h=[],l=r(752246),v={props:["attr"],name:"hide-button",data(){return{isPc:l.b}},computed:{openTooltip:function(){let k=!1,s=this.attr.buttonHideTooltipContent;return l.b&&s&&s!=null&&s.trim()!=""&&(k=!0),k}},methods:{onHide(){this.attr.hide=!0,this.$emit("sendButtonHide")}}},z=v,y=r(768141),O=(0,y.Z)(z,u,h,!1,null,"bf399b9a",null),S=O.exports},93250:function(L,b,r){r.r(b),r.d(b,{default:function(){return D}});var u=function(){var t=this,i=t._self._c;return i("div",{ref:"rankingCarousel",style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px",overflow:"hidden",cursor:t.getCursor(t.widgetInfo.action,t.$$global_editor.actionType.click.code)},on:{click:t.onClick}},[i("hide-button",{attrs:{attr:t.widgetInfo.attr}}),i("div",{style:{width:t.widgetInfo.attr.w+"px",height:t.widgetInfo.attr.hh+"px",overflow:"hidden",paddingTop:t.widgetInfo.config.board.paddingTop+"px",paddingRight:t.widgetInfo.config.board.paddingRight+"px",paddingBottom:t.widgetInfo.config.board.paddingBottom+"px",paddingLeft:t.widgetInfo.config.board.paddingLeft+"px"}},[i("div",{ref:t.ref,staticClass:"scroll-ranking",style:{width:t.widgetInfo.attr.w-t.widgetInfo.config.board.paddingLeft-t.widgetInfo.config.board.paddingRight+"px",height:t.widgetInfo.attr.hh-t.widgetInfo.config.board.paddingTop-t.widgetInfo.config.board.paddingBottom+"px"}},t._l(t.rows,function(o,d){return i("div",{key:o.toString()+o.scroll,staticClass:"row-item",style:`height: ${t.heights[d]}px;`,on:{click:function(n){return t.onClick(o)}}},[i("div",{staticClass:"ranking-info"},[i("div",{staticClass:"rank",style:{color:t.widgetInfo.config.board.rank.color,fontSize:t.widgetInfo.config.board.rank.fontSize+"px",fontFamily:t.widgetInfo.config.board.rank.fontFamily},domProps:{innerHTML:t._s(o.ranking)}}),i("div",{staticClass:"info-name",style:{color:t.widgetInfo.config.board.name.color,fontSize:t.widgetInfo.config.board.name.fontSize+"px",fontFamily:t.widgetInfo.config.board.name.fontFamily},domProps:{innerHTML:t._s(o.name)}}),i("div",{staticClass:"ranking-value",style:{color:t.widgetInfo.config.board.value.color,fontSize:t.widgetInfo.config.board.value.fontSize+"px",fontFamily:t.widgetInfo.config.board.value.fontFamily},domProps:{innerHTML:t._s(o.value)}}),i("div",{style:{color:t.widgetInfo.config.board.unit.color,fontSize:t.widgetInfo.config.board.unit.fontSize+"px",fontFamily:t.widgetInfo.config.board.unit.fontFamily}},[t._v(" "+t._s(t.mergedConfig.unit)+" ")])]),i("div",[i("div",{staticClass:"progress-border",style:{width:o.percent+"%",height:t.widgetInfo.config.board.progress.height+"px",backgroundColor:t.widgetInfo.config.board.progress.backgroundColor,borderRadius:t.widgetInfo.config.board.progress.borderRadius+"px"}},[t.widgetInfo.config.board.shine.enabled?i("div",{staticClass:"progress-shine",style:{top:t.widgetInfo.config.board.shine.top+"px",width:t.widgetInfo.config.board.shine.width+"px",height:t.widgetInfo.config.board.shine.height+"px",background:"radial-gradient("+t.widgetInfo.config.board.shine.backgroundColor+", transparent "+t.widgetInfo.config.board.shine.backgroundGradient+"%)",animationDuration:t.widgetInfo.config.board.shine.animationDuration+"s",animationIterationCount:"1"}}):t._e()])]),t.widgetInfo.config.board.full.enabled?i("div",{staticClass:"full-border",style:{width:"100%",height:t.widgetInfo.config.board.full.height+"px",marginTop:t.widgetInfo.config.board.full.marginTop+"px",backgroundColor:t.widgetInfo.config.board.full.backgroundColor,borderRadius:t.widgetInfo.config.board.full.borderRadius+"px"}}):t._e()])}),0)])],1)},h=[],l=r(927966),v=r(321300),z=r(445061),y=r(126711),O=r(56279),S=r(844513),k=r(147921),s=r(555616),I=r(275770),x=r(149500),R={name:"ComRankingCarousel",components:{HideButton:S.Z},mixins:[k.baseConfig,z.u,y.H,O.P],props:["widgetInfo"],data(){return{ref:"scroll-ranking",mergedConfig:null,rowsData:[],rows:[],heights:[],animationIndex:0,animationHandler:"",updater:0,dom:"",width:0,height:0,debounceInitWHFun:"",domObserver:""}},computed:{},watch:{"widgetInfo.attr.hide":function(){this.$emit("attrChange",this.widgetInfo),this.loadInfo(this.widgetInfo)}},mounted(){this.loadInfo(this.widgetInfo),this.initAction(this.widgetInfo),this.resizeObserver=new ResizeObserver((e,t)=>{this.loadInfo(this.widgetInfo)}),this.resizeObserver&&this.resizeObserver.observe(this.$refs.rankingCarousel)},destroyed(){this.stopAnimation(),this.unbindDomResizeCallback(),this.resizeObserver&&this.resizeObserver.unobserve(this.$refs.rankingCarousel)},methods:{loadInfo(e){this.rows=[],this.rowsData=[],this.mergedConfig={data:this.getRankingData(e),rowNum:e.config.carousel.rowNum,waitTime:e.config.carousel.waitTime,carousel:e.config.carousel.carousel,unit:e.config.board.unit.text,sort:e.config.carousel.sort},this.calcData(),this.autoResizeMixinInit(),this.lifecycleAfterLoad()},reLoadInfo(e){this.loadInfo(e)},getRankingData(e){let t=[];if(e.dataset[e.dataset.type]){let i=JSON.parse(JSON.stringify(e.dataset[e.dataset.type].source)),o=JSON.parse(JSON.stringify(e.dataset[e.dataset.type].encode)),d=JSON.parse(JSON.stringify(e.dataset[e.dataset.type].columnList)),n=null,f=null;d.forEach(c=>{o.name==c.name&&(n=c.index),o.value==c.name&&(f=c.index)}),i.forEach(c=>{let w={};w.name=c[n],w.value=c[f],t.push(w)})}return t},afterAutoResizeMixinInit(){this.calcData()},onResize(){this.mergedConfig&&this.calcHeights(!0)},calcData(){this.stopAnimation(),this.calcRowsData(),this.calcHeights(),this.widgetInfo.config.carousel.enabled&&this.animation(!0)},calcRowsData(){let{data:e,rowNum:t}=JSON.parse(JSON.stringify(this.mergedConfig)),i=0,o=[];for(let a in e)if(/^(-?\d+)(\.\d+)?$/.test(e[a].value)){if(!/^-?\d+$/.test(e[a].value)){let g=e[a].value+"";g.split(".")[1].length>i&&(i=g.split(".")[1].length)}o.push(e[a])}if(e=o,i>0)for(let a in e)e[a].value=e[a].value*Math.pow(10,i);this.mergedConfig.sort&&e.sort((a,g)=>g.value-a.value);const d=e.map(({value:a})=>a),n=Math.min(...d)||0,f=Math.abs(n),c=Math.max(...d)||0,w=Math.abs(c),m=c+f;if(e=e.map((a,g)=>({...a,ranking:g+1,percent:(parseInt(a.value)+f)/m*100})),i>0)for(let a in e)e[a].value=e[a].value/Math.pow(10,i);const C=e.length;C>t&&C<2*t&&(e=[...e,...e]),e=e.map((a,g)=>({...a,scroll:g}));let p=JSON.parse(JSON.stringify(this.widgetInfo.config.board));if(p.rank.type=="text"&&e.forEach(a=>{a.ranking=p.rank.html.replace(/\${ranking}/g,a.ranking)}),p.rank.type=="formatter"&&p.rank.formatter&&p.rank.formatter.scriptContent)if(x.log("Execute script for "+this.widgetInfo.name),p.rank.formatter.scriptContent=="")s.Message.warning({message:"\u6392\u540D\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});else{let a=new Function("item,index",p.rank.formatter.scriptContent);e.forEach((g,H)=>{g.ranking=a(g,H)})}e&&(this.rowsData=e,this.rows=e)},calcHeights(e=!1){const{height:t,mergedConfig:i}=this,{rowNum:o,data:d}=i,n=t/o;this.avgHeight=n,e||(this.heights=new Array(d.length).fill(n))},async animation(e=!1){let{avgHeight:t,animationIndex:i,mergedConfig:o,rowsData:d,animation:n,updater:f}=this;const{waitTime:c,carousel:w,rowNum:m}=o,C=d.length;if(m>=C||e&&(await new Promise(H=>setTimeout(H,c)),f!==this.updater))return;const p=w==="single"?1:m;let a=d.slice(i);if(a.push(...d.slice(0,i)),w=="single"?this.rows=a.slice(0,m+1):this.rows=a,this.heights=new Array(C).fill(t),await new Promise(H=>setTimeout(H,300)),f!==this.updater)return;this.heights.splice(0,p,...new Array(p).fill(0)),i+=p;const g=i-C;g>=0&&(i=g),this.animationIndex=i,this.animationHandler=setTimeout(n,c-300)},stopAnimation(){const{animationHandler:e,updater:t}=this;this.updater=(t+1)%999999,e&&clearTimeout(e)},async autoResizeMixinInit(){await this.initWH(!1),this.getDebounceInitWHFun(),this.bindDomResizeCallback(),typeof this.afterAutoResizeMixinInit=="function"&&this.afterAutoResizeMixinInit()},initWH(e=!0){const{$nextTick:t,$refs:i,ref:o,onResize:d}=this;return new Promise(n=>{t(()=>{const f=this.dom=i[o];this.width=f?f.clientWidth:0,this.height=f?f.clientHeight:0,f?(!this.width||!this.height)&&x.warn("Component width or height is 0px, rendering abnormality may occur!"):x.warn("Failed to get dom node, component rendering may be abnormal!"),typeof d=="function"&&e&&d(),n()})})},getDebounceInitWHFun(){this.debounceInitWHFun=this.debounce(100,this.initWH)},bindDomResizeCallback(){this.domObserver=this.observerDomResize(this.dom,this.debounceInitWHFun),window.addEventListener("resize",this.debounceInitWHFun)},debounce(e,t){let i;return function(){clearTimeout(i);const[o,d]=[this,arguments];i=setTimeout(()=>{t.apply(o,d)},e)}},observerDomResize(e,t){const i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,o=new i(t);return o.observe(e,{attributes:!0,attributeFilter:["style"],attributeOldValue:!0}),o},unbindDomResizeCallback(){},initAction(e){this.actionReceive(e)},onClick(e){if(!e.ranking)return;let t=this.widgetInfo,i=[],o=this,d=t.action.sendOut.actionList;o.$$lib__.each(d,n=>{let f=n.code+"_"+t.id,c={};n.paramsExtend&&n.paramsExtend.length>0&&o.getParamsExtend(c,n.paramsExtend,t);let w=n.postMessage;if(n.enabled&&n.code==I.default.click.code){if(t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(i=t.dataset[t.dataset.type].source[e.scroll]),o.getExtendParams(c,n.paramsExtend,i,t.dataset[t.dataset.type].dimensions),n.script&&n.script.enabled){if(x.log("Execute script for "+o.widgetInfo.name+" component to "+n.name+" component"),n.script.content==""){s.Message.warning({message:n.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}c=new Function("params,info",n.script.content)(e,this.widgetInfo)}l.Z.$emit(f,e),w&&o.doPostMessage(e)}else if(n.enabled&&n.code==I.default.click.openLink.code){if(n.paramsExtend&&n.paramsExtend.length>0){let m=[];t.dataset[t.dataset.type].source&&t.dataset[t.dataset.type].source.length>0&&(m=t.dataset[t.dataset.type].source[e.index]),n.type===o.$$global_editor.linkType.dynamic.code&&(n[o.$$global_editor.linkType.dynamic.code].url=o.getActionUrl(n,t.dataset[t.dataset.type].source[e.index],t.dataset[t.dataset.type].dimensions)),o.getExtendParams(c,n.paramsExtend,m,t.dataset[t.dataset.type].dimensions)}if(n.script&&n.script.enabled){if(x.log("Execute script for "+o.widgetInfo.name+" component to "+n.name+" component"),n.script.content==""){s.Message.warning({message:n.name+"\u81EA\u5B9A\u4E49\u811A\u672C\u5DF2\u542F\u7528\uFF0C\u4F46\u672A\u7F16\u5199\u4EFB\u4F55\u811A\u672C",offset:60});return}c=new Function("params,info",n.script.content)(e,this.widgetInfo)}o.openLinkAction(n,e)}})}}},M=R,T=r(768141),F=(0,T.Z)(M,u,h,!1,null,"2ce9d960",null),D=F.exports}}]);
