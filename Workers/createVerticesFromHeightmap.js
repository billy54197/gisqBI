/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.99.9
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */define(["./Matrix3-2955527a","./AxisAlignedBoundingBox-a26a3fb6","./Transforms-5b74e989","./Matrix2-462b83d3","./defaultValue-ebbd2e4d","./TerrainEncoding-519593e1","./Math-1fe079f3","./OrientedBoundingBox-48eb7862","./WebMercatorProjection-3d5b0545","./RuntimeError-38a08050","./createTaskProcessorWorker","./combine-55e9f355","./AttributeCompression-6f93ad0c","./ComponentDatatype-f9ac3ed8","./WebGLConstants-544672c2","./EllipsoidTangentPlane-da4fdd19","./IntersectionTests-2a07bba4","./Plane-7e97483e"],function(Q,Ke,Re,q,O,ze,we,$e,Me,_e,et,ht,mt,gt,pt,xt,wt,kt){"use strict";var tt=Object.freeze({NONE:0,LERC:1});const Z={};Z.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});const Ve=new Q.Cartesian3,at=new q.Matrix4,rt=new Q.Cartesian3,it=new Q.Cartesian3;Z.computeVertices=function(A){const ue=Math.cos,E=Math.sin,ce=Math.sqrt,H=Math.atan,se=Math.exp,de=we.CesiumMath.PI_OVER_TWO,J=we.CesiumMath.toRadians,he=A.heightmap,L=A.width,R=A.height,le=A.skirtHeight,B=le>0,K=O.defaultValue(A.isGeographic,!0),j=O.defaultValue(A.ellipsoid,Q.Ellipsoid.WGS84),W=1/j.maximumRadius,z=q.Rectangle.clone(A.nativeRectangle),$=q.Rectangle.clone(A.rectangle);let me,ee,t,e;O.defined($)?(me=$.west,ee=$.south,t=$.east,e=$.north):K?(me=J(z.west),ee=J(z.south),t=J(z.east),e=J(z.north)):(me=z.west*W,ee=de-2*H(se(-z.south*W)),t=z.east*W,e=de-2*H(se(-z.north*W)));let a=A.relativeToCenter;const r=O.defined(a);a=r?a:Q.Cartesian3.ZERO;const i=O.defaultValue(A.includeWebMercatorT,!1),n=O.defaultValue(A.exaggeration,1),s=O.defaultValue(A.exaggerationRelativeHeight,0),o=n!==1,l=O.defaultValue(A.structure,Z.DEFAULT_STRUCTURE),f=O.defaultValue(l.heightScale,Z.DEFAULT_STRUCTURE.heightScale),u=O.defaultValue(l.heightOffset,Z.DEFAULT_STRUCTURE.heightOffset),c=O.defaultValue(l.elementsPerHeight,Z.DEFAULT_STRUCTURE.elementsPerHeight),m=O.defaultValue(l.stride,Z.DEFAULT_STRUCTURE.stride),g=O.defaultValue(l.elementMultiplier,Z.DEFAULT_STRUCTURE.elementMultiplier),h=O.defaultValue(l.isBigEndian,Z.DEFAULT_STRUCTURE.isBigEndian);let d=q.Rectangle.computeWidth(z),x=q.Rectangle.computeHeight(z);const y=d/(L-1),k=x/(R-1);K||(d*=W,x*=W);const M=j.radiiSquared,p=M.x,I=M.y,w=M.z;let b=65536,V=-65536;const D=Re.Transforms.eastNorthUpToFixedFrame(a,j),T=q.Matrix4.inverseTransformation(D,at);let v,U;i&&(v=Me.WebMercatorProjection.geodeticLatitudeToMercatorAngle(ee),U=1/(Me.WebMercatorProjection.geodeticLatitudeToMercatorAngle(e)-v));const S=rt;S.x=Number.POSITIVE_INFINITY,S.y=Number.POSITIVE_INFINITY,S.z=Number.POSITIVE_INFINITY;const C=it;C.x=Number.NEGATIVE_INFINITY,C.y=Number.NEGATIVE_INFINITY,C.z=Number.NEGATIVE_INFINITY;let G=Number.POSITIVE_INFINITY;const F=L*R,P=F+(le>0?2*L+2*R:0),oe=new Array(P),ke=new Array(P),be=new Array(P),pe=i?new Array(P):[],te=o?new Array(P):[];let X=0,Ae=R,ve=0,De=L;B&&(--X,++Ae,--ve,++De);const Ie=1e-5;for(let _=X;_<Ae;++_){let ae=_;ae<0&&(ae=0),ae>=R&&(ae=R-1);let re=z.north-k*ae;re=K?J(re):de-2*H(se(-re*W));let Se=(re-ee)/(e-ee);Se=we.CesiumMath.clamp(Se,0,1);const ye=_===X,Ue=_===Ae-1;le>0&&(ye?re+=Ie*x:Ue&&(re-=Ie*x));const je=ue(re),Pe=E(re),Ge=w*Pe;let Qe;i&&(Qe=(Me.WebMercatorProjection.geodeticLatitudeToMercatorAngle(re)-v)*U);for(let xe=ve;xe<De;++xe){let ie=xe;ie<0&&(ie=0),ie>=L&&(ie=L-1);const Ee=ae*(L*m)+ie*m;let N;if(c===1)N=he[Ee];else{let Y;if(N=0,h)for(Y=0;Y<c;++Y)N=N*g+he[Ee+Y];else for(Y=c-1;Y>=0;--Y)N=N*g+he[Ee+Y]}N=N*f+u,V=Math.max(V,N),b=Math.min(b,N);let fe=z.west+y*ie;K?fe=J(fe):fe*=W;let Ce=(fe-me)/(t-me);Ce=we.CesiumMath.clamp(Ce,0,1);let ne=ae*L+ie;if(le>0){const Y=xe===ve,Le=xe===De-1,dt=ye||Ue||Y||Le;if((ye||Ue)&&(Y||Le))continue;dt&&(N-=le,Y?(ne=F+(R-ae-1),fe-=Ie*d):Ue?ne=F+R+(L-ie-1):Le?(ne=F+R+L+ae,fe+=Ie*d):ye&&(ne=F+R+L+R+ie))}const Fe=je*ue(fe),Ne=je*E(fe),qe=p*Fe,Je=I*Ne,Oe=1/ce(qe*Fe+Je*Ne+Ge*Pe),ft=qe*Oe,ut=Je*Oe,ct=Ge*Oe,ge=new Q.Cartesian3;ge.x=ft+Fe*N,ge.y=ut+Ne*N,ge.z=ct+Pe*N,q.Matrix4.multiplyByPoint(T,ge,Ve),Q.Cartesian3.minimumByComponent(Ve,S,S),Q.Cartesian3.maximumByComponent(Ve,C,C),G=Math.min(G,N),oe[ne]=ge,be[ne]=new q.Cartesian2(Ce,Se),ke[ne]=N,i&&(pe[ne]=Qe),o&&(te[ne]=j.geodeticSurfaceNormal(ge))}}const lt=Re.BoundingSphere.fromPoints(oe);let Ye,We;O.defined($)&&(Ye=$e.OrientedBoundingBox.fromRectangle($,b,V,j)),r&&(We=new ze.EllipsoidalOccluder(j).computeHorizonCullingPointPossiblyUnderEllipsoid(a,oe,b));const ot=new Ke.AxisAlignedBoundingBox(S,C,a),Be=new ze.TerrainEncoding(a,ot,G,V,D,!1,i,o,n,s),Xe=new Float32Array(P*Be.stride);let Ze=0;for(let _=0;_<P;++_)Ze=Be.encode(Xe,Ze,oe[_],be[_],ke[_],void 0,pe[_],te[_]);return{vertices:Xe,maximumHeight:V,minimumHeight:b,encoding:Be,boundingSphere3D:lt,orientedBoundingBox:Ye,occludeePointInScaledSpace:We}};var Te,nt=Z,He={exports:{}};Te=He,function(){var A,ue,E,ce,H,se,de,J,he,L,R,le,B,K,j,W,z=(A={defaultNoDataValue:-34027999387901484e22,decode:function(t,e){var a=(e=e||{}).encodedMaskData||e.encodedMaskData===null,r=H(t,e.inputOffset||0,a),i=e.noDataValue!==null?e.noDataValue:A.defaultNoDataValue,n=ue(r,e.pixelType||Float32Array,e.encodedMaskData,i,e.returnMask),s={width:r.width,height:r.height,pixelData:n.resultPixels,minValue:n.minValue,maxValue:r.pixels.maxValue,noDataValue:i};return n.resultMask&&(s.maskData=n.resultMask),e.returnEncodedMask&&r.mask&&(s.encodedMaskData=r.mask.bitset?r.mask.bitset:null),e.returnFileInfo&&(s.fileInfo=E(r),e.computeUsedBitDepths&&(s.fileInfo.bitDepths=ce(r))),s}},ue=function(t,e,a,r,i){var n,s,o,l=0,f=t.pixels.numBlocksX,u=t.pixels.numBlocksY,c=Math.floor(t.width/f),m=Math.floor(t.height/u),g=2*t.maxZError,h=Number.MAX_VALUE;a=a||(t.mask?t.mask.bitset:null),s=new e(t.width*t.height),i&&a&&(o=new Uint8Array(t.width*t.height));for(var d,x,y=new Float32Array(c*m),k=0;k<=u;k++){var M=k!==u?m:t.height%u;if(M!==0)for(var p=0;p<=f;p++){var I=p!==f?c:t.width%f;if(I!==0){var w,b,V,D,T=k*t.width*m+p*c,v=t.width-I,U=t.pixels.blocks[l];if(U.encoding<2?(U.encoding===0?w=U.rawData:(se(U.stuffedData,U.bitsPerPixel,U.numValidPixels,U.offset,g,y,t.pixels.maxValue),w=y),b=0):V=U.encoding===2?0:U.offset,a)for(x=0;x<M;x++){for(7&T&&(D=a[T>>3],D<<=7&T),d=0;d<I;d++)7&T||(D=a[T>>3]),128&D?(o&&(o[T]=1),h=h>(n=U.encoding<2?w[b++]:V)?n:h,s[T++]=n):(o&&(o[T]=0),s[T++]=r),D<<=1;T+=v}else if(U.encoding<2)for(x=0;x<M;x++){for(d=0;d<I;d++)h=h>(n=w[b++])?n:h,s[T++]=n;T+=v}else for(h=h>V?V:h,x=0;x<M;x++){for(d=0;d<I;d++)s[T++]=V;T+=v}if(U.encoding===1&&b!==U.numValidPixels)throw"Block and Mask do not match";l++}}}return{resultPixels:s,resultMask:o,minValue:h}},E=function(t){return{fileIdentifierString:t.fileIdentifierString,fileVersion:t.fileVersion,imageType:t.imageType,height:t.height,width:t.width,maxZError:t.maxZError,eofOffset:t.eofOffset,mask:t.mask?{numBlocksX:t.mask.numBlocksX,numBlocksY:t.mask.numBlocksY,numBytes:t.mask.numBytes,maxValue:t.mask.maxValue}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,numBytes:t.pixels.numBytes,maxValue:t.pixels.maxValue,noDataValue:t.noDataValue}}},ce=function(t){for(var e=t.pixels.numBlocksX*t.pixels.numBlocksY,a={},r=0;r<e;r++){var i=t.pixels.blocks[r];i.encoding===0?a.float32=!0:i.encoding===1?a[i.bitsPerPixel]=!0:a[0]=!0}return Object.keys(a)},H=function(t,e,a){var r={},i=new Uint8Array(t,e,10);if(r.fileIdentifierString=String.fromCharCode.apply(null,i),r.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+r.fileIdentifierString;e+=10;var n=new DataView(t,e,24);if(r.fileVersion=n.getInt32(0,!0),r.imageType=n.getInt32(4,!0),r.height=n.getUint32(8,!0),r.width=n.getUint32(12,!0),r.maxZError=n.getFloat64(16,!0),e+=24,!a)if(n=new DataView(t,e,16),r.mask={},r.mask.numBlocksY=n.getUint32(0,!0),r.mask.numBlocksX=n.getUint32(4,!0),r.mask.numBytes=n.getUint32(8,!0),r.mask.maxValue=n.getFloat32(12,!0),e+=16,r.mask.numBytes>0){var s=new Uint8Array(Math.ceil(r.width*r.height/8)),o=(n=new DataView(t,e,r.mask.numBytes)).getInt16(0,!0),l=2,f=0;do{if(o>0)for(;o--;)s[f++]=n.getUint8(l++);else{var u=n.getUint8(l++);for(o=-o;o--;)s[f++]=u}o=n.getInt16(l,!0),l+=2}while(l<r.mask.numBytes);if(o!==-32768||f<s.length)throw"Unexpected end of mask RLE encoding";r.mask.bitset=s,e+=r.mask.numBytes}else!(r.mask.numBytes|r.mask.numBlocksY|r.mask.maxValue)&&(r.mask.bitset=new Uint8Array(Math.ceil(r.width*r.height/8)));n=new DataView(t,e,16),r.pixels={},r.pixels.numBlocksY=n.getUint32(0,!0),r.pixels.numBlocksX=n.getUint32(4,!0),r.pixels.numBytes=n.getUint32(8,!0),r.pixels.maxValue=n.getFloat32(12,!0),e+=16;var c=r.pixels.numBlocksX,m=r.pixels.numBlocksY,g=c+(r.width%c>0?1:0),h=m+(r.height%m>0?1:0);r.pixels.blocks=new Array(g*h);for(var d=0,x=0;x<h;x++)for(var y=0;y<g;y++){var k=0,M=t.byteLength-e;n=new DataView(t,e,Math.min(10,M));var p={};r.pixels.blocks[d++]=p;var I=n.getUint8(0);if(k++,p.encoding=63&I,p.encoding>3)throw"Invalid block encoding ("+p.encoding+")";if(p.encoding!==2){if(I!==0&&I!==2){if(I>>=6,p.offsetType=I,I===2)p.offset=n.getInt8(1),k++;else if(I===1)p.offset=n.getInt16(1,!0),k+=2;else{if(I!==0)throw"Invalid block offset type";p.offset=n.getFloat32(1,!0),k+=4}if(p.encoding===1)if(I=n.getUint8(k),k++,p.bitsPerPixel=63&I,I>>=6,p.numValidPixelsType=I,I===2)p.numValidPixels=n.getUint8(k),k++;else if(I===1)p.numValidPixels=n.getUint16(k,!0),k+=2;else{if(I!==0)throw"Invalid valid pixel count type";p.numValidPixels=n.getUint32(k,!0),k+=4}}var w;if(e+=k,p.encoding!==3){if(p.encoding===0){var b=(r.pixels.numBytes-1)/4;if(b!==Math.floor(b))throw"uncompressed block has invalid length";w=new ArrayBuffer(4*b),new Uint8Array(w).set(new Uint8Array(t,e,4*b));var V=new Float32Array(w);p.rawData=V,e+=4*b}else if(p.encoding===1){var D=Math.ceil(p.numValidPixels*p.bitsPerPixel/8),T=Math.ceil(D/4);w=new ArrayBuffer(4*T),new Uint8Array(w).set(new Uint8Array(t,e,D)),p.stuffedData=new Uint32Array(w),e+=D}}}else e++}return r.eofOffset=e,r},se=function(t,e,a,r,i,n,s){var o,l,f,u=(1<<e)-1,c=0,m=0,g=Math.ceil((s-r)/i),h=4*t.length-Math.ceil(e*a/8);for(t[t.length-1]<<=8*h,o=0;o<a;o++){if(m===0&&(f=t[c++],m=32),m>=e)l=f>>>m-e&u,m-=e;else{var d=e-m;l=(f&u)<<d&u,l+=(f=t[c++])>>>(m=32-d)}n[o]=l<g?r+l*i:s}return n},A),$=(de=function(t,e,a,r,i,n,s,o){var l,f,u,c,m,g=(1<<a)-1,h=0,d=0,x=4*t.length-Math.ceil(a*r/8);if(t[t.length-1]<<=8*x,i)for(l=0;l<r;l++)d===0&&(u=t[h++],d=32),d>=a?(f=u>>>d-a&g,d-=a):(f=(u&g)<<(c=a-d)&g,f+=(u=t[h++])>>>(d=32-c)),e[l]=i[f];else for(m=Math.ceil((o-n)/s),l=0;l<r;l++)d===0&&(u=t[h++],d=32),d>=a?(f=u>>>d-a&g,d-=a):(f=(u&g)<<(c=a-d)&g,f+=(u=t[h++])>>>(d=32-c)),e[l]=f<m?n+f*s:o},J=function(t,e,a,r,i,n){var s,o=(1<<e)-1,l=0,f=0,u=0,c=0,m=0,g=[],h=4*t.length-Math.ceil(e*a/8);t[t.length-1]<<=8*h;var d=Math.ceil((n-r)/i);for(f=0;f<a;f++)c===0&&(s=t[l++],c=32),c>=e?(m=s>>>c-e&o,c-=e):(m=(s&o)<<(u=e-c)&o,m+=(s=t[l++])>>>(c=32-u)),g[f]=m<d?r+m*i:n;return g.unshift(r),g},he=function(t,e,a,r,i,n,s,o){var l,f,u,c,m=(1<<a)-1,g=0,h=0,d=0;if(i)for(l=0;l<r;l++)h===0&&(u=t[g++],h=32,d=0),h>=a?(f=u>>>d&m,h-=a,d+=a):(f=u>>>d&m,h=32-(c=a-h),f|=((u=t[g++])&(1<<c)-1)<<a-c,d=c),e[l]=i[f];else{var x=Math.ceil((o-n)/s);for(l=0;l<r;l++)h===0&&(u=t[g++],h=32,d=0),h>=a?(f=u>>>d&m,h-=a,d+=a):(f=u>>>d&m,h=32-(c=a-h),f|=((u=t[g++])&(1<<c)-1)<<a-c,d=c),e[l]=f<x?n+f*s:o}return e},L=function(t,e,a,r,i,n){var s,o=(1<<e)-1,l=0,f=0,u=0,c=0,m=0,g=0,h=[],d=Math.ceil((n-r)/i);for(f=0;f<a;f++)c===0&&(s=t[l++],c=32,g=0),c>=e?(m=s>>>g&o,c-=e,g+=e):(m=s>>>g&o,c=32-(u=e-c),m|=((s=t[l++])&(1<<u)-1)<<e-u,g=u),h[f]=m<d?r+m*i:n;return h.unshift(r),h},R=function(t,e,a,r){var i,n,s,o,l=(1<<a)-1,f=0,u=0,c=4*t.length-Math.ceil(a*r/8);for(t[t.length-1]<<=8*c,i=0;i<r;i++)u===0&&(s=t[f++],u=32),u>=a?(n=s>>>u-a&l,u-=a):(n=(s&l)<<(o=a-u)&l,n+=(s=t[f++])>>>(u=32-o)),e[i]=n;return e},le=function(t,e,a,r){var i,n,s,o,l=(1<<a)-1,f=0,u=0,c=0;for(i=0;i<r;i++)u===0&&(s=t[f++],u=32,c=0),u>=a?(n=s>>>c&l,u-=a,c+=a):(n=s>>>c&l,u=32-(o=a-u),n|=((s=t[f++])&(1<<o)-1)<<a-o,c=o),e[i]=n;return e},B={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(t){for(var e=65535,a=65535,r=t.length,i=Math.floor(r/2),n=0;i;){var s=i>=359?359:i;i-=s;do e+=t[n++]<<8,a+=e+=t[n++];while(--s);e=(65535&e)+(e>>>16),a=(65535&a)+(a>>>16)}return 1&r&&(a+=e+=t[n]<<8),((a=(65535&a)+(a>>>16))<<16|(e=(65535&e)+(e>>>16)))>>>0},readHeaderInfo:function(t,e){var a=e.ptr,r=new Uint8Array(t,a,6),i={};if(i.fileIdentifierString=String.fromCharCode.apply(null,r),i.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;a+=6;var n,s=new DataView(t,a,8),o=s.getInt32(0,!0);if(i.fileVersion=o,a+=4,o>=3&&(i.checksum=s.getUint32(4,!0),a+=4),s=new DataView(t,a,12),i.height=s.getUint32(0,!0),i.width=s.getUint32(4,!0),a+=8,o>=4?(i.numDims=s.getUint32(8,!0),a+=4):i.numDims=1,s=new DataView(t,a,40),i.numValidPixel=s.getUint32(0,!0),i.microBlockSize=s.getInt32(4,!0),i.blobSize=s.getInt32(8,!0),i.imageType=s.getInt32(12,!0),i.maxZError=s.getFloat64(16,!0),i.zMin=s.getFloat64(24,!0),i.zMax=s.getFloat64(32,!0),a+=40,e.headerInfo=i,e.ptr=a,o>=3&&(n=o>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(t,a-n,i.blobSize-14))!==i.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(t,e){var a=e.headerInfo,r=this.getDataTypeArray(a.imageType),i=a.numDims*this.getDataTypeSize(a.imageType),n=this.readSubArray(t,e.ptr,r,i),s=this.readSubArray(t,e.ptr+i,r,i);e.ptr+=2*i;var o,l=!0;for(o=0;o<a.numDims;o++)if(n[o]!==s[o]){l=!1;break}return a.minValues=n,a.maxValues=s,l},readSubArray:function(t,e,a,r){var i;if(a===Uint8Array)i=new Uint8Array(t,e,r);else{var n=new ArrayBuffer(r);new Uint8Array(n).set(new Uint8Array(t,e,r)),i=new a(n)}return i},readMask:function(t,e){var a,r,i=e.ptr,n=e.headerInfo,s=n.width*n.height,o=n.numValidPixel,l=new DataView(t,i,4),f={};if(f.numBytes=l.getUint32(0,!0),i+=4,(o===0||s===o)&&f.numBytes!==0)throw"invalid mask";if(o===0)a=new Uint8Array(Math.ceil(s/8)),f.bitset=a,r=new Uint8Array(s),e.pixels.resultMask=r,i+=f.numBytes;else if(f.numBytes>0){a=new Uint8Array(Math.ceil(s/8));var u=(l=new DataView(t,i,f.numBytes)).getInt16(0,!0),c=2,m=0,g=0;do{if(u>0)for(;u--;)a[m++]=l.getUint8(c++);else for(g=l.getUint8(c++),u=-u;u--;)a[m++]=g;u=l.getInt16(c,!0),c+=2}while(c<f.numBytes);if(u!==-32768||m<a.length)throw"Unexpected end of mask RLE encoding";r=new Uint8Array(s);var h=0,d=0;for(d=0;d<s;d++)7&d?(h=a[d>>3],h<<=7&d):h=a[d>>3],128&h&&(r[d]=1);e.pixels.resultMask=r,f.bitset=a,i+=f.numBytes}return e.ptr=i,e.mask=f,!0},readDataOneSweep:function(t,e,a){var r,i=e.ptr,n=e.headerInfo,s=n.numDims,o=n.width*n.height,l=n.imageType,f=n.numValidPixel*B.getDataTypeSize(l)*s,u=e.pixels.resultMask;if(a===Uint8Array)r=new Uint8Array(t,i,f);else{var c=new ArrayBuffer(f);new Uint8Array(c).set(new Uint8Array(t,i,f)),r=new a(c)}if(r.length===o*s)e.pixels.resultPixels=r;else{e.pixels.resultPixels=new a(o*s);var m=0,g=0,h=0,d=0;if(s>1)for(h=0;h<s;h++)for(d=h*o,g=0;g<o;g++)u[g]&&(e.pixels.resultPixels[d+g]=r[m++]);else for(g=0;g<o;g++)u[g]&&(e.pixels.resultPixels[g]=r[m++])}return i+=f,e.ptr=i,!0},readHuffmanTree:function(t,e){var a=this.HUFFMAN_LUT_BITS_MAX,r=new DataView(t,e.ptr,16);if(e.ptr+=16,r.getInt32(0,!0)<2)throw"unsupported Huffman version";var i=r.getInt32(4,!0),n=r.getInt32(8,!0),s=r.getInt32(12,!0);if(n>=s)return!1;var o=new Uint32Array(s-n);B.decodeBits(t,e,o);var l,f,u,c,m=[];for(l=n;l<s;l++)m[f=l-(l<i?0:i)]={first:o[l-n],second:null};var g=t.byteLength-e.ptr,h=Math.ceil(g/4),d=new ArrayBuffer(4*h);new Uint8Array(d).set(new Uint8Array(t,e.ptr,g));var x,y=new Uint32Array(d),k=0,M=0;for(x=y[0],l=n;l<s;l++)(c=m[f=l-(l<i?0:i)].first)>0&&(m[f].second=x<<k>>>32-c,32-k>=c?(k+=c)===32&&(k=0,x=y[++M]):(k+=c-32,x=y[++M],m[f].second|=x>>>32-k));var p=0,I=0,w=new K;for(l=0;l<m.length;l++)m[l]!==void 0&&(p=Math.max(p,m[l].first));I=p>=a?a:p,p>=30&&console.log("WARning, large NUM LUT BITS IS "+p);var b,V,D,T,v,U=[];for(l=n;l<s;l++)if((c=m[f=l-(l<i?0:i)].first)>0)if(b=[c,f],c<=I)for(V=m[f].second<<I-c,D=1<<I-c,u=0;u<D;u++)U[V|u]=b;else for(V=m[f].second,v=w,T=c-1;T>=0;T--)V>>>T&1?(v.right||(v.right=new K),v=v.right):(v.left||(v.left=new K),v=v.left),T!==0||v.val||(v.val=b[1]);return{decodeLut:U,numBitsLUTQick:I,numBitsLUT:p,tree:w,stuffedData:y,srcPtr:M,bitPos:k}},readHuffman:function(t,e,a){var r,i,n,s,o,l,f,u,c,m=e.headerInfo,g=m.numDims,h=e.headerInfo.height,d=e.headerInfo.width,x=d*h,y=this.readHuffmanTree(t,e),k=y.decodeLut,M=y.tree,p=y.stuffedData,I=y.srcPtr,w=y.bitPos,b=y.numBitsLUTQick,V=y.numBitsLUT,D=e.headerInfo.imageType===0?128:0,T=e.pixels.resultMask,v=0;w>0&&(I++,w=0);var U,S=p[I],C=e.encodeMode===1,G=new a(x*g),F=G;for(U=0;U<m.numDims;U++){if(g>1&&(F=new a(G.buffer,x*U,x),v=0),e.headerInfo.numValidPixel===d*h)for(u=0,l=0;l<h;l++)for(f=0;f<d;f++,u++){if(i=0,o=s=S<<w>>>32-b,32-w<b&&(o=s|=p[I+1]>>>64-w-b),k[o])i=k[o][1],w+=k[o][0];else for(o=s=S<<w>>>32-V,32-w<V&&(o=s|=p[I+1]>>>64-w-V),r=M,c=0;c<V;c++)if(!(r=s>>>V-c-1&1?r.right:r.left).left&&!r.right){i=r.val,w=w+c+1;break}w>=32&&(w-=32,S=p[++I]),n=i-D,C?(n+=f>0?v:l>0?F[u-d]:v,n&=255,F[u]=n,v=n):F[u]=n}else for(u=0,l=0;l<h;l++)for(f=0;f<d;f++,u++)if(T[u]){if(i=0,o=s=S<<w>>>32-b,32-w<b&&(o=s|=p[I+1]>>>64-w-b),k[o])i=k[o][1],w+=k[o][0];else for(o=s=S<<w>>>32-V,32-w<V&&(o=s|=p[I+1]>>>64-w-V),r=M,c=0;c<V;c++)if(!(r=s>>>V-c-1&1?r.right:r.left).left&&!r.right){i=r.val,w=w+c+1;break}w>=32&&(w-=32,S=p[++I]),n=i-D,C?(f>0&&T[u-1]?n+=v:l>0&&T[u-d]?n+=F[u-d]:n+=v,n&=255,F[u]=n,v=n):F[u]=n}e.ptr=e.ptr+4*(I+1)+(w>0?4:0)}e.pixels.resultPixels=G},decodeBits:function(t,e,a,r,i){var n=e.headerInfo,s=n.fileVersion,o=0,l=new DataView(t,e.ptr,5),f=l.getUint8(0);o++;var u=f>>6,c=u===0?4:3-u,m=(32&f)>0,g=31&f,h=0;if(c===1)h=l.getUint8(o),o++;else if(c===2)h=l.getUint16(o,!0),o+=2;else{if(c!==4)throw"Invalid valid pixel count type";h=l.getUint32(o,!0),o+=4}var d,x,y,k,M,p,I,w,b,V=2*n.maxZError,D=n.numDims>1?n.maxValues[i]:n.zMax;if(m){for(e.counter.lut++,w=l.getUint8(o),o++,k=Math.ceil((w-1)*g/8),M=Math.ceil(k/4),x=new ArrayBuffer(4*M),y=new Uint8Array(x),e.ptr+=o,y.set(new Uint8Array(t,e.ptr,k)),I=new Uint32Array(x),e.ptr+=k,b=0;w-1>>>b;)b++;k=Math.ceil(h*b/8),M=Math.ceil(k/4),x=new ArrayBuffer(4*M),(y=new Uint8Array(x)).set(new Uint8Array(t,e.ptr,k)),d=new Uint32Array(x),e.ptr+=k,p=s>=3?L(I,g,w-1,r,V,D):J(I,g,w-1,r,V,D),s>=3?he(d,a,b,h,p):de(d,a,b,h,p)}else e.counter.bitstuffer++,b=g,e.ptr+=o,b>0&&(k=Math.ceil(h*b/8),M=Math.ceil(k/4),x=new ArrayBuffer(4*M),(y=new Uint8Array(x)).set(new Uint8Array(t,e.ptr,k)),d=new Uint32Array(x),e.ptr+=k,s>=3?r==null?le(d,a,b,h):he(d,a,b,h,!1,r,V,D):r==null?R(d,a,b,h):de(d,a,b,h,!1,r,V,D))},readTiles:function(t,e,a){var r=e.headerInfo,i=r.width,n=r.height,s=r.microBlockSize,o=r.imageType,l=B.getDataTypeSize(o),f=Math.ceil(i/s),u=Math.ceil(n/s);e.pixels.numBlocksY=u,e.pixels.numBlocksX=f,e.pixels.ptr=0;var c,m,g,h,d,x,y,k,M=0,p=0,I=0,w=0,b=0,V=0,D=0,T=0,v=0,U=0,S=0,C=0,G=0,F=0,P=0,oe=new a(s*s),ke=n%s||s,be=i%s||s,pe=r.numDims,te=e.pixels.resultMask,X=e.pixels.resultPixels;for(I=0;I<u;I++)for(b=I!==u-1?s:ke,w=0;w<f;w++)for(U=I*i*s+w*s,S=i-(V=w!==f-1?s:be),k=0;k<pe;k++){if(pe>1&&(X=new a(e.pixels.resultPixels.buffer,i*n*k*l,i*n)),D=t.byteLength-e.ptr,m={},P=0,P++,v=(T=(c=new DataView(t,e.ptr,Math.min(10,D))).getUint8(0))>>6&255,(T>>2&15)!=(w*s>>3&15))throw"integrity issue";if((d=3&T)>3)throw e.ptr+=P,"Invalid block encoding ("+d+")";if(d!==2)if(d===0){if(e.counter.uncompressed++,e.ptr+=P,C=(C=b*V*l)<(G=t.byteLength-e.ptr)?C:G,g=new ArrayBuffer(C%l==0?C:C+l-C%l),new Uint8Array(g).set(new Uint8Array(t,e.ptr,C)),h=new a(g),F=0,te)for(M=0;M<b;M++){for(p=0;p<V;p++)te[U]&&(X[U]=h[F++]),U++;U+=S}else for(M=0;M<b;M++){for(p=0;p<V;p++)X[U++]=h[F++];U+=S}e.ptr+=F*l}else if(x=B.getDataTypeUsed(o,v),y=B.getOnePixel(m,P,x,c),P+=B.getDataTypeSize(x),d===3)if(e.ptr+=P,e.counter.constantoffset++,te)for(M=0;M<b;M++){for(p=0;p<V;p++)te[U]&&(X[U]=y),U++;U+=S}else for(M=0;M<b;M++){for(p=0;p<V;p++)X[U++]=y;U+=S}else if(e.ptr+=P,B.decodeBits(t,e,oe,y,k),P=0,te)for(M=0;M<b;M++){for(p=0;p<V;p++)te[U]&&(X[U]=oe[P++]),U++;U+=S}else for(M=0;M<b;M++){for(p=0;p<V;p++)X[U++]=oe[P++];U+=S}else e.counter.constant++,e.ptr+=P}},formatFileInfo:function(t){return{fileIdentifierString:t.headerInfo.fileIdentifierString,fileVersion:t.headerInfo.fileVersion,imageType:t.headerInfo.imageType,height:t.headerInfo.height,width:t.headerInfo.width,numValidPixel:t.headerInfo.numValidPixel,microBlockSize:t.headerInfo.microBlockSize,blobSize:t.headerInfo.blobSize,maxZError:t.headerInfo.maxZError,pixelType:B.getPixelType(t.headerInfo.imageType),eofOffset:t.eofOffset,mask:t.mask?{numBytes:t.mask.numBytes}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,maxValue:t.headerInfo.zMax,minValue:t.headerInfo.zMin,noDataValue:t.noDataValue}}},constructConstantSurface:function(t){var e=t.headerInfo.zMax,a=t.headerInfo.numDims,r=t.headerInfo.height*t.headerInfo.width,i=r*a,n=0,s=0,o=0,l=t.pixels.resultMask;if(l)if(a>1)for(n=0;n<a;n++)for(o=n*r,s=0;s<r;s++)l[s]&&(t.pixels.resultPixels[o+s]=e);else for(s=0;s<r;s++)l[s]&&(t.pixels.resultPixels[s]=e);else if(t.pixels.resultPixels.fill)t.pixels.resultPixels.fill(e);else for(s=0;s<i;s++)t.pixels.resultPixels[s]=e},getDataTypeArray:function(t){var e;switch(t){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:default:e=Float32Array;break;case 7:e=Float64Array}return e},getPixelType:function(t){var e;switch(t){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:default:e="F32";break;case 7:e="F64"}return e},isValidPixelValue:function(t,e){if(e==null)return!1;var a;switch(t){case 0:a=e>=-128&&e<=127;break;case 1:a=e>=0&&e<=255;break;case 2:a=e>=-32768&&e<=32767;break;case 3:a=e>=0&&e<=65536;break;case 4:a=e>=-2147483648&&e<=2147483647;break;case 5:a=e>=0&&e<=4294967296;break;case 6:a=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:a=e>=5e-324&&e<=17976931348623157e292;break;default:a=!1}return a},getDataTypeSize:function(t){var e=0;switch(t){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=t}return e},getDataTypeUsed:function(t,e){var a=t;switch(t){case 2:case 4:a=t-e;break;case 3:case 5:a=t-2*e;break;case 6:a=e===0?t:e===1?2:1;break;case 7:a=e===0?t:t-2*e+1;break;default:a=t}return a},getOnePixel:function(t,e,a,r){var i=0;switch(a){case 0:i=r.getInt8(e);break;case 1:i=r.getUint8(e);break;case 2:i=r.getInt16(e,!0);break;case 3:i=r.getUint16(e,!0);break;case 4:i=r.getInt32(e,!0);break;case 5:i=r.getUInt32(e,!0);break;case 6:i=r.getFloat32(e,!0);break;case 7:i=r.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return i}},K=function(t,e,a){this.val=t,this.left=e,this.right=a},{decode:function(t,e){var a=(e=e||{}).noDataValue,r=0,i={};i.ptr=e.inputOffset||0,i.pixels={},B.readHeaderInfo(t,i);var n=i.headerInfo,s=n.fileVersion,o=B.getDataTypeArray(n.imageType);B.readMask(t,i),n.numValidPixel===n.width*n.height||i.pixels.resultMask||(i.pixels.resultMask=e.maskData);var l,f=n.width*n.height;if(i.pixels.resultPixels=new o(f*n.numDims),i.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},n.numValidPixel!==0)if(n.zMax===n.zMin)B.constructConstantSurface(i);else if(s>=4&&B.checkMinMaxRanges(t,i))B.constructConstantSurface(i);else{var u=new DataView(t,i.ptr,2),c=u.getUint8(0);if(i.ptr++,c)B.readDataOneSweep(t,i,o);else if(s>1&&n.imageType<=1&&Math.abs(n.maxZError-.5)<1e-5){var m=u.getUint8(1);if(i.ptr++,i.encodeMode=m,m>2||s<4&&m>1)throw"Invalid Huffman flag "+m;m?B.readHuffman(t,i,o):B.readTiles(t,i,o)}else B.readTiles(t,i,o)}i.eofOffset=i.ptr,e.inputOffset?(l=i.headerInfo.blobSize+e.inputOffset-i.ptr,Math.abs(l)>=1&&(i.eofOffset=e.inputOffset+i.headerInfo.blobSize)):(l=i.headerInfo.blobSize-i.ptr,Math.abs(l)>=1&&(i.eofOffset=i.headerInfo.blobSize));var g={width:n.width,height:n.height,pixelData:i.pixels.resultPixels,minValue:n.zMin,maxValue:n.zMax,validPixelCount:n.numValidPixel,dimCount:n.numDims,dimStats:{minValues:n.minValues,maxValues:n.maxValues},maskData:i.pixels.resultMask};if(i.pixels.resultMask&&B.isValidPixelValue(n.imageType,a)){var h=i.pixels.resultMask;for(r=0;r<f;r++)h[r]||(g.pixelData[r]=a);g.noDataValue=a}return i.noDataValue=a,e.returnFileInfo&&(g.fileInfo=B.formatFileInfo(i)),g},getBandCount:function(t){for(var e=0,a=0,r={ptr:0,pixels:{}};a<t.byteLength-58;)B.readHeaderInfo(t,r),a+=r.headerInfo.blobSize,e++,r.ptr=a;return e}}),me=(j=new ArrayBuffer(4),W=new Uint8Array(j),new Uint32Array(j)[0]=1,W[0]===1),ee={decode:function(t,e){if(!me)throw"Big endian system is not supported.";var a,r,i=(e=e||{}).inputOffset||0,n=new Uint8Array(t,i,10),s=String.fromCharCode.apply(null,n);if(s.trim()==="CntZImage")a=z,r=1;else{if(s.substring(0,5)!=="Lerc2")throw"Unexpected file identifier string: "+s;a=$,r=2}for(var o,l,f,u,c,m,g=0,h=t.byteLength-10,d=[],x={width:0,height:0,pixels:[],pixelType:e.pixelType,mask:null,statistics:[]};i<h;){var y=a.decode(t,{inputOffset:i,encodedMaskData:o,maskData:f,returnMask:g===0,returnEncodedMask:g===0,returnFileInfo:!0,pixelType:e.pixelType||null,noDataValue:e.noDataValue||null});i=y.fileInfo.eofOffset,g===0&&(o=y.encodedMaskData,f=y.maskData,x.width=y.width,x.height=y.height,x.dimCount=y.dimCount||1,x.pixelType=y.pixelType||y.fileInfo.pixelType,x.mask=y.maskData),r>1&&y.fileInfo.mask&&y.fileInfo.mask.numBytes>0&&d.push(y.maskData),g++,x.pixels.push(y.pixelData),x.statistics.push({minValue:y.minValue,maxValue:y.maxValue,noDataValue:y.noDataValue,dimStats:y.dimStats})}if(r>1&&d.length>1){for(m=x.width*x.height,x.bandMasks=d,(f=new Uint8Array(m)).set(d[0]),u=1;u<d.length;u++)for(l=d[u],c=0;c<m;c++)f[c]=f[c]&l[c];x.maskData=f}return x}};Te.exports?Te.exports=ee:this.Lerc=ee}();var st=He.exports;return et(function(A,ue){if(A.encoding===tt.LERC){let H;try{H=st.decode(A.heightmap)}catch(se){throw new _e.RuntimeError(se)}if(H.statistics[0].minValue===Number.MAX_VALUE)throw new _e.RuntimeError("Invalid tile data");A.heightmap=H.pixels[0],A.width=H.width,A.height=H.height}A.ellipsoid=Q.Ellipsoid.clone(A.ellipsoid),A.rectangle=q.Rectangle.clone(A.rectangle);const E=nt.computeVertices(A),ce=E.vertices;return ue.push(ce.buffer),{vertices:ce.buffer,numberOfAttributes:E.encoding.stride,minimumHeight:E.minimumHeight,maximumHeight:E.maximumHeight,gridWidth:A.width,gridHeight:A.height,boundingSphere3D:E.boundingSphere3D,orientedBoundingBox:E.orientedBoundingBox,occludeePointInScaledSpace:E.occludeePointInScaledSpace,encoding:E.encoding,westIndicesSouthToNorth:E.westIndicesSouthToNorth,southIndicesEastToWest:E.southIndicesEastToWest,eastIndicesNorthToSouth:E.eastIndicesNorthToSouth,northIndicesWestToEast:E.northIndicesWestToEast}})});
