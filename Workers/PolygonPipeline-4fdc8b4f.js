/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.99.9
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */define(["exports","./Matrix2-462b83d3","./Matrix3-2955527a","./ComponentDatatype-f9ac3ed8","./defaultValue-ebbd2e4d","./EllipsoidRhumbLine-8bc8a516","./GeometryAttribute-9c756444","./Math-1fe079f3","./WebGLConstants-544672c2"],function(ct,A,h,nt,D,ut,W,rt,dt){"use strict";var st={exports:{}};function et(t,r,e){e=e||2;var o,a,u,i,n,y,s,f=r&&r.length,v=f?r[0]*e:t.length,c=vt(t,0,v,e,!0),C=[];if(!c||c.next===c.prev)return C;if(f&&(c=function(S,g,Z,b){var x,p,d,m=[];for(x=0,p=g.length;x<p;x++)(d=vt(S,g[x]*b,x<p-1?g[x+1]*b:S.length,b,!1))===d.next&&(d.steiner=!0),m.push(Pt(d));for(m.sort(Tt),x=0;x<m.length;x++)Z=Bt(m[x],Z);return Z}(t,r,c,e)),t.length>80*e){o=u=t[0],a=i=t[1];for(var l=e;l<v;l+=e)(n=t[l])<o&&(o=n),(y=t[l+1])<a&&(a=y),n>u&&(u=n),y>i&&(i=y);s=(s=Math.max(u-o,i-a))!==0?32767/s:0}return j(c,C,e,o,a,s,0),C}function vt(t,r,e,o,a){var u,i;if(a===lt(t,r,e,o)>0)for(u=r;u<e;u+=o)i=wt(u,t[u],t[u+1],i);else for(u=e-o;u>=r;u-=o)i=wt(u,t[u],t[u+1],i);return i&&at(i,i.next)&&(J(i),i=i.next),i}function P(t,r){if(!t)return t;r||(r=t);var e,o=t;do if(e=!1,o.steiner||!at(o,o.next)&&M(o.prev,o,o.next)!==0)o=o.next;else{if(J(o),(o=r=o.prev)===o.next)break;e=!0}while(e||o!==r);return r}function j(t,r,e,o,a,u,i){if(t){!i&&u&&function(f,v,c,C){var l=f;do l.z===0&&(l.z=xt(l.x,l.y,v,c,C)),l.prevZ=l.prev,l.nextZ=l.next,l=l.next;while(l!==f);l.prevZ.nextZ=null,l.prevZ=null,function(S){var g,Z,b,x,p,d,m,z,T=1;do{for(Z=S,S=null,p=null,d=0;Z;){for(d++,b=Z,m=0,g=0;g<T&&(m++,b=b.nextZ);g++);for(z=T;m>0||z>0&&b;)m!==0&&(z===0||!b||Z.z<=b.z)?(x=Z,Z=Z.nextZ,m--):(x=b,b=b.nextZ,z--),p?p.nextZ=x:S=x,x.prevZ=p,p=x;Z=b}p.nextZ=null,T*=2}while(d>1)}(l)}(t,o,a,u);for(var n,y,s=t;t.prev!==t.next;)if(n=t.prev,y=t.next,u?Rt(t,o,a,u):Dt(t))r.push(n.i/e|0),r.push(t.i/e|0),r.push(y.i/e|0),J(t),t=y.next,s=y.next;else if((t=y)===s){i?i===1?j(t=Gt(P(t),r,e),r,e,o,a,u,2):i===2&&Ot(t,r,e,o,a,u):j(P(t),r,e,o,a,u,1);break}}}function Dt(t){var r=t.prev,e=t,o=t.next;if(M(r,e,o)>=0)return!1;for(var a=r.x,u=e.x,i=o.x,n=r.y,y=e.y,s=o.y,f=a<u?a<i?a:i:u<i?u:i,v=n<y?n<s?n:s:y<s?y:s,c=a>u?a>i?a:i:u>i?u:i,C=n>y?n>s?n:s:y>s?y:s,l=o.next;l!==r;){if(l.x>=f&&l.x<=c&&l.y>=v&&l.y<=C&&K(a,n,u,y,i,s,l.x,l.y)&&M(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function Rt(t,r,e,o){var a=t.prev,u=t,i=t.next;if(M(a,u,i)>=0)return!1;for(var n=a.x,y=u.x,s=i.x,f=a.y,v=u.y,c=i.y,C=n<y?n<s?n:s:y<s?y:s,l=f<v?f<c?f:c:v<c?v:c,S=n>y?n>s?n:s:y>s?y:s,g=f>v?f>c?f:c:v>c?v:c,Z=xt(C,l,r,e,o),b=xt(S,g,r,e,o),x=t.prevZ,p=t.nextZ;x&&x.z>=Z&&p&&p.z<=b;){if(x.x>=C&&x.x<=S&&x.y>=l&&x.y<=g&&x!==a&&x!==i&&K(n,f,y,v,s,c,x.x,x.y)&&M(x.prev,x,x.next)>=0||(x=x.prevZ,p.x>=C&&p.x<=S&&p.y>=l&&p.y<=g&&p!==a&&p!==i&&K(n,f,y,v,s,c,p.x,p.y)&&M(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;x&&x.z>=Z;){if(x.x>=C&&x.x<=S&&x.y>=l&&x.y<=g&&x!==a&&x!==i&&K(n,f,y,v,s,c,x.x,x.y)&&M(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;p&&p.z<=b;){if(p.x>=C&&p.x<=S&&p.y>=l&&p.y<=g&&p!==a&&p!==i&&K(n,f,y,v,s,c,p.x,p.y)&&M(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Gt(t,r,e){var o=t;do{var a=o.prev,u=o.next.next;!at(a,u)&&mt(a,o,o.next,u)&&H(a,u)&&H(u,a)&&(r.push(a.i/e|0),r.push(o.i/e|0),r.push(u.i/e|0),J(o),J(o.next),o=t=u),o=o.next}while(o!==t);return P(o)}function Ot(t,r,e,o,a,u){var i=t;do{for(var n=i.next.next;n!==i.prev;){if(i.i!==n.i&&$t(i,n)){var y=Ct(i,n);return i=P(i,i.next),y=P(y,y.next),j(i,r,e,o,a,u,0),void j(y,r,e,o,a,u,0)}n=n.next}i=i.next}while(i!==t)}function Tt(t,r){return t.x-r.x}function Bt(t,r){var e=function(a,u){var i,n=u,y=a.x,s=a.y,f=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var v=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(v<=y&&v>f&&(f=v,i=n.x<n.next.x?n:n.next,v===y))return i}n=n.next}while(n!==u);if(!i)return null;var c,C=i,l=i.x,S=i.y,g=1/0;n=i;do y>=n.x&&n.x>=l&&y!==n.x&&K(s<S?y:f,s,l,S,s<S?f:y,s,n.x,n.y)&&(c=Math.abs(s-n.y)/(y-n.x),H(n,a)&&(c<g||c===g&&(n.x>i.x||n.x===i.x&&Wt(i,n)))&&(i=n,g=c)),n=n.next;while(n!==C);return i}(t,r);if(!e)return r;var o=Ct(e,t);return P(o,o.next),P(e,e.next)}function Wt(t,r){return M(t.prev,t,r.prev)<0&&M(r.next,t,t.next)<0}function xt(t,r,e,o,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-o)*a|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Pt(t){var r=t,e=t;do(r.x<e.x||r.x===e.x&&r.y<e.y)&&(e=r),r=r.next;while(r!==t);return e}function K(t,r,e,o,a,u,i,n){return(a-i)*(r-n)>=(t-i)*(u-n)&&(t-i)*(o-n)>=(e-i)*(r-n)&&(e-i)*(u-n)>=(a-i)*(o-n)}function $t(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!function(e,o){var a=e;do{if(a.i!==e.i&&a.next.i!==e.i&&a.i!==o.i&&a.next.i!==o.i&&mt(a,a.next,e,o))return!0;a=a.next}while(a!==e);return!1}(t,r)&&(H(t,r)&&H(r,t)&&function(e,o){var a=e,u=!1,i=(e.x+o.x)/2,n=(e.y+o.y)/2;do a.y>n!=a.next.y>n&&a.next.y!==a.y&&i<(a.next.x-a.x)*(n-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==e);return u}(t,r)&&(M(t.prev,t,r.prev)||M(t,r.prev,r))||at(t,r)&&M(t.prev,t,t.next)>0&&M(r.prev,r,r.next)>0)}function M(t,r,e){return(r.y-t.y)*(e.x-r.x)-(r.x-t.x)*(e.y-r.y)}function at(t,r){return t.x===r.x&&t.y===r.y}function mt(t,r,e,o){var a=ot(M(t,r,e)),u=ot(M(t,r,o)),i=ot(M(e,o,t)),n=ot(M(e,o,r));return a!==u&&i!==n||!(a!==0||!it(t,e,r))||!(u!==0||!it(t,o,r))||!(i!==0||!it(e,t,o))||!(n!==0||!it(e,r,o))}function it(t,r,e){return r.x<=Math.max(t.x,e.x)&&r.x>=Math.min(t.x,e.x)&&r.y<=Math.max(t.y,e.y)&&r.y>=Math.min(t.y,e.y)}function ot(t){return t>0?1:t<0?-1:0}function H(t,r){return M(t.prev,t,t.next)<0?M(t,r,t.next)>=0&&M(t,t.prev,r)>=0:M(t,r,t.prev)<0||M(t,t.next,r)<0}function Ct(t,r){var e=new pt(t.i,t.x,t.y),o=new pt(r.i,r.x,r.y),a=t.next,u=r.prev;return t.next=r,r.prev=t,e.next=a,a.prev=e,o.next=e,e.prev=o,u.next=o,o.prev=u,o}function wt(t,r,e,o){var a=new pt(t,r,e);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function J(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function pt(t,r,e){this.i=t,this.x=r,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lt(t,r,e,o){for(var a=0,u=r,i=e-o;u<e;u+=o)a+=(t[i]-t[u])*(t[u+1]+t[i+1]),i=u;return a}st.exports=et,st.exports.default=et,et.deviation=function(t,r,e,o){var a=r&&r.length,u=a?r[0]*e:t.length,i=Math.abs(lt(t,0,u,e));if(a)for(var n=0,y=r.length;n<y;n++){var s=r[n]*e,f=n<y-1?r[n+1]*e:t.length;i-=Math.abs(lt(t,s,f,e))}var v=0;for(n=0;n<o.length;n+=3){var c=o[n]*e,C=o[n+1]*e,l=o[n+2]*e;v+=Math.abs((t[c]-t[l])*(t[C+1]-t[c+1])-(t[c]-t[C])*(t[l+1]-t[c+1]))}return i===0&&v===0?0:Math.abs((v-i)/i)},et.flatten=function(t){for(var r=t[0][0].length,e={vertices:[],holes:[],dimensions:r},o=0,a=0;a<t.length;a++){for(var u=0;u<t[a].length;u++)for(var i=0;i<r;i++)e.vertices.push(t[a][u][i]);a>0&&(o+=t[a-1].length,e.holes.push(o))}return e};const yt={CLOCKWISE:dt.WebGLConstants.CW,COUNTER_CLOCKWISE:dt.WebGLConstants.CCW,validate:function(t){return t===yt.CLOCKWISE||t===yt.COUNTER_CLOCKWISE}};var ft=Object.freeze(yt);const It=new h.Cartesian3,Nt=new h.Cartesian3,Q={computeArea2D:function(t){const r=t.length;let e=0;for(let o=r-1,a=0;a<r;o=a++){const u=t[o],i=t[a];e+=u.x*i.y-i.x*u.y}return .5*e},computeWindingOrder2D:function(t){return Q.computeArea2D(t)>0?ft.COUNTER_CLOCKWISE:ft.CLOCKWISE},triangulate:function(t,r){const e=A.Cartesian2.packArray(t);return st.exports(e,r,2)}},bt=new h.Cartesian3,At=new h.Cartesian3,Mt=new h.Cartesian3,St=new h.Cartesian3,Et=new h.Cartesian3,gt=new h.Cartesian3,O=new h.Cartesian3,Zt=new A.Cartesian2,zt=new A.Cartesian2,Lt=new A.Cartesian2,V=new A.Cartesian2;Q.computeSubdivision=function(t,r,e,o,a){a=D.defaultValue(a,rt.CesiumMath.RADIANS_PER_DEGREE);const u=D.defined(o),i=e.slice(0);let n;const y=r.length,s=new Array(3*y),f=new Array(2*y);let v=0,c=0;for(n=0;n<y;n++){const x=r[n];if(s[v++]=x.x,s[v++]=x.y,s[v++]=x.z,u){const p=o[n];f[c++]=p.x,f[c++]=p.y}}const C=[],l={},S=t.maximumRadius,g=rt.CesiumMath.chordLength(a,S),Z=g*g;for(;i.length>0;){const x=i.pop(),p=i.pop(),d=i.pop(),m=h.Cartesian3.fromArray(s,3*d,bt),z=h.Cartesian3.fromArray(s,3*p,At),T=h.Cartesian3.fromArray(s,3*x,Mt);let X,Y,$;u&&(X=A.Cartesian2.fromArray(f,2*d,Zt),Y=A.Cartesian2.fromArray(f,2*p,zt),$=A.Cartesian2.fromArray(f,2*x,Lt));const F=h.Cartesian3.multiplyByScalar(h.Cartesian3.normalize(m,St),S,St),k=h.Cartesian3.multiplyByScalar(h.Cartesian3.normalize(z,Et),S,Et),I=h.Cartesian3.multiplyByScalar(h.Cartesian3.normalize(T,gt),S,gt),N=h.Cartesian3.magnitudeSquared(h.Cartesian3.subtract(F,k,O)),U=h.Cartesian3.magnitudeSquared(h.Cartesian3.subtract(k,I,O)),tt=h.Cartesian3.magnitudeSquared(h.Cartesian3.subtract(I,F,O)),_=Math.max(N,U,tt);let R,E,w;_>Z?N===_?(R=`${Math.min(d,p)} ${Math.max(d,p)}`,n=l[R],D.defined(n)||(E=h.Cartesian3.add(m,z,O),h.Cartesian3.multiplyByScalar(E,.5,E),s.push(E.x,E.y,E.z),n=s.length/3-1,l[R]=n,u&&(w=A.Cartesian2.add(X,Y,V),A.Cartesian2.multiplyByScalar(w,.5,w),f.push(w.x,w.y))),i.push(d,n,x),i.push(n,p,x)):U===_?(R=`${Math.min(p,x)} ${Math.max(p,x)}`,n=l[R],D.defined(n)||(E=h.Cartesian3.add(z,T,O),h.Cartesian3.multiplyByScalar(E,.5,E),s.push(E.x,E.y,E.z),n=s.length/3-1,l[R]=n,u&&(w=A.Cartesian2.add(Y,$,V),A.Cartesian2.multiplyByScalar(w,.5,w),f.push(w.x,w.y))),i.push(p,n,d),i.push(n,x,d)):tt===_&&(R=`${Math.min(x,d)} ${Math.max(x,d)}`,n=l[R],D.defined(n)||(E=h.Cartesian3.add(T,m,O),h.Cartesian3.multiplyByScalar(E,.5,E),s.push(E.x,E.y,E.z),n=s.length/3-1,l[R]=n,u&&(w=A.Cartesian2.add($,X,V),A.Cartesian2.multiplyByScalar(w,.5,w),f.push(w.x,w.y))),i.push(x,n,p),i.push(n,d,p)):(C.push(d),C.push(p),C.push(x))}const b={attributes:{position:new W.GeometryAttribute({componentDatatype:nt.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s})},indices:C,primitiveType:W.PrimitiveType.TRIANGLES};return u&&(b.attributes.st=new W.GeometryAttribute({componentDatatype:nt.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:f})),new W.Geometry(b)};const Ut=new h.Cartographic,_t=new h.Cartographic,Kt=new h.Cartographic,ht=new h.Cartographic;Q.computeRhumbLineSubdivision=function(t,r,e,o,a){a=D.defaultValue(a,rt.CesiumMath.RADIANS_PER_DEGREE);const u=D.defined(o),i=e.slice(0);let n;const y=r.length,s=new Array(3*y),f=new Array(2*y);let v=0,c=0;for(n=0;n<y;n++){const d=r[n];if(s[v++]=d.x,s[v++]=d.y,s[v++]=d.z,u){const m=o[n];f[c++]=m.x,f[c++]=m.y}}const C=[],l={},S=t.maximumRadius,g=rt.CesiumMath.chordLength(a,S),Z=new ut.EllipsoidRhumbLine(void 0,void 0,t),b=new ut.EllipsoidRhumbLine(void 0,void 0,t),x=new ut.EllipsoidRhumbLine(void 0,void 0,t);for(;i.length>0;){const d=i.pop(),m=i.pop(),z=i.pop(),T=h.Cartesian3.fromArray(s,3*z,bt),X=h.Cartesian3.fromArray(s,3*m,At),Y=h.Cartesian3.fromArray(s,3*d,Mt);let $,F,k;u&&($=A.Cartesian2.fromArray(f,2*z,Zt),F=A.Cartesian2.fromArray(f,2*m,zt),k=A.Cartesian2.fromArray(f,2*d,Lt));const I=t.cartesianToCartographic(T,Ut),N=t.cartesianToCartographic(X,_t),U=t.cartesianToCartographic(Y,Kt);Z.setEndPoints(I,N);const tt=Z.surfaceDistance;b.setEndPoints(N,U);const _=b.surfaceDistance;x.setEndPoints(U,I);const R=x.surfaceDistance,E=Math.max(tt,_,R);let w,B,q,G,L;E>g?tt===E?(w=`${Math.min(z,m)} ${Math.max(z,m)}`,n=l[w],D.defined(n)||(B=Z.interpolateUsingFraction(.5,ht),q=.5*(I.height+N.height),G=h.Cartesian3.fromRadians(B.longitude,B.latitude,q,t,O),s.push(G.x,G.y,G.z),n=s.length/3-1,l[w]=n,u&&(L=A.Cartesian2.add($,F,V),A.Cartesian2.multiplyByScalar(L,.5,L),f.push(L.x,L.y))),i.push(z,n,d),i.push(n,m,d)):_===E?(w=`${Math.min(m,d)} ${Math.max(m,d)}`,n=l[w],D.defined(n)||(B=b.interpolateUsingFraction(.5,ht),q=.5*(N.height+U.height),G=h.Cartesian3.fromRadians(B.longitude,B.latitude,q,t,O),s.push(G.x,G.y,G.z),n=s.length/3-1,l[w]=n,u&&(L=A.Cartesian2.add(F,k,V),A.Cartesian2.multiplyByScalar(L,.5,L),f.push(L.x,L.y))),i.push(m,n,z),i.push(n,d,z)):R===E&&(w=`${Math.min(d,z)} ${Math.max(d,z)}`,n=l[w],D.defined(n)||(B=x.interpolateUsingFraction(.5,ht),q=.5*(U.height+I.height),G=h.Cartesian3.fromRadians(B.longitude,B.latitude,q,t,O),s.push(G.x,G.y,G.z),n=s.length/3-1,l[w]=n,u&&(L=A.Cartesian2.add(k,$,V),A.Cartesian2.multiplyByScalar(L,.5,L),f.push(L.x,L.y))),i.push(d,n,m),i.push(n,z,m)):(C.push(z),C.push(m),C.push(d))}const p={attributes:{position:new W.GeometryAttribute({componentDatatype:nt.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s})},indices:C,primitiveType:W.PrimitiveType.TRIANGLES};return u&&(p.attributes.st=new W.GeometryAttribute({componentDatatype:nt.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:f})),new W.Geometry(p)},Q.scaleToGeodeticHeight=function(t,r,e,o){e=D.defaultValue(e,h.Ellipsoid.WGS84);let a=It,u=Nt;if(r=D.defaultValue(r,0),o=D.defaultValue(o,!0),D.defined(t)){const i=t.length;for(let n=0;n<i;n+=3)h.Cartesian3.fromArray(t,n,u),o&&(u=e.scaleToGeodeticSurface(u,u)),r!==0&&(a=e.geodeticSurfaceNormal(u,a),h.Cartesian3.multiplyByScalar(a,r,a),h.Cartesian3.add(u,a,u)),t[n]=u.x,t[n+1]=u.y,t[n+2]=u.z}return t};var Vt=Q;ct.PolygonPipeline=Vt,ct.WindingOrder=ft});
