/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.99.9
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */define(["exports","./Matrix3-2955527a","./defaultValue-ebbd2e4d","./Transforms-5b74e989","./Math-1fe079f3"],function(ct,t,q,X,R){"use strict";const at={};function ut(e,a,r){const i=e+a;return R.CesiumMath.sign(e)!==R.CesiumMath.sign(a)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(a)))<r?0:i}at.computeDiscriminant=function(e,a,r){return a*a-4*e*r},at.computeRealRoots=function(e,a,r){let i;if(e===0)return a===0?[]:[-r/a];if(a===0){if(r===0)return[0,0];const n=Math.abs(r),C=Math.abs(e);if(n<C&&n/C<R.CesiumMath.EPSILON14)return[0,0];if(n>C&&C/n<R.CesiumMath.EPSILON14)return[];if(i=-r/e,i<0)return[];const M=Math.sqrt(i);return[-M,M]}if(r===0)return i=-a/e,i<0?[i,0]:[0,i];const o=ut(a*a,-(4*e*r),R.CesiumMath.EPSILON14);if(o<0)return[];const s=-.5*ut(a,R.CesiumMath.sign(a)*Math.sqrt(o),R.CesiumMath.EPSILON14);return a>0?[s/e,r/s]:[r/s,s/e]};var V=at;const rt={};function it(e,a,r,i){const o=e,s=a/3,n=r/3,C=i,M=o*n,c=s*C,u=s*s,f=n*n,d=o*n-u,g=o*C-s*n,l=s*C-f,h=4*d*l-g*g;let x,L;if(h<0){let N,G,Y;u*c>=M*f?(N=o,G=d,Y=-2*s*d+o*g):(N=C,G=l,Y=-C*g+2*n*l);const $=-(Y<0?-1:1)*Math.abs(N)*Math.sqrt(-h);L=-Y+$;const J=L/2,_=J<0?-Math.pow(-J,1/3):Math.pow(J,1/3),K=L===$?-_:-G/_;return x=G<=0?_+K:-Y/(_*_+K*K+G),u*c>=M*f?[(x-s)/o]:[-C/(x+n)]}const E=d,W=-2*s*d+o*g,T=l,B=-C*g+2*n*l,S=Math.sqrt(h),y=Math.sqrt(3)/2;let w=Math.abs(Math.atan2(o*S,-W)/3);x=2*Math.sqrt(-E);let m=Math.cos(w);L=x*m;let p=x*(-m/2-y*Math.sin(w));const D=L+p>2*s?L-s:p-s,k=o,P=D/k;w=Math.abs(Math.atan2(C*S,-B)/3),x=2*Math.sqrt(-T),m=Math.cos(w),L=x*m,p=x*(-m/2-y*Math.sin(w));const U=-C,z=L+p<2*n?L+n:p+n,I=U/z,F=-D*z-k*U,b=(n*F-s*(D*U))/(-s*F+n*(k*z));return P<=b?P<=I?b<=I?[P,b,I]:[P,I,b]:[I,P,b]:P<=I?[b,P,I]:b<=I?[b,I,P]:[I,b,P]}rt.computeDiscriminant=function(e,a,r,i){const o=a*a,s=r*r;return 18*e*a*r*i+o*s-27*(e*e)*(i*i)-4*(e*s*r+o*a*i)},rt.computeRealRoots=function(e,a,r,i){let o,s;if(e===0)return V.computeRealRoots(a,r,i);if(a===0){if(r===0){if(i===0)return[0,0,0];s=-i/e;const n=s<0?-Math.pow(-s,1/3):Math.pow(s,1/3);return[n,n,n]}return i===0?(o=V.computeRealRoots(e,0,r),o.Length===0?[0]:[o[0],0,o[1]]):it(e,0,r,i)}return r===0?i===0?(s=-a/e,s<0?[s,0,0]:[0,0,s]):it(e,a,0,i):i===0?(o=V.computeRealRoots(e,a,r),o.length===0?[0]:o[1]<=0?[o[0],o[1],0]:o[0]>=0?[0,o[0],o[1]]:[o[0],0,o[1]]):it(e,a,r,i)};var nt=rt;const st={};function xt(e,a,r,i){const o=e*e,s=a-3*o/8,n=r-a*e/2+o*e/8,C=i-r*e/4+a*o/16-3*o*o/256,M=nt.computeRealRoots(1,2*s,s*s-4*C,-n*n);if(M.length>0){const c=-e/4,u=M[M.length-1];if(Math.abs(u)<R.CesiumMath.EPSILON14){const f=V.computeRealRoots(1,s,C);if(f.length===2){const d=f[0],g=f[1];let l;if(d>=0&&g>=0){const h=Math.sqrt(d),x=Math.sqrt(g);return[c-x,c-h,c+h,c+x]}if(d>=0&&g<0)return l=Math.sqrt(d),[c-l,c+l];if(d<0&&g>=0)return l=Math.sqrt(g),[c-l,c+l]}return[]}if(u>0){const f=Math.sqrt(u),d=(s+u-n/f)/2,g=(s+u+n/f)/2,l=V.computeRealRoots(1,f,d),h=V.computeRealRoots(1,-f,g);return l.length!==0?(l[0]+=c,l[1]+=c,h.length!==0?(h[0]+=c,h[1]+=c,l[1]<=h[0]?[l[0],l[1],h[0],h[1]]:h[1]<=l[0]?[h[0],h[1],l[0],l[1]]:l[0]>=h[0]&&l[1]<=h[1]?[h[0],l[0],l[1],h[1]]:h[0]>=l[0]&&h[1]<=l[1]?[l[0],h[0],h[1],l[1]]:l[0]>h[0]&&l[0]<h[1]?[h[0],l[0],h[1],l[1]]:[l[0],h[0],l[1],h[1]]):l):h.length!==0?(h[0]+=c,h[1]+=c,h):[]}}return[]}function yt(e,a,r,i){const o=e*e,s=-2*a,n=r*e+a*a-4*i,C=o*i-r*a*e+r*r,M=nt.computeRealRoots(1,s,n,C);if(M.length>0){const c=M[0],u=a-c,f=u*u,d=e/2,g=u/2,l=f-4*i,h=f+4*Math.abs(i),x=o-4*c,L=o+4*Math.abs(c);let E,W,T,B,S,y;if(c<0||l*L<x*h){const p=Math.sqrt(x);E=p/2,W=p===0?0:(e*g-r)/p}else{const p=Math.sqrt(l);E=p===0?0:(e*g-r)/p,W=p/2}d===0&&E===0?(T=0,B=0):R.CesiumMath.sign(d)===R.CesiumMath.sign(E)?(T=d+E,B=c/T):(B=d-E,T=c/B),g===0&&W===0?(S=0,y=0):R.CesiumMath.sign(g)===R.CesiumMath.sign(W)?(S=g+W,y=i/S):(y=g-W,S=i/y);const w=V.computeRealRoots(1,T,S),m=V.computeRealRoots(1,B,y);if(w.length!==0)return m.length!==0?w[1]<=m[0]?[w[0],w[1],m[0],m[1]]:m[1]<=w[0]?[m[0],m[1],w[0],w[1]]:w[0]>=m[0]&&w[1]<=m[1]?[m[0],w[0],w[1],m[1]]:m[0]>=w[0]&&m[1]<=w[1]?[w[0],m[0],m[1],w[1]]:w[0]>m[0]&&w[0]<m[1]?[m[0],w[0],m[1],w[1]]:[w[0],m[0],w[1],m[1]]:w;if(m.length!==0)return m}return[]}st.computeDiscriminant=function(e,a,r,i,o){const s=e*e,n=a*a,C=n*a,M=r*r,c=M*r,u=i*i,f=u*i,d=o*o;return n*M*u-4*C*f-4*e*c*u+18*e*a*r*f-27*s*u*u+256*(s*e)*(d*o)+o*(18*C*r*i-4*n*c+16*e*M*M-80*e*a*M*i-6*e*n*u+144*s*r*u)+d*(144*e*n*r-27*n*n-128*s*M-192*s*a*i)},st.computeRealRoots=function(e,a,r,i,o){if(Math.abs(e)<R.CesiumMath.EPSILON15)return nt.computeRealRoots(a,r,i,o);const s=a/e,n=r/e,C=i/e,M=o/e;let c=s<0?1:0;switch(c+=n<0?c+1:c,c+=C<0?c+1:c,c+=M<0?c+1:c,c){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return xt(s,n,C,M);case 1:case 2:case 5:case 8:case 11:return yt(s,n,C,M);default:return}};var Pt=st;function H(e,a){a=t.Cartesian3.clone(q.defaultValue(a,t.Cartesian3.ZERO)),t.Cartesian3.equals(a,t.Cartesian3.ZERO)||t.Cartesian3.normalize(a,a),this.origin=t.Cartesian3.clone(q.defaultValue(e,t.Cartesian3.ZERO)),this.direction=a}H.clone=function(e,a){if(q.defined(e))return q.defined(a)?(a.origin=t.Cartesian3.clone(e.origin),a.direction=t.Cartesian3.clone(e.direction),a):new H(e.origin,e.direction)},H.getPoint=function(e,a,r){return q.defined(r)||(r=new t.Cartesian3),r=t.Cartesian3.multiplyByScalar(e.direction,a,r),t.Cartesian3.add(e.origin,r,r)};const O={rayPlane:function(e,a,r){q.defined(r)||(r=new t.Cartesian3);const i=e.origin,o=e.direction,s=a.normal,n=t.Cartesian3.dot(s,o);if(Math.abs(n)<R.CesiumMath.EPSILON15)return;const C=(-a.distance-t.Cartesian3.dot(s,i))/n;return C<0?void 0:(r=t.Cartesian3.multiplyByScalar(o,C,r),t.Cartesian3.add(i,r,r))}},bt=new t.Cartesian3,Nt=new t.Cartesian3,lt=new t.Cartesian3,Ct=new t.Cartesian3,Mt=new t.Cartesian3;O.rayTriangleParametric=function(e,a,r,i,o){o=q.defaultValue(o,!1);const s=e.origin,n=e.direction,C=t.Cartesian3.subtract(r,a,bt),M=t.Cartesian3.subtract(i,a,Nt),c=t.Cartesian3.cross(n,M,lt),u=t.Cartesian3.dot(C,c);let f,d,g,l,h;if(o){if(u<R.CesiumMath.EPSILON6||(f=t.Cartesian3.subtract(s,a,Ct),g=t.Cartesian3.dot(f,c),g<0||g>u)||(d=t.Cartesian3.cross(f,C,Mt),l=t.Cartesian3.dot(n,d),l<0||g+l>u))return;h=t.Cartesian3.dot(M,d)/u}else{if(Math.abs(u)<R.CesiumMath.EPSILON6)return;const x=1/u;if(f=t.Cartesian3.subtract(s,a,Ct),g=t.Cartesian3.dot(f,c)*x,g<0||g>1||(d=t.Cartesian3.cross(f,C,Mt),l=t.Cartesian3.dot(n,d)*x,l<0||g+l>1))return;h=t.Cartesian3.dot(M,d)*x}return h},O.rayTriangle=function(e,a,r,i,o,s){const n=O.rayTriangleParametric(e,a,r,i,o);if(q.defined(n)&&!(n<0))return q.defined(s)||(s=new t.Cartesian3),t.Cartesian3.multiplyByScalar(e.direction,n,s),t.Cartesian3.add(e.origin,s,s)};const qt=new H;O.lineSegmentTriangle=function(e,a,r,i,o,s,n){const C=qt;t.Cartesian3.clone(e,C.origin),t.Cartesian3.subtract(a,e,C.direction),t.Cartesian3.normalize(C.direction,C.direction);const M=O.rayTriangleParametric(C,r,i,o,s);if(!(!q.defined(M)||M<0||M>t.Cartesian3.distance(e,a)))return q.defined(n)||(n=new t.Cartesian3),t.Cartesian3.multiplyByScalar(C.direction,M,n),t.Cartesian3.add(C.origin,n,n)};const Lt={root0:0,root1:0};function ht(e,a,r){q.defined(r)||(r=new X.Interval);const i=e.origin,o=e.direction,s=a.center,n=a.radius*a.radius,C=t.Cartesian3.subtract(i,s,lt),M=function(c,u,f,d){const g=u*u-4*c*f;if(g<0)return;if(g>0){const h=1/(2*c),x=Math.sqrt(g),L=(-u+x)*h,E=(-u-x)*h;return L<E?(d.root0=L,d.root1=E):(d.root0=E,d.root1=L),d}const l=-u/(2*c);return l!==0?(d.root0=d.root1=l,d):void 0}(t.Cartesian3.dot(o,o),2*t.Cartesian3.dot(o,C),t.Cartesian3.magnitudeSquared(C)-n,Lt);if(q.defined(M))return r.start=M.root0,r.stop=M.root1,r}O.raySphere=function(e,a,r){if(r=ht(e,a,r),q.defined(r)&&!(r.stop<0))return r.start=Math.max(r.start,0),r};const It=new H;O.lineSegmentSphere=function(e,a,r,i){const o=It;t.Cartesian3.clone(e,o.origin);const s=t.Cartesian3.subtract(a,e,o.direction),n=t.Cartesian3.magnitude(s);if(t.Cartesian3.normalize(s,s),i=ht(o,r,i),!(!q.defined(i)||i.stop<0||i.start>n))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,n),i};const Et=new t.Cartesian3,vt=new t.Cartesian3;function j(e,a,r){const i=e+a;return R.CesiumMath.sign(e)!==R.CesiumMath.sign(a)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(a)))<r?0:i}O.rayEllipsoid=function(e,a){const r=a.oneOverRadii,i=t.Cartesian3.multiplyComponents(r,e.origin,Et),o=t.Cartesian3.multiplyComponents(r,e.direction,vt),s=t.Cartesian3.magnitudeSquared(i),n=t.Cartesian3.dot(i,o);let C,M,c,u,f;if(s>1){if(n>=0)return;const d=n*n;if(C=s-1,M=t.Cartesian3.magnitudeSquared(o),c=M*C,d<c)return;if(d>c){u=n*n-c,f=-n+Math.sqrt(u);const l=f/M,h=C/f;return l<h?new X.Interval(l,h):{start:h,stop:l}}const g=Math.sqrt(C/M);return new X.Interval(g,g)}return s<1?(C=s-1,M=t.Cartesian3.magnitudeSquared(o),c=M*C,u=n*n-c,f=-n+Math.sqrt(u),new X.Interval(0,f/M)):n<0?(M=t.Cartesian3.magnitudeSquared(o),new X.Interval(0,-n/M)):void 0};const ot=new t.Cartesian3,mt=new t.Cartesian3,ft=new t.Cartesian3,tt=new t.Cartesian3,zt=new t.Cartesian3,Tt=new t.Matrix3,Ut=new t.Matrix3,Wt=new t.Matrix3,Bt=new t.Matrix3,Vt=new t.Matrix3,dt=new t.Matrix3,gt=new t.Matrix3,pt=new t.Cartesian3,Zt=new t.Cartesian3,At=new t.Cartographic;O.grazingAltitudeLocation=function(e,a){const r=e.origin,i=e.direction;if(!t.Cartesian3.equals(r,t.Cartesian3.ZERO)){const S=a.geodeticSurfaceNormal(r,ot);if(t.Cartesian3.dot(i,S)>=0)return r}const o=q.defined(this.rayEllipsoid(e,a)),s=a.transformPositionToScaledSpace(i,ot),n=t.Cartesian3.normalize(s,s),C=t.Cartesian3.mostOrthogonalAxis(s,tt),M=t.Cartesian3.normalize(t.Cartesian3.cross(C,n,mt),mt),c=t.Cartesian3.normalize(t.Cartesian3.cross(n,M,ft),ft),u=Tt;u[0]=n.x,u[1]=n.y,u[2]=n.z,u[3]=M.x,u[4]=M.y,u[5]=M.z,u[6]=c.x,u[7]=c.y,u[8]=c.z;const f=t.Matrix3.transpose(u,Ut),d=t.Matrix3.fromScale(a.radii,Wt),g=t.Matrix3.fromScale(a.oneOverRadii,Bt),l=Vt;l[0]=0,l[1]=-i.z,l[2]=i.y,l[3]=i.z,l[4]=0,l[5]=-i.x,l[6]=-i.y,l[7]=i.x,l[8]=0;const h=t.Matrix3.multiply(t.Matrix3.multiply(f,g,dt),l,dt),x=t.Matrix3.multiply(t.Matrix3.multiply(h,d,gt),u,gt),L=t.Matrix3.multiplyByVector(h,r,zt),E=function(S,y,w,m,p){const D=m*m,k=p*p,P=(S[t.Matrix3.COLUMN1ROW1]-S[t.Matrix3.COLUMN2ROW2])*k,U=p*(m*j(S[t.Matrix3.COLUMN1ROW0],S[t.Matrix3.COLUMN0ROW1],R.CesiumMath.EPSILON15)+y.y),z=S[t.Matrix3.COLUMN0ROW0]*D+S[t.Matrix3.COLUMN2ROW2]*k+m*y.x+w,I=k*j(S[t.Matrix3.COLUMN2ROW1],S[t.Matrix3.COLUMN1ROW2],R.CesiumMath.EPSILON15),F=p*(m*j(S[t.Matrix3.COLUMN2ROW0],S[t.Matrix3.COLUMN0ROW2])+y.z);let b;const N=[];if(F===0&&I===0){if(b=V.computeRealRoots(P,U,z),b.length===0)return N;const Z=b[0],v=Math.sqrt(Math.max(1-Z*Z,0));if(N.push(new t.Cartesian3(m,p*Z,p*-v)),N.push(new t.Cartesian3(m,p*Z,p*v)),b.length===2){const A=b[1],et=Math.sqrt(Math.max(1-A*A,0));N.push(new t.Cartesian3(m,p*A,p*-et)),N.push(new t.Cartesian3(m,p*A,p*et))}return N}const G=F*F,Y=I*I,$=F*I,J=P*P+Y,_=2*(U*P+$),K=2*z*P+U*U-Y+G,wt=2*(z*U-$),Gt=z*z-G;if(J===0&&_===0&&K===0&&wt===0)return N;b=Pt.computeRealRoots(J,_,K,wt,Gt);const Rt=b.length;if(Rt===0)return N;for(let Z=0;Z<Rt;++Z){const v=b[Z],A=v*v,et=Math.max(1-A,0),Q=Math.sqrt(et);let St;St=R.CesiumMath.sign(P)===R.CesiumMath.sign(z)?j(P*A+z,U*v,R.CesiumMath.EPSILON12):R.CesiumMath.sign(z)===R.CesiumMath.sign(U*v)?j(P*A,U*v+z,R.CesiumMath.EPSILON12):j(P*A+U*v,z,R.CesiumMath.EPSILON12);const Ot=St*j(I*v,F,R.CesiumMath.EPSILON15);Ot<0?N.push(new t.Cartesian3(m,p*v,p*Q)):Ot>0?N.push(new t.Cartesian3(m,p*v,p*-Q)):Q!==0?(N.push(new t.Cartesian3(m,p*v,p*-Q)),N.push(new t.Cartesian3(m,p*v,p*Q)),++Z):N.push(new t.Cartesian3(m,p*v,p*Q))}return N}(x,t.Cartesian3.negate(L,ot),0,0,1);let W,T;const B=E.length;if(B>0){let S=t.Cartesian3.clone(t.Cartesian3.ZERO,Zt),y=Number.NEGATIVE_INFINITY;for(let m=0;m<B;++m){W=t.Matrix3.multiplyByVector(d,t.Matrix3.multiplyByVector(u,E[m],pt),pt);const p=t.Cartesian3.normalize(t.Cartesian3.subtract(W,r,tt),tt),D=t.Cartesian3.dot(p,i);D>y&&(y=D,S=t.Cartesian3.clone(W,S))}const w=a.cartesianToCartographic(S,At);return y=R.CesiumMath.clamp(y,0,1),T=t.Cartesian3.magnitude(t.Cartesian3.subtract(S,r,tt))*Math.sqrt(1-y*y),T=o?-T:T,w.height=T,a.cartographicToCartesian(w,new t.Cartesian3)}};const Dt=new t.Cartesian3;O.lineSegmentPlane=function(e,a,r,i){q.defined(i)||(i=new t.Cartesian3);const o=t.Cartesian3.subtract(a,e,Dt),s=r.normal,n=t.Cartesian3.dot(s,o);if(Math.abs(n)<R.CesiumMath.EPSILON6)return;const C=t.Cartesian3.dot(s,e),M=-(r.distance+C)/n;return M<0||M>1?void 0:(t.Cartesian3.multiplyByScalar(o,M,i),t.Cartesian3.add(e,i,i),i)},O.trianglePlaneIntersection=function(e,a,r,i){const o=i.normal,s=i.distance,n=t.Cartesian3.dot(o,e)+s<0,C=t.Cartesian3.dot(o,a)+s<0,M=t.Cartesian3.dot(o,r)+s<0;let c,u,f=0;if(f+=n?1:0,f+=C?1:0,f+=M?1:0,f!==1&&f!==2||(c=new t.Cartesian3,u=new t.Cartesian3),f===1){if(n)return O.lineSegmentPlane(e,a,i,c),O.lineSegmentPlane(e,r,i,u),{positions:[e,a,r,c,u],indices:[0,3,4,1,2,4,1,4,3]};if(C)return O.lineSegmentPlane(a,r,i,c),O.lineSegmentPlane(a,e,i,u),{positions:[e,a,r,c,u],indices:[1,3,4,2,0,4,2,4,3]};if(M)return O.lineSegmentPlane(r,e,i,c),O.lineSegmentPlane(r,a,i,u),{positions:[e,a,r,c,u],indices:[2,3,4,0,1,4,0,4,3]}}else if(f===2){if(!n)return O.lineSegmentPlane(a,e,i,c),O.lineSegmentPlane(r,e,i,u),{positions:[e,a,r,c,u],indices:[1,2,4,1,4,3,0,3,4]};if(!C)return O.lineSegmentPlane(r,a,i,c),O.lineSegmentPlane(e,a,i,u),{positions:[e,a,r,c,u],indices:[2,0,4,2,4,3,1,3,4]};if(!M)return O.lineSegmentPlane(e,r,i,c),O.lineSegmentPlane(a,r,i,u),{positions:[e,a,r,c,u],indices:[0,1,4,0,4,3,2,3,4]}}};var Ft=O;ct.IntersectionTests=Ft,ct.Ray=H});
